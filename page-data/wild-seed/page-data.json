{"componentChunkName":"component---src-templates-blog-template-js","path":"/wild-seed/","result":{"data":{"cur":{"id":"0f626f47-1e74-54b0-85f7-27ca17a6b8b0","html":"<p>야생 학습을 하면 자연스레 지식이 실전을 뒤따르게 된다. 우테코에서 처음 제대로 경험한 야생 학습은 낯설었으나 <em>너무 잘</em> 적응한 탓인지 어느 순간 당장 쓰이지 않을 지식을 공부하는 게 마땅찮았다.<br>\n당장 터지는 테스트를 고치고 싶을 뿐인데 왜 <code class=\"language-text\">Configuration</code>을 알아야 하지? 이걸 쓸 때가 있을까? 좋게 말하면 야생, 나쁘게 말하면 땜빵 마인드로, 그래도 연계되는 지식을 우겨넣고는 있었다. 언젠가는 쓸모가 있겠지 하고.  <!--more-->\n이런 <em>알지만 알지 못하는 죽은 지식</em>이 레벨3 프로젝트를 하다 <em>죽은 줄 알았지만 다 때가 있구나!</em> 로 바뀌는 순간을 겪었다.</p>\n<h2 id=\"bean은-외부-라이브러리를-등록하고\" style=\"position:relative;\"><a href=\"#bean%EC%9D%80-%EC%99%B8%EB%B6%80-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%EB%A5%BC-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B3%A0\" aria-label=\"bean은 외부 라이브러리를 등록하고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Bean은 외부 라이브러리를 등록하고…</h2>\n<p>나에겐 <code class=\"language-text\">@Bean</code>이 <em>알지만 알지 못하는 죽은 지식</em>이었다.\n<a href=\"https://hyewoncc.github.io/2022/04/25/spring-study-1.html#bean%EA%B3%BC-component%EC%9D%98-%EC%B0%A8%EC%9D%B4\">@Bean과 @Component의 차이</a> 포스팅을 쓰기도 했고, <code class=\"language-text\">@Bean</code>의 쓰임새가 뭐냐고 하면 줄줄 얘기할 수 있었다. <em>개발자가 직접 제어할 수 없는 외부 라이브러리 클래스를 빈에 등록할 때 사용됩니다.</em> 하고. 그런데 좀처럼 <code class=\"language-text\">@Bean</code>을 사용할 일이 없었다.</p>\n<p>그러다 레벨3 프로젝트인 줍줍에서 슬랙 api를 자바 라이브러리를 통해 호출하게 되었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">MethodsClient</span> slackClient <span class=\"token operator\">=</span> <span class=\"token class-name\">Slack</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">methods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">ConversationsInfoResponse</span> response <span class=\"token operator\">=</span> slackClient<span class=\"token punctuation\">.</span><span class=\"token function\">conversationsInfo</span><span class=\"token punctuation\">(</span>\n    request <span class=\"token operator\">-></span> request<span class=\"token punctuation\">.</span><span class=\"token function\">token</span><span class=\"token punctuation\">(</span>slackBotToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>해당 코드를 살펴보자. 우선 <code class=\"language-text\">Slack.getInstance()</code>부분이다. <code class=\"language-text\">getInstance()</code>라는 정적 팩토리 메서드 명에서 추측 가능하듯이 <code class=\"language-text\">Slack</code>의 싱글턴 객체를 얻게 된다. <code class=\"language-text\">methods()</code>는 <code class=\"language-text\">MethodsClient</code>라는 api 호출용 인스턴스를 반환한다. 이 <code class=\"language-text\">methods()</code>안에서는 http 요청을 보낼 때 필요값을 설정하는 작업이 일어난다.</p>\n<p>얻게 되는 최종 인스턴스는 <code class=\"language-text\">MethodsClientImpl</code>이라는 <code class=\"language-text\">MethodsClient</code>의 구현체이다. 변경되는 상태값이 없는데다 여러 객체에서 이 인스턴스를 이용해 슬랙 api를 호출한다. 따라서 필요한 곳에서 중복 생성하기 보다 싱글턴 스프링 빈으로 만들어 관리하고 주입하는게 좋을 것 같았다. 그런데 이걸 어떻게 빈으로 만들까? 생각하다가 <em>바로 이 때 <code class=\"language-text\">@Bean</code>을 쓰는 거구나!</em> 하는 깨달음이 왔다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SlackConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MethodsClient</span> <span class=\"token function\">methodsClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Slack</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">methods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그리고 이렇게 생성한 빈을 해당 객체를 사용하는 곳에서 주입받게 개선했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberInitializer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MethodsClient</span> slackClient<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MemberRepository</span> memberRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MemberInitializer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MethodsClient</span> slackClient<span class=\"token punctuation\">,</span> <span class=\"token class-name\">MemberRepository</span> memberRepository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>slackClient <span class=\"token operator\">=</span> slackClient<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>memberRepository <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<br>\n<h2 id=\"야생-적응-완료-기념비\" style=\"position:relative;\"><a href=\"#%EC%95%BC%EC%83%9D-%EC%A0%81%EC%9D%91-%EC%99%84%EB%A3%8C-%EA%B8%B0%EB%85%90%EB%B9%84\" aria-label=\"야생 적응 완료 기념비 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>야생 적응 완료 기념비</h2>\n<p>어찌보면 그냥 <em><code class=\"language-text\">@Bean</code>을 사용했다</em> 로 요약할 수 있는 하찮은 내용을 굳이 회고 포스팅으로 남긴 두 가지 이유가 있다. 먼저 이 일을 통해 내가 완전히 야생 학습에 적응했다는 것을 기념하고 싶어서다.</p>\n<p><a href=\"https://github.com/hyewoncc/woowa-writing-4/blob/hyewoncc/level2.md\">우테코 레벨2 글쓰기 미션</a>에서 야생 학습이 익숙하지 않았음을 얘기했었다. 주어진 인터넷 강의를 차례로 들으며 따라 치는게 익숙했었고, 책을 목차대로 읽는게 마음 편했다. 그런데 이번 일로 야생에서 익히지 않은, 그러니까 실전과 일치하지 않는 지식은 사실 나에게 <em>진짜</em> 와닿은 지식이 아니었음을 실감했다. 우테코에 와서 바뀐 나의 학습 모습이 스스로도 놀랍다.</p>\n<p>두번째로, 다람쥐가 묻어두고 잊어버린 도토리처럼 죽은 줄 알았던 지식이 우연히 실전이라는 비를 만나 싹틔우는 짜릿함에 눈뜬 것을 기념하기 위함이다. 부끄럽지만 깊은 학습을 해야 한다고 되뇌이면서도, 야생 학습이라는 핑계로 늘 빠져나갈 궁리를 했던 것 같다. 그런데 <code class=\"language-text\">@Bean</code>이라는 복선이 회수되는 순간 진심으로 <code class=\"language-text\">와... 이걸 위해 공부했구나!</code> 싶어 정말 기뻤다. 야생 학습과 모순되는 말이겠지만 이 즐거움을 더 느끼고 싶어서라도 지식을 더 더 많이, 미리 확장시켜 둬야겠다 생각했다.</p>\n<p>하여간 <code class=\"language-text\">@Bean</code>하나 적절히 쓴 걸로 유난이다 싶을 수도 있겠지만… 이 일이 있어 더 열심히 할 수 있을 것 같다. 또 다시 <em>얻어 걸리기</em> 위해서.  레벨3, 진~짜 힘들지만 재밌다.</p>\n<br>  \n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#bean%EC%9D%80-%EC%99%B8%EB%B6%80-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%EB%A5%BC-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B3%A0\">@Bean은 외부 라이브러리를 등록하고…</a></li>\n<li><a href=\"#%EC%95%BC%EC%83%9D-%EC%A0%81%EC%9D%91-%EC%99%84%EB%A3%8C-%EA%B8%B0%EB%85%90%EB%B9%84\">야생 적응 완료 기념비</a></li>\n</ul>\n</div>","excerpt":"야생 학습을 하면 자연스레 지식이 실전을 뒤따르게 된다. 우테코에서 처음 제대로 경험한 야생 학습은 낯설었으나 너무 잘 적응한 탓인지 어느 순간 당장 쓰이지 않을 지식을 공부하는 게 마땅찮았다. 당장 터지는 테스트를 고치고 싶을 뿐인데 왜 을 알아야 하지? 이걸 쓸 때가 있을까? 좋게 말하면 야생, 나쁘게 말하면 땜빵 마인드로, 그래도 연계되는 지식을 우겨넣고는 있었다. 언젠가는 쓸모가 있겠지 하고.  \n이런 알지만 알지 못하는 죽은 지식이 레벨3 프로젝트를 하다 죽은 줄 알았지만 다 때가 있구나! 로 바뀌는 순간을 겪었다. @Bean은 외부 라이브러리를 등록하고… 나에겐 이 알지만 알지 못하는 죽은 지식이었다.\n@Bean과 @Component의 차이 포스팅을 쓰기도 했고, 의 쓰임새가 뭐냐고 하면 줄줄 얘기할 수 있었다. 개발자가 직접 제어할 수 없는 외부 라이브러리 클래스를 빈에 등록할 때 사용됩니다. 하고. 그런데 좀처럼 을 사용할 일이 없었다. 그러다 레벨3 프로젝트인 줍줍…","frontmatter":{"date":"August 02, 2022","title":"야생에서 사과씨 심기 (@Bean)","categories":"Spring 회고 우아한테크코스","author":"써머","emoji":"headers/wild-seed.png"},"fields":{"slug":"/wild-seed/"}},"next":{"id":"c364f0ce-17f7-5b0f-985a-9cf1832a534c","html":"<h2 id=\"슬랙이-봇을-강퇴시켰어요\" style=\"position:relative;\"><a href=\"#%EC%8A%AC%EB%9E%99%EC%9D%B4-%EB%B4%87%EC%9D%84-%EA%B0%95%ED%87%B4%EC%8B%9C%EC%BC%B0%EC%96%B4%EC%9A%94\" aria-label=\"슬랙이 봇을 강퇴시켰어요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>슬랙이 봇을 강퇴시켰어요</h2>\n<p>서버에서 슬랙 API를 호출하려면 발급받은 봇 토큰이 필요하다. 해당 정보를 기밀이라고 생각하지 않았는데…</p>\n<ol>\n<li>애초에 봇에게 호출할 수 있는 API 제한이 있다</li>\n<li>연결된 워크스페이스가 개발을 위해 생성된 줍줍 팀 워크스페이스다</li>\n</ol>\n<p>라는 이유에서였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABSUlEQVR42p1SXW+DMBDj//+47WF9rErSiq6FECB8hRDw5Fth1aRp2k6yQkji8/kuiTFiGAb0fY8QAhjruv4Z27tkHEcc3g54fXlFWZb4b2zEybIsqKoK1lo455DnOe73O0xhUBSF7G1p5ZswxsBw7zxs3cg5322RsNzT6YTj8QitNVSqQNXMRjsIJuU6z/MDEXNcMMu/IOfbWeK9h9Ia5/NZSNM0FSUsn6rruhZV0zR9L/Lnkoe+w+TH/VKMn4rYqLZt5fs3//aSKf/d1LgWFUo3IMxxv0R1VNq6dp+E57XrOknGuyyX4pK4rKj6CbabYFoPH74Ib7cbLpeL2EBopZFlmdhDr6/ZdVdGctoihG6YBL0PZBIyZmO5nACuVPsM+ts0jTSQMYeHQnaraEbkzYiq87sfPOT4KKVEHRvD8SAJsSVh+Qzu2eAPtOkHTBYyoXwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bot scopes\"\n        title=\"\"\n        src=\"/static/5f6a98a9050130e45c6238b44da2370d/37523/scopes.png\"\n        srcset=\"/static/5f6a98a9050130e45c6238b44da2370d/e9ff0/scopes.png 180w,\n/static/5f6a98a9050130e45c6238b44da2370d/f21e7/scopes.png 360w,\n/static/5f6a98a9050130e45c6238b44da2370d/37523/scopes.png 720w,\n/static/5f6a98a9050130e45c6238b44da2370d/302a4/scopes.png 1080w,\n/static/5f6a98a9050130e45c6238b44da2370d/c45c7/scopes.png 1346w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div style=\"text-align:center; font-style:italic; color:grey;\">\n  슬랙에서 scopes 라는 명칭으로 봇에게 api별 호출 권한을 설정 가능하다\n</div>\n<p>그래서 깃헙에 <code class=\"language-text\">bot-token</code>을 포함한 <code class=\"language-text\">yml</code>을 올려놨는데… <strong>어느날 API 응답이 오지 않았다.</strong> 개발자 도구의 응답에는 <code class=\"language-text\">Expired Token</code>이라는 에러 문구가 떴고, 분명 워크스페이스에 정상 추가했던 봇이 사라져 있었다. <!--more--> <strong>슬랙이 봇을 강제 추방</strong>시킨 것이었다…</p>\n<p>얼마간 잘 썼기에, 일정 주기로 공개 저장소들을 크롤링 해 한번에 정지시키는 게 아닐까 싶다.</p>\n<br/>\n<h3 id=\"설명서를-잘-읽자\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EB%AA%85%EC%84%9C%EB%A5%BC-%EC%9E%98-%EC%9D%BD%EC%9E%90\" aria-label=\"설명서를 잘 읽자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설명서를 잘 읽자</h3>\n<p>슬랙 API에 들어가면 <code class=\"language-text\">토큰을 공개적인 버전 컨트롤에 올리지 말라</code>가 떡하니 명시되어 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAl0lEQVR42m2P4QrDMAiE+/5PuiR6Jm26jjZwQ7MOBvvxcWr0jiwiwlIKVTXUe8d75997zjkAQJU5h4IpJS5xKEozi6EvRe36AaqzNoSxH4YJ5r7PPMDDwvA2cWMpMk2sEtaoqIHAiLqytZXbtn3Z9z20tcbjOLjcaff3PElVmLUyWWe2Hlpq5wOd/fniGBev65fzPDnG4BsqAy+0y+a0zAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack warning\"\n        title=\"\"\n        src=\"/static/16366b208f74e43a27f1ecc9b709e4bf/37523/slack_warning.png\"\n        srcset=\"/static/16366b208f74e43a27f1ecc9b709e4bf/e9ff0/slack_warning.png 180w,\n/static/16366b208f74e43a27f1ecc9b709e4bf/f21e7/slack_warning.png 360w,\n/static/16366b208f74e43a27f1ecc9b709e4bf/37523/slack_warning.png 720w,\n/static/16366b208f74e43a27f1ecc9b709e4bf/302a4/slack_warning.png 1080w,\n/static/16366b208f74e43a27f1ecc9b709e4bf/07a9c/slack_warning.png 1440w,\n/static/16366b208f74e43a27f1ecc9b709e4bf/891d5/slack_warning.png 1520w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>봇 토큰에는 큰 권한이 있습니다. 토큰은 사용자가 앱을 설치함으로써 권한을 부여했음을 나타냅니다. 앱을 설치한 유저가 준 신뢰를 해치지 않도록 토큰을 안전하게, 기밀로 보관하세요.<br>\n<strong>최소한 공개적인 형상관리에 토큰을 올리지 마세요.</strong> 환경 변수를 통해 사용하시길 바랍니다. 더 많은 정보는 저희가 제공하는 <a href=\"https://api.slack.com/authentication/best-practices\">앱 보안을 위한 지침</a>을 참고하세요.</p>\n</blockquote>\n<p>하지만 직접 정지시킬 줄은 몰랐다. 깃헙에 올라간 상태로 꽤 오래 쓰고 있었기 때문에 더 그랬다.<br>\n변명을 하자면 테스트용 팀 워크스페이스를 사용하고 있었고, 실서비스라면 절대 그러지 않았을 것이다. 그럼에도 보안에 너무 소홀했던 것 같다. 슬랙의 안내를 읽고 나니 앱을 설치함으로써 우리를 신뢰할 미래의 사용자에게 큰 잘못이 맞았다.</p>\n<br/>\n<h2 id=\"서브모듈-도입기\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B8%8C%EB%AA%A8%EB%93%88-%EB%8F%84%EC%9E%85%EA%B8%B0\" aria-label=\"서브모듈 도입기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서브모듈 도입기</h2>\n<h3 id=\"yaml-밀거래\" style=\"position:relative;\"><a href=\"#yaml-%EB%B0%80%EA%B1%B0%EB%9E%98\" aria-label=\"yaml 밀거래 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>yaml 밀거래</h3>\n<p>봇 정지를 당하고 <code class=\"language-text\">application.yml</code> 설정파일을 깃헙에서 내렸다. 그리고 <code class=\"language-text\">yml</code>파일을 팀 워크스페이스에서 밀거래(?)했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACAUlEQVR42p1Uy24aQRDcT+KIEJeYGxKPH+AX+A7uDnD0X8RIcEOA5D3EQiIgYTCKw8OGfbHL7rI8Kqq2BhkrJCItFTP0zNR0d/WsZlkWRk9PGI1G6Pf7GA6HGI/HOBwOoB2Px3+Cxv1RFEFbvL3i5/QXNpsNbNuG4zhYr9cyD8MQH42HefBv0BzPxctiLiRBEMLzPLlpu91it9vBdV1Mp1MB13hov9+foIg4lwh3PByEMM0VHNuUqLhBpcP/KnJecilK+oWQP7TlfIiX5y48byMkQRAISMI9hPJzVHOWSmV1IiS7ZTv40euhUCggnU4jl8shm80KMpnMaU7k83mkUimUSiWJjuXixUxbY51w3MNbG1gsXqHrD2i1Wmi32xfR6XTQbDYxGAyERJXCMAxo22gHHCLsQgu+H+BaU+LQJpMJNNZiuVxhZdhSP/YlfUppjsyCUD4F+pQoJ0JuosMyZoJrTV3ClNkNJ5Xf5mMMejq+3d+jXq+j0WjI+CdwrVarQdd1+L4vKp+JQnbX8/H42MXNzRfE43EkEomLSCaTiMViKBaLQsTWOWub93fImkRXpaver6ozyUWU1YqimHDdjbwIJYAS4zPU2scPBMmF8D3CI2xjBsec/Zcgqn7nT2/xjO73Nm5vv6JSqaBarcr4GfSXy2Xc3d3BNE15fvyAqDb6DeJak7Y2KkhGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"yml trafficking\"\n        title=\"\"\n        src=\"/static/7a5d781111bde075323f0f53981f4c18/37523/yml.png\"\n        srcset=\"/static/7a5d781111bde075323f0f53981f4c18/e9ff0/yml.png 180w,\n/static/7a5d781111bde075323f0f53981f4c18/f21e7/yml.png 360w,\n/static/7a5d781111bde075323f0f53981f4c18/37523/yml.png 720w,\n/static/7a5d781111bde075323f0f53981f4c18/302a4/yml.png 1080w,\n/static/7a5d781111bde075323f0f53981f4c18/a6ec4/yml.png 1438w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div style=\"text-align:center; font-style:italic; color:grey;\">\n  yaml 밀거래의 현장. 설정이 바뀔 때 마다 밀거래가 발생했다.\n</div>\n<p>언제까지고 이렇게 할 수는 없을 뿐 더러, <code class=\"language-text\">배포 자동화</code>를 앞두고 있었기에 이를 해결해야만 했다.</p>\n<br/>\n<h3 id=\"서브모듈-등록\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B8%8C%EB%AA%A8%EB%93%88-%EB%93%B1%EB%A1%9D\" aria-label=\"서브모듈 등록 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서브모듈 등록</h3>\n<ol>\n<li>개발 중이라 설정이 완전히 고정되지 않았다</li>\n<li>팀원 누구나 접근해서 수정할 수 있어야 한다</li>\n<li>배포 자동화 시 최대한 관리가 편해야 한다</li>\n</ol>\n<p>이 세 가지를 고려해 <code class=\"language-text\">서브모듈</code> 사용을 제안했고 받아들여졌다. 연로그가 백엔드 팀원들을 모두 초대한 <code class=\"language-text\">organization</code>을 만들고 <code class=\"language-text\">private</code> 레포지토리를 개설했다. 여기에 <code class=\"language-text\">application.yml</code>을 올리고, 기존 프로젝트에 서브모듈을 추가했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> submodule <span class=\"token function\">add</span> <span class=\"token operator\">&lt;</span>private repository 주소<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>추가할 모듈명<span class=\"token operator\">></span></code></pre></div>\n<p>추가하면 폴더와 파일이 생기는데, 깃에는 내용을 제외한 폴더만 감지된다. 그리고 최상단에 경로에 서브모듈 경로 정보를 담은 <code class=\"language-text\">.gitmodules</code> 파일이 생성된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[submodule \"backend/src/main/resources/security\"]\n\tpath = backend/src/main/resources/security\n\turl = https://github.com/2022-pickpick/security.git</code></pre></div>\n<p>우리 팀은 <code class=\"language-text\">security</code>란 이름으로 서브모듈을 추가했다. 이 상태로 <code class=\"language-text\">push</code>하면 서브모둘이 <code class=\"language-text\">github</code>에 추가된 것을 볼 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAo0lEQVR42o2Q22rDMBBE/f/fWEoLdVzFwZKty2plySfILSE0Lx04DOy8zOwgubD5gJeK2Rq30LCxsUnDS8OtHmctx3HwHw3jeOHt/YNpXvgyC5+j4Xu2XMyN6bowmZnx6liDIFroBR7oK8PqHB1VRXMmxoRkJUkmJTldtKKlstf2S6Xs/ba/MPgCXsHGes78qz41ify8JURCCKxRKbX18MyfuQNhFTd2XqgNkwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"submodule in github\"\n        title=\"\"\n        src=\"/static/7473e109db6825064794d4033bfc703a/37523/submodule.png\"\n        srcset=\"/static/7473e109db6825064794d4033bfc703a/e9ff0/submodule.png 180w,\n/static/7473e109db6825064794d4033bfc703a/f21e7/submodule.png 360w,\n/static/7473e109db6825064794d4033bfc703a/37523/submodule.png 720w,\n/static/7473e109db6825064794d4033bfc703a/302a4/submodule.png 1080w,\n/static/7473e109db6825064794d4033bfc703a/07a9c/submodule.png 1440w,\n/static/7473e109db6825064794d4033bfc703a/cb1ac/submodule.png 1936w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>접근 권한이 있는 상태로 모듈을 클릭하면 해당 private 레포로 이동한다. 하지만 권한이 없는 상태로 모듈을 클릭할 시, <code class=\"language-text\">404 에러 페이지</code>가 뜬다.</p>\n<br/>\n<h3 id=\"-젠킨스-배포\" style=\"position:relative;\"><a href=\"#-%EC%A0%A0%ED%82%A8%EC%8A%A4-%EB%B0%B0%ED%8F%AC\" aria-label=\" 젠킨스 배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>+ 젠킨스 배포</h3>\n<p>이 후 젠킨스를 통한 빌드 및 배포 자동화가 이뤄졌다. 젠킨스에서는 깃헙 계정에서 발급한 토큰을 <code class=\"language-text\">credentianl</code>에 등록해 서브모듈의 접근 권한을 줄 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAApklEQVR42qWPWQ6DMAxEuf9V+OM+CASU0KYCskHY8qqkQup/LY1lecZjO2vblrIsqeua67r4NzKtNfM8M00Ty+I4joN933HOsa5rqrdtS8tCCImP/Yhb+4tkqJRCyje9GJKRtZam7Xi+JN57hBBUVUXXdRhjeEnJox/QxibtjchlMU3jiLYL1od0BQT0crJuZ3qjaRryPKcoCrRWnAFGs+P8l48zNz6G/DStpSYesQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jenkins credential\"\n        title=\"\"\n        src=\"/static/f2c65f119b81122d0e7ba1b1f35291d4/37523/credential.png\"\n        srcset=\"/static/f2c65f119b81122d0e7ba1b1f35291d4/e9ff0/credential.png 180w,\n/static/f2c65f119b81122d0e7ba1b1f35291d4/f21e7/credential.png 360w,\n/static/f2c65f119b81122d0e7ba1b1f35291d4/37523/credential.png 720w,\n/static/f2c65f119b81122d0e7ba1b1f35291d4/302a4/credential.png 1080w,\n/static/f2c65f119b81122d0e7ba1b1f35291d4/07a9c/credential.png 1440w,\n/static/f2c65f119b81122d0e7ba1b1f35291d4/5e703/credential.png 1942w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>젠킨스 credential 깃헙 권한 등록 때 도움을 받은 포스트 - <a href=\"https://velog.io/@zzarbttoo/JenkinsGit-%EC%97%B0%EB%8F%99%ED%95%98%EA%B8%B0Git-Token-%EB%B0%9C%EA%B8%89-Jenkins-Credential-%EB%93%B1%EB%A1%9D\">[Jenkins]Git 연동하기(Git Token 발급 + Jenkins Credential 등록)</a></p>\n<p>권한을 주지 않고 테스트 또는 빌드를 진행할 시, 설정값을 불러오지 못해 시행되지 않는다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABBklEQVR42p2QQY+DIBSE/f//rNkee922ohZBsGhVrKDfBprsaU87CXnDMG94eUXXdQghsNaScBwH/0XqLd7vN8uykGoS0okxsq4rIYTMU933PXuSnngIMddt2/DeZ09C8ddPz2fP5XKhbVucc1yvV/zqsdagtc5B8zwRY2AYBpqm4fV6fQLTRCFsWUhmYwxKG4SoaKWkt30Otrbn8WiRUmZeS4PUPUopynv5u7LCTSuqM5zPZ/pnn8dXo0K4G81YoZcWNUvUJKlcSeXu+d6MDXKS1IPgZr/RY/sJTDsanePrdMIvcxbt2tF4gfQNNmrsruk2hfQ1D19hgsJGld+Sp55LjNdwwA+TCsyt8lJ4QAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build success\"\n        title=\"\"\n        src=\"/static/e6a2644d6ef47d5c9dee94fc949086da/37523/success.png\"\n        srcset=\"/static/e6a2644d6ef47d5c9dee94fc949086da/e9ff0/success.png 180w,\n/static/e6a2644d6ef47d5c9dee94fc949086da/f21e7/success.png 360w,\n/static/e6a2644d6ef47d5c9dee94fc949086da/37523/success.png 720w,\n/static/e6a2644d6ef47d5c9dee94fc949086da/302a4/success.png 1080w,\n/static/e6a2644d6ef47d5c9dee94fc949086da/07a9c/success.png 1440w,\n/static/e6a2644d6ef47d5c9dee94fc949086da/cb1ac/success.png 1936w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">credential</code> 등록 후 서브모듈이 포함된 프로젝트가 성공적으로 빌드되는 것을 볼 수 있다.</p>\n<br/>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%8A%AC%EB%9E%99%EC%9D%B4-%EB%B4%87%EC%9D%84-%EA%B0%95%ED%87%B4%EC%8B%9C%EC%BC%B0%EC%96%B4%EC%9A%94\">슬랙이 봇을 강퇴시켰어요</a></p>\n<ul>\n<li><a href=\"#%EC%84%A4%EB%AA%85%EC%84%9C%EB%A5%BC-%EC%9E%98-%EC%9D%BD%EC%9E%90\">설명서를 잘 읽자</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%84%9C%EB%B8%8C%EB%AA%A8%EB%93%88-%EB%8F%84%EC%9E%85%EA%B8%B0\">서브모듈 도입기</a></p>\n<ul>\n<li><a href=\"#yaml-%EB%B0%80%EA%B1%B0%EB%9E%98\">yaml 밀거래</a></li>\n<li><a href=\"#%EC%84%9C%EB%B8%8C%EB%AA%A8%EB%93%88-%EB%93%B1%EB%A1%9D\">서브모듈 등록</a></li>\n<li><a href=\"#-%EC%A0%A0%ED%82%A8%EC%8A%A4-%EB%B0%B0%ED%8F%AC\">+ 젠킨스 배포</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"July 25, 2022","title":"[git] 슬랙한테 봇 강퇴당하고 서브모듈 도입한 이야기","categories":"etc 트러블슈팅","author":"써머","emoji":"headers/git-submodule.png"},"fields":{"slug":"/git-submodule/"}},"prev":{"id":"03c0fc33-5407-5104-919a-147585babc6a","html":"<h2 id=\"문제상황\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9\" aria-label=\"문제상황 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제상황</h2>\n<p><a href=\"https://github.com/woowacourse/jwp-qna\">우테코 QNA 미션</a>에서 상수로 선언된 엔티티 픽스쳐가 있었다. 레벨3 같은 팀 크루인 봄이 해당 미션을 진행하다 테스트가 터져 어쩌다보니 같이 원인을 찾게 되었다. 상황을 비슷하게 복구해보자면 이런 구성이었다.  <!--more--></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BlogServiceTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">BlogService</span> blogService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">User</span> <span class=\"token constant\">USER_A</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"새로운 회원 저장 후 포스트 저장 1\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">saveUser_savePost1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        blogService<span class=\"token punctuation\">.</span><span class=\"token function\">saveUser</span><span class=\"token punctuation\">(</span><span class=\"token constant\">USER_A</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        blogService<span class=\"token punctuation\">.</span><span class=\"token function\">savePost</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"포스팅1\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">USER_A</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"새로운 회원 저장 후 포스트 저장 2\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">saveUser_savePost2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        blogService<span class=\"token punctuation\">.</span><span class=\"token function\">saveUser</span><span class=\"token punctuation\">(</span><span class=\"token constant\">USER_A</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        blogService<span class=\"token punctuation\">.</span><span class=\"token function\">savePost</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"포스팅2\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">USER_A</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>원본 미션 코드에서는 픽스쳐가 <code class=\"language-text\">public static final</code>로 별도 클래스에 선언되어 있었다. 그런데 테스트 클래스 하나에서만 사용되고 있어서 해당 클래스로 옮겼던 것 같다. 나도 픽스쳐를 옮겼다가, 평소 쓰는 방식대로 한다고 지웠었다.</p>\n<p>어쨌든 <code class=\"language-text\">User</code>와 <code class=\"language-text\">Post</code>는 <code class=\"language-text\">Post -> User</code>의 단방향 연관관계였고, <code class=\"language-text\">BlogService</code>는 <code class=\"language-text\">UserRepository, PostRepository</code>를 통해 저장해주는 상태였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Post</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>length <span class=\"token operator\">=</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> contents<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> writer<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그러다 테스트가 터지며 의문의 에러메시지를 마주했다.</p>\n<blockquote>\n<p>org.springframework.dao.DataIntegrityViolationException: could not execute statement; SQL [n/a]; constraint [FK83S99F4KX8OIQM3RO0SASMPWW]; nested exception is org.hibernate.exception.ConstraintViolationException: could not execute statement</p>\n</blockquote>\n<p>좀 더 내려보니 <code class=\"language-text\">insert</code> 수행이 안 되는 상황이었다.</p>\n<blockquote>\n<p>Caused by: org.h2.jdbc.JdbcSQLIntegrityConstraintViolationException: Referential integrity constraint violation: “FK83S99F4KX8OIQM3RO0SASMPWW: PUBLIC.POST FOREIGN KEY(USERS_ID) REFERENCES PUBLIC.USERS(ID) (CAST(1 AS BIGINT))”; SQL statement:\ninsert into post (id, contents, user_id) values (default, ?, ?) [23506-214]</p>\n</blockquote>\n<p>무언가 <em><strong>외래키가 없어서 post에 insert가 안 되는 상황인가…?</strong></em> 하는 추측은 했지만 이유를 알 수가 없었다. 분명히 <code class=\"language-text\">@Transactional</code>로 변경을 롤백한 후에, <code class=\"language-text\">saveUser()</code>를 통해 <code class=\"language-text\">USER_A</code>를 저장해줬기 때문이다.</p>\n<br>\n<h3 id=\"추측-1persist와-merge-실행-차이\" style=\"position:relative;\"><a href=\"#%EC%B6%94%EC%B8%A1-1persist%EC%99%80-merge-%EC%8B%A4%ED%96%89-%EC%B0%A8%EC%9D%B4\" aria-label=\"추측 1persist와 merge 실행 차이 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>추측 1.persist()와 merge() 실행 차이?</h3>\n<p><code class=\"language-text\">Post</code>를 저장하는데 외래키가 없는 게 맞다면 <code class=\"language-text\">User</code>를 저장할 때 문제가 생기는 것이라 추측했다. 그래서 디버거를 찍으며 따라가다 보니 <code class=\"language-text\">SimpleJpaRepository</code>라는 클래스의 <code class=\"language-text\">save()</code> 메서드에 도착했다. 여기서 **먼저 실행돼 통과하는 테스트는 persist()**를, **나중에 실행돼 실패하는 테스트는 merge()**를 호출하고 있음을 확인했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAxUlEQVR42mXMWW6DMABFUZYSMTnYeLYDVasmIVlCVAHd/zpuBZHSSv04evfrFS5EvFF4p0muxzpDDBYfE9pajNEMXuBtRyfVP1L9UkpRhJDQvSaFzCm/c8pvpJhJKeG9w1qDcdtaoul2QT9tbbYjqejVUzGEQBQ1H7Jlip7PEBhVR+4ESTTEpiK1NamtGMSB8a/jgdSUhKYk7iqKPJ5pLjP69oWZHsj7N/K+0F5nxLQgbyvtddn7OK2IaaU8Ly/VZX6pLzM/Fo9+uwwods4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"call merge\"\n        title=\"\"\n        src=\"/static/26745027aaab5f8593b368764fd9910f/37523/merge.png\"\n        srcset=\"/static/26745027aaab5f8593b368764fd9910f/e9ff0/merge.png 180w,\n/static/26745027aaab5f8593b368764fd9910f/f21e7/merge.png 360w,\n/static/26745027aaab5f8593b368764fd9910f/37523/merge.png 720w,\n/static/26745027aaab5f8593b368764fd9910f/302a4/merge.png 1080w,\n/static/26745027aaab5f8593b368764fd9910f/07a9c/merge.png 1440w,\n/static/26745027aaab5f8593b368764fd9910f/e04e6/merge.png 2152w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그래서 실제로 저장된 적 없는 데이터인데 <code class=\"language-text\">merge()</code>로 처리되어서 들어가지 않는건가? 생각했다. 그런데 <code class=\"language-text\">show_sql</code>을 설정해 콘솔에서 sql문을 보니 <code class=\"language-text\">insert</code>가 실행되고 있었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABGUlEQVR42lWRyW7DMBBD/TmR7GjfbMtL3AJFkFPPRX+k/XgWM4lT5zAQIBJPQ6q5fv3g4/sXsV+RU4QQEm3bwljH0ykNlSrebp8o7zc4H9CXAm0MrLVQSkEZA+M8zkqjGZcN47qhOyvEGOC9h3wAtbVs8n1FmTekuuKsFHJKCCHwMJSBjrVmWFYM84IQIkrOMMZASgkhBKQQvG1fJ9T1gmGaWc85I8bIGvukZC+dzbhcMMwrrHUIwbOp6zoeMrRthzJOnKLUGTElht219mVegMZapIeZYlOU3cjAZUM/LfwQbUj6Dt1P0p5A5z13QjCKpbVmw3HDvs73auhTtH7CdiDdMZCGCj2dTv+dHIzHyNY5flg8+j3Gpch/gZnewVcSZKYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sql\"\n        title=\"\"\n        src=\"/static/b80d694fac170b44fb688c4f2237ca6f/37523/sql.png\"\n        srcset=\"/static/b80d694fac170b44fb688c4f2237ca6f/e9ff0/sql.png 180w,\n/static/b80d694fac170b44fb688c4f2237ca6f/f21e7/sql.png 360w,\n/static/b80d694fac170b44fb688c4f2237ca6f/37523/sql.png 720w,\n/static/b80d694fac170b44fb688c4f2237ca6f/302a4/sql.png 1080w,\n/static/b80d694fac170b44fb688c4f2237ca6f/07a9c/sql.png 1440w,\n/static/b80d694fac170b44fb688c4f2237ca6f/0330c/sql.png 2458w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>알아보니 <code class=\"language-text\">merge()</code>는 아래 순서로 엔티티를 처리한다고 한다.</p>\n<ol>\n<li>id 값으로 1차 캐시 조회</li>\n<li>1차 캐시에 없다면 <code class=\"language-text\">select</code>문으로 DB에서 조회 후 있다면 1차 캐시에 저장</li>\n<li>조회 결과 마저 없으면 <code class=\"language-text\">insert</code>를 수행</li>\n</ol>\n<br>\n<h3 id=\"추측-2id값이-달라서\" style=\"position:relative;\"><a href=\"#%EC%B6%94%EC%B8%A1-2id%EA%B0%92%EC%9D%B4-%EB%8B%AC%EB%9D%BC%EC%84%9C\" aria-label=\"추측 2id값이 달라서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>추측 2.id값이 달라서?</h3>\n<p>그럼 대체 왜 저장된 값의 PK가 없다고 하는 것일까?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABSUlEQVR42m3JyXKbQACEYV4lh4hNiNUSwwwDM4NYFJyDH8GyokPe//ynRJxKOfHhq67u9pT4wqnaURQRRR5xSAOSQ0iy94mCr4TBjjj0iYOHHdG7bfvHPgrwpHaoztJoQ9NqyrrjUGkyYSiFpTga4kIQV4r9U7tJjpqoaAhzQZAL/KzexGWNl7/cSec3suc7xXqlWq9k3x/9leN6J7tceXr5uUm+3cief2zS9Ua+3kgub4TzdRMvr3jLZWKaDJ1ukEoiGkHT1EzTxHkccFbSd4q2VUgpkLL5j1J/ec4tTJcZe3ao3qI6Q600dlw243Km7XtkZ37/79oH4z7QdsA7mZFUdOTSUCrDQWgK0SLMRCY60qYnV3bLh+xPyp6ytRTKUmpH2ToqPeBJN9PbmVyPZO2Af+zYnzTSTVg3U/UTuR6IhSU49R/4n/gFgq3sgfClNjsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ids\"\n        title=\"\"\n        src=\"/static/2508e47d6c3e3a11b8f2338a3974a28f/37523/different_ids.png\"\n        srcset=\"/static/2508e47d6c3e3a11b8f2338a3974a28f/e9ff0/different_ids.png 180w,\n/static/2508e47d6c3e3a11b8f2338a3974a28f/f21e7/different_ids.png 360w,\n/static/2508e47d6c3e3a11b8f2338a3974a28f/37523/different_ids.png 720w,\n/static/2508e47d6c3e3a11b8f2338a3974a28f/302a4/different_ids.png 1080w,\n/static/2508e47d6c3e3a11b8f2338a3974a28f/07a9c/different_ids.png 1440w,\n/static/2508e47d6c3e3a11b8f2338a3974a28f/ec5f6/different_ids.png 1852w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>디버거를 통해 찍어보니, 저장 된 뒤의 id는 <code class=\"language-text\">2L</code>인데 static 픽스쳐의 id는 <code class=\"language-text\">1L</code>이었다. FK로 1L의 값을 넣으니 찾을 수 없어 무결성 제약 조건에 위배되었던 것이다. <code class=\"language-text\">@Transactional</code>로 데이터는 초기화 되었지만, h2에서 id값은 초기화하지 않아서 생긴 문제였다. 생각보다 허망한 이유였다.</p>\n<br>\n<h2 id=\"해결안\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0%EC%95%88\" aria-label=\"해결안 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결안</h2>\n<h3 id=\"1-픽스쳐-공유하지-않기\" style=\"position:relative;\"><a href=\"#1-%ED%94%BD%EC%8A%A4%EC%B3%90-%EA%B3%B5%EC%9C%A0%ED%95%98%EC%A7%80-%EC%95%8A%EA%B8%B0\" aria-label=\"1 픽스쳐 공유하지 않기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 픽스쳐 공유하지 않기</h3>\n<p>평소 테스트를 할 때 일회용 인스턴트를 쓰고 버리는(?) 방식을 선호했다.</p>\n<ol>\n<li>테스트 격리를 위해 데이터도 격리한다</li>\n<li>생성되는 데이터를 메서드 내에서 바로 보고싶다</li>\n</ol>\n<p>그래서 같은 데이터를 쓰더라도 다 분리했기에 익숙한 형식으로 바꿨다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"새로운 회원 저장 후 포스트 저장 1\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">saveUser_savePost1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    blogService<span class=\"token punctuation\">.</span><span class=\"token function\">saveUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"포스팅\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    blogService<span class=\"token punctuation\">.</span><span class=\"token function\">savePost</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"새로운 회원 저장 후 포스트 저장 2\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">saveUser_savePost2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    blogService<span class=\"token punctuation\">.</span><span class=\"token function\">saveUser</span><span class=\"token punctuation\">(</span>useer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"포스팅\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    blogService<span class=\"token punctuation\">.</span><span class=\"token function\">savePost</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>솔직히 테스트 픽스쳐를 공유해서 쓰다가 실제로 문제를 마주쳐 봐서 이렇게 한 것은 아니었고… <a href=\"https://jojoldu.tistory.com/611\">테스트 픽스처 올바르게 사용하기 by.향로</a> 이 포스팅을 읽었어서가 크다. 어쨌든 상수 픽스쳐를 사용한 건 처음이었다.</p>\n<br>  \n<h3 id=\"2-generatedvalue-떼기\" style=\"position:relative;\"><a href=\"#2-generatedvalue-%EB%96%BC%EA%B8%B0\" aria-label=\"2 generatedvalue 떼기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. @GeneratedValue 떼기</h3>\n<p>그럼 <code class=\"language-text\">id</code>를 직접 지정해주면 되지 않을까 싶어서 static 픽스쳐에서 지정해주고 <code class=\"language-text\">@GeneratedValue</code>를 제거했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BlogServiceTest</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Member</span> <span class=\"token constant\">MEMBER_A</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token number\">1L</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이러니 테스트는 통과했지만 사실 이렇게 짤 일은 없다고 생각한다. 그냥 다른 방법으로도 통과시켜 보려고 해본 것이다.</p>\n<br>\n<h2 id=\"그럼-기존-코드는-왜-\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9F%BC-%EA%B8%B0%EC%A1%B4-%EC%BD%94%EB%93%9C%EB%8A%94-%EC%99%9C-\" aria-label=\"그럼 기존 코드는 왜  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그럼 기존 코드는 왜…? 🤔</h2>\n<p>상수 픽스쳐 선언이 근본적으로 좋지 않은 방식이라면 왜 기존 미션 코드에서 사용하고 있었을까?<br>\n<a href=\"https://github.com/woowacourse/jwp-qna/blob/main/src/test/java/qna/service/QnaServiceTest.java\">기존 서비스 테스트 코드</a>를 보면 서비스를 슬라이스 테스트 하고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> delete_성공<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">when</span><span class=\"token punctuation\">(</span>questionRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByIdAndDeletedFalse</span><span class=\"token punctuation\">(</span>question<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">thenReturn</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>question<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">when</span><span class=\"token punctuation\">(</span>answerRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByQuestionIdAndDeletedFalse</span><span class=\"token punctuation\">(</span>question<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">thenReturn</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span>answer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p><code class=\"language-text\">Repository</code>의 메서드를 모두 모킹하고 있기 때문에 <code class=\"language-text\">JPA</code>와 무관한 테스트였다. 따라서 정말 <em>고정된 값</em>으로써의 상수 픽스쳐를 사용해도 괜찮았던 것이다. 이를 통합 테스트로 바꾸면서 생긴 문제였다.</p>\n<p>테스트 간 데이터 격리가 중요하다는 말이 맞는 말이긴 하지만, 이전까진 고정관념처럼 무작정 받아들여 박혀있었다. 그런데 이번 문제를 맞딱드리면서 고정관념이 아닌 <em>진짜 나의 생각</em>이 된 것 같아 좋았다. 어쨌든, 테스트 격리 잘 하자.</p>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9\">문제상황</a></p>\n<ul>\n<li><a href=\"#%EC%B6%94%EC%B8%A1-1persist%EC%99%80-merge-%EC%8B%A4%ED%96%89-%EC%B0%A8%EC%9D%B4\">추측 1.persist()와 merge() 실행 차이?</a></li>\n<li><a href=\"#%EC%B6%94%EC%B8%A1-2id%EA%B0%92%EC%9D%B4-%EB%8B%AC%EB%9D%BC%EC%84%9C\">추측 2.id값이 달라서?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%95%B4%EA%B2%B0%EC%95%88\">해결안</a></p>\n<ul>\n<li><a href=\"#1-%ED%94%BD%EC%8A%A4%EC%B3%90-%EA%B3%B5%EC%9C%A0%ED%95%98%EC%A7%80-%EC%95%8A%EA%B8%B0\">1. 픽스쳐 공유하지 않기</a></li>\n<li><a href=\"#2-generatedvalue-%EB%96%BC%EA%B8%B0\">2. @GeneratedValue 떼기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B7%B8%EB%9F%BC-%EA%B8%B0%EC%A1%B4-%EC%BD%94%EB%93%9C%EB%8A%94-%EC%99%9C-\">그럼 기존 코드는 왜…? 🤔</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"August 13, 2022","title":"[JPA] 상수 픽스쳐 사용 주의","categories":"JPA 트러블슈팅","author":"써머","emoji":"headers/jpa-static-fixture-trouble.png"},"fields":{"slug":"/jpa-static-fixture-trouble/"}},"site":{"siteMetadata":{"siteUrl":"https://hyewoncc.github.io","comments":{"utterances":{"repo":"hyewoncc/hyewoncc.github.io"}}}}},"pageContext":{"slug":"/wild-seed/","nextSlug":"/git-submodule/","prevSlug":"/jpa-static-fixture-trouble/"}},"staticQueryHashes":["1073350324","1956554647","2938748437","3350743975"],"slicesMap":{}}