{"componentChunkName":"component---src-templates-blog-template-js","path":"/collection-beans/","result":{"data":{"cur":{"id":"2e516f8c-d1a4-5c62-9121-7b6703a03f46","html":"<p>해당 포스팅은 <a href=\"https://github.com/woowacourse-teams/2022-pickpick\">줍줍</a> 개발 과정 중 맞딱뜨린 문제점과 답을 찾아가는 과정을 다른 방식으로 재구성한 글이다.<br>\n생각보다 글이 길어진 고로, 문제상황과 해결방안만 보고싶다면</p>\n<ul>\n<li><a href=\"https://hyewoncc.github.io/collection-beans/#%EC%8A%AC%EB%9E%99-rtm%EB%A6%AC%EC%96%BC%ED%83%80%EC%9E%84-%EB%A9%94%EC%8B%9C%EC%A7%80%EC%99%80%EC%9D%98-%EC%82%AC%ED%88%AC\">문제상황</a></li>\n<li><a href=\"https://github.com/hyewoncc/spring-sandbox/tree/spring/collection-beans\">빈 컬렉션 주입을 이용한 해결 예시코드</a></li>\n</ul>\n<p>이 둘을 보기를 권한다.</p>\n<h2 id=\"간단한-게시판-서비스를-상상하기\" style=\"position:relative;\"><a href=\"#%EA%B0%84%EB%8B%A8%ED%95%9C-%EA%B2%8C%EC%8B%9C%ED%8C%90-%EC%84%9C%EB%B9%84%EC%8A%A4%EB%A5%BC-%EC%83%81%EC%83%81%ED%95%98%EA%B8%B0\" aria-label=\"간단한 게시판 서비스를 상상하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>간단한 게시판 서비스를 상상하기</h2>\n<h3 id=\"회원-가입과-탈퇴\" style=\"position:relative;\"><a href=\"#%ED%9A%8C%EC%9B%90-%EA%B0%80%EC%9E%85%EA%B3%BC-%ED%83%88%ED%87%B4\" aria-label=\"회원 가입과 탈퇴 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회원 가입과 탈퇴</h3>\n<p>당신은 지나가던 고양이의 의뢰로 서버를 개발하게 되었다.\n고양이는 🐱 닉네임을 입력하면 가입이 가능하고, 탈퇴할 수 있는 서비스를 만들어 주세요 💬 라고 요구했다.\n그래서 나는 (그리고 이 글을 볼 대부분의 사람들은) 이건 쉽지~ 하고 간단한 컨트롤러를 만들었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/members\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@PostMapping</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> memberService<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">created</span><span class=\"token punctuation\">(</span><span class=\"token constant\">URI</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/members/\"</span> <span class=\"token operator\">+</span> member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@DeleteMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/{id}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">leave</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        memberService<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">noContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"그런데-이제-엔드포인트를-하나로-하고\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9F%B0%EB%8D%B0-%EC%9D%B4%EC%A0%9C-%EC%97%94%EB%93%9C%ED%8F%AC%EC%9D%B8%ED%8A%B8%EB%A5%BC-%ED%95%98%EB%82%98%EB%A1%9C-%ED%95%98%EA%B3%A0\" aria-label=\"그런데 이제 엔드포인트를 하나로 하고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그런데 이제 엔드포인트를 하나로 하고</h3>\n<p>이 코드를 본 고양이가 말했다.<br>\n🐱 엔드포인트를 하나로 통일할래요. 그리고 이게 <strong>회원 가입인지 탈퇴인지</strong>는 <strong>body</strong>안에 쓸게요. 이렇게요. 💬</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span> <span class=\"token comment\">// 회원 가입 시 </span>\n    <span class=\"token property\">\"event\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"join\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cat\"</span>\n<span class=\"token punctuation\">}</span> \n<span class=\"token punctuation\">{</span> <span class=\"token comment\">// 회원 탈퇴 시</span>\n    <span class=\"token property\">\"event\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"leave\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>코드가 이상해지기 시작한다. 그래도 아직 납득 가능한 수준이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/members\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@PostMapping</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">event</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">MemberRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"join\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> memberService<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">created</span><span class=\"token punctuation\">(</span><span class=\"token constant\">URI</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/members/\"</span> <span class=\"token operator\">+</span> member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"leave\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            memberService<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">noContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">internalServerError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"여기에-포스팅-기능도-몽땅-넣어줘\" style=\"position:relative;\"><a href=\"#%EC%97%AC%EA%B8%B0%EC%97%90-%ED%8F%AC%EC%8A%A4%ED%8C%85-%EA%B8%B0%EB%8A%A5%EB%8F%84-%EB%AA%BD%EB%95%85-%EB%84%A3%EC%96%B4%EC%A4%98\" aria-label=\"여기에 포스팅 기능도 몽땅 넣어줘 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>여기에 포스팅 기능도 몽땅 넣어줘</h3>\n<p>이 코드를 본 고양이가 또 요구했다.\n🐱 각자 게시글을 쓰고, 수정하고, 삭제하는 것도 가능하게 만들어주세요. 엔드포인트는 여전히 하나만 쓰고요. <strong>body</strong>는 이렇게 바꿀래요. 💬</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span> <span class=\"token comment\">// 회원 가입 시 </span>\n    <span class=\"token property\">\"event\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"member\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"join\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cat\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span> <span class=\"token comment\">// 회원 탈퇴 시 </span>\n    <span class=\"token property\">\"event\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"member\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"leave\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span> <span class=\"token comment\">// 게시글 작성 시 </span>\n    <span class=\"token property\">\"event\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"posting\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"write\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"posting\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"memberId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"안녕하세요\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span> <span class=\"token comment\">// 게시글 수정 시 </span>\n    <span class=\"token property\">\"event\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"posting\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"edit\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"posting\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"안녕하세요, 반갑습니다\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span> <span class=\"token comment\">// 게시글 삭제 시 </span>\n    <span class=\"token property\">\"event\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"posting\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>이제 어떻게 해결할 지 정말 막막해졌다.\n이유를 추려보자.</p>\n<ol>\n<li>여러개의 도메인 x 여러개의 요구사항의 수많은 가짓수를 한 엔드포인트로 처리해야 한다</li>\n<li>요청값의 형태가 각자 다르므로 <code class=\"language-text\">DTO</code> 클래스로 받을 수 없다</li>\n<li>처리해야 할 도메인이 추가될 때 마다 주입될 서비스 클래스도 추가된다</li>\n<li>처리해야 할 도메인이나 요구사항이 추가될 때 마다 <code class=\"language-text\">if</code>문이 추가된다</li>\n</ol>\n<p>여기까지의 요구사항을 억지로나마 맞추면 코드를 이렇게 짤 수는 있겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@PostMapping</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">event</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">String</span> event <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"event\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> content <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"member\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"join\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"leave\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"posting\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"write\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"edit\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">internalServerError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>몇가지 리팩토링을 통한 개선 여지는 보이지만 마음이 아픈 코드다.\n여기까지 읽었으면 <code class=\"language-text\">이런 억지 요구사항이 어딨나?</code>고 생각할 수도 있다.\n그런데 이게 <strong>슬랙이 우리에게 요구했던 사항</strong>이다.</p>\n<br>\n<h2 id=\"슬랙-rtm리얼타임-메시지와의-사투\" style=\"position:relative;\"><a href=\"#%EC%8A%AC%EB%9E%99-rtm%EB%A6%AC%EC%96%BC%ED%83%80%EC%9E%84-%EB%A9%94%EC%8B%9C%EC%A7%80%EC%99%80%EC%9D%98-%EC%82%AC%ED%88%AC\" aria-label=\"슬랙 rtm리얼타임 메시지와의 사투 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>슬랙 RTM(리얼타임 메시지)와의 사투</h2>\n<h3 id=\"url을-하나-제출하세요\" style=\"position:relative;\"><a href=\"#url%EC%9D%84-%ED%95%98%EB%82%98-%EC%A0%9C%EC%B6%9C%ED%95%98%EC%84%B8%EC%9A%94\" aria-label=\"url을 하나 제출하세요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>url을 하나 제출하세요</h3>\n<p>줍줍을 개발하면서 애증하게 된 슬랙의 애정하는 면 중 하나는 사용자에게 정말 폭넓은 편의를 제공한다는 것이다.\n처음 개발에 착수했을 때, 슬랙에서 발생하는 메시지 생성, 삭제, 채널명 수정 등의 사건을 어떻게 포착할지 막막했다.\n그런데 슬랙은 이미 봇을 통해 이를 리얼타임으로 제공한다. 와!</p>\n<p>하지만… 리얼타임 메세지를 한번 받아보니 바로 애정이 애증이 되었다.\n원래 물에서 건져주면 보따리 내놓으라고 한다고, 이 모든 걸 한 엔드포인트에 꽂아주는 게 문제였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhklEQVR42pVS226DMAzlj/dP2y/sE/bQl66ofag02rUFAuMWIAQoBDiTPajUh2pbpCPbSXxiH8dyPhwcj0fs93s4joPD4YDdbsd+nufoug5t2+J6vd5A8bK3+EtsrddrJrNtG/bGZrLVaoXN+wZxHKPv+7ukW/JsTddh7M2N3MIvaxiGh5jGEUWj8aVymMFwN1aWZdhut9zi0vI0TfjrerHf8PT6jKKtMRgDqygK1tB1XZzPZ5w+T/B9H0IIXC4XeK4H4Qve80UAL/iCK0JEUYxcSsRJAl1rJucKm6YBkUqZ8xDKooSUkkFxmqZsKblQFWR1hVQNejNgHEcG5o6YsCxLriQQAfw0xjlP0Jr+QYMTMP0QEBFrOZMSaIBcoed5CMMQvhDcKvmELM1Q1/VD0FRpBqR7VVUwpCGVSQFdUEqhUgpa6zvQGT282AUU0znl31UYRRFkJvm1NMsg4wTKC1GGMZIkYfBZmrJPdvHpr1IhNw2JlXTUVQWlG0jdQTWzhv/4PgvhNxu1SeiwFn0kAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"url\"\n        title=\"\"\n        src=\"/static/472998381523f6f149fb03cd311177f9/37523/url.png\"\n        srcset=\"/static/472998381523f6f149fb03cd311177f9/e9ff0/url.png 180w,\n/static/472998381523f6f149fb03cd311177f9/f21e7/url.png 360w,\n/static/472998381523f6f149fb03cd311177f9/37523/url.png 720w,\n/static/472998381523f6f149fb03cd311177f9/302a4/url.png 1080w,\n/static/472998381523f6f149fb03cd311177f9/4a00e/url.png 1406w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>여기를 통해서 다음과 같은 모든 이벤트를 처리해야 했다.</p>\n<ul>\n<li>메시지 관련\n<ul>\n<li>새로운 메시지 전송</li>\n<li>메시지 내용 수정</li>\n<li>메시지 삭제</li>\n<li>메시지 댓글을 채널로 다시 전송</li>\n</ul>\n</li>\n<li>공개 채널 관련\n<ul>\n<li>채널 정보(ex.이름) 수정</li>\n<li>채널 삭제</li>\n</ul>\n</li>\n<li>사용자 관련\n<ul>\n<li>사용자 정보(ex.이름, 프로필 사진) 수정</li>\n<li>워크스페이스에 새로운 사용자 입장</li>\n</ul>\n</li>\n</ul>\n<p>보면 알겠지만 전혀 다른 도메인과 그에 따른 요구사항이 섞여있다.</p>\n<h3 id=\"dto-만들-수-있으면-만들어-봐\" style=\"position:relative;\"><a href=\"#dto-%EB%A7%8C%EB%93%A4-%EC%88%98-%EC%9E%88%EC%9C%BC%EB%A9%B4-%EB%A7%8C%EB%93%A4%EC%96%B4-%EB%B4%90\" aria-label=\"dto 만들 수 있으면 만들어 봐 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DTO? 만들 수 있으면 만들어 봐</h3>\n<p>여기다가 형식이 통일됐다면 나았을텐데, 이벤트 특성이 달라서 그런가 들어오는 값이 달라도 너무 달랐다.\n<code class=\"language-text\">DTO</code> 클래스가 아닌 <code class=\"language-text\">Map&lt;String, Object></code>로 요청값을 받는 게 강제된 이유가 이것이다.\n(민감 정보 부분은 대치했다)</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// 채널명 변경 시 들어오는 값  </span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"token\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"token string\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"team_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"team id string\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"api_app_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"app id string\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"event\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"subtype\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"channel_name\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"ts\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1656920324.323089\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"user id string\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"채널 이름을 \\\"4기-공지사항\\\"에서 \\\"4기-공지사항-변경했지요\\\"(으)로 변경했습니다.\"</span><span class=\"token punctuation\">,</span> \n        <span class=\"token property\">\"old_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"4기-공지사항\"</span><span class=\"token punctuation\">,</span> \n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"4기-공지사항-변경했지요\"</span><span class=\"token punctuation\">,</span> \n        <span class=\"token property\">\"channel\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"channel id string\"</span><span class=\"token punctuation\">,</span> \n        <span class=\"token property\">\"event_tannel_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"channel\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"event_callback\"</span><span class=\"token punctuation\">,</span> \n    <span class=\"token property\">\"event_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Ev03MS66TUQP\"</span><span class=\"token punctuation\">,</span> \n    <span class=\"token property\">\"event_time\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1656920324\"</span><span class=\"token punctuation\">,</span> \n    <span class=\"token property\">\"authorizations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"enterprise_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"null\"</span><span class=\"token punctuation\">,</span> \n            <span class=\"token property\">\"team_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"team id string\"</span><span class=\"token punctuation\">,</span> \n            <span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"user id string\"</span><span class=\"token punctuation\">,</span> \n            <span class=\"token property\">\"is_bot\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">,</span> \n            <span class=\"token property\">\"is_enterprise_install\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"false\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> \n    <span class=\"token property\">\"is_ext_shared_channel\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"false\"</span><span class=\"token punctuation\">,</span> \n    <span class=\"token property\">\"event_context\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"4-eyJldCI6Im1lc3NhZ2UiLCJ0aWQiOiJUMDNNUzhTOUUzViIsImFpZCI6IkEwM01WRE01UjdDIiwiY2lkIjoiQzAzTjdTU1RVTVAifQ\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 메시지 삭제 시 들어오는 값  </span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"token\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"token string\"</span><span class=\"token punctuation\">,</span> \n    <span class=\"token property\">\"team_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"team id string\"</span><span class=\"token punctuation\">,</span> \n    <span class=\"token property\">\"api_app_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"app id string\"</span><span class=\"token punctuation\">,</span>  \n    <span class=\"token property\">\"event\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span> \n\t\t<span class=\"token property\">\"subtype\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"message_deleted\"</span><span class=\"token punctuation\">,</span> \n        <span class=\"token property\">\"previous_message\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"client_msg_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"f226562b-81e0-42ae-ba24-2e68898a7d35\"</span><span class=\"token punctuation\">,</span> \n\t\t\t<span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span> \n\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"안녕하세요?\"</span><span class=\"token punctuation\">,</span> \n\t\t\t<span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"user id string\"</span><span class=\"token punctuation\">,</span> \n\t\t\t<span class=\"token property\">\"ts\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1658055738.383439\"</span><span class=\"token punctuation\">,</span> \n\t\t\t<span class=\"token property\">\"team\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"T03MS8S9E3V\"</span><span class=\"token punctuation\">,</span> \n\t\t\t<span class=\"token property\">\"blocks\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rich_text\"</span><span class=\"token punctuation\">,</span> \n\t\t\t\t\t<span class=\"token property\">\"block_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"9Ldl\"</span><span class=\"token punctuation\">,</span> \n\t\t\t\t\t<span class=\"token property\">\"elements\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n                            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rich_text_section\"</span><span class=\"token punctuation\">,</span> \n\t\t\t\t\t\t\t<span class=\"token property\">\"elements\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n                                    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"t\"</span><span class=\"token punctuation\">,</span> \n\t\t\t\t\t\t\t\t\t<span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"안녕하세요?\"</span>\n\t\t\t\t\t\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n\t\t\t\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"channel\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"channel id string\"</span><span class=\"token punctuation\">,</span> \n\t<span class=\"token property\">\"hidden\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">,</span> \n\t<span class=\"token property\">\"deleted_ts\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1658055738.383439\"</span><span class=\"token punctuation\">,</span> \n\t<span class=\"token property\">\"event_ts\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1658055753.002600\"</span><span class=\"token punctuation\">,</span> \n\t<span class=\"token property\">\"ts\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1658055753.002600\"</span><span class=\"token punctuation\">,</span> \n\t<span class=\"token property\">\"channel_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"channel\"</span><span class=\"token punctuation\">,</span> \n\t<span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"event_callback\"</span><span class=\"token punctuation\">,</span> \n\t<span class=\"token property\">\"evend\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Ev03PTECHXLK\"</span><span class=\"token punctuation\">,</span> \n\t<span class=\"token property\">\"event_time\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1658055753\"</span><span class=\"token punctuation\">,</span> \n\t<span class=\"token property\">\"authorizations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"enterprise_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"null\"</span><span class=\"token punctuation\">,</span> \n\t\t<span class=\"token property\">\"team_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"team id string\"</span><span class=\"token punctuation\">,</span> \n\t\t<span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"user id string\"</span><span class=\"token punctuation\">,</span> \n\t\t<span class=\"token property\">\"is_bot\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">,</span> \n\t\t<span class=\"token property\">\"is_enterprise_install\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"false\"</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> \n\t<span class=\"token property\">\"is_ext_shared_channel\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"false\"</span><span class=\"token punctuation\">,</span> \n\t<span class=\"token property\">\"event_context\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"4-eyJldCI6Im1lc3NhZ2UiLCJ0aWQiOiJUMDNNUzhTOUUzViIsImFpZCI6IkEwM01WRE01UjdDIiwiY2lkIjoiQzAzTjdTU1RVTVAifQ\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<h2 id=\"줄줄이-if문을-막아라\" style=\"position:relative;\"><a href=\"#%EC%A4%84%EC%A4%84%EC%9D%B4-if%EB%AC%B8%EC%9D%84-%EB%A7%89%EC%95%84%EB%9D%BC\" aria-label=\"줄줄이 if문을 막아라 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>줄줄이 if문을 막아라</h2>\n<p>이 문제 해결을 위한 방안을 팀원 각자 고민해오기로 했다.\n얘기해보니 크게 두 갈래의 의견이 나왔다.</p>\n<h3 id=\"1-핸들러-이전에-엔드포인트를-분리\" style=\"position:relative;\"><a href=\"#1-%ED%95%B8%EB%93%A4%EB%9F%AC-%EC%9D%B4%EC%A0%84%EC%97%90-%EC%97%94%EB%93%9C%ED%8F%AC%EC%9D%B8%ED%8A%B8%EB%A5%BC-%EB%B6%84%EB%A6%AC\" aria-label=\"1 핸들러 이전에 엔드포인트를 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 핸들러 이전에 엔드포인트를 분리</h3>\n<p>첫번째로 제시된 방안은 아예 엔드포인트를 분리하기였다.\n<code class=\"language-text\">HandlerAdapter</code>를 구현하면 가능할 것 같다는 의견이 나왔었다.\n나도 이 방법으로 시도해보았으나, 잘 짜지지 않았다.\n핸들러 매핑 과정에 대한 이해가 부족했던 것 같다.</p>\n<p>다른 팀원은 <code class=\"language-text\">필터</code>로 헤더값을 추가하는 식으로 구현을 해왔다.\n이 방식을 이용하면 컨트롤러 코드는 대략 이렇게 바뀌었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span>headers <span class=\"token operator\">=</span> <span class=\"token string\">\"{type=member-join}\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">saveMember</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">MemberRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    memberService<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">noContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span>headers <span class=\"token operator\">=</span> <span class=\"token string\">\"{type=member-leave}\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">deleteMember</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">MemberLeaveRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    memberService<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">noContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span>headers <span class=\"token operator\">=</span> <span class=\"token string\">\"{type=posting-write}\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">savePosting</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">PostWriteRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    postService<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">noContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>아마 추가적인 작업으로 컨트롤러도 <code class=\"language-text\">MemberController, PostController...</code>하는 식으로 분리 가능했다.\n메서드를 명확하게 분리 가능하다는 점, <code class=\"language-text\">DTO</code>를 만들 수 있다는 점이 좋았다.</p>\n<br>\n<h3 id=\"2-어쨌든-동일-엔드포인트-내에서-분기-처리\" style=\"position:relative;\"><a href=\"#2-%EC%96%B4%EC%A8%8C%EB%93%A0-%EB%8F%99%EC%9D%BC-%EC%97%94%EB%93%9C%ED%8F%AC%EC%9D%B8%ED%8A%B8-%EB%82%B4%EC%97%90%EC%84%9C-%EB%B6%84%EA%B8%B0-%EC%B2%98%EB%A6%AC\" aria-label=\"2 어쨌든 동일 엔드포인트 내에서 분기 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 어쨌든 동일 엔드포인트 내에서 분기 처리</h3>\n<p>두번째로 제시된 방안은 ‘어쨌든 한 엔드포인트로 받은 후, 로직을 <em>깔끔하게</em> 분리 실행하자’였다.\n나는 이 방안을 선호했다.\n1안을 <code class=\"language-text\">HandlerAdapter</code>를 통해 구현 시도하면서 <code class=\"language-text\">inputStream</code>을 통해 읽은 <code class=\"language-text\">body</code>값을 다시 읽을 수 없다는 사실을 알게 되었기 때문이다.\n이를 위해선 <a href=\"https://meetup.toast.com/posts/44\">wrapper를 통해 다시 읽도록 처리</a>하는 추가 작업이 필요했다.\n간단한 방법(비록 if문이 늘어나지만)을 두고 돌아간다는 생각이 들었다.\n거기에 슬랙이 의도를 갖고 보낸 http 요청을 분기 처리를 위해 중간에 조작하는 것이 옳을까? 하는 측면도 있었다.</p>\n<p>얘기 끝에 2번을 시도해보고, 잘 안된다면 1번을 해보자고 결론이 났다.</p>\n<br>  \n<h2 id=\"그래서-어떻게-했느냐면\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%96%88%EB%8A%90%EB%83%90%EB%A9%B4\" aria-label=\"그래서 어떻게 했느냐면 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서 어떻게 했느냐면…</h2>\n<h3 id=\"1-enum으로-이벤트-분리\" style=\"position:relative;\"><a href=\"#1-enum%EC%9C%BC%EB%A1%9C-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%B6%84%EB%A6%AC\" aria-label=\"1 enum으로 이벤트 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. enum으로 이벤트 분리</h3>\n<p>if문의 처리를 위해 <code class=\"language-text\">Events</code>라는 <code class=\"language-text\">enum</code>을 만들었다.\n<code class=\"language-text\">Map&lt;String, Object></code> 형태의 요청값을 넣어주면, 어떤 요청인지 식별할 수 있게 되었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">Events</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">MEMBER_JOIN</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"member\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"join\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">MEMBER_LEAVE</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"member\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"leave\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function\">POSTING_WRITE</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"posting\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"write\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">POSTING_EDIT</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"posting\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"edit\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">POSTING_DELETE</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"posting\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> event<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> subtype<span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Events</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> event<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> subtype<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>event <span class=\"token operator\">=</span> event<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>subtype <span class=\"token operator\">=</span> subtype<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Events</span> <span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> requestBody<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> event <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>requestBody<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"event\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> type <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span> requestBody<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>events <span class=\"token operator\">-></span> <span class=\"token function\">isSameEvent</span><span class=\"token punctuation\">(</span>events<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">findAny</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NoSuchElementException</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isSameEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Events</span> events<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> event<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> events<span class=\"token punctuation\">.</span>event<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> events<span class=\"token punctuation\">.</span>subtype<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"2-각-event를-처리할-객체들의-인터페이스-분리\" style=\"position:relative;\"><a href=\"#2-%EA%B0%81-event%EB%A5%BC-%EC%B2%98%EB%A6%AC%ED%95%A0-%EA%B0%9D%EC%B2%B4%EB%93%A4%EC%9D%98-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4-%EB%B6%84%EB%A6%AC\" aria-label=\"2 각 event를 처리할 객체들의 인터페이스 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 각 event를 처리할 객체들의 인터페이스 분리</h3>\n<p>이 단계에서 조금 막혔는데, 팀원이 개발바닥 오픈톡방에 질문을 올렸다가 호돌맨님, 형덕님, 승일님이 큰 도움을 주셔서 잘 풀어나갈 수 있었다.\n각 이벤트를 처리할 객체들의 공통 인터페이스를 분리했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">EventService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">void</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> requestBody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">boolean</span> <span class=\"token function\">isSameEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Events</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"3-event-별로-구현체-작성\" style=\"position:relative;\"><a href=\"#3-event-%EB%B3%84%EB%A1%9C-%EA%B5%AC%ED%98%84%EC%B2%B4-%EC%9E%91%EC%84%B1\" aria-label=\"3 event 별로 구현체 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. event 별로 구현체 작성</h3>\n<p>이제 각 이벤트를 처리할 서비스 구현체를 하나씩 만든다.\n예시로 회원 가입을 처리할 구현체를 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberJoinService</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">EventService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MemberRepository</span> members<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MemberJoinService</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">MemberRepository</span> members<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>members <span class=\"token operator\">=</span> members<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> requestBody<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span> requestBody<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        members<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isSameEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Events</span> event<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Events</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MEMBER_JOIN</span> <span class=\"token operator\">==</span> event<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">isSameEvent</code>로 이 서비스 객체가 <strong>회원 가입</strong>을 처리할 객체임을 식별한다.\n<code class=\"language-text\">execute</code>로 요청값에서 필요값을 추출해 필요한 작업을 한다.</p>\n<h3 id=\"4-모든-eventservice-빈을-컬렉션으로-주입받는-finder-만들기\" style=\"position:relative;\"><a href=\"#4-%EB%AA%A8%EB%93%A0-eventservice-%EB%B9%88%EC%9D%84-%EC%BB%AC%EB%A0%89%EC%85%98%EC%9C%BC%EB%A1%9C-%EC%A3%BC%EC%9E%85%EB%B0%9B%EB%8A%94-finder-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"4 모든 eventservice 빈을 컬렉션으로 주입받는 finder 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 모든 EventService 빈을 컬렉션으로 주입받는 Finder 만들기</h3>\n<p>이제 만들어진 모든 <code class=\"language-text\">EventService</code> 구현체를 <code class=\"language-text\">EventServiceFinder</code>라는 클래스에 모은다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EventServiceFinder</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">EventService</span><span class=\"token punctuation\">></span></span> eventServices<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">EventServiceFinder</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">EventService</span><span class=\"token punctuation\">></span></span> eventServices<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eventServices <span class=\"token operator\">=</span> eventServices<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">EventService</span> <span class=\"token function\">findByEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Events</span> events<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> eventServices<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>service <span class=\"token operator\">-></span> service<span class=\"token punctuation\">.</span><span class=\"token function\">isSameEvent</span><span class=\"token punctuation\">(</span>events<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">findAny</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NoSuchElementException</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>빈을 컬렉션으로 주입받는 걸 언제 쓰나 했더니 이럴 때 쓰는 것이었다.\n<a href=\"https://hyewoncc.github.io/wild-seed/\">죽은 지식이 살아나는</a> 또 다른 순간이었다.\n이제 <code class=\"language-text\">findByEvent()</code>를 호출하며 해당 이벤트 <code class=\"language-text\">enum</code>을 넣으면, <code class=\"language-text\">isSameEvent()</code>로 이벤트에 대응되는 서비스가 반환 될 것이다.</p>\n<h3 id=\"5-마침내-컨트롤러에서-사용하기\" style=\"position:relative;\"><a href=\"#5-%EB%A7%88%EC%B9%A8%EB%82%B4-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"5 마침내 컨트롤러에서 사용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 마침내, 컨트롤러에서 사용하기</h3>\n<p>컨트롤러는 <code class=\"language-text\">EventFinder</code>만 주입받는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/event\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EventController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">EventServiceFinder</span> serviceFinder<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">EventController</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">EventServiceFinder</span> serviceFinder<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serviceFinder <span class=\"token operator\">=</span> serviceFinder<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@PostMapping</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        serviceFinder<span class=\"token punctuation\">.</span><span class=\"token function\">findByEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Events</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">noContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>각 요청값을 처리하는 건 각 서비스 객체의 <code class=\"language-text\">execute()</code>안에 구현되어 있으므로, <code class=\"language-text\">serviceFinder</code>로 찾은 객체에서 <code class=\"language-text\">execute()</code>만 호출하면 된다.\n북잡한 if문의 향연은 <code class=\"language-text\">enum</code>안으로 사라졌다.\n그리고 컨트롤러에서는 <strong>대응되는 서비스를 찾아 처리를 맡긴다</strong>는 깔끔한 맥락만 남았다.</p>\n<p><a href=\"https://github.com/hyewoncc/spring-sandbox/tree/spring/collection-beans\">전체 예제 코드</a>를 깃헙에서 볼 수 있다. <a href=\"https://github.com/hyewoncc/spring-sandbox/blob/spring/collection-beans/src/test/java/sandbox/EventsTest.java\">통합 테스트 코드</a> 실행 시 잘 동작한다.</p>\n<br>\n<h2 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>순수한 자체 서비스를 개발했다면 이런 경험을 할 일이 없었을 것이다. 그냥 엔드포인트 분리하고 끝내면 되니까.\n그런데 외부 데이터에 의존하는 기능을 만들다보니 이런 골치아프고 재밌는 일도 겪어본다.</p>\n<p>여담으로, 빈을 컬렉션으로 주입받을 수 있다는 사실이 김영한님 스프링 강의에 있었다고 한다.\n분명 나도 들은 강의인데 연관시켜 해결 할 생각은 전혀 하지 못했다.\n이런 지식 적용의 어려움은 어떻게 풀어나갈 수 있을까 고민이 든다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EA%B0%84%EB%8B%A8%ED%95%9C-%EA%B2%8C%EC%8B%9C%ED%8C%90-%EC%84%9C%EB%B9%84%EC%8A%A4%EB%A5%BC-%EC%83%81%EC%83%81%ED%95%98%EA%B8%B0\">간단한 게시판 서비스를 상상하기</a></p>\n<ul>\n<li><a href=\"#%ED%9A%8C%EC%9B%90-%EA%B0%80%EC%9E%85%EA%B3%BC-%ED%83%88%ED%87%B4\">회원 가입과 탈퇴</a></li>\n<li><a href=\"#%EA%B7%B8%EB%9F%B0%EB%8D%B0-%EC%9D%B4%EC%A0%9C-%EC%97%94%EB%93%9C%ED%8F%AC%EC%9D%B8%ED%8A%B8%EB%A5%BC-%ED%95%98%EB%82%98%EB%A1%9C-%ED%95%98%EA%B3%A0\">그런데 이제 엔드포인트를 하나로 하고</a></li>\n<li><a href=\"#%EC%97%AC%EA%B8%B0%EC%97%90-%ED%8F%AC%EC%8A%A4%ED%8C%85-%EA%B8%B0%EB%8A%A5%EB%8F%84-%EB%AA%BD%EB%95%85-%EB%84%A3%EC%96%B4%EC%A4%98\">여기에 포스팅 기능도 몽땅 넣어줘</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%8A%AC%EB%9E%99-rtm%EB%A6%AC%EC%96%BC%ED%83%80%EC%9E%84-%EB%A9%94%EC%8B%9C%EC%A7%80%EC%99%80%EC%9D%98-%EC%82%AC%ED%88%AC\">슬랙 RTM(리얼타임 메시지)와의 사투</a></p>\n<ul>\n<li><a href=\"#url%EC%9D%84-%ED%95%98%EB%82%98-%EC%A0%9C%EC%B6%9C%ED%95%98%EC%84%B8%EC%9A%94\">url을 하나 제출하세요</a></li>\n<li><a href=\"#dto-%EB%A7%8C%EB%93%A4-%EC%88%98-%EC%9E%88%EC%9C%BC%EB%A9%B4-%EB%A7%8C%EB%93%A4%EC%96%B4-%EB%B4%90\">DTO? 만들 수 있으면 만들어 봐</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A4%84%EC%A4%84%EC%9D%B4-if%EB%AC%B8%EC%9D%84-%EB%A7%89%EC%95%84%EB%9D%BC\">줄줄이 if문을 막아라</a></p>\n<ul>\n<li><a href=\"#1-%ED%95%B8%EB%93%A4%EB%9F%AC-%EC%9D%B4%EC%A0%84%EC%97%90-%EC%97%94%EB%93%9C%ED%8F%AC%EC%9D%B8%ED%8A%B8%EB%A5%BC-%EB%B6%84%EB%A6%AC\">1. 핸들러 이전에 엔드포인트를 분리</a></li>\n<li><a href=\"#2-%EC%96%B4%EC%A8%8C%EB%93%A0-%EB%8F%99%EC%9D%BC-%EC%97%94%EB%93%9C%ED%8F%AC%EC%9D%B8%ED%8A%B8-%EB%82%B4%EC%97%90%EC%84%9C-%EB%B6%84%EA%B8%B0-%EC%B2%98%EB%A6%AC\">2. 어쨌든 동일 엔드포인트 내에서 분기 처리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%96%88%EB%8A%90%EB%83%90%EB%A9%B4\">그래서 어떻게 했느냐면…</a></p>\n<ul>\n<li><a href=\"#1-enum%EC%9C%BC%EB%A1%9C-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%B6%84%EB%A6%AC\">1. enum으로 이벤트 분리</a></li>\n<li><a href=\"#2-%EA%B0%81-event%EB%A5%BC-%EC%B2%98%EB%A6%AC%ED%95%A0-%EA%B0%9D%EC%B2%B4%EB%93%A4%EC%9D%98-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4-%EB%B6%84%EB%A6%AC\">2. 각 event를 처리할 객체들의 인터페이스 분리</a></li>\n<li><a href=\"#3-event-%EB%B3%84%EB%A1%9C-%EA%B5%AC%ED%98%84%EC%B2%B4-%EC%9E%91%EC%84%B1\">3. event 별로 구현체 작성</a></li>\n<li><a href=\"#4-%EB%AA%A8%EB%93%A0-eventservice-%EB%B9%88%EC%9D%84-%EC%BB%AC%EB%A0%89%EC%85%98%EC%9C%BC%EB%A1%9C-%EC%A3%BC%EC%9E%85%EB%B0%9B%EB%8A%94-finder-%EB%A7%8C%EB%93%A4%EA%B8%B0\">4. 모든 EventService 빈을 컬렉션으로 주입받는 Finder 만들기</a></li>\n<li><a href=\"#5-%EB%A7%88%EC%B9%A8%EB%82%B4-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\">5. 마침내, 컨트롤러에서 사용하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B2%B0%EB%A1%A0\">결론</a></p>\n</li>\n</ul>\n</div>","excerpt":"해당 포스팅은 줍줍 개발 과정 중 맞딱뜨린 문제점과 답을 찾아가는 과정을 다른 방식으로 재구성한 글이다. 생각보다 글이 길어진 고로, 문제상황과 해결방안만 보고싶다면 문제상황 빈 컬렉션 주입을 이용한 해결 예시코드 이 둘을 보기를 권한다. 간단한 게시판 서비스를 상상하기 회원 가입과 탈퇴 당신은 지나가던 고양이의 의뢰로 서버를 개발하게 되었다.\n고양이는 🐱 닉네임을 입력하면 가입이 가능하고, 탈퇴할 수 있는 서비스를 만들어 주세요 💬 라고 요구했다.\n그래서 나는 (그리고 이 글을 볼 대부분의 사람들은) 이건 쉽지~ 하고 간단한 컨트롤러를 만들었다. 그런데 이제 엔드포인트를 하나로 하고 이 코드를 본 고양이가 말했다. 🐱 엔드포인트를 하나로 통일할래요. 그리고 이게 회원 가입인지 탈퇴인지는 body안에 쓸게요. 이렇게요. 💬 코드가 이상해지기 시작한다. 그래도 아직 납득 가능한 수준이다. 여기에 포스팅 기능도 몽땅 넣어줘 이 코드를 본 고양이가 또 요구했다.\n🐱 각자 게시글을 쓰고,…","frontmatter":{"date":"August 27, 2022","title":"[Spring] 모든 요구사항을 한 엔드포인트로 처리해보자! 😂","categories":"Spring 트러블슈팅","author":"써머","emoji":"headers/collection-beans.png"},"fields":{"slug":"/collection-beans/"}},"next":{"id":"1f626f64-8318-5c6b-94bd-c6195b09497f","html":"<h2 id=\"long-id--0l-\" style=\"position:relative;\"><a href=\"#long-id--0l-\" aria-label=\"long id  0l  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Long id = 0L ?</h2>\n<p>코틀린을 공부하다 참고하려고 <a href=\"https://github.com/woowacourse/service-apply\">우테코 지원 플랫폼</a>의 코드를 봤다.\n그 중 흥미로운 점을 발견했는데, 엔티티를 생성할 때 <code class=\"language-text\">id</code>를 <code class=\"language-text\">0L</code>로 초기화 하는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Entity</span>\n<span class=\"token keyword\">class</span> <span class=\"token function\">Member</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span>\n  id<span class=\"token operator\">:</span> Long <span class=\"token operator\">=</span> <span class=\"token number\">0L</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">..</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>이게 왜 흥미로웠냐면 <a href=\"https://hyewoncc.github.io/2022/08/13/jpa-static-fixture-trouble.html\">상수 픽스쳐 사용 주의</a> 포스팅에서 썼듯이 <code class=\"language-text\">id</code>가 <code class=\"language-text\">null</code>이 아니면 <code class=\"language-text\">merge()</code>를 시행한다고 생각했기 때문이다.\n굳이 <code class=\"language-text\">0L</code>로 초기화하면 <code class=\"language-text\">select</code> 비용만 추가로 들 것 같았다.  <!--more--></p>\n<p>그래서 자바 스프링에서 직접 간단한 엔티티를 만들고, id를 <code class=\"language-text\">0L</code>로 지정해 저장해봤다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberJPATest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MemberRepository</span> members<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Long id = 0L 이라면\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token number\">0L</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dog\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        members<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Hibernate: \n    select\n        member0_.id as id1_0_0_,\n        member0_.name as name2_0_0_ \n    from\n        member member0_ \n    where\n        member0_.id=?\nHibernate: \n    insert \n    into\n        member\n        (id, name) \n    values\n        (default, ?)\n</code></pre></div>\n<p>실행된 SQL문을 보면, 역시나 <code class=\"language-text\">select</code>문이 <code class=\"language-text\">insert</code>문에 선행되었다.\n<code class=\"language-text\">persist()</code>대신 <code class=\"language-text\">merge()</code>가 수행된 것이다.</p>\n<br>\n<h2 id=\"jpa의-새로운-엔티티-식별법\" style=\"position:relative;\"><a href=\"#jpa%EC%9D%98-%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%8B%9D%EB%B3%84%EB%B2%95\" aria-label=\"jpa의 새로운 엔티티 식별법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JPA의 새로운 엔티티 식별법</h2>\n<p><code class=\"language-text\">JPARepository</code> 상속 시 쓰게 되는 구현체인 <code class=\"language-text\">SimpleRepository</code>의 <code class=\"language-text\">save</code>를 다시 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">S</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">S</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">S</span> entity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">notNull</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Entity must not be null.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entityInformation<span class=\"token punctuation\">.</span><span class=\"token function\">isNew</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        em<span class=\"token punctuation\">.</span><span class=\"token function\">persist</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> entity<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>참 명료한 언어로 잘 짜여있다.\n<code class=\"language-text\">if (entityInformation.isNew(entity))</code>니까 <strong>엔티티가 새로운 엔티티라면</strong> <code class=\"language-text\">persist()</code>를, 아니라면 <code class=\"language-text\">merge()</code>를 수행한다.\n그렇다면 이 <code class=\"language-text\">isNew()</code>는 어디서 가져오는 걸까?</p>\n<p><code class=\"language-text\">isNew()</code>를 구현한 몇 개의 클래스에 디버깅을 걸며 찾아보니 <code class=\"language-text\">AbstractEntityInformation</code>라는 낯선 이름의 클래스에 걸렸다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AbstractEntityInformation</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> ID<span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">EntityInformation</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> ID<span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isNew</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> entity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      \n        <span class=\"token class-name\">ID</span> id <span class=\"token operator\">=</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>ID<span class=\"token punctuation\">></span></span> idType <span class=\"token operator\">=</span> <span class=\"token function\">getIdType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>idType<span class=\"token punctuation\">.</span><span class=\"token function\">isPrimitive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> id <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        \n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>id <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Number</span><span class=\"token punctuation\">)</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">longValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0L</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        \n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Unsupported primitive id type %s\"</span><span class=\"token punctuation\">,</span> idType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>코드 상 <code class=\"language-text\">isNew()</code>를 판단하는 조건은 다음과 같다.</p>\n<ul>\n<li>엔티티의 <code class=\"language-text\">id</code>가 원시 타입이 아니라면\n<ul>\n<li><code class=\"language-text\">null</code>일 때 새로운 엔티티다</li>\n<li>값이 있을 때 새로운 엔티티가 아니다</li>\n</ul>\n</li>\n<li>엔티티의 <code class=\"language-text\">id</code>가 원시 타입이고, <code class=\"language-text\">getId</code>한 <code class=\"language-text\">id</code>가 래퍼 클래스의 인스턴스라면\n<ul>\n<li>값이 <code class=\"language-text\">0</code>일 때 새로운 엔티티다</li>\n<li>값이 <code class=\"language-text\">0</code>이 아니면 새로운 엔티티가 아니다</li>\n</ul>\n</li>\n</ul>\n<p>처음 읽었을 때 <code class=\"language-text\">id instanceof Number</code>라는 부분이 이상했다.\n위에서 원시값이 아닌 경우를 한번 분기처리 했는데, 왜 다시 <code class=\"language-text\">Number</code>의 인스턴스임을 확인하는 걸까?\n애초에 <code class=\"language-text\">id</code>가 원시값이면 <code class=\"language-text\">Number</code>의 인스턴스가 될 수 없지 않나?\n코드를 읽다 혼란이 와서 <code class=\"language-text\">Number</code>에 대한 정보도 찾아보고 왔다.</p>\n<p>이 의문의 답은 <code class=\"language-text\">Id id = getId(entity)</code>에 있었다. <code class=\"language-text\">getId</code>를 하면서 원시타입의 경우 래퍼 클래스로 바꿔준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">ID</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> entity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">ID</span><span class=\"token punctuation\">)</span> persistentEntity<span class=\"token punctuation\">.</span><span class=\"token function\">getIdentifierAccessor</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getIdentifier</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>굳이 이렇게 번거롭게 처리한 이유는 찾아봤지만 사실 아직 잘 모르겠다…\n어쨌든 여기의 <code class=\"language-text\">ID</code>형은 <code class=\"language-text\">JPARepository</code>를 상속하면서 지정한 형태다.\n따라서 엔티티에서 <code class=\"language-text\">long</code>으로 정의된 <code class=\"language-text\">id</code>는, <code class=\"language-text\">getID</code>를 거쳐 자동으로 <code class=\"language-text\">Long</code>이 된다.</p>\n<p>그럼 <code class=\"language-text\">Long</code>이 아닌 <code class=\"language-text\">long id</code>를 <code class=\"language-text\">0L</code>로 초기화하면 <code class=\"language-text\">persist()</code>가 호출될까?</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Hibernate: \n    insert \n    into\n        member\n        (id, name) \n    values\n        (default, ?)\n</code></pre></div>\n<p>실행 결과 그런 것을 볼 수 있다.<br>\n코틀린 코드는 위 예제처럼 자바에서 <code class=\"language-text\">id</code>의 자료형을 <code class=\"language-text\">long</code>으로 하고, <code class=\"language-text\">0L</code>로 초기화 한 것과 동일하다.</p>\n<h3 id=\"숫자가-아닌-값을-id로-쓰려면\" style=\"position:relative;\"><a href=\"#%EC%88%AB%EC%9E%90%EA%B0%80-%EC%95%84%EB%8B%8C-%EA%B0%92%EC%9D%84-id%EB%A1%9C-%EC%93%B0%EB%A0%A4%EB%A9%B4\" aria-label=\"숫자가 아닌 값을 id로 쓰려면 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>숫자가 아닌 값을 id로 쓰려면?</h3>\n<p>줍줍 서비스를 개발하다 슬랙은 식별값으로 문자열을 쓴다는 사실이 기억났다.\n(물론 내부적으로는 숫자 <code class=\"language-text\">id</code>를 쓸 수도 있겠으나…)\n메시지 같은 경우는 수가 많아서 그런지 <a href=\"https://ko.wikipedia.org/wiki/%EB%B2%94%EC%9A%A9_%EA%B3%A0%EC%9C%A0_%EC%8B%9D%EB%B3%84%EC%9E%90\">UUID</a>를 사용한다.\n해당 코드를 본다면 <code class=\"language-text\">id</code>로 UUID를 사용할 경우 <code class=\"language-text\">persist</code>가 호출되지 않을 것 같았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>columnDefinition <span class=\"token operator\">=</span> <span class=\"token string\">\"BINARY(16)\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UUID</span> id <span class=\"token operator\">=</span> <span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberJPATest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MemberRepository</span> members<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"UUID id = UUID 랜덤값 이라면\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dog\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        members<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Hibernate: \n    select\n        member0_.id as id1_0_0_,\n        member0_.name as name2_0_0_ \n    from\n        member member0_ \n    where\n        member0_.id=?\nHibernate: \n    insert \n    into\n        member\n        (name, id) \n    values\n        (?, ?)</code></pre></div>\n<p>역시나 <code class=\"language-text\">merge</code>가 호출되어 <code class=\"language-text\">select</code> 후 <code class=\"language-text\">insert</code>가 나갔다.\n그럼 숫자가 아닌 값을 <code class=\"language-text\">id</code>로 사용하려면 성능 저하를 필연적으로 안고 가야 하는 것일까?</p>\n<br>\n<h2 id=\"persistableid-구현으로-내-맘대로-식별시키기\" style=\"position:relative;\"><a href=\"#persistableid-%EA%B5%AC%ED%98%84%EC%9C%BC%EB%A1%9C-%EB%82%B4-%EB%A7%98%EB%8C%80%EB%A1%9C-%EC%8B%9D%EB%B3%84%EC%8B%9C%ED%82%A4%EA%B8%B0\" aria-label=\"persistableid 구현으로 내 맘대로 식별시키기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Persistable<ID> 구현으로 내 맘대로 식별시키기</h2>\n<p>당연히 그럴 리는 없다.\nJPA는 엔티티의 <code class=\"language-text\">isNew()</code>를 개발자 입맛대로 바꿀 수 있도록 <code class=\"language-text\">Persistable&lt;ID></code> 인터페이스를 제공한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Persistable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>UUID<span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isNew</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 모든 <code class=\"language-text\">Member</code>의 인스턴스는 <code class=\"language-text\">save</code> 될 때 마다 새 엔티티로 인식된다.\n실제로 테스트 코드 내에서 <code class=\"language-text\">save</code>를 두 번 호출하면 <code class=\"language-text\">PK</code> 중복으로 에러가 난다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"String id = UUID 랜덤값 이라면\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dog\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    members<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    members<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>org.springframework.dao.DataIntegrityViolationException: could not execute statement; SQL [n/a]; constraint [“PUBLIC.PRIMARY_KEY_8 ON PUBLIC.MEMBER(ID) VALUES ( /* 1 */ CAST(X’c63865c5bb6e4f16a3d44aa75244dc1a’ AS BINARY(16)) )”; SQL statement:</p>\n</blockquote>\n<p>insert into member (name, id) values (?, ?) [23505-214]]; nested exception is org.hibernate.exception.ConstraintViolationException: could not execute statement</p>\n<p>다른 조건인 <code class=\"language-text\">생성 일자</code>로 <code class=\"language-text\">isNew()</code>를 판단하도록 수정하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Persistable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>UUID<span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@CreationTimestamp</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LocalDateTime</span> createdAt<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isNew</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> createdAt <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이러면 엔티티 최초 생성 시 <code class=\"language-text\">createdAt</code> 값이 생길 것이고, 이 값의 여부로 <code class=\"language-text\">isNew()</code>를 판단한다.\n해당 인터페이스를 구현하면 이제 <code class=\"language-text\">AbstractEntityInformation</code>의 <code class=\"language-text\">isNew()</code>를 완전히 우선해 대체함에 주의해야 한다.<br>\n<code class=\"language-text\">id</code>가 <code class=\"language-text\">null</code>이면 어쩌고… 는 더이상 적용되지 않는다는 뜻이다.</p>\n<h3 id=\"또는-조금-더-간단한-버전\" style=\"position:relative;\"><a href=\"#%EB%98%90%EB%8A%94-%EC%A1%B0%EA%B8%88-%EB%8D%94-%EA%B0%84%EB%8B%A8%ED%95%9C-%EB%B2%84%EC%A0%84\" aria-label=\"또는 조금 더 간단한 버전 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>또는, 조금 더 간단한 버전</h3>\n<p><code class=\"language-text\">isNew()</code> 구현을 위해 얘기하지 않았지만, 사실 UUID도 자동 생성 처리가 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>generator <span class=\"token operator\">=</span> <span class=\"token string\">\"uuid2\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@GenericGenerator</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"uuid2\"</span><span class=\"token punctuation\">,</span> strategy <span class=\"token operator\">=</span> <span class=\"token string\">\"uuid2\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>columnDefinition <span class=\"token operator\">=</span> <span class=\"token string\">\"BINARY(16)\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UUID</span> id <span class=\"token operator\">=</span> <span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>역시 있을 건 거의 이미 다 있다. 바퀴를 새로 발명하지 말자.</p>\n<br>\n<h2 id=\"그-외에도-식별에-영향을-주는-방법\" style=\"position:relative;\"><a href=\"#%EA%B7%B8-%EC%99%B8%EC%97%90%EB%8F%84-%EC%8B%9D%EB%B3%84%EC%97%90-%EC%98%81%ED%96%A5%EC%9D%84-%EC%A3%BC%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"그 외에도 식별에 영향을 주는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그 외에도 식별에 영향을 주는 방법</h2>\n<h3 id=\"version\" style=\"position:relative;\"><a href=\"#version\" aria-label=\"version permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Version</h3>\n<p>첫번쨰로 <code class=\"language-text\">@Version</code>이 있다. 이 어노테이션은 <code class=\"language-text\">isNew()</code>를 판별하는 용도로 붙이는 건 아니다.\n여기서 다른 클래스가 또 끼어들게 된다. <code class=\"language-text\">JpaMetamodelEntityInformation</code>라는 클래스다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JpaMetamodelEntityInformation</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> ID<span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaEntityInformationSupport</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> ID<span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isNew</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> entity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      \n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>versionAttribute<span class=\"token punctuation\">.</span><span class=\"token function\">isPresent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token operator\">||</span> versionAttribute<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Attribute</span><span class=\"token operator\">::</span><span class=\"token function\">getJavaType</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token operator\">::</span><span class=\"token function\">isPrimitive</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElse</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNew</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\">BeanWrapper</span> wrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectFieldAccessFallbackBeanWrapper</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> versionAttribute<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>it <span class=\"token operator\">-></span> wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">getPropertyValue</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElse</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 클래스의 <code class=\"language-text\">if</code>문을 보자. <code class=\"language-text\">@Version</code>이 붙은 값이 존재하지 않거나, 이 값들이 원시 타입이라면 상위의 <code class=\"language-text\">isNew()</code>를 호출한다.\n이 상위 클래스가 <code class=\"language-text\">AbstractEntityInformation</code>이다. 앞서 <code class=\"language-text\">@Version</code>이 없던 경우에도 사실 이 메서드를 한 번 타고 왔던 것이다.</p>\n<p><code class=\"language-text\">@Version</code> 필드가 있고 원시 타입이 아니라면, 이제 이 값으로 <code class=\"language-text\">isNew()</code>를 판단하게 된다.\n이 때도 역시 <code class=\"language-text\">id</code>가 <code class=\"language-text\">null</code>이면 어쩌고… 는 더이상 적용되지 않는다.\n<code class=\"language-text\">@Version</code>이 붙은 필드 값이 <code class=\"language-text\">null</code>인가의 여부로 판단한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Version</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> version<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberJPATest</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MemberRepository</span> members<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id 값이 있어도 @Version이 null 이라면\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token number\">1L</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dog\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        members<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Hibernate: \n    insert \n    into\n        member\n        (id, name, version) \n    values\n        (default, ?, ?)\n</code></pre></div>\n<p>이 <code class=\"language-text\">@Version</code>은 원래 <code class=\"language-text\">LOCK</code>을 위해 사용된다고 한다.\n<a href=\"https://reiphiel.tistory.com/entry/understanding-jpa-lock\">JPA 잠금(Lock) 이해하기</a> 라는 포스팅에서 상세한 설명을 볼 수 있다.</p>\n<h3 id=\"entityinformation-구현\" style=\"position:relative;\"><a href=\"#entityinformation-%EA%B5%AC%ED%98%84\" aria-label=\"entityinformation 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EntityInformation 구현</h3>\n<p>앞서 <code class=\"language-text\">isNew()</code>가 있었던 구현체들의 상위 인터페이스인 <code class=\"language-text\">EntityInformation</code>을 직접 구현해 <code class=\"language-text\">SimpleJpaRepository</code>에 주입하는 방법이다.\n이 방식은 아직 이해를 제대로 못했다.\n<code class=\"language-text\">SimpleJpaRepository</code>의 생성자에 어떤 방식으로 주입되는지 제대로 파악하고 나서 더 공부해보려 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">SimpleJpaRepository</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JpaEntityInformation</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> entityInformation<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EntityManager</span> entityManager<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  \n    <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">notNull</span><span class=\"token punctuation\">(</span>entityInformation<span class=\"token punctuation\">,</span> <span class=\"token string\">\"JpaEntityInformation must not be null!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">notNull</span><span class=\"token punctuation\">(</span>entityManager<span class=\"token punctuation\">,</span> <span class=\"token string\">\"EntityManager must not be null!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// 이 부분을 자신의 구현체로 대체하라는 의미일까? 어떻게...?  </span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>entityInformation <span class=\"token operator\">=</span> entityInformation<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>em <span class=\"token operator\">=</span> entityManager<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>provider <span class=\"token operator\">=</span> <span class=\"token class-name\">PersistenceProvider</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromEntityManager</span><span class=\"token punctuation\">(</span>entityManager<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>참고한 다른 블로그 포스팅인 <a href=\"https://insanelysimple.tistory.com/300\">spring-data-jpa save 동작 원리</a>에 나와있다.</p>\n<br>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>실제 코드를 탐색한 순서대로 포스팅을 했더니 글이 길어졌다.\n<code class=\"language-text\">EntityInformation</code> 구현을 제외하고, 알아낸 <code class=\"language-text\">isNew()</code>결정 흐름을 정리하자면 다음과 같다.</p>\n<ul>\n<li>엔티티 클래스에서 <strong>Persistable&#x3C;ID></strong> 를 구현했다면, 엔티티 클래스 내의 <strong>isNew()</strong> 로 판단</li>\n<li><strong>JpaMetamodelEntityInformation</strong>의 <strong>isNew()</strong> 가 호출\n<ul>\n<li><strong>@Version</strong>필드가 있고, 해당 값이 원시 타입이 아니라면\n<ul>\n<li>필드가 <strong>null</strong>이라면 <strong>true</strong>, 아니라면 <strong>false</strong> 반환</li>\n</ul>\n</li>\n<li><strong>@Version</strong>필드가 없거나, 해당 값이 원시 타입이라면\n<ul>\n<li><strong>AbstractEntityInformation</strong>의 <strong>isNew()</strong> 가 호출\n<ul>\n<li><strong>id</strong>가 원시 타입이 아니라면\n<ul>\n<li>값이 <strong>null</strong>이라면 <strong>true</strong>, 아니라면 <strong>false</strong> 반환</li>\n</ul>\n</li>\n<li><strong>id</strong>가 숫자값이라면\n<ul>\n<li>값이 <strong>0</strong>이라면  <strong>true</strong>, 아니라면 <strong>false</strong> 반환</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>참으로 복잡한 과정이 숨겨져 있었다.</p>\n<h3 id=\"그-외의-호기심\" style=\"position:relative;\"><a href=\"#%EA%B7%B8-%EC%99%B8%EC%9D%98-%ED%98%B8%EA%B8%B0%EC%8B%AC\" aria-label=\"그 외의 호기심 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그 외의 호기심?</h3>\n<p>코드를 열어보면서 <code class=\"language-text\">IsNewStrategy</code>라는 인터페이스와 구현체들을 발견했는데, 정작 어디 쓰이는지는 알아내지 못했다.\n구현체에는 <code class=\"language-text\">AbstractEntityInformation</code>와 비슷한 로직이 들어있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IsNewStrategy</span> <span class=\"token punctuation\">{</span>\n  \n    <span class=\"token comment\">/**\n    * 새로운 엔티티인지 여부를 반환합니다. 다시 말해, 실제로 저장 됐었는지와는 별개입니다.\n\t  * @param entity must not be {@literal null}.\n\t  * @return\n\t  */</span>\n\n    <span class=\"token keyword\">boolean</span> <span class=\"token function\">isNew</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PersistentEntityIsNewStrategy</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IsNewStrategy</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isNew</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> entity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      \n        <span class=\"token class-name\">Object</span> value <span class=\"token operator\">=</span> valueLookup<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>valueType <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>valueType<span class=\"token punctuation\">.</span><span class=\"token function\">isPrimitive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Number</span><span class=\"token punctuation\">)</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">longValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span>\n              <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Could not determine whether %s is new; Unsupported identifier or version property\"</span><span class=\"token punctuation\">,</span> entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 친구들은 또 언제 쓰이는 것인지 더 알아봐야겠다.</p>\n<br>\n<h2 id=\"도움받은-곳들\" style=\"position:relative;\"><a href=\"#%EB%8F%84%EC%9B%80%EB%B0%9B%EC%9D%80-%EA%B3%B3%EB%93%A4\" aria-label=\"도움받은 곳들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>도움받은 곳들</h2>\n<ul>\n<li><a href=\"https://insanelysimple.tistory.com/300\">Simple is best - spring-data-jpa save 동작 원리</a></li>\n</ul>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#long-id--0l-\">Long id = 0L ?</a></p>\n</li>\n<li>\n<p><a href=\"#jpa%EC%9D%98-%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%8B%9D%EB%B3%84%EB%B2%95\">JPA의 새로운 엔티티 식별법</a></p>\n<ul>\n<li><a href=\"#%EC%88%AB%EC%9E%90%EA%B0%80-%EC%95%84%EB%8B%8C-%EA%B0%92%EC%9D%84-id%EB%A1%9C-%EC%93%B0%EB%A0%A4%EB%A9%B4\">숫자가 아닌 값을 id로 쓰려면?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#persistableid-%EA%B5%AC%ED%98%84%EC%9C%BC%EB%A1%9C-%EB%82%B4-%EB%A7%98%EB%8C%80%EB%A1%9C-%EC%8B%9D%EB%B3%84%EC%8B%9C%ED%82%A4%EA%B8%B0\">Persistable<ID> 구현으로 내 맘대로 식별시키기</a></p>\n<ul>\n<li><a href=\"#%EB%98%90%EB%8A%94-%EC%A1%B0%EA%B8%88-%EB%8D%94-%EA%B0%84%EB%8B%A8%ED%95%9C-%EB%B2%84%EC%A0%84\">또는, 조금 더 간단한 버전</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B7%B8-%EC%99%B8%EC%97%90%EB%8F%84-%EC%8B%9D%EB%B3%84%EC%97%90-%EC%98%81%ED%96%A5%EC%9D%84-%EC%A3%BC%EB%8A%94-%EB%B0%A9%EB%B2%95\">그 외에도 식별에 영향을 주는 방법</a></p>\n<ul>\n<li><a href=\"#version\">@Version</a></li>\n<li><a href=\"#entityinformation-%EA%B5%AC%ED%98%84\">EntityInformation 구현</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n<ul>\n<li><a href=\"#%EA%B7%B8-%EC%99%B8%EC%9D%98-%ED%98%B8%EA%B8%B0%EC%8B%AC\">그 외의 호기심?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%8F%84%EC%9B%80%EB%B0%9B%EC%9D%80-%EA%B3%B3%EB%93%A4\">도움받은 곳들</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"August 24, 2022","title":"[JPA]는 새로운 엔티티를 어떻게 알아볼까?","categories":"JPA kotlin","author":"써머","emoji":"headers/jpa-is-new.png"},"fields":{"slug":"/jpa-is-new/"}},"prev":{"id":"39113ee2-cf8c-5676-bbc5-885f3d2c5a5c","html":"<p>해당 포스팅은 <a href=\"https://search.shopping.naver.com/book/catalog/32463364883?cat_id=50010881&#x26;frm=PBOKPRO&#x26;query=%ED%86%A0%EB%B9%84%EC%9D%98+%EC%8A%A4%ED%94%84%EB%A7%81&#x26;NaPm=ct%3Dl7xcl9rk%7Cci%3D2beb40c880925062f67b8f4c293f36caed990219%7Ctr%3Dboknx%7Csn%3D95694%7Chk%3De46d0a257b549c8d320d7074983959664f253dd5\">토비의 스프링 3.1</a>을 읽고 책 내용과 실습 코드 정리 및 스터디에서 나온 의견을 정리한 포스팅이다.</p>\n<h2 id=\"1장-오브젝트와-의존관계\" style=\"position:relative;\"><a href=\"#1%EC%9E%A5-%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8%EC%99%80-%EC%9D%98%EC%A1%B4%EA%B4%80%EA%B3%84\" aria-label=\"1장 오브젝트와 의존관계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1장 오브젝트와 의존관계</h2>\n<p>늘 <code class=\"language-text\">개발자인 나는 왜 스프링을 사용했는가</code>만 생각했기에, 1장 서두의 <code class=\"language-text\">스프링은 왜 자신을 쓰라고 하는가</code>가 중점인 스프링의 핵심 철학이 인상깊었다.\n그래서 포스팅을 인용으로 시작한다.</p>\n<blockquote>\n<p>자바 엔터프라이즈 기술의 혼란 속에서 잃어버렸던 객체지향 기술의 진정한 가치를 회복시키고, 그로부터 객체지향 프로그래밍이 제공하는 폭넓은 혜택을 누릴 수 있도록 기본으로 돌아가자는 것이 바로 스프링의 핵심 철학이다.<br>\n그래서 스프링이 가장 관심을 많이 두는 대상은 오브젝트다.<br>\np.53</p>\n</blockquote>\n<h2 id=\"초난감-dao-개선기\" style=\"position:relative;\"><a href=\"#%EC%B4%88%EB%82%9C%EA%B0%90-dao-%EA%B0%9C%EC%84%A0%EA%B8%B0\" aria-label=\"초난감 dao 개선기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>초난감 DAO 개선기</h2>\n<p>JDBC API를 처음 배우며 만들었던 모습의 <code class=\"language-text\">DAO</code> 클래스를 만들었다.\n제일 기본적인 기능으로 User 정보를 단건 저장하는 <code class=\"language-text\">add()</code>, 단건 조회하는 <code class=\"language-text\">get()</code>이 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">MYSQL_JDBC_DRIVER</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"com.mysql.cj.jdbc.Driver\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">MYSQL_URL</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"jdbc:mysql://localhost:3306/springbook\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">MYSQL_USER</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"spring\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">MYSQL_PASSWORD</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"book\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MYSQL_JDBC_DRIVER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>\n                <span class=\"token constant\">MYSQL_URL</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MYSQL_USER</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MYSQL_PASSWORD</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PreparedStatement</span> statement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>\n                <span class=\"token string\">\"insert into users(id, name, password) values(?, ?, ?)\"</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        statement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        statement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        statement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        statement<span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        statement<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MYSQL_JDBC_DRIVER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>\n                <span class=\"token constant\">MYSQL_URL</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MYSQL_USER</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MYSQL_PASSWORD</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PreparedStatement</span> statement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>\n                <span class=\"token string\">\"select id, name, password from users where id = ?\"</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        statement<span class=\"token punctuation\">.</span><span class=\"token function\">setString</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">ResultSet</span> resultSet <span class=\"token operator\">=</span> statement<span class=\"token punctuation\">.</span><span class=\"token function\">executeQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">setId</span><span class=\"token punctuation\">(</span>resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span>resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span>resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        statement<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>비록 동작은 잘 하지만 썩 잘 짠 코드 같진 않다.\n어느 부분이 문제일까?\n책에서는 <strong>세 가지 관심사가 섞여있는 것</strong>이 문제라고 한다.</p>\n<ul>\n<li>DB 연결 커넥션 가져오기</li>\n<li>SQL 문장을 담은 Statement를 만들고 실행</li>\n<li>자원 반납</li>\n</ul>\n<p>이 비대한 <code class=\"language-text\">DAO</code>를 멋진 <code class=\"language-text\">DAO</code>로 바꾸려면 <strong>관심사를 분리</strong>해야 한다.\n프로그램의 변경은 보통 한가지 관심사에 대해 일어난다.\n예를 들어 <code class=\"language-text\">연결할 DB를 다른 DB로 변경한다</code>, <code class=\"language-text\">실행할 SQL 문이 바뀌었다</code>가 있겠다.\n테이블이 10개, 20개로 늘어났을 때, 연결할 DB가 바뀌었다고 20개의 <code class=\"language-text\">DAO</code>클래스를 다 수정하게 된다면 곤란하다.\n<strong>분리와 확장</strong>을 고려한 설계로 작업을 최소화하고, 변경이 문제를 일으키지 않게 하나씩 개선해보자.</p>\n<p>💡 토프링에서 말한 관심사의 분리란?</p>\n<blockquote>\n<p>관심이 같은 것끼리는 하나의 객체 안으로 또는 친한 객체로 모이게 하고, 관심이 다른 것은 가능한 한 따로 떨어져서 서로 영향을 주지 않도록 분리하는 것</p>\n</blockquote>\n<br>\n<h3 id=\"메서드가-한가지-일을-하도록-분리\" style=\"position:relative;\"><a href=\"#%EB%A9%94%EC%84%9C%EB%93%9C%EA%B0%80-%ED%95%9C%EA%B0%80%EC%A7%80-%EC%9D%BC%EC%9D%84-%ED%95%98%EB%8F%84%EB%A1%9D-%EB%B6%84%EB%A6%AC\" aria-label=\"메서드가 한가지 일을 하도록 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메서드가 한가지 일을 하도록 분리</h3>\n<p><code class=\"language-text\">DB 연결 커넥션 가져오기</code> 관심사를 <code class=\"language-text\">메서드 추출</code>을 통해 분리할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token class-name\">PreparedStatement</span> statement <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"insert into users(id, name, password) values(?, ?, ?)\"</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.mysql.cj.jdbc.Driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"jdbc:mysql://localhost:3306/springbook\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"spring\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"book\"</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Connection</code>을 가져오는 부분을 분리해 <code class=\"language-text\">add(), get()</code>의 중복 코드를 제거했다.\n이제 DB 접속 정보가 바뀌면 두 메서드의 코드를 수정하는 대신, <code class=\"language-text\">getConnection()</code>의 코드만 수정하면 된다.\n하지만 다른 DB에 접속하도록 <strong>확장</strong>하려면 이 코드는 어떻게 바뀔까?\n새로운 <code class=\"language-text\">DAO</code>를 만들어 <code class=\"language-text\">getConnection()</code>을 바꿔야 한다.\n<code class=\"language-text\">add(), get()</code>은 그대로 두 클래스 간의 중복 코드가 될 것이다.</p>\n<br>\n<h3 id=\"상속으로-중복을-공유하되-추상메서드-사용\" style=\"position:relative;\"><a href=\"#%EC%83%81%EC%86%8D%EC%9C%BC%EB%A1%9C-%EC%A4%91%EB%B3%B5%EC%9D%84-%EA%B3%B5%EC%9C%A0%ED%95%98%EB%90%98-%EC%B6%94%EC%83%81%EB%A9%94%EC%84%9C%EB%93%9C-%EC%82%AC%EC%9A%A9\" aria-label=\"상속으로 중복을 공유하되 추상메서드 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>상속으로 중복을 공유하되 추상메서드 사용</h3>\n<p>그렇다면 상속을 통해 <code class=\"language-text\">add(), get()</code> 기능을 공유하도록 하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GoogleUserDao</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.mysql.cj.jdbc.Driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>\n                <span class=\"token string\">\"jdbc:mysql://localhost:3306/google\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"password\"</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>슈퍼클래스 <code class=\"language-text\">UserDao</code>에 기본적인 로직의 흐름을 만들었다.\n그리고 DB 연결 정보마다 달라질 <code class=\"language-text\">getConnection()</code>을 추상 메서드로 지정했다.\n이제 다른 DB를 쓸 거라면, 상속 받은 클래스에서 <code class=\"language-text\">getConnection()</code>만 추가 구현하면 된다.\n여기서 <code class=\"language-text\">GithubUserDao</code>가 추가로 생겨도 <code class=\"language-text\">add(), get()</code>은 슈퍼클래스의 메서드를 호출해 사용할 수 있다.\n이런 방식을 <code class=\"language-text\">템플릿 메소드 패턴</code>이라 부른다.</p>\n<p>동시에 <code class=\"language-text\">Connection getConnection()</code>을 구현해 각자 다른 객체를 리턴하게 둔 것을 <code class=\"language-text\">팩토리 메소드 패턴</code>이라 한다.\n처음 책을 읽었을 때는 이 둘의 차이가 헷갈렸다.\n<code class=\"language-text\">템플릿 메소드 패턴</code>은 변하지 않는 기능(=기본 기능 골격)을 상속으로 공유하는 것에,\n<code class=\"language-text\">팩토리 메소드 패턴</code>은 특정 오브젝트를 반환하는 메소드를 하위 클래스에서 구현하는 것에 초점을 맞춰 이해했다.\n후자의 경우 대개 인터페이스를 반환하도록 한다.\n그렇게 하면 슈퍼클래스는 하위 클래스가 어떤 구현체의 인스턴스를 반환할 지 숨길 수 있다.</p>\n<br>\n<h3 id=\"관심사를-클래스로-분리\" style=\"position:relative;\"><a href=\"#%EA%B4%80%EC%8B%AC%EC%82%AC%EB%A5%BC-%ED%81%B4%EB%9E%98%EC%8A%A4%EB%A1%9C-%EB%B6%84%EB%A6%AC\" aria-label=\"관심사를 클래스로 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관심사를 클래스로 분리</h3>\n<p>여기서 더 나아가, <code class=\"language-text\">DB 연결 커넥션 가져오기</code> 라는 관심사를 별도 클래스로 분리해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DBConnector</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">makeConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.mysql.cj.jdbc.Driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>\n                <span class=\"token string\">\"jdbc:mysql://localhost:3306/springbook\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"spring\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"book\"</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DBConnector</span> dbConnector<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDao</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dbConnector <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DBConnector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> dbConnector<span class=\"token punctuation\">.</span><span class=\"token function\">makeConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 <code class=\"language-text\">DB 연결 커넥션 가져오기</code>라는 관심사가 <code class=\"language-text\">UserDao</code>와 클래스 차원에서 분리되었다.\n하지만 <code class=\"language-text\">DB 설정이 달라지면 코드를 수정해야 한다</code>는 단점이 되돌아왔다.\n이를 인터페이스로 분리하고, 구현체를 추가하는 식으로 해결할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">DBConnector</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">Connection</span> <span class=\"token function\">makeConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GoogleDBConnector</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">DBConnector</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">makeConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">SQLException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"com.mysql.cj.jdbc.Driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>\n                <span class=\"token string\">\"jdbc:mysql://localhost:3306/google\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"spring\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"book\"</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DBConnector</span> dbConnector<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDao</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dbConnector <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GoogleDBConnector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 DB 설정이 달라진다면 <code class=\"language-text\">DBConnector</code>의 구현체만 추가되면 된다.</p>\n<br>\n<h3 id=\"관계설정-책임의-분리\" style=\"position:relative;\"><a href=\"#%EA%B4%80%EA%B3%84%EC%84%A4%EC%A0%95-%EC%B1%85%EC%9E%84%EC%9D%98-%EB%B6%84%EB%A6%AC\" aria-label=\"관계설정 책임의 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관계설정 책임의 분리</h3>\n<p>여기서 앞서 쓰지 않은 숨겨진 관심사가 있다.\n바로 <code class=\"language-text\">Dao</code>에서 <code class=\"language-text\">DBConnector</code>의 구현체를 정하는 문제다.\n어떤 <code class=\"language-text\">DBConnector</code>를 사용할지 정하는 관심사를 <code class=\"language-text\">Dao</code>와 분리하려면, <strong>클라이언트 오브젝트</strong>로 이동시키면 된다.\n실습에서는 간단히 <code class=\"language-text\">main()</code> 메서드 안으로 이동시켜봤다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">SQLException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ClassNotFoundException</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token class-name\">UserDao</span> userDao <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserDao</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">GoogleDBConnector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"blackdog\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"검은개\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    userDao<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDao</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DBConnector</span> dbConnector<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDao</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">DBConnector</span> dbConnector<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dbConnector <span class=\"token operator\">=</span> dbConnector<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 <code class=\"language-text\">UserDao</code>는 <code class=\"language-text\">DBConnector</code>에 어떤 구현체가 올지 모른다.\n<code class=\"language-text\">UserDao</code>를 사용하는 <strong>클라이언트</strong>에서 필요에 따라 구현체를 주입해주면 된다.</p>\n<p>후에 스프링까지 적용한 전체 실습 코드는 <a href=\"https://github.com/hyewoncc/topring/tree/chapter1\">깃헙 topring 레포</a>에서 볼 수 있다.</p>\n<br>\n<h2 id=\"dao-개선으로-보는-객체지향\" style=\"position:relative;\"><a href=\"#dao-%EA%B0%9C%EC%84%A0%EC%9C%BC%EB%A1%9C-%EB%B3%B4%EB%8A%94-%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5\" aria-label=\"dao 개선으로 보는 객체지향 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dao 개선으로 보는 객체지향</h2>\n<p><code class=\"language-text\">DB 연결 커넥션 가져오기</code>라는 기능 관심사 하나로 이렇게 많은 얘기를 할 줄 몰랐다.\n인상깊었던 내용을 중점으로 정리해봤다.</p>\n<h3 id=\"클래스오브젝트-의존과-di\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%9E%98%EC%8A%A4%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8-%EC%9D%98%EC%A1%B4%EA%B3%BC-di\" aria-label=\"클래스오브젝트 의존과 di permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클래스/오브젝트 의존과 DI</h3>\n<blockquote>\n<p>클래스 사이에 관계가 만들어진다는 것은 한 클래스가 인터페이스 없이 다른 클래스를 직접 사용한다는 뜻이다. 따라서 클래스가 아니라 오브젝트와 오브젝트 사이의 관계를 설정해줘야 한다.<br>\np.78</p>\n</blockquote>\n<p>‘A가 B를 의존하고 있다’라고 하면 이제까지는 ‘A가 B를 사용하고 있다’로 생각했다.\n그래서 클래스 사이의 관계와 <strong>오브젝트</strong> 사이의 관계를 구분해서 생각하지 않았다.\n앞선 예제에서 <code class=\"language-text\">UserDao</code>를 보면, 내부 코드 상으로 어떤 오브젝트(=구현체)를 사용할지 알 수 없다.\n이 구현체가 정의되는 곳은 외부의 <strong>클라이언트 오브젝트</strong>이며, 실제 오브젝트와의 관계는 <strong>런타임 시점</strong>에 맺어진다.</p>\n<p>DI(의존관계 주입)까지 같이 짚고 넘어가자면, 이 오브젝트간의 의존 관계를 외부(=클라이언트)에서 설정하는 것이다.\n예제 코드상 <code class=\"language-text\">Main</code> 클래스는 <code class=\"language-text\">main()</code> 메서드에서 <code class=\"language-text\">GoogleDBConnector</code> 인스턴스의 참조를 <code class=\"language-text\">UserDao</code>에 전달한다.\n이때 두 오브젝트간의 의존관계가 맺어진다.</p>\n<br>\n<h3 id=\"개방-폐쇄-원칙open-closed-principle\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EB%B0%A9-%ED%8F%90%EC%87%84-%EC%9B%90%EC%B9%99open-closed-principle\" aria-label=\"개방 폐쇄 원칙open closed principle permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개방 폐쇄 원칙(Open-Closed Principle)</h3>\n<p>우테코 레벨1 쯤에 <code class=\"language-text\">확장에는 열려있고 변경에는 닫혀있다</code>는 설명을 제대로 이해하지 못했었다.\n그냥 ‘코드를 추가해서 기능이 늘어남’을 ‘확장’이라 생각했다.\n예제로 보자면 <code class=\"language-text\">UserDao</code>에 <code class=\"language-text\">delete()</code> 메서드가 생기는 걸 확장이라 여겼다.\n다행히 이 큰 오해는 누군가 바로잡아줬었다.</p>\n<p>어쨌든 현재 <a href=\"https://github.com/hyewoncc/topring/tree/chapter1\">최종 예제 코드</a>에서 <code class=\"language-text\">DBConnector</code> 클래스는 <code class=\"language-text\">DB 연결</code>이라는 하나의 관심사에 집중하고 있다.\n이를 <strong>응집도가 높다</strong>고 한다.\n동시에 해당 DB연결에 어떤 변경이 생기더라도 <code class=\"language-text\">UserDao</code>에 영향을 끼치지 않는다.\n이렇게 변경 사항이 전파되지 않고 느슨하게 연결된 상태를 <strong>결합도가 낮다</strong>고 한다.\n<code class=\"language-text\">DBConnector</code>의 구현체를 만들어 다른 DB 연결이라는 <code class=\"language-text\">확장에 열려</code>있고, 이 변경에 다른 클래스가 영향을 받지 않기에 <code class=\"language-text\">변경에는 닫혀</code>있다.</p>\n<br>\n<h3 id=\"전략-패턴\" style=\"position:relative;\"><a href=\"#%EC%A0%84%EB%9E%B5-%ED%8C%A8%ED%84%B4\" aria-label=\"전략 패턴 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>전략 패턴</h3>\n<p>전략 패턴은 우테코의 기념비적인 첫 미션 자동차 경주에서 <code class=\"language-text\">랜덤값에 따라 달라지는 결과를 테스트하기</code>라는 문제를 해결하며 접했던 디자인 패턴이다.\n당시에는 <code class=\"language-text\">값 하나를 제공한다</code>는 관심사를 인터페이스로 분리한 것이 충격적으로 획기적이었다.\n공부보다 실전을 통해 체득한 개념이라 전략 패턴을 설명하라 하면 항상 실전 예제를 들었던 것 같은데…\n토프링에서 아주 우아하게 정의한 부분을 보니 신선했다.</p>\n<blockquote>\n<p>전략 패턴은 자신의 기능 맥락(context)에서, 필요에 따라 변경이 필요한 알고리즘을 인터페이스를 통해 통째로 외부로 분리시키고, 이를 구현한 구체적인 알고리즘 클래스를 필요에 따라 바꿔서 아요할 수 있게 하는 디자인 패턴이다.<br>\n여기서 말하는 알고리즘이란… 독립적인 책임으로 분리가 가능한 기능을 뜻한다.<br>\np.87</p>\n</blockquote>\n<br>\n<h3 id=\"ioc제어의-역전\" style=\"position:relative;\"><a href=\"#ioc%EC%A0%9C%EC%96%B4%EC%9D%98-%EC%97%AD%EC%A0%84\" aria-label=\"ioc제어의 역전 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IoC(제어의 역전)</h3>\n<p>빈출 면접 질문 중에 <em>라이브러리와 프레임워크의 차이</em>가 있는 걸로 안다.\n라이브러리는 자주 쓰는 코드를 모듈화 한 것… 프레임워크는 뼈대… 이런 답이 떠올랐던 것 같다.\n그런데 프레임워크도 <code class=\"language-text\">제어의 역전</code> 개념이 적용된 것이라 해서 큰 충격을 받았다…</p>\n<blockquote>\n<p>라이브러리를 사용하는 애플리케이션 코드는 애플리케이션 흐름을 직접 제어한다.<br>\n…반면에 프레임워크는 거꾸로 애플리케이션 코드가 프레임워크에 의해 사용된다.<br>\np.93</p>\n</blockquote>\n<br>\n<p>이제까지 읽은 기술 책들은 1장이 제일 쉬웠다.\n그런데 토프링은 1장부터 밀도가 장난아니어서 한번 놀라고,\n스프링 공부 하려고 읽었는데 객체지향에 대해 더 흥미롭고 좋은 얘기가 나와서 두번 놀랐다.\n1장 후반부의 용어 정리나 스프링을 이용한 DI의 경우 포스팅에서 중요한 내용이 아니라 생각해 뺐을 정도다.\n객체지향 얘기 만으로 이 책을 산 값을 한다고 느꼈을 정도다.\n남은 두 개의 관심사는 앞으로 어떻게 해결할지, 뒤에는 어떤 얘기가 나올지 기대된다.</p>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#1%EC%9E%A5-%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8%EC%99%80-%EC%9D%98%EC%A1%B4%EA%B4%80%EA%B3%84\">1장 오브젝트와 의존관계</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%B4%88%EB%82%9C%EA%B0%90-dao-%EA%B0%9C%EC%84%A0%EA%B8%B0\">초난감 DAO 개선기</a></p>\n<ul>\n<li><a href=\"#%EB%A9%94%EC%84%9C%EB%93%9C%EA%B0%80-%ED%95%9C%EA%B0%80%EC%A7%80-%EC%9D%BC%EC%9D%84-%ED%95%98%EB%8F%84%EB%A1%9D-%EB%B6%84%EB%A6%AC\">메서드가 한가지 일을 하도록 분리</a></li>\n<li><a href=\"#%EC%83%81%EC%86%8D%EC%9C%BC%EB%A1%9C-%EC%A4%91%EB%B3%B5%EC%9D%84-%EA%B3%B5%EC%9C%A0%ED%95%98%EB%90%98-%EC%B6%94%EC%83%81%EB%A9%94%EC%84%9C%EB%93%9C-%EC%82%AC%EC%9A%A9\">상속으로 중복을 공유하되 추상메서드 사용</a></li>\n<li><a href=\"#%EA%B4%80%EC%8B%AC%EC%82%AC%EB%A5%BC-%ED%81%B4%EB%9E%98%EC%8A%A4%EB%A1%9C-%EB%B6%84%EB%A6%AC\">관심사를 클래스로 분리</a></li>\n<li><a href=\"#%EA%B4%80%EA%B3%84%EC%84%A4%EC%A0%95-%EC%B1%85%EC%9E%84%EC%9D%98-%EB%B6%84%EB%A6%AC\">관계설정 책임의 분리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#dao-%EA%B0%9C%EC%84%A0%EC%9C%BC%EB%A1%9C-%EB%B3%B4%EB%8A%94-%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5\">Dao 개선으로 보는 객체지향</a></p>\n<ul>\n<li><a href=\"#%ED%81%B4%EB%9E%98%EC%8A%A4%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8-%EC%9D%98%EC%A1%B4%EA%B3%BC-di\">클래스/오브젝트 의존과 DI</a></li>\n<li><a href=\"#%EA%B0%9C%EB%B0%A9-%ED%8F%90%EC%87%84-%EC%9B%90%EC%B9%99open-closed-principle\">개방 폐쇄 원칙(Open-Closed Principle)</a></li>\n<li><a href=\"#%EC%A0%84%EB%9E%B5-%ED%8C%A8%ED%84%B4\">전략 패턴</a></li>\n<li><a href=\"#ioc%EC%A0%9C%EC%96%B4%EC%9D%98-%EC%97%AD%EC%A0%84\">IoC(제어의 역전)</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"September 11, 2022","title":"오브젝트와 의존관계 (토비의 스프링)","categories":"Spring","author":"써머","emoji":"headers/topring-chapter1.png"},"fields":{"slug":"/topring-chapter1/"}},"site":{"siteMetadata":{"siteUrl":"https://hyewoncc.github.io","comments":{"utterances":{"repo":"hyewoncc/hyewoncc.github.io"}}}}},"pageContext":{"slug":"/collection-beans/","nextSlug":"/jpa-is-new/","prevSlug":"/topring-chapter1/"}},"staticQueryHashes":["1073350324","1956554647","2938748437","3350743975"],"slicesMap":{}}