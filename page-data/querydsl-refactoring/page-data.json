{"componentChunkName":"component---src-templates-blog-template-js","path":"/querydsl-refactoring/","result":{"data":{"cur":{"id":"35f48c8a-6132-55b3-af5f-ffe41513fbd0","html":"<h2 id=\"-문제상황\" style=\"position:relative;\"><a href=\"#-%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9\" aria-label=\" 문제상황 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧶 문제상황</h2>\n<h3 id=\"-비대해진-서비스-코드\" style=\"position:relative;\"><a href=\"#-%EB%B9%84%EB%8C%80%ED%95%B4%EC%A7%84-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%BD%94%EB%93%9C\" aria-label=\" 비대해진 서비스 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🪐 비대해진 서비스 코드</h3>\n<p><a href=\"https://github.com/woowacourse-teams/2022-pickpick\">줍줍</a>은 요청에 따라 동적으로 변화해야 하는 복잡한 조회 조건을 걸기 위해 <code class=\"language-text\">Querydsl</code>을 도입했다.\n예전에 공부하며 가볍게 사용해 본 적은 있지만, 줍줍 요구사항만큼 복잡한 코드를 짜 본 적은 없었다.\n<code class=\"language-text\">XXXService</code>에 <code class=\"language-text\">Querydsl</code> 코드를 넣는 식으로 우선 구현했고, 무사히 배포되었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MessageService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MemberRepository</span> members<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRepository</span> messages<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ChannelSubscriptionRepository</span> channelSubscriptions<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">JPAQueryFactory</span> jpaQueryFactory<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MessageResponses</span> <span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> memberId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> messageRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds <span class=\"token operator\">=</span> <span class=\"token function\">findChannelId</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageResponse</span><span class=\"token punctuation\">></span></span> messageResponses <span class=\"token operator\">=</span> <span class=\"token function\">findMessages</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">,</span> channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">boolean</span> hasPast <span class=\"token operator\">=</span> <span class=\"token function\">hasPast</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">,</span> messageResponses<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">boolean</span> hasFuture <span class=\"token operator\">=</span> <span class=\"token function\">hasFuture</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">,</span> messageResponses<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageResponses</span><span class=\"token punctuation\">(</span>messageResponses<span class=\"token punctuation\">,</span> hasPast<span class=\"token punctuation\">,</span> hasFuture<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">isNeedPastMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findChannelId</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> memberId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> messageRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds <span class=\"token operator\">=</span> messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getChannelIds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isNonNullNorEmpty</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> channelIds<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\">ChannelSubscription</span> firstSubscription <span class=\"token operator\">=</span> channelSubscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">getFirstByMemberIdOrderByViewOrderAsc</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>firstSubscription<span class=\"token punctuation\">.</span><span class=\"token function\">getChannelId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageResponse</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findMessages</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> memberId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span>\n                                               <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> messageRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">boolean</span> needPastMessage <span class=\"token operator\">=</span> messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">isNeedPastMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> messageCount <span class=\"token operator\">=</span> messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageResponse</span><span class=\"token punctuation\">></span></span> messageResponses <span class=\"token operator\">=</span> jpaQueryFactory\n                <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token function\">getMessageResponseConstructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QMessage</span><span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QMessage</span><span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span>member<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QBookmark</span><span class=\"token punctuation\">.</span>bookmark<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">existsBookmark</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">QReminder</span><span class=\"token punctuation\">.</span>reminder<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">remainReminder</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token function\">meetAllConditions</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token function\">arrangeDateByNeedPastMessage</span><span class=\"token punctuation\">(</span>needPastMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span>messageCount<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">replaceMentionMembers</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">,</span> messageResponses<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그러다 <code class=\"language-text\">Querydsl</code>을 쓰지 않는 다른 서비스 클래스 코드를 보니 ‘어… 여기는 너무 깔끔한데?‘하는 위화감이 들었다.\n그리고 다시 <code class=\"language-text\">Querydsl</code>을 쓰는 코드를 보니, <code class=\"language-text\">Repository</code>가 할 일이 <code class=\"language-text\">Service</code>에서 이뤄지고 있다는 생각이 들었다.</p>\n<p>위에 있는 기존 <code class=\"language-text\">MessageService</code>의 짧은 예시 코드 내에서도 <code class=\"language-text\">Querydsl</code> 사용으로 인한 서비스 역할 비대화가 보인다.\n<code class=\"language-text\">findChannelId()</code>의 경우 DB에서 데이터를 가져오는 역할을 완벽히 <code class=\"language-text\">channelSubscriptions</code>에 맡기고 있다.\n반면, <code class=\"language-text\">findMessages()</code>는 DB에서 어떤 데이터를 가져올지 서비스 코드 상에 완전히 노출되어 있음을 볼 수 있다.</p>\n<p>그래서 각 레이어 별 역할이 원칙대로 분리되도록 <code class=\"language-text\">Querydsl</code> 코드를 별도의 <code class=\"language-text\">Repository</code> 객체로 빼내는 리팩토링을 시작했다.</p>\n<br>\n<h3 id=\"️-일단-레포지토리-코드-분리\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EC%9D%BC%EB%8B%A8-%EB%A0%88%ED%8F%AC%EC%A7%80%ED%86%A0%EB%A6%AC-%EC%BD%94%EB%93%9C-%EB%B6%84%EB%A6%AC\" aria-label=\"️ 일단 레포지토리 코드 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✂️ 일단 레포지토리 코드 분리</h3>\n<p><code class=\"language-text\">Querydsl</code> 사용 예시를 보면 <code class=\"language-text\">Querydsl</code>을 사용하는 레포지토리의 인터페이스를 만들고, 이를 <code class=\"language-text\">JpaRepository</code>와 함께 상속받아 결과적으로 하나의 구현체를 사용하게 하는 방법이 많이 나온다.\n글로 하니 어려운데, 그림과 코드로 보면 이렇다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAo0lEQVQY022PWQ6DMBBDe5ssCGgSAoEsLG3vf6RXgUTV7cOyZjy2PJeqqjihlcYFQ8yJnGdiyge873GjIZVMLgu5zAd2rW4atNavjMtHoNbY3hDGkTQXphwZhoC1lqtvGUIglkRaClNMTDFS1/X/wHOplEIKiVSStmuwncMHjx96nO8wzhyaEAIp5ct38k/D99knx7yubLcH2/1x8P7m+8237wnwQn3uXSCbMwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"querydsl 인터페이스 상속\"\n        title=\"querydsl 인터페이스 상속\"\n        src=\"/static/6041c50db5c2acae632e5f544543d3ef/37523/querydsl_extends.png\"\n        srcset=\"/static/6041c50db5c2acae632e5f544543d3ef/e9ff0/querydsl_extends.png 180w,\n/static/6041c50db5c2acae632e5f544543d3ef/f21e7/querydsl_extends.png 360w,\n/static/6041c50db5c2acae632e5f544543d3ef/37523/querydsl_extends.png 720w,\n/static/6041c50db5c2acae632e5f544543d3ef/302a4/querydsl_extends.png 1080w,\n/static/6041c50db5c2acae632e5f544543d3ef/07a9c/querydsl_extends.png 1440w,\n/static/6041c50db5c2acae632e5f544543d3ef/95e59/querydsl_extends.png 1460w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MessageService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRepository</span> messages<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MessageRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Repository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Message</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">QMessageRepository</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">QMessageRepository</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">QMessageRepositoryImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">QMessageRepository</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 한다면 <code class=\"language-text\">MessageService</code>의 <code class=\"language-text\">messages</code>를 통해, <code class=\"language-text\">QMessageRepositoryImpl</code>에 구현된 메서드도 모두 사용할 수 있다.\n<code class=\"language-text\">XXXService</code> 입장에서 단 하나의 <code class=\"language-text\">Repository</code>를 사용하면 되니 깔끔하다.</p>\n<p>이 방식으로 코드를 분리하면 클래스 다이어그램에서 서비스가 한껏 가벼워진 것을 볼 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABTElEQVQoz2WSi46CUAxE+f/PwygYMShB5RlFBUXQbs4k3bjZJg3cPmamtzeYpskej4c1TWPn81n/8zyb2/P5VG6/38u7rlPs9Xqpvq5r5YmDFfCz2+0syzIl7ve7it04OxBxmiA8nU62Xq8FWFWVXS4XG8fRAn4Oh4OUYZ/PRw18sdvtZovFQqSAYe/3W4C412H0BW3bqiFNU+v7/t/InI/Ho3IoRAX5oigsz3MbhkFncrgUrlYr2263SgKAEh+NGEogxBFAI2D0cb5er7/AAoyiSIwunwSAjEYxd4VCN+LUL5dLfb+vKmBTMCVJIjYH+l4KV8IEgLNhmgGK41hLYao/gCgoy1KbRPH3llkKYGzS78+XgkKWRRxAPRsAYYKRJhTQ4ONDQCNPx4kcMAxD22w2AkWMFILKhXJHuLM5IOO4Oh8LpxYygPxRA/gD9dj9cBuH/tkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1차 리팩터링 uml\"\n        title=\"1차 리팩터링 uml\"\n        src=\"/static/8251179dae69cb7e10f6e003b5613ca0/37523/uml1.png\"\n        srcset=\"/static/8251179dae69cb7e10f6e003b5613ca0/e9ff0/uml1.png 180w,\n/static/8251179dae69cb7e10f6e003b5613ca0/f21e7/uml1.png 360w,\n/static/8251179dae69cb7e10f6e003b5613ca0/37523/uml1.png 720w,\n/static/8251179dae69cb7e10f6e003b5613ca0/302a4/uml1.png 1080w,\n/static/8251179dae69cb7e10f6e003b5613ca0/07a9c/uml1.png 1440w,\n/static/8251179dae69cb7e10f6e003b5613ca0/b2b2c/uml1.png 1708w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그런데 첫번째 리팩터링 후에 보니, <code class=\"language-text\">MessageService</code>에서 일반 <code class=\"language-text\">MessageRepository</code>의 메서드를 전혀 사용하지 않고 있었다.\n동시에 반대로 <code class=\"language-text\">MessageService</code>를 제외하고 <code class=\"language-text\">MessageRepository</code>를 사용하는 다른 모든 곳에서 <code class=\"language-text\">Querydsl</code> 로직을 전혀 사용하지 않고 있었다.\n다중 상속으로 <code class=\"language-text\">Message</code> 도메인과 관련된 DB 접근 로직을 한 곳에 다 모을 수 있었지만,\n정작 사용하지 않는 메서드가 모두 노출되면서, 관리할 인터페이스만 하나 더 생겼다는 생각이 들었다.</p>\n<p>그래서 다중 상속 없이 <code class=\"language-text\">MessageRepository</code>와 <code class=\"language-text\">QMessageRepository</code>를 필요에 따라 각각 사용하도록 다시 리팩터링을 진행했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABY0lEQVQoz3WSWYvCUAyF+///UEEf+6CgiCi41X3DSqsW3G09wxdIGRgmEJre3JycnNzg8/no8XgoTVOdz2eLi6KQG3Ge51oulxoMBtput7per3ZGPJvNtFgsrPb5fCrwy+v12kC5/H6/K8CyLLXZbMzJc//1emm1WlkNefz7/Vrz4HK5aLfbGTPMEx7jcRxrNBpZMz/f7/c6HA7GyhszbZBlmfr9vtG+3W5/RqY4SRLRmCLYO2tq7ve7gcLaALmINmhBEkAS7v8Z+lEHS2oApJEBDodDS8DGFwEYbIj54pw5e0YG8HQ6VZMYQ7ZDYjqdivF/F9G52+2q0WgoiiK1Wi1boANCBP2ZDKsAx+Ox6cQGYexbRtN6vW5ASDKZTGy7GEBozz/Lcu0NkA0y8vF4NIHRAqNzrVZTGIZqt9vq9XoVIARoMJ/Pq4UaIDQp5AB3cTHAm82mOp2OPR2cxq6zu79D/AeW5veyHQ0+AgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2차 리팩터링 uml\"\n        title=\"2차 리팩터링 uml\"\n        src=\"/static/59eebc8e9243f90e728005ab33bb6d33/37523/uml2.png\"\n        srcset=\"/static/59eebc8e9243f90e728005ab33bb6d33/e9ff0/uml2.png 180w,\n/static/59eebc8e9243f90e728005ab33bb6d33/f21e7/uml2.png 360w,\n/static/59eebc8e9243f90e728005ab33bb6d33/37523/uml2.png 720w,\n/static/59eebc8e9243f90e728005ab33bb6d33/302a4/uml2.png 1080w,\n/static/59eebc8e9243f90e728005ab33bb6d33/07a9c/uml2.png 1440w,\n/static/59eebc8e9243f90e728005ab33bb6d33/b2b2c/uml2.png 1708w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>두 형태 중에 고민했는데 설계상으로는 1안이 확연히 좋았다.\n<code class=\"language-text\">MessageRepository</code>의 DB 접근 명세를 한 번에 볼 수 있다는 점이 특히 그랬다.\n메서드 구현을 위해 내부에서 <code class=\"language-text\">JPA</code>가 자동 생성하는 코드를 사용하건, <code class=\"language-text\">Querydsl</code>을 사용하건, 외부의 관심사가 아니기 때문이다.</p>\n<p>반면, 이 설계의 장점이 현재 우리 프로젝트에 맞을까? 하는 고민이 들었다.\n실질적으로 <code class=\"language-text\">JPA</code> 자동 생성 코드를 쓰는 클라이언트 클래스와 <code class=\"language-text\">Querydsl</code> 코드를 쓰는 클라이언트가 완벽히 나누어져 있고,\n이 둘을 한 번에 쓸 새로운 객체가 생길 가능성이 낮다.\n그렇다면 객체를 분리해 자신이 쓸 메서드만 제공받는 것이 낫지 않을까?</p>\n<p>이 부분은 혼자 고민해서 답을 내리기 보다 팀원들의 의견을 듣고 별도 진행하는 게 나을 것 같아, 두 가지 방안을 모두 열어두고 나머지 리팩터링을 진행했다.</p>\n<br>\n<h3 id=\"-메서드-이름을-명확하게\" style=\"position:relative;\"><a href=\"#-%EB%A9%94%EC%84%9C%EB%93%9C-%EC%9D%B4%EB%A6%84%EC%9D%84-%EB%AA%85%ED%99%95%ED%95%98%EA%B2%8C\" aria-label=\" 메서드 이름을 명확하게 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📛 메서드 이름을 명확하게</h3>\n<p>다음으로 <code class=\"language-text\">QMessageRepository</code>의 메서드 이름 개선 작업에 들어갔다.\n기존 코드는 빌더 안 메서드 명이 추상적이라, 코드만 보고 실제로 어떤 조건인지 파악하기 쉽지 않았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageResponse</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findMessages</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> memberId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span>\n                                            <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> messageRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">boolean</span> needPastMessage <span class=\"token operator\">=</span> messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">isNeedPastMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> messageCount <span class=\"token operator\">=</span> messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> jpaQueryFactory\n        <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token function\">getMessageResponseConstructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>member<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>bookmark<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">existsBookmark</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>reminder<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">remainReminder</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token function\">meetAllConditions</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token function\">arrangeDateByNeedPastMessage</span><span class=\"token punctuation\">(</span>needPastMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span>messageCount<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>이를 <code class=\"language-text\">JPA</code> 메서드 컨벤션에 맞춰 아래와 같이 명확하게 개선했다.</p>\n<h4 id=\"1-on-조건문\" style=\"position:relative;\"><a href=\"#1-on-%EC%A1%B0%EA%B1%B4%EB%AC%B8\" aria-label=\"1 on 조건문 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. on 조건문</h4>\n<p>on절 안의 메서드는 둘 다 해당 멤버가 갖고 있는 북마크와 리마인더만 조회하는 조건이다.\n여기에 리마인더는 추가로 알람 시각이 현재 시간보다 미래일 경우만 조회한다.\n따라서 조건에 맞춰 구체적인 이름을 지었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">return</span> jpaQueryFactory\n    <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token function\">getMessageResponseConstructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>bookmark<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">bookmarksFindByMemberId</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>reminder<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">remindersFindByMemberIdWhereRemindDateAfterNow</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4 id=\"2-where-조건문\" style=\"position:relative;\"><a href=\"#2-where-%EC%A1%B0%EA%B1%B4%EB%AC%B8\" aria-label=\"2 where 조건문 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. where 조건문</h4>\n<p>where 절 내의 메서드는 <code class=\"language-text\">where(meetAllConditions(channelIds, messageRequest)</code>로 <code class=\"language-text\">모든 조건을 만족하는 경우</code>라는 추상화된 내용만 들어가있다.\n사실 이 안에 너무 많은 조건이 감싸져 있긴 하다.\n정리하자면 다음과 같다.</p>\n<ul>\n<li>특정 채널들에 속한 메시지만 조회한다</li>\n<li>검색 키워드가 있다면, 해당 키워드가 본문에 존재하는 메시지만 조회한다</li>\n<li>본문이 빈 메시지는 조회 대상에서 제외한다</li>\n<li>기준삼는 메시지가 있다면, 해당 메시지의 작성시간 기준으로 조회한다\n<ul>\n<li>이 때, 조건에 따라 작성시간이 기준 메시지의 작성시간 이전/이후의 메시지로 추가 분기처리된다</li>\n</ul>\n</li>\n<li>기준삼는 메시지가 없다면, 특정 시간 기준으로 조회한다\n<ul>\n<li>이 때, 조건에 따라 작성시간이 특정 시간 이전/이후인 메시지로 추가 분기처리된다</li>\n</ul>\n</li>\n<li>기준삼는 메시지와 특정 시간이 둘 다 없다면, 작성시간 상관없이 조회한다</li>\n</ul>\n<p>처음에는 이 조건들을 메서드 명에 다 넣으려니 도저히 불가능했다.\n그래서 본문과 관련된 두 항목을 <code class=\"language-text\">본문에 따라 필터링</code>,\n그리고 아래 세 항목을 <code class=\"language-text\">작성 시간에 따라 필터링</code>이라는 항목으로 간추렸다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">return</span> jpaQueryFactory\n    <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token function\">getMessageResponseConstructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>bookmark<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">bookmarksFindByMemberId</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>reminder<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">remindersFindByMemberIdWhereRemindDateAfterNow</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token function\">inChannelsFilterByTextAndPostedDate</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>특정 채널들에 속해있으며, 본문과 작성 시간에 따라 필터링 된다고 요약된 이름이다.</p>\n<h4 id=\"3-orderby-조건문\" style=\"position:relative;\"><a href=\"#3-orderby-%EC%A1%B0%EA%B1%B4%EB%AC%B8\" aria-label=\"3 orderby 조건문 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. orderBy 조건문</h4>\n<p>기존 메서드 이름은 <code class=\"language-text\">arrangeDateByNeedPastMessage</code>였는데, 내부 로직은 결국 <code class=\"language-text\">posted_date</code>의 정렬 기준,\n즉 <code class=\"language-text\">decs/asc</code>를 결정하는 내용이었다.\n그래서 <code class=\"language-text\">오름차순/내림차순</code> 여부가 바뀐다는 내용을 이름에 넣었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">return</span> jpaQueryFactory\n    <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token function\">getMessageResponseConstructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token function\">postedDateDescOrAsc</span><span class=\"token punctuation\">(</span>needPastMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>최종적으로 바뀐 빌더 코드이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// before</span>\n<span class=\"token keyword\">return</span> jpaQueryFactory\n    <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token function\">getMessageResponseConstructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>member<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>bookmark<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">existsBookmark</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>reminder<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">remainReminder</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token function\">meetAllConditions</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token function\">arrangeDateByNeedPastMessage</span><span class=\"token punctuation\">(</span>needPastMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span>messageCount<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// after </span>\n<span class=\"token keyword\">return</span> jpaQueryFactory\n    <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token function\">getMessageResponseConstructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>member<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>bookmark<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">bookmarksFindByMemberId</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">leftJoin</span><span class=\"token punctuation\">(</span>reminder<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token function\">remindersFindByMemberIdWhereRemindDateAfterNow</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token function\">inChannelsFilterByTextAndPostedDate</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span><span class=\"token function\">postedDateDescOrAsc</span><span class=\"token punctuation\">(</span>needPastMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span>messageCount<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>메서드 이름이 많이 길긴 하지만, 실제로 어떤 조건으로 조회하는지 더 잘 보인다.\n추가로 해당 메서드 내부의 메서드들도 이름을 바꿨다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// before</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">BooleanExpression</span> <span class=\"token function\">inChannelsFilterByTextAndPostedDate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">channelIdsIn</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token function\">textContains</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getKeyword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token function\">messageHasText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token function\">decideMessageIdOrDate</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">isNeedPastMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// after</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">BooleanExpression</span> <span class=\"token function\">inChannelsFilterByTextAndPostedDate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">inChannels</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token function\">textContains</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getKeyword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token function\">textIsNotNullNorEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token function\">afterOrBeforeMessagePostedDateOrRequestDate</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">isNeedPastMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<h3 id=\"-서비스-로직은-서비스로\" style=\"position:relative;\"><a href=\"#-%EC%84%9C%EB%B9%84%EC%8A%A4-%EB%A1%9C%EC%A7%81%EC%9D%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EB%A1%9C\" aria-label=\" 서비스 로직은 서비스로 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🕊 서비스 로직은 서비스로</h3>\n<p>나머지 <code class=\"language-text\">public</code> 메서드인 <code class=\"language-text\">hasPast(), hasFuture()</code>은 메시지 조회 결과에 대해 각각 과거와 미래의 메시지 조회 결과가 더 있는지 확인하는 메서드다.\n피드에서 자유로운 날짜 이동과 양방향 무한스크롤을 구현하기 위해 페이지네이션을 없애고, 앞/뒤의 메시지를 추가로 불러오는 식으로 구현해 생겼다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">hasPast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> messageRequest<span class=\"token punctuation\">,</span>\n                        <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageResponse</span><span class=\"token punctuation\">></span></span> messages<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Integer</span> result <span class=\"token operator\">=</span> jpaQueryFactory\n        <span class=\"token punctuation\">.</span><span class=\"token function\">selectOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token function\">meetAllHasPastCondition</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">,</span> messages<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">fetchFirst</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> result <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">BooleanExpression</span> <span class=\"token function\">meetAllHasPastCondition</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> request<span class=\"token punctuation\">,</span>\n                                                    <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageResponse</span><span class=\"token punctuation\">></span></span> messages<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">MessageResponse</span> targetMessage <span class=\"token operator\">=</span> messages<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>messages<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token function\">inChannels</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token function\">textContains</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getKeyword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>postedDate<span class=\"token punctuation\">.</span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span>targetMessage<span class=\"token punctuation\">.</span><span class=\"token function\">getPostedDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>결국 이 메서드는 같은 조회 조건일 때 위의 <code class=\"language-text\">findMessages()</code>로 찾은 결과 목록에서,\n첫번째 결과 기준으로 과거/미래의 메시지가 더 존재하는지 조회한다.\n앞과 동일한 방식으로 이름을 개선했다.</p>\n<p>또, <code class=\"language-text\">messages.get(messages.size() - 1)</code>와 <code class=\"language-text\">messages.get(0)</code>로,\n조회 기준이 되는 메시지를 선정하는 건 서비스 레이어의 책임이라 생각해 파라미터를 변경했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">existsByChannelsBeforePostedDate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> messageRequest<span class=\"token punctuation\">,</span>\n                                                    <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageResponse</span> messageResponse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Integer</span> result <span class=\"token operator\">=</span> jpaQueryFactory\n        <span class=\"token punctuation\">.</span><span class=\"token function\">selectOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token function\">inChannelsFilterByTextBeforePostedDate</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">,</span> messageResponse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">fetchFirst</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> result <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">BooleanExpression</span> <span class=\"token function\">inChannelsFilterByTextBeforePostedDate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> request<span class=\"token punctuation\">,</span>\n                                                                <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageResponse</span> messageResponse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">inChannels</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token function\">textContains</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getKeyword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>postedDate<span class=\"token punctuation\">.</span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span>messageResponse<span class=\"token punctuation\">.</span><span class=\"token function\">getPostedDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>서비스 코드를 보면 맥락이 훨씬 뚜렷해졌다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// before</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">hasPast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> messageRequest<span class=\"token punctuation\">,</span>\n                        <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageResponse</span><span class=\"token punctuation\">></span></span> messages<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>messages<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>messages<span class=\"token punctuation\">.</span><span class=\"token function\">hasPast</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">,</span> messages<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// after</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">hasPast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> messageRequest<span class=\"token punctuation\">,</span>\n                        <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageResponse</span><span class=\"token punctuation\">></span></span> messages<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>messages<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token class-name\">MessageResponse</span> message <span class=\"token operator\">=</span> messages<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>messages<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>messages<span class=\"token punctuation\">.</span><span class=\"token function\">existsByChannelsBeforePostedDate</span><span class=\"token punctuation\">(</span>channelIds<span class=\"token punctuation\">,</span> messageRequest<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<h3 id=\"-레포지토리에게-dto-숨기기\" style=\"position:relative;\"><a href=\"#-%EB%A0%88%ED%8F%AC%EC%A7%80%ED%86%A0%EB%A6%AC%EC%97%90%EA%B2%8C-dto-%EC%88%A8%EA%B8%B0%EA%B8%B0\" aria-label=\" 레포지토리에게 dto 숨기기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤫 레포지토리에게 DTO 숨기기</h3>\n<p>현재 <code class=\"language-text\">QMessageRepository</code>는 <code class=\"language-text\">MessageService</code>에서 <code class=\"language-text\">MessageRequest</code> 객체를 받아와 값을 꺼내 사용한다.\n이 요청값 DTO가 컨트롤러부터 넘어왔다는 사실을 고려한다면, 레포지토리가 클라이언트에서 어떤 값을 받아오는지 알고 있는 상황이다.\n그래서 파라미터가 늘어남을 감수하고, 값을 꺼내서 받도록 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MessageService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageResponse</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findMessages</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> memberId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span>\n                                               <span class=\"token keyword\">final</span> <span class=\"token class-name\">MessageRequest</span> messageRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">boolean</span> needPastMessage <span class=\"token operator\">=</span> messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">isNeedPastMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageResponse</span><span class=\"token punctuation\">></span></span> messageResponses <span class=\"token operator\">=</span> messages<span class=\"token punctuation\">.</span><span class=\"token function\">findMessages</span><span class=\"token punctuation\">(</span>\n                memberId<span class=\"token punctuation\">,</span>\n                channelIds<span class=\"token punctuation\">,</span>\n                messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getKeyword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">isNeedPastMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                messageRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">QMessageRepository</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageResponse</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findMessages</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> memberId<span class=\"token punctuation\">,</span>\n                                              <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> channelIds<span class=\"token punctuation\">,</span>\n                                              <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> keyword<span class=\"token punctuation\">,</span>\n                                              <span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> messageId<span class=\"token punctuation\">,</span>\n                                              <span class=\"token keyword\">final</span> <span class=\"token class-name\">LocalDateTime</span> date<span class=\"token punctuation\">,</span>\n                                              <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> needPastMessage<span class=\"token punctuation\">,</span>\n                                              <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> messageCount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 레포지토리는 DTO를 알지 못한다!</p>\n<br>\n<h2 id=\"-마치며\" style=\"position:relative;\"><a href=\"#-%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\" 마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧹 마치며</h2>\n<p>구현이 급하고 <code class=\"language-text\">Querydsl</code>을 잘 몰랐을 때는 기존 구현 방식의 단점을 잘 몰랐다.\n그런데 여유가 생기고 프로젝트 구조에 익숙해지자, 보이지 않던 문제가 보이기 시작한다.</p>\n<p>솔직히 사용자 요구사항에 따른 기능 추가가 더 급해 리팩토링이 내키지 않을 때도 있다.\n하지만 깨끗한 코드 위에 새로운 코드를 올리는 것이, 결과적으로 복잡한 코드 사이를 헤매며 올리는 것 보다 대부분 더 빠르고 효율적이다.\n그래서 지속적인 리팩터링이 신규 개발 만큼 중요한 것이다.</p>\n<p>여담으로 요즘은 프로그래밍이 치워도 치워도 필연적으로 다시 더러워진다는 점에서 참 집안일 같다는 생각이 든다…</p>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9\">🧶 문제상황</a></p>\n<ul>\n<li>\n<p><a href=\"#-%EB%B9%84%EB%8C%80%ED%95%B4%EC%A7%84-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%BD%94%EB%93%9C\">🪐 비대해진 서비스 코드</a></p>\n</li>\n<li>\n<p><a href=\"#%EF%B8%8F-%EC%9D%BC%EB%8B%A8-%EB%A0%88%ED%8F%AC%EC%A7%80%ED%86%A0%EB%A6%AC-%EC%BD%94%EB%93%9C-%EB%B6%84%EB%A6%AC\">✂️ 일단 레포지토리 코드 분리</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%A9%94%EC%84%9C%EB%93%9C-%EC%9D%B4%EB%A6%84%EC%9D%84-%EB%AA%85%ED%99%95%ED%95%98%EA%B2%8C\">📛 메서드 이름을 명확하게</a></p>\n<ul>\n<li><a href=\"#1-on-%EC%A1%B0%EA%B1%B4%EB%AC%B8\">1. on 조건문</a></li>\n<li><a href=\"#2-where-%EC%A1%B0%EA%B1%B4%EB%AC%B8\">2. where 조건문</a></li>\n<li><a href=\"#3-orderby-%EC%A1%B0%EA%B1%B4%EB%AC%B8\">3. orderBy 조건문</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%84%9C%EB%B9%84%EC%8A%A4-%EB%A1%9C%EC%A7%81%EC%9D%80-%EC%84%9C%EB%B9%84%EC%8A%A4%EB%A1%9C\">🕊 서비스 로직은 서비스로</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%A0%88%ED%8F%AC%EC%A7%80%ED%86%A0%EB%A6%AC%EC%97%90%EA%B2%8C-dto-%EC%88%A8%EA%B8%B0%EA%B8%B0\">🤫 레포지토리에게 DTO 숨기기</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EB%A7%88%EC%B9%98%EB%A9%B0\">🧹 마치며</a></p>\n</li>\n</ul>\n</div>","excerpt":"🧶 문제상황 🪐 비대해진 서비스 코드 줍줍은 요청에 따라 동적으로 변화해야 하는 복잡한 조회 조건을 걸기 위해 을 도입했다.\n예전에 공부하며 가볍게 사용해 본 적은 있지만, 줍줍 요구사항만큼 복잡한 코드를 짜 본 적은 없었다.\n에  코드를 넣는 식으로 우선 구현했고, 무사히 배포되었다. 그러다 을 쓰지 않는 다른 서비스 클래스 코드를 보니 ‘어… 여기는 너무 깔끔한데?‘하는 위화감이 들었다.\n그리고 다시 을 쓰는 코드를 보니, 가 할 일이 에서 이뤄지고 있다는 생각이 들었다. 위에 있는 기존 의 짧은 예시 코드 내에서도  사용으로 인한 서비스 역할 비대화가 보인다.\n의 경우 DB에서 데이터를 가져오는 역할을 완벽히 에 맡기고 있다.\n반면, 는 DB에서 어떤 데이터를 가져올지 서비스 코드 상에 완전히 노출되어 있음을 볼 수 있다. 그래서 각 레이어 별 역할이 원칙대로 분리되도록  코드를 별도의  객체로 빼내는 리팩토링을 시작했다. ✂️ 일단 레포지토리 코드 분리  사용 예시를 보면 을…","frontmatter":{"date":"October 26, 2022","title":"Querydsl만의 아늑한 🏡 지어주기","categories":"Spring 트러블슈팅 etc","author":"써머","emoji":"headers/querydsl-refactoring.png"},"fields":{"slug":"/querydsl-refactoring/"}},"next":{"id":"48a52cee-5a60-549e-9e68-7293d2b558b7","html":"<h2 id=\"-문제상황\" style=\"position:relative;\"><a href=\"#-%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9\" aria-label=\" 문제상황 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💣 문제상황</h2>\n<p><a href=\"https://github.com/woowacourse-teams/2022-pickpick\">줍줍</a>에는 북마크 설정한 메시지를 모아서 보는 기능이 있다.\n기존에는 이 북마크 목록을 보여줄 때, 북마크가 등록 된 <strong>메시지의 생성 시간</strong> 순서대로 보여줬다.\n그러다 사용자 편의를 위해 이를 <strong>북마크 등록 시간</strong> 순서대로 보여주기로 바꿨다.\n이 때, 북마크 등록 시간을 편하게 관리하기 위해 <code class=\"language-text\">JPA Auditing</code>을 도입했다.\n그리고 <a href=\"https://github.com/woowacourse-teams/2022-pickpick/pull/568\">해당 PR</a>은 순조롭게 머지 되었는데…</p>\n<p>팀원 봄이 진행한 <a href=\"https://github.com/woowacourse-teams/2022-pickpick/pull/570\">컨트롤러 테스트를 WebMvcTest로 개선하는 PR</a>에서 문제가 생겼다.\n봄의 로컬에서 테스트가 잘 돌아가는 상태였는데, PR의 <a href=\"https://github.com/woowacourse-teams/2022-pickpick/actions/runs/3179844507/jobs/5182750602\">github action</a>에서는 테스트가 실패했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA60lEQVQY062PfWuDQAzG7/t/t1FY5/pi9fSUVtmqtSaXO1t9xl3HGGywfxb4kRCeJE9U8rqB1gWquoapaqSHDLt9iqI0KE2F9UsSc5ZrbHd7MDNCLMvyK4qYQUQYR4K1gpEIXX+JvTB87joEDVuLyzBgmm5xcJ5nzPPyA3UlAtHj6n+E8s5HZ845TH6C9x4iArECEQdmCyaObsNhthL1wfH3OmjDJ6ppW6ye16iaFrqucXp7j5hTExmYIbd7hJ37WmAjAiuPpfKZ1bXvcXxagfMC4yED5RrWVOBcY0w28KWBTzO4LMf93P358gfXNs4R38PsUAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"깃헙 액션 실패\"\n        title=\"깃헙 액션 실패\"\n        src=\"/static/d4cfb4b4007765978f585ce48e18552c/37523/ci_fail.png\"\n        srcset=\"/static/d4cfb4b4007765978f585ce48e18552c/e9ff0/ci_fail.png 180w,\n/static/d4cfb4b4007765978f585ce48e18552c/f21e7/ci_fail.png 360w,\n/static/d4cfb4b4007765978f585ce48e18552c/37523/ci_fail.png 720w,\n/static/d4cfb4b4007765978f585ce48e18552c/302a4/ci_fail.png 1080w,\n/static/d4cfb4b4007765978f585ce48e18552c/07a9c/ci_fail.png 1440w,\n/static/d4cfb4b4007765978f585ce48e18552c/95e59/ci_fail.png 1460w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">@WebMvcTest</code>로 변경한 모든 <code class=\"language-text\">RestDocs</code>용 컨트롤러 테스트가 같은 이유로 실패하고 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>IllegalStateException</span><span class=\"token operator\">:</span> <span class=\"token class-name\">Failed</span> <span class=\"token keyword\">to</span> <span class=\"token namespace\">load</span> <span class=\"token class-name\">ApplicationContext</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token class-name\">Caused</span> by<span class=\"token operator\">:</span> <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span></span>BeanCreationException</span><span class=\"token operator\">:</span> <span class=\"token class-name\">Error</span> creating bean <span class=\"token keyword\">with</span> <span class=\"token namespace\">name</span> 'jpaAuditingHandler'<span class=\"token operator\">:</span> <span class=\"token class-name\">Cannot</span> resolve reference <span class=\"token keyword\">to</span> <span class=\"token namespace\">bean</span> 'jpaMappingContext' <span class=\"token keyword\">while</span> setting constructor argument<span class=\"token punctuation\">;</span> \nnested exception is <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span></span>BeanCreationException</span><span class=\"token operator\">:</span> <span class=\"token class-name\">Error</span> creating bean <span class=\"token keyword\">with</span> <span class=\"token namespace\">name</span> 'jpaMappingContext'<span class=\"token operator\">:</span> <span class=\"token class-name\">Invocation</span> of init method failed<span class=\"token punctuation\">;</span> \nnested exception is <span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>IllegalArgumentException</span><span class=\"token operator\">:</span> <span class=\"token constant\">JPA</span> metamodel must not be empty<span class=\"token operator\">!</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token class-name\">Caused</span> by<span class=\"token operator\">:</span> <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span></span>BeanCreationException</span><span class=\"token operator\">:</span> <span class=\"token class-name\">Error</span> creating bean <span class=\"token keyword\">with</span> <span class=\"token namespace\">name</span> 'jpaMappingContext'<span class=\"token operator\">:</span> <span class=\"token class-name\">Invocation</span> of init method failed<span class=\"token punctuation\">;</span> \nnested exception is <span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>IllegalArgumentException</span><span class=\"token operator\">:</span> <span class=\"token constant\">JPA</span> metamodel must not be empty<span class=\"token operator\">!</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p><code class=\"language-text\">JPA metamodel must not be empty</code>라는 문구가 눈에 띈다.\n해당 문구로 라이브러리를 검색해보면 <code class=\"language-text\">JpaMetamodelMappingContext</code>라는 클래스가 나온다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JpaMetamodelMappingContext</span>\n\t\t<span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractMappingContext</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">JpaPersistentEntityImpl</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">JpaPersistentProperty</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Metamodels</span> models<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PersistenceProvider</span> persistenceProvider<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">/**\n\t * Creates a new JPA {@link Metamodel} based {@link MappingContext}.\n\t *\n\t * @param models must not be {@literal null} or empty.\n\t */</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">JpaMetamodelMappingContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Metamodel</span><span class=\"token punctuation\">></span></span> models<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">notNull</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">,</span> <span class=\"token string\">\"JPA metamodel must not be null!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">notEmpty</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">,</span> <span class=\"token string\">\"JPA metamodel must not be empty!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>사실 이 문구로 검색하면 많은 사람들이 해결법을 이미 올려두었다.\n그런데 여기까지 오니, <code class=\"language-text\">JPA metamodel</code>이 대체 뭔데? <code class=\"language-text\">null</code>도 아니고 <code class=\"language-text\">empty</code>라고?\n이거랑 <code class=\"language-text\">Auditing</code>은 무슨 상관이지? 등등 궁금한 점이 생겨서 코드를 조금 열어봤다.</p>\n<br>\n<h2 id=\"-jpa-metamodel\" style=\"position:relative;\"><a href=\"#-jpa-metamodel\" aria-label=\" jpa metamodel permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👾 JPA Metamodel</h2>\n<p>그렇다면 테스트가 잘 실행 될 때와, <code class=\"language-text\">@WebMvcTest</code>를 붙여 실행되지 않을 때, 저 <code class=\"language-text\">models</code>에는 무슨 값이 들어가있을까?\n정상적으로 실행되는 경우, <code class=\"language-text\">MetamodelImpl</code>이라는 클래스의 인스턴스에 엔티티 클래스와 관련된 정보가 담겨있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4UlEQVQoz22Sy24UMRBF538gQmJDJsn0w+5uv8ru12QGERFNku+ABYsACiD++CB7JNiwuK5Sq+t03eveDIPiGAzWCNoKXZYT1OBpekfTWZTJveWq1v9XpehdwMWRzcX4BfXhM/b0jH78ze7+J+3pF+r0k/rjC93DD5r7F94s33g1PnMxfeVi/qfX83feTp/ofWTwgc27xiHieJgnbmXPLCsiK0NWXDFxxU0HtF9o7MS1Dmwby2Vj2bau1J327FrNdlezyUfyFY/Jcu+FxyA8SSQ5h7GWwTqM97gQ8CJISjRac1M33NQ1V7uKqlUFeFU1bC53LZO0PI2eUxh5iiN3ITJ5YXQB40KxYrxgJTF4oekG2t5wXbdsd02B5WeV6vKGDdYojjIwO2HNgy6gC0gwIeIkFVgOvbNne1kZkKV6Q6268oFNXrNqW5xVaOvLQB72cSROMz5NxGlBSj+Slj2dcajBMLj8fo4kUOUMs+UMrJUiOF1sZYshTaR5ZVpvGZd9qfP+3M/7Q6k2xAIbXKC3nptGnTM8b6gIXjGESO+FMC3EZc9yOBbAcntkPbwvfVYG5BhMkFJzxtluAW6rbFdzlwyrjxwlcYwjxzQhaSy55Y1lnItyn3/ifAmN7kutdf8X+AeTsHTWx+/SzwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"metamodel\"\n        title=\"metamodel\"\n        src=\"/static/723d9c45ddb107118ff118a946096b8c/37523/models_not_empty.png\"\n        srcset=\"/static/723d9c45ddb107118ff118a946096b8c/e9ff0/models_not_empty.png 180w,\n/static/723d9c45ddb107118ff118a946096b8c/f21e7/models_not_empty.png 360w,\n/static/723d9c45ddb107118ff118a946096b8c/37523/models_not_empty.png 720w,\n/static/723d9c45ddb107118ff118a946096b8c/302a4/models_not_empty.png 1080w,\n/static/723d9c45ddb107118ff118a946096b8c/07a9c/models_not_empty.png 1440w,\n/static/723d9c45ddb107118ff118a946096b8c/95e59/models_not_empty.png 1460w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">@WebMvcTest</code>로 실행되지 않을 때는 해당 <code class=\"language-text\">models</code>가 비어있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.111111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAQklEQVQI10XISwqAMAwAUa9lBUvTTxJTt97/JiPYhYvHwGy9F55wTAPRi6pBtaX5pNn6ZThHrqQspK+//RRkODZvXqf9I/YqVpU1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"metamodel empty\"\n        title=\"metamodel empty\"\n        src=\"/static/9fccb72b921b1d2b7efe811c83d1dc54/37523/models_empty.png\"\n        srcset=\"/static/9fccb72b921b1d2b7efe811c83d1dc54/e9ff0/models_empty.png 180w,\n/static/9fccb72b921b1d2b7efe811c83d1dc54/f21e7/models_empty.png 360w,\n/static/9fccb72b921b1d2b7efe811c83d1dc54/37523/models_empty.png 720w,\n/static/9fccb72b921b1d2b7efe811c83d1dc54/302a4/models_empty.png 1080w,\n/static/9fccb72b921b1d2b7efe811c83d1dc54/07a9c/models_empty.png 1440w,\n/static/9fccb72b921b1d2b7efe811c83d1dc54/95e59/models_empty.png 1460w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이 이슈를 검색하면 제일 자주 나오는 해결법이 <code class=\"language-text\">@WebMvcTest</code>를 쓰는 곳에 아래와 같이 <code class=\"language-text\">@MockBean</code>을 추가로 사용하는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@WebMvcTest</span>\n<span class=\"token annotation punctuation\">@MockBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JpaMetamodelMappingContext</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ControllerTest</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>일단 이 해결법을 적용했었지만, 내부 코드를 열고 보니 의문이 든다.\n이렇게 하면 <code class=\"language-text\">JpaMetamodelMappingContext</code> 생성자의 <code class=\"language-text\">Assert</code>문이 실행되지 않으니 터지지는 않는다.\n그런데 컨트롤러 슬라이스 테스트에서 사용하지 않을 JPA 관련 빈을 모킹해주는 것이 맞을까?</p>\n<p>어쨌든 이 <code class=\"language-text\">MetamodelImpl</code>이 어디서 생성되는가를 보자면…</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAqUlEQVQY022NbWrDMBAFfZt6JdCHV1qngbpgS3ba+99nSlxampIfs7AP3rzBOYd3nvpWWNaF1m9s/aCYclln1q2ff9sPtrbT+nFmWTNn1/sHhp8wTQmtilnFbCbGQNLIpMo0FerVKJdKne0kpPBceD/OO5w4RASREZEXYgoUjZT7UE6UkjDLhOAZZfyV/ZcOz1a8CHp95X1b+OiN2/7N596YNSPyKPvr+AKZAH5yRHyEYwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"SessionFactoryObserver\"\n        title=\"SessionFactoryObserver\"\n        src=\"/static/6a7541ca966e3424be235b81315a3593/37523/sessionfactoryobserver.png\"\n        srcset=\"/static/6a7541ca966e3424be235b81315a3593/e9ff0/sessionfactoryobserver.png 180w,\n/static/6a7541ca966e3424be235b81315a3593/f21e7/sessionfactoryobserver.png 360w,\n/static/6a7541ca966e3424be235b81315a3593/37523/sessionfactoryobserver.png 720w,\n/static/6a7541ca966e3424be235b81315a3593/302a4/sessionfactoryobserver.png 1080w,\n/static/6a7541ca966e3424be235b81315a3593/07a9c/sessionfactoryobserver.png 1440w,\n/static/6a7541ca966e3424be235b81315a3593/95e59/sessionfactoryobserver.png 1460w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Incubating</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TypeConfiguration</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">SessionFactoryObserver</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MetamodelImplementor</span> <span class=\"token function\">scope</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SessionFactoryImplementor</span> sessionFactory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">debugf</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"Scoping TypeConfiguration [%s] to SessionFactoryImpl [%s]\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> sessionFactory <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span> <span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> importEntry <span class=\"token operator\">:</span> scope<span class=\"token punctuation\">.</span>metadataBuildingContext<span class=\"token punctuation\">.</span><span class=\"token function\">getMetadataCollector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getImports</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">entrySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> importMap<span class=\"token punctuation\">.</span><span class=\"token function\">containsKey</span><span class=\"token punctuation\">(</span> importEntry<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\n\t\t\timportMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span> importEntry<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> importEntry<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\tscope<span class=\"token punctuation\">.</span><span class=\"token function\">setSessionFactory</span><span class=\"token punctuation\">(</span> sessionFactory <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tsessionFactory<span class=\"token punctuation\">.</span><span class=\"token function\">addObserver</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">this</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MetamodelImpl</span><span class=\"token punctuation\">(</span> sessionFactory<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>  </code></pre></div>\n<p><code class=\"language-text\">SessionFactoryObserver</code>를 구현한 <code class=\"language-text\">TypeConfiguration</code> 클래스의 <code class=\"language-text\">scope</code>라는 메서드에서 생성해주고 있다.\n그리고 이 메서드를 호출하는 곳은 <code class=\"language-text\">Hibernate</code>의 <code class=\"language-text\">SessionFactoryImpl</code>라는 클래스다.\n이 클래스는 <code class=\"language-text\">JPA</code>의 <code class=\"language-text\">EntityManagerFactory</code>를 상속하고 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABIklEQVQoz31RW5KEIBDzOALy8gUICqhz/yNlCyzdnd2p/Qihi5BOVzeUUlBCUflfkMqEELCOYQ4TtpSQjhM+rGBFwxiarusglYQQooJzDiHLXVbctZSX5mYuOFSvoLSqmtKMFUPZCyzbgrjviPnAOI+Y/Ih4ZGwpo5972NUgph3pPBDzDu9X9EYjpBX5eGEYhit5MSzH3U1qWdMWqPGuBYQW9V3P+kokeB2bCQbK6JOucNNx9p0gH8jnif11Ih8n9vOFEDb0VsPHgLhnbDHVkdu2fUx+cnMvhVBSY9eOHb2YUahJYnYWxjmY4DAbC+sWKK3/mD0jv4EWwcUFetKwzsEtHsvqKxdo3b8ZfTT8LajpO44hBKxbrOOWRRljQUj78c8XcKH7CkIlBQUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"SessionFactoryImpl\"\n        title=\"SessionFactoryImpl\"\n        src=\"/static/759d4349731893465904fe5e8d57ae45/37523/SessionFactoryImpl.png\"\n        srcset=\"/static/759d4349731893465904fe5e8d57ae45/e9ff0/SessionFactoryImpl.png 180w,\n/static/759d4349731893465904fe5e8d57ae45/f21e7/SessionFactoryImpl.png 360w,\n/static/759d4349731893465904fe5e8d57ae45/37523/SessionFactoryImpl.png 720w,\n/static/759d4349731893465904fe5e8d57ae45/302a4/SessionFactoryImpl.png 1080w,\n/static/759d4349731893465904fe5e8d57ae45/07a9c/SessionFactoryImpl.png 1440w,\n/static/759d4349731893465904fe5e8d57ae45/95e59/SessionFactoryImpl.png 1460w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SessionFactoryImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">SessionFactoryImplementor</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">SessionFactoryImpl</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">MetadataImplementor</span> metadata<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token class-name\">SessionFactoryOptions</span> options<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token class-name\">QueryPlanCache<span class=\"token punctuation\">.</span>QueryPlanCreator</span> queryPlanCacheFunction<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MetamodelImpl</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>metamodel <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span>\n\t\t\tmetadata<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token function\">determineJpaMetaModelPopulationSetting</span><span class=\"token punctuation\">(</span> properties <span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>여기서 <code class=\"language-text\">MetamodelImpl.initialize()</code>를 호출하고…</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MetamodelImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">MetamodelImplementor</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MetadataImplementor</span> mappingMetadata<span class=\"token punctuation\">,</span> <span class=\"token class-name\">JpaMetaModelPopulationSetting</span> jpaMetaModelPopulationSetting<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>imports<span class=\"token punctuation\">.</span><span class=\"token function\">putAll</span><span class=\"token punctuation\">(</span> mappingMetadata<span class=\"token punctuation\">.</span><span class=\"token function\">getImports</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>파라미터로 전달받은 <code class=\"language-text\">mappingMetadata</code>에서 여러 값을 불러와 저장하게 된다.\n이 <code class=\"language-text\">mappingMetadata</code>는 <code class=\"language-text\">SessionFactoryBuilderImpl</code>을 통해 <code class=\"language-text\">SessionFactoryImpl</code>에 주입되고,\n<code class=\"language-text\">SessionFactoryBuilderImpl</code>은 <code class=\"language-text\">DefaultSessionFactoryBuilderService</code>을 통해 생성되는데…\n의 과정을 따라가다보니 어느새 <code class=\"language-text\">MetadataImpl</code>로 돌아오고 있었다. 😵</p>\n<p>결론은 이 <code class=\"language-text\">MetamodelImpl</code>은 엔티티 정보를 담은 JPA <code class=\"language-text\">Metamodel</code>의 하이버네이트의 구현체며, 그래서 <code class=\"language-text\">@WebMvcTest</code>에서 생성되지 않았던 것이다.\n원래 최초 생성 시점을 찾으려고 했는데 결국 찾지 못했다.</p>\n<p>JPA 관련 빈이 로딩되는 <code class=\"language-text\">@DataJpaTest</code>가 붙은 테스트는 <code class=\"language-text\">models</code>가 정상적으로 생성되어 있는 것을 볼 수 있었다.</p>\n<br>\n<h2 id=\"-enablejpaauditing\" style=\"position:relative;\"><a href=\"#-enablejpaauditing\" aria-label=\" enablejpaauditing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🎧 EnableJpaAuditing</h2>\n<p>그렇다면 어떤 경위로 이 <code class=\"language-text\">Metamodel</code>이 필요했던 걸까?\nAuditing을 위해 추가했던 <code class=\"language-text\">@EnableJpaAuditing</code> 어노테이션을 보면 <code class=\"language-text\">JpaAuditingRegistrar</code> 클래스를 import 하고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Import</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JpaAuditingRegistrar</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">EnableJpaAuditing</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">JpaAuditingRegistrar</code>는 spring data jpa에 들어있는데, spring의 <code class=\"language-text\">ImportBeanDefinitionRegistrar</code> 클래스를 상속하고 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAs0lEQVQY042P2w7CIBBE+zdYoGgv7LJQ2hf//5fGuLHaNDX6cDIJGU52Guccjlhr0V07RJkgUiD5Qy4zOAm899o7/m2OIs3WwnmLgQYwC1LOkFpU9JQSs3bf/Z24Ob0uBIxEIOIXBEqESIxIpDzfz678KpxEUMqMPFdIWSDLHVJmpdRFp/8U7idcjIH3DtPYg+OIlJImTQOcbWGM+X/ylqG/gXPGUitqrVjXVTOEDvbQ34QP1Xm6oawy5NYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"JpaAuditingRegistrar\"\n        title=\"JpaAuditingRegistrar\"\n        src=\"/static/03cf5aa0426628543dec4b0843ee2d35/37523/JpaAuditingRegistrar.png\"\n        srcset=\"/static/03cf5aa0426628543dec4b0843ee2d35/e9ff0/JpaAuditingRegistrar.png 180w,\n/static/03cf5aa0426628543dec4b0843ee2d35/f21e7/JpaAuditingRegistrar.png 360w,\n/static/03cf5aa0426628543dec4b0843ee2d35/37523/JpaAuditingRegistrar.png 720w,\n/static/03cf5aa0426628543dec4b0843ee2d35/302a4/JpaAuditingRegistrar.png 1080w,\n/static/03cf5aa0426628543dec4b0843ee2d35/07a9c/JpaAuditingRegistrar.png 1440w,\n/static/03cf5aa0426628543dec4b0843ee2d35/95e59/JpaAuditingRegistrar.png 1460w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><a href=\"https://javacan.tistory.com/entry/spring-at-enable-config\">스프링 @Enable 설정 세 가지 구현 방식 - 자바캔</a> 포스팅에서 해당 클래스 이해에 도움을 받았는데, 이 클래스를 구현해 빈 설정을 직접 등록할 수 있다고 한다.\n바로 상위의 <code class=\"language-text\">AuditingBeanDefinitionRegistrarSupport</code>에서 하위 <code class=\"language-text\">JpaAuditingRegistrar</code>의 <code class=\"language-text\">registerAuditListenerBeanDefinition</code>를 호출하고 있고…</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuditingBeanDefinitionRegistrarSupport</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ImportBeanDefinitionRegistrar</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">registerBeanDefinitions</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AnnotationMetadata</span> annotationMetadata<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanDefinitionRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">notNull</span><span class=\"token punctuation\">(</span>annotationMetadata<span class=\"token punctuation\">,</span> <span class=\"token string\">\"AnnotationMetadata must not be null\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">notNull</span><span class=\"token punctuation\">(</span>registry<span class=\"token punctuation\">,</span> <span class=\"token string\">\"BeanDefinitionRegistry must not be null\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token class-name\">AbstractBeanDefinition</span> ahbd <span class=\"token operator\">=</span> <span class=\"token function\">registerAuditHandlerBeanDefinition</span><span class=\"token punctuation\">(</span>registry<span class=\"token punctuation\">,</span> <span class=\"token function\">getConfiguration</span><span class=\"token punctuation\">(</span>annotationMetadata<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">registerAuditListenerBeanDefinition</span><span class=\"token punctuation\">(</span>ahbd<span class=\"token punctuation\">,</span> registry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>이 메서드에서 포스팅 초반에 봤던 키워드를 발견할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">JpaAuditingRegistrar</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AuditingBeanDefinitionRegistrarSupport</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">registerAuditListenerBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinition</span> auditingHandlerDefinition<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token class-name\">BeanDefinitionRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>registry<span class=\"token punctuation\">.</span><span class=\"token function\">containsBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JPA_MAPPING_CONTEXT_BEAN_NAME</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\tregistry<span class=\"token punctuation\">.</span><span class=\"token function\">registerBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JPA_MAPPING_CONTEXT_BEAN_NAME</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//</span>\n\t\t\t\t\t<span class=\"token keyword\">new</span> <span class=\"token class-name\">RootBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JpaMetamodelMappingContextFactoryBean</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p><code class=\"language-text\">JPA metamodel must not be empty</code> 에러 문구가 있던 <code class=\"language-text\">JpaMetamodelMappingContext</code> 클래스가 기억나는가?\n<code class=\"language-text\">JpaMetamodelMappingContextFactoryBean</code>라는 정직한 이름의 팩토리 빈에서 해당 클래스를 생성해주고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JpaMetamodelMappingContextFactoryBean</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractFactoryBean</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">JpaMetamodelMappingContext</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationContextAware</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">protected</span> <span class=\"token class-name\">JpaMetamodelMappingContext</span> <span class=\"token function\">createInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">LOG</span><span class=\"token punctuation\">.</span><span class=\"token function\">isDebugEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token constant\">LOG</span><span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Initializing JpaMetamodelMappingContext…\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token class-name\">JpaMetamodelMappingContext</span> context <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JpaMetamodelMappingContext</span><span class=\"token punctuation\">(</span><span class=\"token function\">getMetamodels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        context<span class=\"token punctuation\">.</span><span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">LOG</span><span class=\"token punctuation\">.</span><span class=\"token function\">isDebugEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token constant\">LOG</span><span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Finished initializing JpaMetamodelMappingContext!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token keyword\">return</span> context<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token comment\">/**\n\t * Obtains all {@link Metamodel} instances of the current {@link ApplicationContext}.\n\t **/</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Metamodel</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getMetamodels</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanFactory <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"BeanFactory must not be null!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">EntityManagerFactory</span><span class=\"token punctuation\">></span></span> factories <span class=\"token operator\">=</span> <span class=\"token class-name\">BeanFactoryUtils</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">beansOfTypeIncludingAncestors</span><span class=\"token punctuation\">(</span>beanFactory<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EntityManagerFactory</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">return</span> factories<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EntityManagerFactory</span><span class=\"token operator\">::</span><span class=\"token function\">getMetamodel</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StreamUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">toUnmodifiableSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">getMetamodels()</code> 메서드에 친절하게 현재 애플리케이션 컨텍스트의 모든 <code class=\"language-text\">Metamodel</code> 인스턴스를 찾는다고 적혀있다.\n아까 보았던 <code class=\"language-text\">EntityManagerFactory</code>도 보인다.</p>\n<br>\n<h2 id=\"-더-나은-해결법\" style=\"position:relative;\"><a href=\"#-%EB%8D%94-%EB%82%98%EC%9D%80-%ED%95%B4%EA%B2%B0%EB%B2%95\" aria-label=\" 더 나은 해결법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👀 더 나은 해결법?</h2>\n<p><code class=\"language-text\">@WebMvcTest</code>로 실행할 때는 JPA 관련 빈이 로딩되지 않아서. 라는 이유를 납득하기 위해 많이 돌아왔다.\n<code class=\"language-text\">@MockBean</code>을 쓰면 <code class=\"language-text\">@WebMvcTest</code>를 사용하는 테스트가 늘어날 때 마다 붙여줘야 한다는 문제가 있다.\n하지만 이 사소한 귀찮음이 진짜 문제는 아니라고 생각한다.\n<strong>진짜 문제</strong>는 <code class=\"language-text\">@WebMvcTest</code>에서 의도한 대로 빈 설정이 분리되고 있지 않는 상황이 아닐까?</p>\n<p>Auditing을 도입할 때, <code class=\"language-text\">Application</code> 클래스에 <code class=\"language-text\">@EnableJpaAuditing</code>을 붙였었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@EnableJpaAuditing</span>\n<span class=\"token annotation punctuation\">@ConfigurationPropertiesScan</span>\n<span class=\"token annotation punctuation\">@SpringBootApplication</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PickpickApplication</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PickpickApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">@MockBean</code> 해결법이 검색에 많이 나오는 걸 보면, 이렇게 설정한 사람들이 많은 듯 하다.\n이를 <code class=\"language-text\">@Configuration</code> 클래스를 분리해 <code class=\"language-text\">@EnableJpaAuditing</code>를 거기 붙이는 해결 방법이 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ConfigurationPropertiesScan</span>\n<span class=\"token annotation punctuation\">@SpringBootApplication</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PickpickApplication</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PickpickApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableJpaAuditing</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuditingConfig</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 하면 <code class=\"language-text\">@WebMvcTest</code>에서 <code class=\"language-text\">@MockBean</code>을 사용하지 않아도 된다.\n해당 방식으로 리팩토링 하기를 제안해봐야겠다.</p>\n<br>\n<h3 id=\"-부록---자바독을-잘-읽자\" style=\"position:relative;\"><a href=\"#-%EB%B6%80%EB%A1%9D---%EC%9E%90%EB%B0%94%EB%8F%85%EC%9D%84-%EC%9E%98-%EC%9D%BD%EC%9E%90\" aria-label=\" 부록   자바독을 잘 읽자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 부록 - 자바독을 잘 읽자</h3>\n<p>추가로 볼만한 부분이 있다.\nAuditing을 사용할 엔티티에 붙이는 리스너 클래스다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@EntityListeners</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuditingEntityListener</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Bookmark</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>해당 리스너 클래스의 자바독 주석을 보면 <code class=\"language-text\">@Configuration</code> 클래스를 분리한 것을 볼 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token comment\">/**\n * JPA entity listener to capture auditing information on persiting and updating entities. To get this one flying be\n * sure you configure it as entity listener in your {@code orm.xml} as follows:\n * ...\n * After that it's just a matter of activating auditing in your Spring config:\n *\n * @Configuration\n * @EnableJpaAuditing\n * class ApplicationConfig {\n *\n * }\n */</span>\n<span class=\"token annotation punctuation\">@Configurable</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuditingEntityListener</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>물론 베스트 프랙티스라고 올려둔 것은 아니겠으나… 자바독을 챙겨보는 습관을 기르면 도움이 될 것 같다.</p>\n<p>로컬에서 잘 돌아가고, 머지 때 충돌도 나지 않는 코드가, 깃헙 액션에서 터지는 이번 같은 때가 종종 있다.\nCI 구축… 참 소중하다.</p>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9\">💣 문제상황</a></p>\n</li>\n<li>\n<p><a href=\"#-jpa-metamodel\">👾 JPA Metamodel</a></p>\n</li>\n<li>\n<p><a href=\"#-enablejpaauditing\">🎧 EnableJpaAuditing</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%8D%94-%EB%82%98%EC%9D%80-%ED%95%B4%EA%B2%B0%EB%B2%95\">👀 더 나은 해결법?</a></p>\n<ul>\n<li><a href=\"#-%EB%B6%80%EB%A1%9D---%EC%9E%90%EB%B0%94%EB%8F%85%EC%9D%84-%EC%9E%98-%EC%9D%BD%EC%9E%90\">📚 부록 - 자바독을 잘 읽자</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"October 14, 2022","title":"[JPA] EnableJpaAuditing의 내부와 CI의 소중함","categories":"Spring JPA 트러블슈팅","author":"써머","emoji":"headers/jpa-auditing-and-ci.png"},"fields":{"slug":"/jpa-auditing-and-ci/"}},"prev":{"id":"4d5fe298-4d67-5c79-80f0-499dab5410cb","html":"<p>유난히 길고 힘들었던 2022년이 지났다.\n<code class=\"language-text\">우아한테크코스</code>와 <code class=\"language-text\">취업</code>이라는 두가지로 축약되는 해였다.\n글을 쓰기 시작한 건 작년 30일인데, 이제야 올리려니 머쓱하지만😓 그래도 회고 완성했다!</p>\n<h2 id=\"-취업-회고\" style=\"position:relative;\"><a href=\"#-%EC%B7%A8%EC%97%85-%ED%9A%8C%EA%B3%A0\" aria-label=\" 취업 회고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔥 취업 회고</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWklEQVQoz42Su04CURCGj2aFgsTO+DQisVd4EyvfQFsrE1oTEwsLbWzQaLIFndGIhsQLuBhRlIsCguyuO5/hnFWReJtkkrn9c+Y/M4pQRISfRCTgl+QXV70302Evj3RtpJtFXrLG7uUMzs8hro24WcTLahs/r3GDw4QNfQOqJMFRULKQogUXCsoJ89hjHBoK6mNGawqaKZML8R8N+wGdqM5RP1Q0cxEojuHlFZ6T0CVBI87tiaLlRHkuRemUFPKUZHCgzwmDV+20Cik2VkZYXJgkvTTB+vIonfMZnevdJ1iYH2c1Pcnm2gRbaxa0UiFl/3vK7nUSx1bkd2Icb8co7Cq4mf6g7N0qeuUor5UIbrlPOfkH5btZuFRwNWr0TCHOlCnp/+GDgpoFVUvbP1MOtyS9Y4J2hqC9b7SVgZcDQ8s/Qty9cNO2tvFPwwmHtjx8h4OXZQAB8s87fAMf/IN2kh164QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"logos\"\n        title=\"logos\"\n        src=\"/static/7d1128fd3c29b3008abc10749a50d554/37523/logos.png\"\n        srcset=\"/static/7d1128fd3c29b3008abc10749a50d554/e9ff0/logos.png 180w,\n/static/7d1128fd3c29b3008abc10749a50d554/f21e7/logos.png 360w,\n/static/7d1128fd3c29b3008abc10749a50d554/37523/logos.png 720w,\n/static/7d1128fd3c29b3008abc10749a50d554/302a4/logos.png 1080w,\n/static/7d1128fd3c29b3008abc10749a50d554/07a9c/logos.png 1440w,\n/static/7d1128fd3c29b3008abc10749a50d554/efb68/logos.png 2032w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>감사하게도 <code class=\"language-text\">디어</code>와 <code class=\"language-text\">카카오페이</code>, 그리고 다른 두 곳에 최종 합격했다.\n카카오페이 합격 통보 시점에 나머지 진행 중이었던 곳들은 중단한다는 연락을 드렸다.\n모두 진지하게 고려중인 회사였으나, 현실적으로 두 회사의 입사일 전에 결과가 나오기 어려운 상황이었다.</p>\n<p>22년도 안에, 그러니까 해가 바뀌기 전에 취업하기가 목표였는데 기대보다 좋은 결과로 무사히 달성했다.\n<code class=\"language-text\">비전공자 10개월 교육으로 네카라쿠배 취업?!</code> 같은 어그로 업적을 달성한 스스로가 자랑스럽기도 하고(ㅋㅋ)\n취업연계를 제외한 곳에서도 예상 외의 좋은 기회를 많이 받았기에 어떤 점이 좋았고 아쉬웠는지 정리해봤다.</p>\n<h3 id=\"-이건-정말-잘했다\" style=\"position:relative;\"><a href=\"#-%EC%9D%B4%EA%B1%B4-%EC%A0%95%EB%A7%90-%EC%9E%98%ED%96%88%EB%8B%A4\" aria-label=\" 이건 정말 잘했다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💯 이건 정말 잘했다</h3>\n<ul>\n<li>\n<h4 id=\"블로그를-썼다\" style=\"position:relative;\"><a href=\"#%EB%B8%94%EB%A1%9C%EA%B7%B8%EB%A5%BC-%EC%8D%BC%EB%8B%A4\" aria-label=\"블로그를 썼다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>블로그를 썼다!!!</h4>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAc0lEQVQY041O0Q7DIAj0/7/M7/DZB0oraIpeYxM7tmzJSMjBcQeEMQZmTPS1xxgjcs5vus9cs+CNPhbXe0dKCcyMX1rPh5fx+1UzAxFBRP77cDXbxiBiHEeBiIJ5h6qitYbztJufWWtFKRPbPVOtMOvPwgurCzsdJYbuKwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"posts\"\n        title=\"posts\"\n        src=\"/static/e4810d65da543b12f6c88f15b70a2e4e/37523/posts.png\"\n        srcset=\"/static/e4810d65da543b12f6c88f15b70a2e4e/e9ff0/posts.png 180w,\n/static/e4810d65da543b12f6c88f15b70a2e4e/f21e7/posts.png 360w,\n/static/e4810d65da543b12f6c88f15b70a2e4e/37523/posts.png 720w,\n/static/e4810d65da543b12f6c88f15b70a2e4e/302a4/posts.png 1080w,\n/static/e4810d65da543b12f6c88f15b70a2e4e/07a9c/posts.png 1440w,\n/static/e4810d65da543b12f6c88f15b70a2e4e/31d79/posts.png 1954w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>우테코 기간 동안 블로그를 성실히 쓴 다른 크루들에 비하면 글 수는 적다.\n면접 보던 시점에 포스팅이 20개 정도 있었으니, 2주에 하나쯤 쓴 셈이다.\n그럼에도 면접에서 블로그에 대한 긍정적인 피드백을 많이 들었다.\n면접관 중에는 우테코를 모르는 분들도 계셔서 간략하게 부트캠프라고만 소개했는데,\n부트캠프 과정과 별개로 스스로 공부하고 생각한 내용을 꾸준히 정리했다는 점이 좋았다 짚어주신 적이 있다.\n블로그를 안했으면 취업이 어려웠을 거라는 생각이 든다.</p>\n<ul>\n<li>\n<h4 id=\"연차-신경쓰지-않고-지원했고-실제로-서류-통과한-곳이-꽤-있었다\" style=\"position:relative;\"><a href=\"#%EC%97%B0%EC%B0%A8-%EC%8B%A0%EA%B2%BD%EC%93%B0%EC%A7%80-%EC%95%8A%EA%B3%A0-%EC%A7%80%EC%9B%90%ED%96%88%EA%B3%A0-%EC%8B%A4%EC%A0%9C%EB%A1%9C-%EC%84%9C%EB%A5%98-%ED%86%B5%EA%B3%BC%ED%95%9C-%EA%B3%B3%EC%9D%B4-%EA%BD%A4-%EC%9E%88%EC%97%88%EB%8B%A4\" aria-label=\"연차 신경쓰지 않고 지원했고 실제로 서류 통과한 곳이 꽤 있었다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>연차 신경쓰지 않고 지원했고, 실제로 서류 통과한 곳이 꽤 있었다</h4>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABvElEQVQoz22SXWsTQRSG9weJv8H/4B/oraCUXlmpV1rBS5WCeCFeKFKskgaVprYqhTbrthGjdmtR080mm02ym02azQfJfswjE5PtFj0wzAznnWfecziKEIJZdLtdGo06TcehVjXxWi7NZpMwDImiCNd1J0tqXKmp1QiCYPJ2xlHkwfM8HMeh3W7TG4T4XpUvW/dIh4TW63Vs28b1Opz6fU5Kpf8DWy0Xx21hW2W+f8rwOXeXnbUFjK9Zhj2H6YsErm08Zj/3LLmnq1TSQsfYZfflPHvrN1Az1/nw/Aql4qtJLo7jyd4f9Hn6YJ77cxfRte1pLjrvcCbW8084eHub/ewi6ouraOuL/DxYTVwI8Vf363CL1aVLrCxc/selkhaW9RzFjysUXi9ReHOTwsYy5tG7xIWM0WjI5totlucu8OjOtSksnn4oUNJ0EQc0zAKVo02qx9tUjt8TBYNzJXuugV7IspN5iH74jROjjGVZiUslgQnBeDwmCAXDQY9gNCAIY4LwrD8SattyrFyM3z8Io4hUzWclz4DyJ9M0qVYtOp1TKqY5mUMJkmMjR0bTNFQ1z15epVgs4vt+qseCP2BVmLpnHdUEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dogo meme\"\n        title=\"dogo meme\"\n        src=\"/static/d63d01a3d5cc2ec5b00d2b98ed3849f7/37523/dogo.png\"\n        srcset=\"/static/d63d01a3d5cc2ec5b00d2b98ed3849f7/e9ff0/dogo.png 180w,\n/static/d63d01a3d5cc2ec5b00d2b98ed3849f7/f21e7/dogo.png 360w,\n/static/d63d01a3d5cc2ec5b00d2b98ed3849f7/37523/dogo.png 720w,\n/static/d63d01a3d5cc2ec5b00d2b98ed3849f7/302a4/dogo.png 1080w,\n/static/d63d01a3d5cc2ec5b00d2b98ed3849f7/07a9c/dogo.png 1440w,\n/static/d63d01a3d5cc2ec5b00d2b98ed3849f7/093ec/dogo.png 1930w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>최종 합격을 받았던 곳 중 조건이 3년차인 곳도 있었다.\n어차피 정말 신입이 갈 수 없는 자리면 서류에서 거를 거란 생각으로 많은 지원을 했다.\n그렇게 넣지 않으면 넣을 곳이 없었다…ㅎㅎ\n어떤 곳에서는 면접 때 신입이라 면접에 못 올 줄 알았다 했더니 도전하는 마음가짐이 좋다는 얘기를 해주셨다.😄\n좋게 봐주셔서 정말 감사했다.</p>\n<ul>\n<li>\n<h4 id=\"이력서와-면접을-위해-여러-노력을-했다\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%A0%A5%EC%84%9C%EC%99%80-%EB%A9%B4%EC%A0%91%EC%9D%84-%EC%9C%84%ED%95%B4-%EC%97%AC%EB%9F%AC-%EB%85%B8%EB%A0%A5%EC%9D%84-%ED%96%88%EB%8B%A4\" aria-label=\"이력서와 면접을 위해 여러 노력을 했다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이력서와 면접을 위해 여러 노력을 했다</h4>\n</li>\n</ul>\n<p>이력서 속의 자신이 가증스러워서🙃 누구 보여주기가 참 부끄러웠는데…\n나름 용기내서 씨유께 피드백 부탁드린 걸 시작으로 주위에 개선을 위한 도움을 요청했다.\n그래서 구직을 종료하는 순간까지도, 계속 더 나은 버전을 만들 수 있었다.\n흔쾌히 도와주신 모든 분들께 감사드린다.<br>\n면접은 스터디가 큰 도움이 됐다.\n내가 모르는 것이 무엇인지 확실히 알게되었을 뿐 더러, 다른 크루들이 우테코 기간동안 어떤 걸 집중해서 공부했는지 보고 배움을 보충할 수 있었다.</p>\n<br>\n<h3 id=\"-이것까지-신경썼다면-더-좋았을-걸\" style=\"position:relative;\"><a href=\"#-%EC%9D%B4%EA%B2%83%EA%B9%8C%EC%A7%80-%EC%8B%A0%EA%B2%BD%EC%8D%BC%EB%8B%A4%EB%A9%B4-%EB%8D%94-%EC%A2%8B%EC%95%98%EC%9D%84-%EA%B1%B8\" aria-label=\" 이것까지 신경썼다면 더 좋았을 걸 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👀 이것까지 신경썼다면 더 좋았을 걸</h3>\n<ul>\n<li>\n<h4 id=\"정작-아껴뒀던-기업-중에-지원을-못-한-곳이-많다\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EC%9E%91-%EC%95%84%EA%BB%B4%EB%92%80%EB%8D%98-%EA%B8%B0%EC%97%85-%EC%A4%91%EC%97%90-%EC%A7%80%EC%9B%90%EC%9D%84-%EB%AA%BB-%ED%95%9C-%EA%B3%B3%EC%9D%B4-%EB%A7%8E%EB%8B%A4\" aria-label=\"정작 아껴뒀던 기업 중에 지원을 못 한 곳이 많다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정작 아껴뒀던 기업 중에 지원을 못 한 곳이 많다</h4>\n</li>\n</ul>\n<p>이 부분은 정말 크게 후회중이다!😭\n카카오페이 합격 후 취소했던 곳들도 합격했더라면 정말 진지하게 고려할 곳들이었고,\n공고를 정리한 노션을 보니 가고싶었는데 지원하지 않은 곳들이 많았다.\n확률이 크진 않았을 거라 생각하지만 어쨌든 복권을 긁어서 꽝이 나온 것과 안 긁어본 것은 다르니까…</p>\n<ul>\n<li>\n<h4 id=\"지원을-많이-해서-일정-분배가-어려웠다\" style=\"position:relative;\"><a href=\"#%EC%A7%80%EC%9B%90%EC%9D%84-%EB%A7%8E%EC%9D%B4-%ED%95%B4%EC%84%9C-%EC%9D%BC%EC%A0%95-%EB%B6%84%EB%B0%B0%EA%B0%80-%EC%96%B4%EB%A0%A4%EC%9B%A0%EB%8B%A4\" aria-label=\"지원을 많이 해서 일정 분배가 어려웠다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>지원을 많이 해서 일정 분배가 어려웠다</h4>\n</li>\n</ul>\n<p>사실 서류 통과를 많이 성공한 건 아닌데, 이상하게 면접 일정이 몰려서 잡힌 때가 많았다.\n과제나 코딩 테스트까지 겹치면 우선순위를 정하기 쉽지 않았다.\n왜이렇게 무식하게 지원을 많이 했나 추억하는 의미로 쓰던 노션 캡쳐를 올려본다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5ElEQVQ4y21Ujc7aMBDj/R9v0rZvDCjwoVHa5j9tkobg6Q6oKDQSlUhcx/bddTUMA8aUQGscE1JK6EOEcQ63UuCcg1IK1+uVcXnM0EohDAPa+ozjdoMYI79H5yshBKy1TEgHtGphcZHufknO8N7jdZGIXAqi7OBOB4QYeY/Wih63243/hBCQrxleWdTbE0q5wmgNrTVecd45xHFEfzlDbdbo+x7WmjshgSagdxhCRDIt1P4n39p1LYyZE5LdlDMr9KcjhhAmdzPCvveIlKEWOG++HrmOnOOSQt/U6DZrzjfnzOczyyQ9pohea1yqHYOklFPGTxwXMmcY0eHyfZjOPgidtehDQJIC6s+vB6H4IKRoSGFsaqi/X6DdUsqCQu8RqPxGw+53bMUY80FIThIVRQq2zcXM47JCKorXDf7tfnB+BCZFS4SDVvDthS+m3wchZcNFMRr1oZp607lly4HaZv2bydNjOFbvQFJkdIdqe8+wbdsFy56nSmsDIyXvlVtZVvjM0FTbF4Vzy9YYng7fNND7aq7wvbFZoRQ4bNYMogl4jt5r8YjEiw7toWInyxlyHyY4rXCudkyuKfg3wqdC1bZojkce14nwfVLIctISZnf/itT1mZv7vcrUAVYq+K5jJ89J+Q+7TY7wYJF2NQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"applies\"\n        title=\"applies\"\n        src=\"/static/37262b7dc8e7e76675083acb1555bf32/37523/list.png\"\n        srcset=\"/static/37262b7dc8e7e76675083acb1555bf32/e9ff0/list.png 180w,\n/static/37262b7dc8e7e76675083acb1555bf32/f21e7/list.png 360w,\n/static/37262b7dc8e7e76675083acb1555bf32/37523/list.png 720w,\n/static/37262b7dc8e7e76675083acb1555bf32/302a4/list.png 1080w,\n/static/37262b7dc8e7e76675083acb1555bf32/07a9c/list.png 1440w,\n/static/37262b7dc8e7e76675083acb1555bf32/17009/list.png 1932w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>심지어 다 캡쳐한 것도 아니다 😓</p>\n<br>  \n<h3 id=\"-취업-후에-남은-생각들\" style=\"position:relative;\"><a href=\"#-%EC%B7%A8%EC%97%85-%ED%9B%84%EC%97%90-%EB%82%A8%EC%9D%80-%EC%83%9D%EA%B0%81%EB%93%A4\" aria-label=\" 취업 후에 남은 생각들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧶 취업 후에 남은 생각들</h3>\n<p>처음 면접을 보러 갈 때만 해도 취업을 못할까봐 무서웠다.\n대학생 때 스타트업을 하겠답시고 휴학하고 뛰쳐나간 나는 성적도 좋지 않았고,\n전공도 개발과 관련이 없었으며,\n프리랜서로 일해 증명하기 어려운 공백기가 있는,\n그러니까 취업에 불리한 점만 종합선물세트로 모아놓은 상황이었다.\n하지만 면접을 통해 내 경험과 생각을 다른 사람에게 말로 전하면서,\n취업 성공 여부와는 별개로 내면을 다질 수 있었다.</p>\n<p>레벨2 때 브라운과 면담 중 나는 바보인데 잘하는 사람 너무 많다는 얘기를 했다.\n그때 브라운이 <code class=\"language-text\">잘하는 사람의 잘하는 면을 따라하기보다, 써머만의 장점을 돋보이게 하면 어때요?</code>라는 조언을 해주셨다.\n물론 위로되는 말이었지만 한편으로는 저는 장점이 없어욧😭 하는 생각이 들었는데…\n면접을 거치며 브라운이 했던 <code class=\"language-text\">내 장점을 돋보이게 해라</code>의 진짜 의미를 알게 되었다.</p>\n<p>흔히 컴공, 소프트웨어 전공을 제외한 개발자를 <code class=\"language-text\">비전공자</code>라고 부른다.\n난 비전공자라 잘 못한다는 틀에 스스로를 가두지 말라는 말을 들으면서도, 가끔은 모르는게 당연하다는 변명으로 써먹었던 것 같다.\n하지만 요즘은 <code class=\"language-text\">나는 비전공자 아니지. 디자인 전공자잖아!</code> 가 되었다.</p>\n<p>평범한 사람인 나는, 대학 4년 교육의 차이를 어찌해도 단숨에 따라갈 수 없다.\n따라갈 수 있다고 말하면 오만이라 생각한다.\n하지만 내가 디자인을 전공했기에, 다른 사람들보다 잘 할 수 있는 점이 분명히 있다.\n디자인 전공인 나는 남들보다 프론트엔드와 잘 얘기할 수 있고, 기술을 모르는 사람들의 입장에서 소통할 줄 안다.\n또, 전공이 아님에도 노력해서 단기간에 이만큼 쌓았으니 앞으로 더 잘할 수 있다는 강점을 어필할 수 있었다.\n물론 기술면접에서 나쁘지 않은 결과를 보여줬기에 가능한 얘기다.😅</p>\n<br>\n<h2 id=\"-우아한테크코스를-떠나며\" style=\"position:relative;\"><a href=\"#-%EC%9A%B0%EC%95%84%ED%95%9C%ED%85%8C%ED%81%AC%EC%BD%94%EC%8A%A4%EB%A5%BC-%EB%96%A0%EB%82%98%EB%A9%B0\" aria-label=\" 우아한테크코스를 떠나며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🌈 우아한테크코스를 떠나며</h2>\n<p>작년 한 해, 정말 많이 힘들었다.\n하굣길에 엉엉 운 날도 있고, 막바지엔 개인적인 사정으로 진지하게 우테코를 그만둘까도 고려했다.\n내 성취가 힘들었던 시간이나 어떤 사건에 대한 교환물이라고 생각하지 않음에도…\n지금도 가끔 이럴만한 가치가 있었을까? 하는 생각이 든다.</p>\n<p>그런데도 작년을 행복하고 즐거웠다고 말할 수 있는 건, 우테코에서 만난 사람들이 있어서다.\n친한 크루에게 짓궂은 농담으로 <code class=\"language-text\">퇴사하고 브라운조랑 알고 지내기</code> vs <code class=\"language-text\">회사다니고 브라운조랑 연락 끊기</code>를 물어본 적이 있다.\n(솔직히 전환된 게 부러워서 그랬다ㅎㅎ 미안합니다)\n그 크루는 전자를 골랐고, 나도 같은 마음이다.</p>\n<p>늘 의지했던 브라운과 브라운조 가족들, 믿음직한 선배같았던 공원, 매번 귀찮게 굴어도 잘 알려주신 제이슨,\n우테코 무사히 마칠 수 있도록 배려해주신 포비와 모든 코치분들,\n그리고 너무 멋진 줍줍 팀원들까지,\n모두 우테코에서 만난 소중한 인연이다.🤧</p>\n<p>우테코에서 말로 다 못할 만큼 많은 배려와 애정을 받았고,\n앞으로 개발자로 걷는 길에서 만나는 사람들에게 받은 감정만큼 베풀면서 살아가고 싶다.\n우테코를 떠나는 것이 내 인생이라는 이야기 속 한 장의 멋진 마무리자, 다음 장으로 넘어가는 설레는 순간으로 느껴진다.\n함께 떠나는 모든 사람들의 앞날에 행복하고 즐거운 일이 가득하길 바란다.</p>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EC%B7%A8%EC%97%85-%ED%9A%8C%EA%B3%A0\">🔥 취업 회고</a></p>\n<ul>\n<li><a href=\"#-%EC%9D%B4%EA%B1%B4-%EC%A0%95%EB%A7%90-%EC%9E%98%ED%96%88%EB%8B%A4\">💯 이건 정말 잘했다</a></li>\n<li><a href=\"#-%EC%9D%B4%EA%B2%83%EA%B9%8C%EC%A7%80-%EC%8B%A0%EA%B2%BD%EC%8D%BC%EB%8B%A4%EB%A9%B4-%EB%8D%94-%EC%A2%8B%EC%95%98%EC%9D%84-%EA%B1%B8\">👀 이것까지 신경썼다면 더 좋았을 걸</a></li>\n<li><a href=\"#-%EC%B7%A8%EC%97%85-%ED%9B%84%EC%97%90-%EB%82%A8%EC%9D%80-%EC%83%9D%EA%B0%81%EB%93%A4\">🧶 취업 후에 남은 생각들</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EC%9A%B0%EC%95%84%ED%95%9C%ED%85%8C%ED%81%AC%EC%BD%94%EC%8A%A4%EB%A5%BC-%EB%96%A0%EB%82%98%EB%A9%B0\">🌈 우아한테크코스를 떠나며</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"January 06, 2023","title":"우아한테크코스를 떠나며","categories":"회고 우아한테크코스","author":"써머","emoji":"headers/goodbye-2022.png"},"fields":{"slug":"/goodbye-2022/"}},"site":{"siteMetadata":{"siteUrl":"https://hyewoncc.github.io","comments":{"utterances":{"repo":"hyewoncc/hyewoncc.github.io"}}}}},"pageContext":{"slug":"/querydsl-refactoring/","nextSlug":"/jpa-auditing-and-ci/","prevSlug":"/goodbye-2022/"}},"staticQueryHashes":["1073350324","1956554647","2938748437","3350743975"]}