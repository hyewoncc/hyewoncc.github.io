{"componentChunkName":"component---src-templates-blog-template-js","path":"/how-can-collect-time/","result":{"data":{"cur":{"id":"880db91f-acbb-52ed-aee2-ad41974cea40","html":"<p>지난 반 년간 회사에서 한 ‘개발’을 돌아봤을 때, 절반은 Node.js의 레거시를 스프링으로 옮기고, 그에 수반되는 작업에 해당되고,\n나머지 절반은 동시에 새로운 요구사항을 Node.js와 옮긴 신규 시스템에 붙이는 일에 해당되는 것 같다. ‘달리는 기차의 바퀴를 갈아 끼우’면서 동시에 열차 칸을 열심히 붙이고 있다.</p>\n<p>나는 레거시라는 단어의 절묘함을 좋아한다.\n레거시가 있어서 회사가 먹고 살았고, 나도 들어올 수 있었다는 점에서 ‘유산’이라는 의미가 딱 맞다.\n그리고 동시에 언제까지나 유산에 의지해서 살 수 없다는 면도 그렇다.\n그래서 레거시를 부정적인 뜻으로만 사용하는 걸 보면 조금 슬퍼진다.</p>\n<p>어쨌든 레거시 코드를 보며 회사 도메인 정책을 파악하는 일이, 좋은 사내 문서와 더 좋은 살아있는 레퍼런스인 팀원들이 있음에도 만만치 않았다.\n예외 상황은 너무 많았고 코드가 복잡해 쉽게 파악할 수 없었으며, 아무도 그렇게 돌아가고 있는 줄 모르던 부분을 발견하기도 했다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABn0lEQVR42o3P20uTARzGcf8JwYs8vBPPJzQ8bIp7N3GUlSgpTr0Z87jBLkSZZBjMaQZ1lQaFIDh5TUi9mDciyFC8UN+peIAdNEQLFJoGzUu3b9C6ULB4fze/i4fnA08cty5yc/Pn78lbPM3LpqawgIr8HAw6EZ26HHVxARbTY1obnuDzHcU6kchtgrj7wAOvjJiUhCYxhYeJAnXVOsz1tVSWFKFSPSAvJ4NAIKgcPPTKGAQBUVBRnprOM70ec62BmrIiitOTyc1NwxfwKwf3tzapjE9Ak5yJJr8CndbAI7EKUa2lNCuDlDQB/3FAAfg3PAn6GGiuxm6swmbU47CbeDts4aWtia5GLW3P9Zx+VQBGo7HwR+iCxck+FsZbWJgwsy7ZkV2juD44cM+P4JaGCF2c3un8A4zGwMsQ0pgNyWFk7pUVj8PJSv9r5j9Nsr0rs7HhJRy+vtP572T/cZAhq4mpLgufe/rxDI6y+s7J7Jte3EsSaztuwtc/lYPfzr/z0TnIdEc3s+2drEy954tngHGplTGXlZnlF1z9Ort38m/ETkTqbVwjEAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"두뇌 풀 가동\"\n        title=\"\"\n        src=\"/static/90a74a039afdd7dd2a75efd40f713e3b/37523/full.png\"\n        srcset=\"/static/90a74a039afdd7dd2a75efd40f713e3b/e9ff0/full.png 180w,\n/static/90a74a039afdd7dd2a75efd40f713e3b/f21e7/full.png 360w,\n/static/90a74a039afdd7dd2a75efd40f713e3b/37523/full.png 720w,\n/static/90a74a039afdd7dd2a75efd40f713e3b/302a4/full.png 1080w,\n/static/90a74a039afdd7dd2a75efd40f713e3b/07a9c/full.png 1440w,\n/static/90a74a039afdd7dd2a75efd40f713e3b/c6162/full.png 2166w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div style=\"text-align:center; font-style:italic; color:grey;\">\n  레거시 코드에서 정책을 파악하는 나\n</div>\n<br>\n<p>그러다 팀에서 인프런 <a href=\"https://www.inflearn.com/course/practical-testing-%EC%8B%A4%EC%9A%A9%EC%A0%81%EC%9D%B8-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EA%B0%80%EC%9D%B4%EB%93%9C\">박우빈 님의 실용적인 테스트 가이드</a>를 듣고 얘기하는 단기 스터디를 하게 되었다.<br>\n그 중에 ‘테스트는 문서니까 개발자스러운 용어 보다 사용자에 가깝게 쓰라’는 말이 있었다.</p>\n<p>이 얘기를 듣기 전까지 대략 이런 식으로 노드 테스트 코드를 짜고 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getTransferDiscountInfo'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        service<span class=\"token punctuation\">.</span>_useRepo<span class=\"token punctuation\">.</span>getLastEndedUseBeforeTimeByUserId <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        service<span class=\"token punctuation\">.</span>getTransferSpan <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'마지막 이용이 없다면 예외를 던진다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        service<span class=\"token punctuation\">.</span>_useRepo<span class=\"token punctuation\">.</span>getLastEndedUseBeforeTimeByUserId<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span>Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> applicable <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">getTransferDiscountInfo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2023-05-17 14:00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>applicable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'마지막 이용으로부터 환승 가능 시간이 지났다면 예외를 던진다'</span> <span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        service<span class=\"token punctuation\">.</span>_useRepo<span class=\"token punctuation\">.</span>getLastEndedUseBeforeTimeByUserId<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span>Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">use_end_at</span><span class=\"token operator\">:</span><span class=\"token string\">'2023-05-17 13:00:00'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">use_area_id</span><span class=\"token operator\">:</span> <span class=\"token number\">199</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        service<span class=\"token punctuation\">.</span>getTransferSpan<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span>Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">minutes</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> applicable <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">getTransferDiscountInfo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2023-05-17 13:30:01'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>applicable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'마지막 이용으로부터 환승 가능 시작 시간과 종료 시간을 반환한다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        service<span class=\"token punctuation\">.</span>_useRepo<span class=\"token punctuation\">.</span>getLastEndedUseBeforeTimeByUserId<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span>Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">use_end_at</span><span class=\"token operator\">:</span><span class=\"token string\">'2023-05-17 13:00:00'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">use_area_id</span><span class=\"token operator\">:</span> <span class=\"token number\">199</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        service<span class=\"token punctuation\">.</span>getTransferSpan<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span>Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">minutes</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> applicable<span class=\"token punctuation\">,</span> from<span class=\"token punctuation\">,</span> to <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">getTransferDiscountInfo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2023-05-17 13:00:10'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>applicable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">'YYYY-MM-DD HH:mm:ss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2023-05-17 13:00:00'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">'YYYY-MM-DD HH:mm:ss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2023-05-17 13:30:00'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>나쁘진 않은 것 같은데, 문서로 쓰기에 충분하지 않다는 생각이 든다.\n대표적으로 개발자의 언어로 쓰여진 ‘예외를 던진다’ 부분이 그렇다.</p>\n<p>이 테스트를 처음 보는 상황이라 가정하고 봤을 때, 우선 예외를 던진다더니 예외를 검증하고 있지 않아서 이 테스트가 제대로 짜인 테스트가 맞는지 의구심이 든다.\n더 나아가 입사 초의 나라면 마지막 이용이 없다는 게 처음 이용했다는 뜻이 맞나? 내 추측이 맞나? 고민하다 정책을 파악하고 싶었을 뿐인데 구체 레벨로 내려가서 또 사투를 벌였을 것 같다.</p>\n<p>그래서 요즘은 팀 스터디 후 액션 플랜으로 나온 ‘도메인 용어를 사용해 누구나 이해할 수 있는 설명을 쓴다’는 작성 규칙에 따라 이렇게 쓰려고 노력하고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'현재 시간 기준으로 환승 가능 여부와 가능한 시간을 조회한다.'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        service<span class=\"token punctuation\">.</span>_useRepo<span class=\"token punctuation\">.</span>getLastEndedUseBeforeTimeByUserId <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        service<span class=\"token punctuation\">.</span>getTransferSpan <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'유저의 첫 이용이라면 환승이 적용되지 않는다.'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        service<span class=\"token punctuation\">.</span>_useRepo<span class=\"token punctuation\">.</span>getLastEndedUseBeforeTimeByUserId<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span>Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> applicable <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">getTransferDiscountInfo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2023-05-17 14:00:00'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>applicable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'이용한 적이 있다면, 마지막 이용의 종료 시간에 환승 가능 시간을 더한다.'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'이미 그 시간이 지났다면 환승 불가능하다.'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            service<span class=\"token punctuation\">.</span>_useRepo<span class=\"token punctuation\">.</span>getLastEndedUseBeforeTimeByUserId<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span>Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">use_end_at</span><span class=\"token operator\">:</span><span class=\"token string\">'2023-05-17 13:00:00'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">use_area_id</span><span class=\"token operator\">:</span> <span class=\"token number\">199</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            service<span class=\"token punctuation\">.</span>getTransferSpan<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span>Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">minutes</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> applicable <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">getTransferDiscountInfo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2023-05-17 13:30:01'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>applicable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'그 시간이 지나지 않았다면 환승 가능하다. 환승 가능 시작 시간과 종료 시간을 계산한다.'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            service<span class=\"token punctuation\">.</span>_useRepo<span class=\"token punctuation\">.</span>getLastEndedUseBeforeTimeByUserId<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span>Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">use_end_at</span><span class=\"token operator\">:</span><span class=\"token string\">'2023-05-17 13:00:00'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">use_area_id</span><span class=\"token operator\">:</span> <span class=\"token number\">199</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            service<span class=\"token punctuation\">.</span>getTransferSpan<span class=\"token punctuation\">.</span><span class=\"token function\">mockResolvedValue</span><span class=\"token punctuation\">(</span>Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">minutes</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> applicable<span class=\"token punctuation\">,</span> from<span class=\"token punctuation\">,</span> to <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> service<span class=\"token punctuation\">.</span><span class=\"token function\">getTransferDiscountInfo</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2023-05-17 13:00:10'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>applicable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n            <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">'YYYY-MM-DD HH:mm:ss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2023-05-17 13:00:00'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">'YYYY-MM-DD HH:mm:ss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2023-05-17 13:30:00'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAnElEQVR42lWO2w6DIABD/ZPpBk4QBJWLgs7Llv3/H3UR48MeTto0adMsJxylbOCmFT7uCMsX4/yBn3YM8xsubOjcBN4Y3Ms6UVD+R05Y0pJrZAXhyCmD7C3MsKSyGV6wYYWLGzo/g8keleggWodnrXF7VIlr6NADyhSyK6BCorUR2gTYcT3fxfOdbD1qZSG0S/5A9SNIJf9GKVf4AfN0XJRKwWX1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"테스트 실행 결과\"\n        title=\"\"\n        src=\"/static/96b524911433d64af3f5eb72922faeb2/37523/result.png\"\n        srcset=\"/static/96b524911433d64af3f5eb72922faeb2/e9ff0/result.png 180w,\n/static/96b524911433d64af3f5eb72922faeb2/f21e7/result.png 360w,\n/static/96b524911433d64af3f5eb72922faeb2/37523/result.png 720w,\n/static/96b524911433d64af3f5eb72922faeb2/302a4/result.png 1080w,\n/static/96b524911433d64af3f5eb72922faeb2/07a9c/result.png 1440w,\n/static/96b524911433d64af3f5eb72922faeb2/d7ceb/result.png 1446w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>코드는 그대로지만 정책 파악에 훨씬 도움되는 테스트가 되었다.</p>\n<br>\n<p>회사에서 정말 재미있게 일하다 시계를 보면, 늘 왜 벌써 퇴근 시간이야?! 를 외치게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 420px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHqUaJmBvFsQmD/xAAbEAADAQADAQAAAAAAAAAAAAAAAQIRAxQhMf/aAAgBAQABBQJVQ3ysXZR4fJ3RzqcJmH//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAdEAABBAIDAAAAAAAAAAAAAAABAAIQIRESMUFR/9oACAEBAAY/AkGh2vrkQT3Fxg8K4//EABwQAQEBAAMAAwAAAAAAAAAAAAERACExQVFhsf/aAAgBAQABPyFXJ19unkJV/DW2ZwWcmRiBJ6PeE8kc9uDuPhj5SW6N/9oADAMBAAIAAwAAABBzwAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAcEAEAAgMBAQEAAAAAAAAAAAABADERIUFhUbH/2gAIAQEAAT8QDehzZWYa1N4c7o87LN4fMMJ5NJa/QLIRUJuUVCYcBR2PWUtdmwACM6cffIt1n//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"아무것도 안했는데\"\n        title=\"\"\n        src=\"/static/69fbd19e3c01d2a2392cc0af76f7d868/65f94/offwork.jpg\"\n        srcset=\"/static/69fbd19e3c01d2a2392cc0af76f7d868/4ec73/offwork.jpg 180w,\n/static/69fbd19e3c01d2a2392cc0af76f7d868/158ba/offwork.jpg 360w,\n/static/69fbd19e3c01d2a2392cc0af76f7d868/65f94/offwork.jpg 420w\"\n        sizes=\"(max-width: 420px) 100vw, 420px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>초반에는 이게 너무 신기했고, 내가 일에 잘 몰입하고 있다는 증거 같아서 기뻤는데…\n이 얘기를 했을 때 팀원이 지금은 그 기분을 만끽해도 좋지만, 아마 조만간 하루를 효율적으로 쓰기에 대해 고민하게 될 거라 했었다.\n일에 적응하니 그 시기가 금방 온 것 같다.</p>\n<p>왜 벌써 퇴근 시간이야를 진지하게 고민 하다 보면, 저번에 읽었던 코드 또 읽느라 낭비한 시간,\n정책을 찾느라 문서를 뒤지거나 누군가에게 물어봤던 시간(이러면 심지어 두 명분의 시간이 된다), 요구 사항을 잘못 이해해 잘못 짠 코드를 고친 시간,\n오류가 났는데 대응 메뉴얼을 만들어 두지 않아서 매번 내가 직접 무언가 수정해야했던 시간… 등등이 떠오르는 것이다.</p>\n<p>기술적으로 어려운 부분이 있어서 공부를 했거나 애쓴 시간은 아쉽긴 하지만 뭐 아까운 마음은 들지 않는다.\n오히려 새로운 걸 배웠으니 뿌듯한 마음도 있다.\n그런데 기술 외적으로 헤매던 시간을 생각하면 좀 많이 아깝다.</p>\n<p>테스트 코드 설명을 잘 쓰는 게 그렇게까지 중요한 일인가? 이번만 보고 말 문서 같은데 굳이 고쳐둬야 할까? 같은 방심이 모여서 일의 효율성을 떨어트리는 것 같다.<br>\n그리고 사실 이런 일은… 해 두면 언젠가 모두에게 좋다는 건 아는데, 늘 지금 하기엔 아까운 마음이 든다.</p>\n<p>이런 자잘하게 개선이 필요한 일들을 나서서 해주는 좋은 팀원이 있는데, 나도 좀 더 적극적으로 나서서 해봐야겠다.</p>\n<br>","excerpt":"지난 반 년간 회사에서 한 ‘개발’을 돌아봤을 때, 절반은 Node.js의 레거시를 스프링으로 옮기고, 그에 수반되는 작업에 해당되고,\n나머지 절반은 동시에 새로운 요구사항을 Node.js와 옮긴 신규 시스템에 붙이는 일에 해당되는 것 같다. ‘달리는 기차의 바퀴를 갈아 끼우’면서 동시에 열차 칸을 열심히 붙이고 있다. 나는 레거시라는 단어의 절묘함을 좋아한다.\n레거시가 있어서 회사가 먹고 살았고, 나도 들어올 수 있었다는 점에서 ‘유산’이라는 의미가 딱 맞다.\n그리고 동시에 언제까지나 유산에 의지해서 살 수 없다는 면도 그렇다.\n그래서 레거시를 부정적인 뜻으로만 사용하는 걸 보면 조금 슬퍼진다. 어쨌든 레거시 코드를 보며 회사 도메인 정책을 파악하는 일이, 좋은 사내 문서와 더 좋은 살아있는 레퍼런스인 팀원들이 있음에도 만만치 않았다.\n예외 상황은 너무 많았고 코드가 복잡해 쉽게 파악할 수 없었으며, 아무도 그렇게 돌아가고 있는 줄 모르던 부분을 발견하기도 했다.  그러다 팀에서…","frontmatter":{"date":"July 02, 2023","title":"새는 시간을 줄이고 싶다는 고민","categories":"etc 회고","author":"써머","emoji":"headers/how-can-collect-time.png"},"fields":{"slug":"/how-can-collect-time/"}},"next":{"id":"bf219710-390f-5cde-918c-40c4ce3086ca","html":"<h2 id=\"️-문제-상황\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\" aria-label=\"️ 문제 상황 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⚡️ 문제 상황</h2>\n<p>언젠가부터 백엔드 서버 배포 직후에 아주 짧은 서비스 순단이 일어났다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.555555555555557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAZ0lEQVR42m2MSwqAIBRF2/92oq3UIIg+A7Wflk/7WN5IokkduHAGhxvxQUHbBTfe+7CbiQy0scE7qVALCSEyNEUC0u3Tn2+/7Q6TXRGxXkKb/8OZTHDej6jYCMFTlHkMovbTb+4Ihxf2oJqshiIhMAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"데이터독 로그\"\n        title=\"\"\n        src=\"/static/8aef0bdae49e0e866850d2f48ebcb9b4/37523/datadog_log.png\"\n        srcset=\"/static/8aef0bdae49e0e866850d2f48ebcb9b4/e9ff0/datadog_log.png 180w,\n/static/8aef0bdae49e0e866850d2f48ebcb9b4/f21e7/datadog_log.png 360w,\n/static/8aef0bdae49e0e866850d2f48ebcb9b4/37523/datadog_log.png 720w,\n/static/8aef0bdae49e0e866850d2f48ebcb9b4/302a4/datadog_log.png 1080w,\n/static/8aef0bdae49e0e866850d2f48ebcb9b4/07a9c/datadog_log.png 1440w,\n/static/8aef0bdae49e0e866850d2f48ebcb9b4/d3d45/datadog_log.png 1614w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>배포 직후 외부 API를 호출 할 때 DNS 조회에 실패하는 걸로 추정되었다.\n여러번 발생하는 에러가 아니기에 다른 팀원이 애플리케이션 실행 후 트래픽 허용 전, <code class=\"language-text\">nslookup</code>으로 호출하는 모든 도메인을 한 번씩 조회하도록 배포 스크립트를 수정했다.\nDNS 조회 결과를 캐싱할 것으로 기대했기 때문이다.</p>\n<p>하지만 조치 후에도 여전히 <code class=\"language-text\">EAI_AGAIN</code>이라는 동일한 에러 메시지와 함께 순단이 발생했다.\n순단으로 인해 틀어진 여러 정합을 수동으로 맞춰야 하는 상황을 없애기 위해 이번 스프린트에 해결을 목표했다.</p>\n<br>\n<h2 id=\"-eai_again은-어디에서-오는가\" style=\"position:relative;\"><a href=\"#-eai_again%EC%9D%80-%EC%96%B4%EB%94%94%EC%97%90%EC%84%9C-%EC%98%A4%EB%8A%94%EA%B0%80\" aria-label=\" eai_again은 어디에서 오는가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧶 EAI_AGAIN은 어디에서 오는가</h2>\n<p>이 코드를 누가 언제 왜 던지는가 부터 알기 위해 라이브러리를 포함해 코드를 검색했는데 나오지 않았다.\n그래서 함수 이름으로 추정되는 <code class=\"language-text\">getaddrinfo</code>를 검색해보고, 에러 콜스택도 읽어봤다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAZklEQVR42i2MgQqAIAxE+/+/LA1EnVMrxQwuthqMd/cGW67xYM6J4zwRIsHHiECkWdbuO6y1ynXdsBmj/eN3897DOQdmxoJ/xhigxOBclPKs1AORkrrEGblUpXhx0iW31tF6x31PvLn4l5LSsxdjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"에러 콜스택\"\n        title=\"\"\n        src=\"/static/3d841a7863112fee934981180cac0112/37523/error_call_stack.png\"\n        srcset=\"/static/3d841a7863112fee934981180cac0112/e9ff0/error_call_stack.png 180w,\n/static/3d841a7863112fee934981180cac0112/f21e7/error_call_stack.png 360w,\n/static/3d841a7863112fee934981180cac0112/37523/error_call_stack.png 720w,\n/static/3d841a7863112fee934981180cac0112/302a4/error_call_stack.png 1080w,\n/static/3d841a7863112fee934981180cac0112/07a9c/error_call_stack.png 1440w,\n/static/3d841a7863112fee934981180cac0112/7db30/error_call_stack.png 1494w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>프로젝트 및 노드 모듈 코드 내에 <code class=\"language-text\">getaddrinfo</code>라는 함수는 없었고, 대신 노드 모듈 내의 <code class=\"language-text\">dns.d.ts</code> 파일의 주석에 언급이 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"> <span class=\"token operator\">*</span> See the <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Implementation considerations section</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token keyword\">for</span> more information<span class=\"token punctuation\">.</span>\n <span class=\"token operator\">*</span> <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">see</span></span> <span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>nodejs<span class=\"token operator\">/</span>node<span class=\"token operator\">/</span>blob<span class=\"token operator\">/</span>v16<span class=\"token punctuation\">.</span><span class=\"token number\">9.0</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>dns<span class=\"token punctuation\">.</span>js<span class=\"token punctuation\">)</span>\n <span class=\"token operator\">*</span><span class=\"token operator\">/</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'dns'</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> dnsPromises <span class=\"token keyword\">from</span> <span class=\"token string\">'node:dns/promises'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Supported getaddrinfo flags.</span>\n    <span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">ADDRCONFIG</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">...</span></code></pre></div>\n<br>\n<p>그리고 해당 파일의 제일 상단 주석에서 node DNS 모듈 내 <code class=\"language-text\">lockup()</code>과 다른 메서드들의 역할을 알 수 있었다.</p>\n<blockquote>\n<p>The <code class=\"language-text\">dns</code> module enables name resolution. For example, use it to look up IP addresses of host names. Although named for the <a href=\"https://en.wikipedia.org/wiki/Domain_Name_System\">Domain Name System (DNS)</a>, it does not always use the DNS protocol for lookups… (생략)</p>\n</blockquote>\n<p>설명은 대략 이런 내용이었다.</p>\n<p><code class=\"language-text\">dns.lookup()</code>은 DNS 조회를 운영체제 기능을 통해 수행한다. 네트워크 통신이 일어나지 않을 수도 있다.\n시스템의 다른 애플리케이션들과 동일한 방식으로 동작하는 DNS 조회를 할 수 있다.</p>\n<p>반면 다른 메서드들은 실제 DNS 서버에 연결해 항상 네트워크를 통해 조회한다. <code class=\"language-text\">lookup()</code>과 사용하는 설정값이 다르다.\n다른 DNS 조회 기능을 사용하지 않고 언제나 네트워크를 통해 수행하고 싶다면 <code class=\"language-text\">resolve()</code>와 같은 다른 메서드를 사용하면 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB20lEQVR42n3PTWiSARzH8R061cE5bDmfpsu09QQqDV0WMnKtZ9q0lpYWsaHEGFnCoKIGCyrKw3aIXk6xWxRF1KW9pfXQXizKgl7oYDRih7EOvtZV/cbsUtR2+vE7/D/8/jUAlUplOSgWcgQCHqQDLiSvxKmgHc/+Dvw9fjwBD26/i7Y9rbS7d2HebqBerWBiaqJ6WyqVqlnzJ1go5OkLdRMJd3E9YiF+vpETPe30RvsJhgIEQ0FcB/fS6ZNosYmIFh0JOf4vWC6Xq2UpU+DsMSvyORVzQypmhlTcjRpwdzqwOXZgbTXTYjdhtVtwudqwOcwk5Kf/W/gbzObzHO6WeHKmAXlQ4EFEz2h4M8PhrezzSex02hi5ESOd/sTX+TTuQ26mnk2uvDCXyyLoDBx3buB1rIEXl+q5E9Xw+LSRI0Ev3qMBPnz+SPFnjkf3byNs28jcm+TKYDaTQWjSolHU8dCjYaZPYCzUxNhuPbdszYwOiLwbv8ni4gLXBjrQmfQkU69WAbMZjGIzW9QC4+tqSa1VMKmtI+FUMXtSyezlRt7K98j9KBK7MojWtGl1cPll0WTBIqiZrlXyfo2CeNd6pkcEnvcqGe73Mf99iW8LX7h49QJGq0gy9fIv8Bcj4MGUs39DGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"푸 노안 짤\"\n        title=\"\"\n        src=\"/static/c9327bf6aee2bb3e651f1e359117c6df/37523/pooh.png\"\n        srcset=\"/static/c9327bf6aee2bb3e651f1e359117c6df/e9ff0/pooh.png 180w,\n/static/c9327bf6aee2bb3e651f1e359117c6df/f21e7/pooh.png 360w,\n/static/c9327bf6aee2bb3e651f1e359117c6df/37523/pooh.png 720w,\n/static/c9327bf6aee2bb3e651f1e359117c6df/302a4/pooh.png 1080w,\n/static/c9327bf6aee2bb3e651f1e359117c6df/07a9c/pooh.png 1440w,\n/static/c9327bf6aee2bb3e651f1e359117c6df/c0566/pooh.png 1544w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>난 에러 코드의 뜻을 알고 싶었을 뿐인데 서먹한 개념들만 나온다…\n에러 콜스택에서 <code class=\"language-text\">onlookup()</code>이라는 비슷한 이름의 메서드를 봤으니 이 메서드를 찾아봤다.</p>\n<p>어쩐지 모듈 내 코드에는 없고, 주석에 링크가 있던 <code class=\"language-text\">dns.js</code> 파일에서 발견할 수 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">onlookup</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> addresses</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token function\">dnsException</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> <span class=\"token string\">'getaddrinfo'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>hostname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> addresses<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>family <span class=\"token operator\">||</span> <span class=\"token function\">isIP</span><span class=\"token punctuation\">(</span>addresses<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">lookup</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">hostname<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> hints <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> family <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> all <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> verbatim <span class=\"token operator\">=</span> <span class=\"token function\">getDefaultVerbatim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">...</span>\n\n  <span class=\"token keyword\">const</span> req <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GetAddrInfoReqWrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 콜스택에서 본 친구다!  </span>\n  req<span class=\"token punctuation\">.</span>callback <span class=\"token operator\">=</span> callback<span class=\"token punctuation\">;</span>\n  req<span class=\"token punctuation\">.</span>family <span class=\"token operator\">=</span> family<span class=\"token punctuation\">;</span>\n  req<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">=</span> hostname<span class=\"token punctuation\">;</span>\n  req<span class=\"token punctuation\">.</span>oncomplete <span class=\"token operator\">=</span> all <span class=\"token operator\">?</span> onlookupall <span class=\"token operator\">:</span> onlookup<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 완료되면 onlookup을 호출하는구나 짐작된다  </span>\n  <span class=\"token operator\">...</span>\n\n  <span class=\"token keyword\">return</span> req<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>콜스택에서 봤던 <code class=\"language-text\">GetAddrInfoReqWrap.onlookup()</code>가 있었고, 해당 모듈과 다른 모듈의 테스트 코드에서 에러 코드를 찾을 수 있었다.</p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> dnsPromises <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dns'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>promises<span class=\"token punctuation\">;</span>\n\ndnsPromises<span class=\"token punctuation\">.</span><span class=\"token function\">lookupService</span><span class=\"token punctuation\">(</span><span class=\"token string\">'127.0.0.1'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>common<span class=\"token punctuation\">.</span><span class=\"token function\">mustCall</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ssh'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">strictEqual</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> result<span class=\"token punctuation\">.</span>hostname<span class=\"token punctuation\">,</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">notStrictEqual</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>hostname<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Use an IP from the RFC 5737 test range to cause an error.</span>\n<span class=\"token comment\">// Refs: https://tools.ietf.org/html/rfc5737</span>\nassert<span class=\"token punctuation\">.</span><span class=\"token function\">rejects</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> dnsPromises<span class=\"token punctuation\">.</span><span class=\"token function\">lookupService</span><span class=\"token punctuation\">(</span><span class=\"token string\">'192.0.2.1'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">code</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^(?:ENOTFOUND|EAI_AGAIN)$</span><span class=\"token regex-delimiter\">/</span></span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p><code class=\"language-text\">dns.lookup()</code>이 OS 기능을 사용한다는 것과 에러 코드 정의가 없는 것을 봤을 때, <code class=\"language-text\">EAI_AGAIN</code>은 OS에서 반환하는 코드인 것 같았다.\n그렇다면 배포 스크립트의 <code class=\"language-text\">nslookup</code>이 성공하지 않았던 것일까?\n배포 로그를 봤을 때 그건 아니었다. 잘 조회되고 있었다.</p>\n<p>사실 이쯤 해서 시도할 해결책은 결정나 있었다.\n팀원이 언급한 적 있던 <a href=\"https://github.com/yahoo/dnscache\">dnscache</a>로 노드 애플리케이션에서 별도 캐싱을 적용하는 것이었다.\n서버 로그를 봤을 때, 배포 직후 첫 요청에 실패하는 것이 아니라 새로운 서버에 트래픽이 흐르고 1~2분 지났을 시점에 한두건의 요청이 실패한다는 특정한 패턴이 있었다.\n그래서 애플리케이션 단에서 캐싱을 적용하면 해결될 것으로 기대했다.</p>\n<p>어쨌든 에러 코드의 명확한 스펙을 알게된 건 아니라 더 찾아보았다.\n사실 여기서 시간을 엄청나게 소비했는데…\n검색해보면 정보가 잘 안나왔다.</p>\n<p>특히 노드 모듈 테스트 코드도 그랬고, 틀린 도메인이나 설정값으로 요청해서 해당 에러가 생기는 경우가 대부분이었다.\n우리처럼 정상적으로 동작하다가 에러가 발생하고, 다시 정상적으로 되는 경우는 없었다.\n공식 문서 찾기에 지쳤을 때 문득 생각나서 빙챗으로 검색을 했는데 <a href=\"https://man7.org/linux/man-pages/man3/getaddrinfo.3.html\">linux 문서</a>를 바로 알려주는 것이었다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9klEQVR42mVQi2rDMBDr///fWsbiOo82Xhrn/bJ9TjTuIGNlB0LiMLJOlznPMagEze2KuTKYVo8QCEQBIQQQkfC2bcJ/4b2Hc040z3EcuLAIkaCTTxSpQmVKlKVBnudY11UwzzOapsGyLKJPTNOEvu9Fvxs6B2seeKYJHvoL09AjECHGKOCHjH3ff5n3nIz1acYjhocsD7SNxe36AX2/wxiDoiiglBLWWiPLMtGcfhxHdF0nqf8ZUvDoXgbfRYp1WUAxSncM7o57YvD5zLzjZOcbTvt28r5HxOBRvyqkWksKTlPXtXR0dmWtlWTDMAi3bSvgT07DH7c/zhlMRv64AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"리눅스 문서\"\n        title=\"\"\n        src=\"/static/357ffa25bfba15ab254061ef09a3ff60/37523/linux_docs.png\"\n        srcset=\"/static/357ffa25bfba15ab254061ef09a3ff60/e9ff0/linux_docs.png 180w,\n/static/357ffa25bfba15ab254061ef09a3ff60/f21e7/linux_docs.png 360w,\n/static/357ffa25bfba15ab254061ef09a3ff60/37523/linux_docs.png 720w,\n/static/357ffa25bfba15ab254061ef09a3ff60/302a4/linux_docs.png 1080w,\n/static/357ffa25bfba15ab254061ef09a3ff60/07a9c/linux_docs.png 1440w,\n/static/357ffa25bfba15ab254061ef09a3ff60/a8c87/linux_docs.png 1538w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>그리고 이 함수에 대해 상세한 설명을 해주신 블로그 글 <a href=\"https://techlog.gurucat.net/293\">[네트워크/C] getaddrinfo 함수 - 제임스 딘딘</a>도 함께 알려주었다.\n문서에 따르면 일시적인 조회 실패로, 잠시 후 다시 시도하라는 뜻이었다.</p>\n<p>모든 외부 API 호출이 해당 사유로 실패 가능했기 때문에, 전역적인 재시도 처리를 하는 것도 방법이었다.\n그래도 캐싱으로 충분할 것 같아 <code class=\"language-text\">dnscache</code>를 적용했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dnscache'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">enable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>해당 모듈을 적용하면 전역적으로 모든 <code class=\"language-text\">dns</code> 메서드를 래핑해준다 한다.</p>\n<p>적용 후 테스트 환경에서 세차례 정도 배포해보았는데, 순단이 발생하지 않았다.\n그래서 프로덕션에도 적용해 배포해본 결과 일단은 무찌른 것 같다. 아마도…</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA2klEQVR42p1R22rDMAzN///dYPRhfSgrdKXFtSw7thI7ySly15ayDTILDgJfpHPpUkpwRLgYA2ZGCAF6tiwLtO59bXX62ZLD7nACOfe40EEt6Pq+R0wJQy6Y57mJ1QvDQQRMhKmUP5npojW4MfQevP/E1/EAYwystSCiB5xzUBW/Qf0OPtQeY0QpBZ2yYnbYnc44mgtEBNM0IZdSHyjWePcSSpIBhiOGccTyTb2lquQkcpNnLfI4VoY55/aUg+fqk/e+yntua0z5bfOOj+0W1hKYzshCP9L+z8ArzJgSh1U3+2EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"슬랙\"\n        title=\"\"\n        src=\"/static/07140bbe82d85b9668a7168d790c09dd/37523/slack.png\"\n        srcset=\"/static/07140bbe82d85b9668a7168d790c09dd/e9ff0/slack.png 180w,\n/static/07140bbe82d85b9668a7168d790c09dd/f21e7/slack.png 360w,\n/static/07140bbe82d85b9668a7168d790c09dd/37523/slack.png 720w,\n/static/07140bbe82d85b9668a7168d790c09dd/302a4/slack.png 1080w,\n/static/07140bbe82d85b9668a7168d790c09dd/07a9c/slack.png 1440w,\n/static/07140bbe82d85b9668a7168d790c09dd/bfe41/slack.png 2082w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div style=\"text-align:center; font-style:italic; color:grey;\">\n  진짜로 순간 속았음  \n</div>  \n<br>  \n<h2 id=\"-잘-하는-개발자는-어떻게-될-수-있나요\" style=\"position:relative;\"><a href=\"#-%EC%9E%98-%ED%95%98%EB%8A%94-%EA%B0%9C%EB%B0%9C%EC%9E%90%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%90%A0-%EC%88%98-%EC%9E%88%EB%82%98%EC%9A%94\" aria-label=\" 잘 하는 개발자는 어떻게 될 수 있나요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🛶 잘 하는 개발자는 어떻게 될 수 있나요</h2>\n<p>사실 글로만 보면 꽤 간단하게 해결한 것 같은데!!!\n여기에 페어로 이틀을 꼬박 소모했다.</p>\n<p>이유는 이 에러가 프로덕션 무중단 배포 시에만 발생했는데, 스테이지 환경은 동일한 배포 파이프라인이 구축되어 있지 않아서 재연이 어려웠기 때문이다.\n원인을 확실하게 알지 못하니 재연된 스테이지 환경에 적용 후 해결 되었는지 봐야 했는데…\n여러가지 다양한 이유로 재연 환경을 구축하기가 만만치 않았다.\n사실 나는 조수석에 앉아있었고 든든한 페어가 멋지게 뚝딱뚝딱 구축해줬지만…</p>\n<p>잘 하고 싶다는 고민이 많은 요즘이다.\n내가 생각하는 ‘잘 하는 개발자’는 언어나 분야에 제약받지 않는 사람이다.\n예를 들어, 정말 그림을 잘 그리는 사람은 동양화를 주로 그렸어도, 대리석 조각을 깎으라 시키면 잘 할 수 있다.\n동양화를 그리면서 체득한 양감이나 구도에 대한 이해와 손을 쓰는 능력은 조각에도 적용되기 때문이다.</p>\n<p>반면 나는 노드에서 익숙하지 않은 코드를 보면 스프링을 보듯이 이해 할 수가 없다.\n같은 백엔드인데도 그렇다.\n인프라도 그렇고… 열심히 하면 어떻게든 되겠지만 참 쉽지않다!!!\n‘노드라서 자스라서 잘 모르겠다’는 말을 하고싶지 않은데 하지 않기가 어렵다.</p>\n<p>그래도 처음에는 노드 + 자스에 손 댈 일이 생길 때 마다 부담되고 고통스러웠는데 지금은 즐겁다.\n디버깅도 즐거워지는 때가 오겠지…</p>\n<p>그리고 프롬프트 엔지니어 얘기가 괜히 나온 게 아니라는 걸 느꼈다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABdklEQVR42j3NO2sUUQDF8f1A1qIBcet8AeuAIGInKcRaJJ1iNtgoaLVIEBUbSWflB3DNusnO7rx2nvfO885N5rV/2UFS/DinOmeUF5osr0nzhqJsCWXDw7cJ+y8F+y8k958Lxs8E9w4F40PJ+GnC3ScJe49T9h6l3D5IuXOQcetBytGHilGa1QipiaUmihVeqJj+zHh3lvP+LOPke8bJt4zJ15zJl4LjzwXHpyWT05I3nxSvporX04qjj4ofv64ZRYlivjCZna+4NDY4rkQVFX3T0dUd27a/0Tc9fbulb6Gue67rjqu6R++y6UhVxyhJNBtPYDsBQZgQhCm2G+FsJKYtMNbhYG3Fg+UqYLH0cEOFG7fYYTMwow4r7hgJUWAYFkvDZf7XYPbngt+zC87nq+HEDySeL/BDOfSNL3DciEgqPNHj7EbjDkvcDCocx8f1KxbrCtO94tLULG1NqXoqvUXpLWX1nwaZ1Vhhhhk1rKOGVbjTDv4BYCCrQ7uOxwwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"빙쳇\"\n        title=\"\"\n        src=\"/static/a882dd5f2516c760b7e5343c51dc983b/37523/bingchat.png\"\n        srcset=\"/static/a882dd5f2516c760b7e5343c51dc983b/e9ff0/bingchat.png 180w,\n/static/a882dd5f2516c760b7e5343c51dc983b/f21e7/bingchat.png 360w,\n/static/a882dd5f2516c760b7e5343c51dc983b/37523/bingchat.png 720w,\n/static/a882dd5f2516c760b7e5343c51dc983b/302a4/bingchat.png 1080w,\n/static/a882dd5f2516c760b7e5343c51dc983b/07a9c/bingchat.png 1440w,\n/static/a882dd5f2516c760b7e5343c51dc983b/8170e/bingchat.png 2132w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>빙챗의 엄청난 검색 능력을 보여주려고 다시 질문했는데 절대 그 때 주었던 리눅스 문서를 주지 않는다.\n로그인 하지 않고 검색했어서 히스토리를 찾을 수가 없는데, 어떻게 검색했었을까?\n내가 했는데도 기억이 안 나서 몹시 안타깝다.</p>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EF%B8%8F-%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\">⚡️ 문제 상황</a></li>\n<li><a href=\"#-eai_again%EC%9D%80-%EC%96%B4%EB%94%94%EC%97%90%EC%84%9C-%EC%98%A4%EB%8A%94%EA%B0%80\">🧶 EAI_AGAIN은 어디에서 오는가</a></li>\n<li><a href=\"#-%EC%9E%98-%ED%95%98%EB%8A%94-%EA%B0%9C%EB%B0%9C%EC%9E%90%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%90%A0-%EC%88%98-%EC%9E%88%EB%82%98%EC%9A%94\">🛶 잘 하는 개발자는 어떻게 될 수 있나요</a></li>\n</ul>\n</div>","frontmatter":{"date":"June 04, 2023","title":"배포 중 순단을 없애고 싶었을 뿐인데","categories":"etc CS","author":"써머","emoji":"headers/dns-error-eia-again.png"},"fields":{"slug":"/dns-error-eia-again/"}},"prev":{"id":"304c87ae-95b3-5ca0-b493-14b7d6ae7127","html":"<p>많은 스타트업에서 백엔드 언어로 자바스크립트를 쓰고 있다.\n나는 자바스크립트랑 node.js로 바닥부터 개발을 해보지 않아서 모르지만, 다른 언어와 프레임워크에 비해 프로덕트를 빠르게 낼 수 있어, 초기 스타트업에서 많이 사용한다고 들었다.\n그런데 나처럼 특정 언어와 프레임워크를 사용하는 백엔드 교육 과정으로 개발을 시작한 사람은 배운 것 밖에 쓸 줄 모른다.\n대부분의 교육 과정에서 가르치는 자바•스프링이 공개된 자료도 훨씬 많다.</p>\n<p>그런데 예전에 구직 사이트에서 신입 공고를 볼 때 자바스크립트•노드 스택이 많았다.\n가고 싶은 회사 중 한 곳이었던 인프런도 자바스크립트•노드 스택이었다.\n취준 때 스택에 상관없이 이곳저곳 서류를 넣고 면접을 보면서 &#x3C;자바 스프링이 아닌 무언가>를 사용하는데 괜찮으세요 라는 질문을 받으면 언어랑 프레임워크는 도구일 뿐이죠!😉 라고 답하면서 허세는 잔뜩 부렸는데,\n솔직히 나도 할 줄 아는 걸로 해먹고 살고 싶었다. 편하니까.</p>\n<p>다행스럽게 자바•스프링을 사용하는 디어어 오게 되었는데… 도착해서 본 것은 거대한 자바스크립트•노드 레거시 덩어리였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAsElEQVR42m2OywrCMBBF/f9fUxdaF/YdodqkaRuzKdSUHslIQcTAZSYh93B2AOu6xsEw9CTJicsl4XjYk6XXzz05o1TNPM+EEAjhJTP2tmyc3TcwfhzHga4ztO0DYzRaa4wxaN1ibSfprcU5x/fZGD/AIIWqKsmylNtNyV4UOWVZoOqKPM9Qdc29aXBuxPun9P4aLsuC956+twKOhtE2xlorZk/n5N1oLdbTNElvA74BVGQwcrNQF/gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"deer skillset\"\n        title=\"\"\n        src=\"/static/75dbb32fca23981950800779c64e8d62/37523/deer_skills_1.png\"\n        srcset=\"/static/75dbb32fca23981950800779c64e8d62/e9ff0/deer_skills_1.png 180w,\n/static/75dbb32fca23981950800779c64e8d62/f21e7/deer_skills_1.png 360w,\n/static/75dbb32fca23981950800779c64e8d62/37523/deer_skills_1.png 720w,\n/static/75dbb32fca23981950800779c64e8d62/302a4/deer_skills_1.png 1080w,\n/static/75dbb32fca23981950800779c64e8d62/07a9c/deer_skills_1.png 1440w,\n/static/75dbb32fca23981950800779c64e8d62/6ee58/deer_skills_1.png 1640w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAsUlEQVR42nWP2wqDMBBE/f9/awOtVXyoVqtuLmo1PpmIUzZoKZQGhiGXPTOJAGDbNjZopRBfL0jTBMktRpalEOIMIU6QkrCuK7z3QcuywDkH791nnj36BvIjYwyI2gBgb5oaTV1DEoWzrjMwRmMYeozjC9M04lg/QE5mQFHkqJ8VyvIRRG2LPL+j2vccau0Eay3m2YYif4HcgNv0fRcaKSV3KRARtFYhlMF8L6UMXz+AbyRmL+5MdeQ8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"deer skillset\"\n        title=\"\"\n        src=\"/static/112afa491880906c0656e894fac1172f/37523/deer_skills_2.png\"\n        srcset=\"/static/112afa491880906c0656e894fac1172f/e9ff0/deer_skills_2.png 180w,\n/static/112afa491880906c0656e894fac1172f/f21e7/deer_skills_2.png 360w,\n/static/112afa491880906c0656e894fac1172f/37523/deer_skills_2.png 720w,\n/static/112afa491880906c0656e894fac1172f/302a4/deer_skills_2.png 1080w,\n/static/112afa491880906c0656e894fac1172f/07a9c/deer_skills_2.png 1440w,\n/static/112afa491880906c0656e894fac1172f/6ee58/deer_skills_2.png 1640w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div style=\"text-align:center; font-style:italic; color:grey;\">\n  디어 백엔드 채용 공고... 스프링이라며! 스프링이라며! \n</div>\n<br>\n<p>낯선 언어와 프레임워크로 잘 개발하려면 뭘 하면 될까?\n일단 각잡고 자바스크립트와 노드 공부하기? 인프런에서 강의 끊기?<br>\n이것도 좋은 방식이겠지만, 그냥 자신있게 해오던 대로 하면 된다. 언어랑 프레임워크는 도구일 뿐이죠. 라고 뭣모르고 뱉었던 말을 실천해본다. 🔥</p>\n<br>\n<h2 id=\"-jest로-테스트-짜기\" style=\"position:relative;\"><a href=\"#-jest%EB%A1%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A7%9C%EA%B8%B0\" aria-label=\" jest로 테스트 짜기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🚀 Jest로 테스트 짜기</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaklEQVR42o2Sa2ukQBBF8/9/WpZA2GQyD3V8dre2tq8eJ2psz7IuYbOwzKSgqFsf6nAp7gPAuq58Tjt3NKOhtAXVUNKMNdflwnRxWL3Q5uPWVn9wbdw/t7/r4evi3IIcEsLW58l/5CV9JuoDqimnF458N+P90JweNXI3YgKHc+4GcHVIm5IbRSxiRJ4hqgwzF3RiIT/3FMKQRQVl1lEGI6tbbwPVkJHYiKgJCGufxIbUs6bNPijDd8Kj5PgzwqRXymDC3QOKPqXqSxIRo7QibxVmKjagjgZEpIk9hRHDBrzrUF5SwibgVBw45ftN/3U4kCeG1M8x2XeBNkX3kiA5kqgzqsu+OJyIzyX+QVLJ6btAQaALjkLhSY2v5eawl47GVzShR+Wd6KKE+jze++FCahP2uuBFKHayYK8F1aToMke7T+gOb5jXV+zRx/jvt4GfwW6nim6u6SZDO1Zcl+FPsMuVSwWDYdP/C/YvDx/+ZuCRKZYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"architecture\"\n        title=\"\"\n        src=\"/static/1d10e288c0cf4e1b499b2d07c6dd52c6/37523/spring_node_test_architecture.png\"\n        srcset=\"/static/1d10e288c0cf4e1b499b2d07c6dd52c6/e9ff0/spring_node_test_architecture.png 180w,\n/static/1d10e288c0cf4e1b499b2d07c6dd52c6/f21e7/spring_node_test_architecture.png 360w,\n/static/1d10e288c0cf4e1b499b2d07c6dd52c6/37523/spring_node_test_architecture.png 720w,\n/static/1d10e288c0cf4e1b499b2d07c6dd52c6/302a4/spring_node_test_architecture.png 1080w,\n/static/1d10e288c0cf4e1b499b2d07c6dd52c6/f32b7/spring_node_test_architecture.png 1136w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>현재 자바스크립트•노드로 짜여진 디어의 메인 레거시 서버는 스프링 MVC 아키텍쳐와 비슷한 구조다.\n중간에 여러 서비스를 의존해 처리하는 application 레이어가 끼워져 있을 뿐이다.</p>\n<p>처음 테스트를 작성하려 했을 때 놀랐던 건 H2 처럼 자동으로 설정해주는 인메모리 DB가 있겠거니 한 거였는데 없었다.\n도커로 DB를 띄우는 방식을 생각했지만, DB에 접근하는 코드와 repository 계층 클래스들은 이미 몇 년간 버그없이 잘 사용하고 있어서 테스트 대상 우선순위에서 제외해도 될 것 같았다.\n그래서 repository 계층을 Jest로 모킹한 뒤 application 계층의 메서드를 호출해 통합 테스트를 짰다.</p>\n<p>예시로 디어에는 앱 설치 여부와 관계없이 돈을 대신 내고 친구를 태워줄 수 있는 <code class=\"language-text\">디어쏘기(treat)</code> 기능을 새로 출시했었다. (참고로 현재는 서비스를 중단했다.🥹)\n일부 지역에서 시험적으로 도입한 기능이라 해당 지역의 유저에게만 기능이 노출되어야 한다.</p>\n<ol>\n<li>외부 서버를 호출하는 부분</li>\n<li>DB에서 데이터를 읽어오는 부분</li>\n</ol>\n<p>두 부분을 모킹해 테스트한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> TreatApplication <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../../../src/applications/TreatApplication\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> application <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TreatApplication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'디어쏘기 지역인지 확인하다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        application<span class=\"token punctuation\">.</span>_experimentAreaService<span class=\"token punctuation\">.</span>_otherServerConnector<span class=\"token punctuation\">.</span>getAreaPolicy <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        application<span class=\"token punctuation\">.</span>_experimentAreaService<span class=\"token punctuation\">.</span>_experimentalAreaRepo<span class=\"token punctuation\">.</span>findAllByAreaId <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>JPA 있으면 되는데~ 아 스프링은 H2로 테스트 해주는데~ 생각 그만하고 성실히 짠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'디어쏘기 지역인지 확인하다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        application<span class=\"token punctuation\">.</span>_experimentAreaService<span class=\"token punctuation\">.</span>_otherServerConnector<span class=\"token punctuation\">.</span>getAreaPolicy <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        application<span class=\"token punctuation\">.</span>_experimentAreaService<span class=\"token punctuation\">.</span>_experimentalAreaRepo<span class=\"token punctuation\">.</span>findAllByAreaId <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'디어쏘기 대상 지역이 아니라면 디어쏘기를 보여주지 않는다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// given</span>\n        application<span class=\"token punctuation\">.</span>_experimentAreaService<span class=\"token punctuation\">.</span>_otherServerConnector<span class=\"token punctuation\">.</span>getAreaPolicy<span class=\"token punctuation\">.</span><span class=\"token function\">mockReturnValue</span><span class=\"token punctuation\">(</span>\n            <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">areaId</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n        application<span class=\"token punctuation\">.</span>_experimentAreaService<span class=\"token punctuation\">.</span>_experimentalAreaRepo<span class=\"token punctuation\">.</span>findAllByAreaId<span class=\"token punctuation\">.</span><span class=\"token function\">mockReturnValue</span><span class=\"token punctuation\">(</span>\n            <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">area_id</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'SHOP'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// when</span>\n        <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> application<span class=\"token punctuation\">.</span><span class=\"token function\">shouldDisplay</span><span class=\"token punctuation\">(</span><span class=\"token number\">37.123</span><span class=\"token punctuation\">,</span> <span class=\"token number\">127.1234</span><span class=\"token punctuation\">,</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// then</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'디어쏘기 대상 지역이라면 디어쏘기를 보여준다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// given</span>\n        application<span class=\"token punctuation\">.</span>_experimentAreaService<span class=\"token punctuation\">.</span>_otherServerConnector<span class=\"token punctuation\">.</span>getAreaPolicy<span class=\"token punctuation\">.</span><span class=\"token function\">mockReturnValue</span><span class=\"token punctuation\">(</span>\n            <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">areaId</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n        application<span class=\"token punctuation\">.</span>_experimentAreaService<span class=\"token punctuation\">.</span>_experimentalAreaRepo<span class=\"token punctuation\">.</span>findAllByAreaId<span class=\"token punctuation\">.</span><span class=\"token function\">mockReturnValue</span><span class=\"token punctuation\">(</span>\n            <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">area_id</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'TREAT'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// when</span>\n        <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> application<span class=\"token punctuation\">.</span><span class=\"token function\">shouldDisplay</span><span class=\"token punctuation\">(</span><span class=\"token number\">37.123</span><span class=\"token punctuation\">,</span> <span class=\"token number\">127.1234</span><span class=\"token punctuation\">,</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// then</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>Jest로도 Junit에서 하던 테스트를 다 할 수 있다.\n다어쏘기는 고객이 발급받은 공유 코드를 친구에게 전달하면, 친구가 그 코드로 킥보드를 탈 수 있다.\n시행 지역 밖에 있거나 미납 상태인 고객에게 코드를 발급하면 안되기에 해당 상황에서 예외를 던지는 경우를 테스트한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'디어쏘기 공유 코드를 발급한다.'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// 코드를 발급하는 메서드 issueUrl(userId, latitude, longitude, now)</span>\n    \n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'디어쏘기 대상 지역이 아니라면 발급하지 않는다.'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        <span class=\"token comment\">// when &amp; then</span>\n        <span class=\"token keyword\">await</span> <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>application<span class=\"token punctuation\">.</span><span class=\"token function\">issueUrl</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37.123</span><span class=\"token punctuation\">,</span> <span class=\"token number\">127.1234</span><span class=\"token punctuation\">,</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span>rejects<span class=\"token punctuation\">.</span><span class=\"token function\">toThrowError</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'디어쏘기 시행 지역이 아니에요.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'미납 상태인 이용자에겐 발급하지 않는다.'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        <span class=\"token comment\">// when &amp; then</span>\n        <span class=\"token keyword\">await</span> <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>application<span class=\"token punctuation\">.</span><span class=\"token function\">issueUrl</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">37.123</span><span class=\"token punctuation\">,</span> <span class=\"token number\">127.1234</span><span class=\"token punctuation\">,</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span>rejects<span class=\"token punctuation\">.</span><span class=\"token function\">toThrowError</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'미납한 이용이 있으면 디어쏘기를 보낼 수 없어요. \\n결제를 진행해주세요.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>디어쏘기는 해당 기능이 신규 고객 유치에 도움이 되는가가 큰 관심사였다.\n그래서 디어쏘기 기능으로 로그인 또는 회원가입 한 사람을 추적하고 DB에 기록했다.\n앞선 방식으로는 이 데이터가 DB에 제대로 저장되는지, 다시 DB에서 데이터를 읽어 확인할 수 없다.\n그러니 대신 저장 메서드가 호출된 조건을 확인하기로 한다.\nMockito가 지원하는 것과 동일한 기능이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'디어쏘기로 회원가입 또는 로그인했다면 기록을 남긴다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'기존 유저라면 로그인으로 기록을 남긴다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        <span class=\"token comment\">// when </span>\n        <span class=\"token keyword\">await</span> application<span class=\"token punctuation\">.</span><span class=\"token function\">saveTreatAuthHistory</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> now<span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// then</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>application<span class=\"token punctuation\">.</span>_treatService<span class=\"token punctuation\">.</span>_treatAuthHistoryRepo<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> <span class=\"token constant\">LOGIN</span><span class=\"token punctuation\">,</span> <span class=\"token function\">toIsoDateTime</span><span class=\"token punctuation\">(</span>now<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'신규 유저라면 회원가입으로 기록을 남긴다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        <span class=\"token comment\">// when</span>\n        <span class=\"token keyword\">await</span> application<span class=\"token punctuation\">.</span><span class=\"token function\">saveTreatAuthHistory</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> now<span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// then</span>\n        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>application<span class=\"token punctuation\">.</span>_treatService<span class=\"token punctuation\">.</span>_treatAuthHistoryRepo<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> <span class=\"token constant\">SIGN_UP</span><span class=\"token punctuation\">,</span> <span class=\"token function\">toIsoDateTime</span><span class=\"token punctuation\">(</span>now<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>그리고 프레임워크와 무관하게 큰 도움이 되었던 방법으로, 개발 전에 테스트 케이스 모두 다 써두기가 있다.\n우리 회사엔 기획자와 QA 담당자가 따로 없다. 내 개발은 내 스스로 책임진다.🔥\n테스트 케이스를 먼저 모두 짜고 시작하면 정책을 정리하고 예외 상황을 미리 파악하는데 도움이 된다.\n미처 고려하지 못했던 부분을 발견해 더 질좋은 서비스를 만들 수 있었다.</p>\n<p>예로, 결제수단으로 카드를 등록 시 타인 명의 카드 등록을 방지하기 위해 간단한 검증을 넣게 되었다.\n그러면 일단 어떤 경우에 통과하고, 어떤 경우에 통과시키지 않을지를 먼저 테스트로 정리하고 빠진 건 없는지 생각한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'결제수단 카드 등록 시 개인 카드라면 본인 명의인지 확인한다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'법인 카드라면 명의를 확인하지 않는다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'개인 카드일 때, 유저의 생년월일과 카드의 생년월일이 일치하는지 확인한다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'일치하지 않으면 본인 명의가 아니라고 판단한다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'일치하면 본인 명의라고 판단한다'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>종종 구현하다 생각할 시간이 필요하면 전체 테스트를 돌려놓고 쉬곤 한다.\n불멍 때리듯 초록멍을 때리면 마음이 편해진다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAoklEQVR42lWOSYrDMBQFfZKQOB40WIP9FUkYZyLk/keq0G5oOoui4C2K1+ggxPzA5ztzeeLmgo0ZKVdiWtFeaIeJU293n5XDpxWpD6ZYUJOgnKCd0KlA02vPoR3QIVK3J/X6Yr2/dy95Y84bJqQ9fOoNvQ4YX9AuM5iF0cofako0xgvHztCOlqVupHpD6m2P2XhhtPPvs9Fx7DSd8l+B//xsHxpcXN+u3XKmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jest is fast\"\n        title=\"\"\n        src=\"/static/eae5cf9bee80870173cbc94811f36c5d/37523/fast_jest.png\"\n        srcset=\"/static/eae5cf9bee80870173cbc94811f36c5d/e9ff0/fast_jest.png 180w,\n/static/eae5cf9bee80870173cbc94811f36c5d/f21e7/fast_jest.png 360w,\n/static/eae5cf9bee80870173cbc94811f36c5d/37523/fast_jest.png 720w,\n/static/eae5cf9bee80870173cbc94811f36c5d/302a4/fast_jest.png 1080w,\n/static/eae5cf9bee80870173cbc94811f36c5d/07a9c/fast_jest.png 1440w,\n/static/eae5cf9bee80870173cbc94811f36c5d/cc6fe/fast_jest.png 1860w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>DB 접근을 모킹해서 진짜 엄청 빠르다. 기분이 좋다.</p>\n<br>\n<h2 id=\"-객체지향적인-리팩터링\" style=\"position:relative;\"><a href=\"#-%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5%EC%A0%81%EC%9D%B8-%EB%A6%AC%ED%8C%A9%ED%84%B0%EB%A7%81\" aria-label=\" 객체지향적인 리팩터링 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👾 객체지향적인 리팩터링</h2>\n<p><code class=\"language-text\">객체지향적인 코드 짜기</code>라는 말이 다소 진부해 지루하게 들리겠지만, 그렇지 않은 레거시 코드가 많다면 시작하려는 마음을 먹기부터 쉽지 않다.\n하면 이왕 시작한 거 한번에 바꿔야 할 것 같고, 깨끗하게 다 걷어내고 싶고 그렇다.\n하지만 달리는 기차의 바퀴를 뜯어서 닦을 수는 없다. (그리고 그러다가 기차를 터트린 적이 꽤 있다…🤯)\n조급한 마음을 버리고 작은 단계부터 한다.</p>\n<p>레거시 코드를 고치다 보면 DB에서 조회한 값을 직접 비교하던 로직을 클래스로 옮길 때가 많았다.\n아래는 유저가 미납한 요금이 있는지 확인하던 기존 코드다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token function\">checkUnpaidOfUser</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">userId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> unpaidUseAmount <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_getUserUnpaidUsePayment</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>unpaidUseAmount<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token function\">_getUserUnpaidUsePayment</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">userId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> lastUse <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_useRepo<span class=\"token punctuation\">.</span><span class=\"token function\">getLastUseByUserId</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>lastUse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lastUse<span class=\"token punctuation\">.</span>pay_fail_at <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> lastUse<span class=\"token punctuation\">.</span>pay_at<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lastUse<span class=\"token punctuation\">.</span>pay_refund<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lastUse<span class=\"token punctuation\">.</span>pay_refund_amount <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> lastUse<span class=\"token punctuation\">.</span>pay_riding <span class=\"token operator\">+</span> lastUse<span class=\"token punctuation\">.</span>pay_reservation <span class=\"token operator\">+</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>lastUse<span class=\"token punctuation\">.</span>additional_charge<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> lastUse<span class=\"token punctuation\">.</span>pay_discount <span class=\"token operator\">-</span> lastUse<span class=\"token punctuation\">.</span>pay_refund_amount\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> lastUse<span class=\"token punctuation\">.</span>pay_final\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>왜 해당 값들의 특정한 조합에 따라 미납 여부가 달라지는지 알려면 여러가지 슬픈 사연을 알아야 한다.\n이 말은 처음 코드만 보면 도무지 알 수가 없다는 뜻이다.🤗</p>\n<p>마침 추가 기능을 개발하면서 미납 여부를 확인하는 요구사항이 있길래, 클래스를 만들어 로직을 옮겼다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\n<span class=\"token comment\">/**\n * @param {number} userId\n * @return {Promise&lt;boolean>}\n */</span>\n<span class=\"token keyword\">async</span> <span class=\"token function\">checkUnpaidOfUser</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">userId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_isUserHasUnpaidUse</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * @param {number} userId\n * @return {Promise&lt;boolean>}\n * @private\n */</span>\n<span class=\"token keyword\">async</span> <span class=\"token function\">_isUserHasUnpaidUse</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">userId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> lastUseRow <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_useRepo<span class=\"token punctuation\">.</span><span class=\"token function\">getLastUseByUserId</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>lastUseRow<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> lastUse <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Use</span><span class=\"token punctuation\">(</span>lastUseRow<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span>lastUse<span class=\"token punctuation\">.</span><span class=\"token function\">isPaid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Use</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">/**\n     * @return {boolean}\n     */</span>\n    <span class=\"token function\">isPaid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> paid <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>payAt <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>payFailAt\n        <span class=\"token keyword\">return</span> paid <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_isFullRefunded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_doesNotHavePayRemainAfterPartialRefunded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>payFinal <span class=\"token operator\">===</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * @return {boolean}\n     */</span>\n    <span class=\"token function\">_isFullRefunded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">Boolean</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>payRefund <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>payRefundAmount<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * @return {boolean}\n     */</span>\n    <span class=\"token function\">_isPartialRefunded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">Boolean</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>payRefund <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>payRefundAmount<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * @return {boolean}\n     */</span>\n    <span class=\"token function\">_doesNotHavePayRemainAfterPartialRefunded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_isPartialRefunded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n            <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>payRiding <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>payReservation <span class=\"token operator\">+</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>additionalCharge<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>payDiscount <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>payRefundAmount <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>뿐만 아니라 외부 서버에 요청해 받은 응답값 처럼 로직이 없는 데이터도 단순한 DTO 클래스로 감싸주었다.\n그리고 아주 간단한 로직이라면 DTO 내부로 옮겼다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// before</span>\n<span class=\"token keyword\">async</span> <span class=\"token function\">getPolicy</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">requestAt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_client<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/policy'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> requestAt <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ExternalServerError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// after</span>\n<span class=\"token comment\">/**\n* @param {moment.Moment} requestAt\n* @return {Promise&lt;PolicyResponse>}\n*/</span>\n<span class=\"token keyword\">async</span> <span class=\"token function\">getPolicy</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">requestAt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_client<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/policy'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> requestAt <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PolicyResponse</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ExternalServerError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PolicyResponse</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/**\n         * @type {number}\n         */</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/**\n         * @type {string}\n         */</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/**\n         * @type {RuleResponse[]}\n         */</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rules <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">it</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuleResponse</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * @returns {boolean}\n     */</span>\n    <span class=\"token function\">isStopped</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token string\">'STOP'</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">RuleResponse</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/**\n         * @type {number}\n         */</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/**\n         * @type {string}\n         */</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<br>\n<p>이 방법이 답답해 보일 수 있겠지만, 없는 필드에 접근하다가 <code class=\"language-text\">undefined is not a function</code>을 당하지 않을 수 있다.\n나는 이미 너무 너무 많이 충분히!!! 당했다.😇\ndto로 감싸기만 하더라도 코드 작성 시 IDE의 도움을 받을 수 있어서 한결 수월하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAr0lEQVR42j3MwU7EIABF0X7KjFoKA1gKpRQsUM0sjP//P9fMmLh4uYuXnEHaTC8/lPZN2D/xWyekk5A6PnWWcHKUO0dt7LlSPio5dZK/411DSMM46f8Nat6p/YtWK/4BPdB04mLjPRzoJaPmxGQiQq8IHRn1inKJOVasL0izouyGtJFhMivGLtQc8KkR9sYcMnZJSOMRN8eL0FzeFNfxxnX86+VVPX/jNkblnuikA7+ui17ZqZDFlwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ide\"\n        title=\"\"\n        src=\"/static/06e792bcae1dc8ec0c36c8d010224d54/37523/ide_good.png\"\n        srcset=\"/static/06e792bcae1dc8ec0c36c8d010224d54/e9ff0/ide_good.png 180w,\n/static/06e792bcae1dc8ec0c36c8d010224d54/f21e7/ide_good.png 360w,\n/static/06e792bcae1dc8ec0c36c8d010224d54/37523/ide_good.png 720w,\n/static/06e792bcae1dc8ec0c36c8d010224d54/302a4/ide_good.png 1080w,\n/static/06e792bcae1dc8ec0c36c8d010224d54/07a9c/ide_good.png 1440w,\n/static/06e792bcae1dc8ec0c36c8d010224d54/387f2/ide_good.png 1518w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div style=\"text-align:center; font-style:italic; color:grey;\">\n  얼마나 소중한 기능인지 당연할 때는 몰랐어  \n</div>\n<br>\n<p>자바는 DTO 마다 클래스를 만들어야 해서 중첩된 값이 많아지면 클래스 파일도 늘어나는 게 조금 거슬렸는데, 그래도 자스는 한 파일 안에서 여러 클래스를 선언할 수 있어서 나았다.</p>\n<br>\n<h2 id=\"-jsdoc으로-타입-힌트-넣기\" style=\"position:relative;\"><a href=\"#-jsdoc%EC%9C%BC%EB%A1%9C-%ED%83%80%EC%9E%85-%ED%9E%8C%ED%8A%B8-%EB%84%A3%EA%B8%B0\" aria-label=\" jsdoc으로 타입 힌트 넣기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧶 JSDoc으로 타입 힌트 넣기</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAADJ0lEQVR42kWQ+0+aZxiG3/f73o+TVgRBh84iVVEcaGEisgqtR3QiBwXKQdqi8TDWmTaOdXPnZnOmW7K2WdJsybJlf0F/2r93LXzb0h+e5M3z3O91388jpNDRhIEuLChpoEmFEBq6pogGBomHRrHbHGZPSQu6qTXo/tOlgV3vxaLZ0aSBs2cI0R0IE6rMZvet64rDdIDfDxL82b7N8XYMKXUTIk2g1YR1Q1g1BzatB6lZ6OvzvQH+7yiEJBMd4fWXRV4d3eFZ+SaPtiZwO61mSikVb7aymsBuQqnb6O/3/weU3VJIE6hoZyb5++oBvxyv8Xj1BsWoi2GP3ZyZJzH1hpnW0OwozYpuOPAMTCC6rsIUKdNdCAt7Cz6e7oU53QjRXPSxn/ARu+4xN1G6gdS6pUwDXbNj0R1YrS6GvO8glOZB17wo3YvN8CKEi7VokF9PUzw/WaezE6Y0P8TizCiaHECIPoRwI+UAhvJgNd7Cpny4rwXxjyQRhurHYvQjpMsUCuUh916IJ/mbfFGIUl0YZiHQy4NGgU4rTSUzz/j1MXrsg//qRT9Wax9D3iDBiS7QFkSoKYY8fqobk7w8T/KqEycd6iP8toPFiV6enB3w/Ls2f1ws8PrZKn99neJFJ8VBMcJEIIyyLOLzZZkJNRHS+y3R+AmfnyxTz6XJry7xYavI4/Y9ivkczVqNy8ufOG83OWmVePSwyWedFvvVLLvbKRLJLIb7Y4bHPiUSu0TYvHmOyot8cLCFcOwgtE3SO1/RaL+kfHjFdvUb0plzspUfeHflgs3yjxTuvWA0fIbQSyjvPqOzTYLhFtHkQ4R/KkmzEKe6s0S+fkb9oyvcoTI9U2Wc4RquSJP4+4cs5+6y2eiQP73ENrbLYHif4bn7jESqBCLbzMZbxBItROJWjKPKHOnlDMuFTzi7+A3neANXsIVr8j7OYIv1YpNKLUf96HtaZz9z7UaV4dlj3OMNHCN38Ud3Sd5uEI7VERuZFLXKGivrGW4tlUit7DMdzROIFJiK7TId22U9m2evlCGRLpFcaRII5xibKeKbLOCfrjC/tMWdtSxTcxX+AfPwjbwfUIt6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"is not a function\"\n        title=\"\"\n        src=\"/static/1efaa10740dd14c2ea2056fccb9b5583/37523/is_not_a_function.png\"\n        srcset=\"/static/1efaa10740dd14c2ea2056fccb9b5583/e9ff0/is_not_a_function.png 180w,\n/static/1efaa10740dd14c2ea2056fccb9b5583/f21e7/is_not_a_function.png 360w,\n/static/1efaa10740dd14c2ea2056fccb9b5583/37523/is_not_a_function.png 720w,\n/static/1efaa10740dd14c2ea2056fccb9b5583/302a4/is_not_a_function.png 1080w,\n/static/1efaa10740dd14c2ea2056fccb9b5583/07a9c/is_not_a_function.png 1440w,\n/static/1efaa10740dd14c2ea2056fccb9b5583/5b6ee/is_not_a_function.png 1672w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>코드에 많은 개선이 이뤄지고, 테스트를 꼼꼼히 짜게 되고, 나도 자바스크립트에 익숙해진 지금은 잘 볼 일 없는 에러긴 하지만, 처음에는 정말 <code class=\"language-text\">undefined</code>라는 단어만 봐도 머리에 열이 올랐다.\n그냥 에러만 나면 다행인데, 스테이징 배포를 했는데 CPU가 치솟더니 접속이 안된다거나…\n내가 고통받는 걸 보고 프론트 개발자 팀원이 <a href=\"https://jsdoc.app/\">JSDoc</a>을 써보면 어떻겠냐고 했다.</p>\n<p>JSDoc을 사용하면 주석으로 변수, 매개변수, 함수 반환값 등의 데이터 타입을 지정할 수 있다.\n위에서 봤듯이 직접 선언한 클래스는 물론이고 라이브러리의 클래스를 지정하거나,</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * @param {number} userId\n * @param {number} landmarkId\n * @param {moment.Moment} visitedAt\n * @return {Promise&lt;void>}\n*/</span>\n<span class=\"token keyword\">async</span> <span class=\"token function\">visitLandmark</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">userId<span class=\"token punctuation\">,</span> landmarkId<span class=\"token punctuation\">,</span> visitedAt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>람다식도 지정 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\n <span class=\"token comment\">/**\n  * @param {() => Promise&lt;*>} request\n  * @param {number} retryCount\n  * @return {Promise&lt;*>}\n */</span>\n<span class=\"token keyword\">async</span> <span class=\"token function\">requestWithRetry</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> retryCount</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>레거시 코드에는 DB 테이블에서 특정 컬럼값만 가져오는 로직이 많았다.\nJPA에서는 엔티티 단위로 조회하는 경우가 많아 신경 쓸 일이 크게 없었지만, 여기다 JSDoc을 적용하려고 모든 경우의 수 마다 클래스를 별도로 선언하려니 아주 부담스럽다.</p>\n<p>다행히 클래스 정의 없이 프로퍼티를 명시하는 식으로도 사용 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * @param {number} count\n * @return {Promise&lt;{useId: number, eventId: number}[]>}\n * @param {number} userId\n*/</span>\n<span class=\"token function\">findByUserIdOrderByADesc</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">userId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> queryString <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n        select u.id as useId, e.id as eventId\n        from use u \n                left join event e on u.id = e.use_id\n        where u.user_id = ?\n        order by u.id desc\n    </span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_selectPluralRead</span><span class=\"token punctuation\">(</span>queryString<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>userId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>아니면 아예 타입 선언을 주석 내에서 할 수도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * @typedef {Object} UseEvent\n * @property {number} use_id\n * @property {number | undefined} event_id\n*/</span>\n\n<span class=\"token comment\">/**\n * @param {number} userId\n * @return {Promise&lt;UseEvent[]>}\n*/</span>\n<span class=\"token function\">findByUserIdOrderByUseDesc</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">userId</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>위 모든 단계를 거치니 자스에서 겪었던 불편이 많이 사라졌다.\n코드가 늘어나서 보기에 답답할 순 있지만 안정성이 짱이다.\n작성하는 시간도 오래 걸리지 않고, 문제가 생겨서 디버깅 하는 시간에 비하면 짧다! 이런 면에서 테스트 작성과 성격이 비슷하다 느꼈다.</p>\n<br>\n<h2 id=\"️-잘-모르겠으면-직접-쳐보면-된다\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EC%9E%98-%EB%AA%A8%EB%A5%B4%EA%B2%A0%EC%9C%BC%EB%A9%B4-%EC%A7%81%EC%A0%91-%EC%B3%90%EB%B3%B4%EB%A9%B4-%EB%90%9C%EB%8B%A4\" aria-label=\"️ 잘 모르겠으면 직접 쳐보면 된다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✍️ 잘 모르겠으면 직접 쳐보면 된다</h2>\n<p>결과를 모르겠거나, 이해할 수 없는 자스 코드는 로컬에서 노드로 직접 실행해본다.<br>\n자바 스프링 환경에서는 라이브러리나 프레임워크 원리를 공부하려고 학습 테스트를 종종 했는데,\n자스는 언어부터가 낯설어 간단한 코드라도 종종 하게 된다.</p>\n<p>최근에 객체 배열을 시간 문자열 필드 기준 역순 정렬했는데 정렬이 제대로 되지 않았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAc0lEQVR42pXP0Q7FEBCE4bXqIDbhKFq8/3NOwxO0F3/m7kuGSilYjTFQa0XOeW+MEcYYENG3FiYikCDovaO1trGFzjmRUoL3/j3YroZ8ZjjvECTstc6CFIGZd0qp9yAXhr1/MH+DQw5wZehTQ3sNVvz58gOfGVUl6YqPIAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"정렬 안 됨\"\n        title=\"\"\n        src=\"/static/ef4c95f5830afb7ab3055c2377987559/37523/date_not_sorted.png\"\n        srcset=\"/static/ef4c95f5830afb7ab3055c2377987559/e9ff0/date_not_sorted.png 180w,\n/static/ef4c95f5830afb7ab3055c2377987559/f21e7/date_not_sorted.png 360w,\n/static/ef4c95f5830afb7ab3055c2377987559/37523/date_not_sorted.png 720w,\n/static/ef4c95f5830afb7ab3055c2377987559/302a4/date_not_sorted.png 1080w,\n/static/ef4c95f5830afb7ab3055c2377987559/11b93/date_not_sorted.png 1124w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>분명 자스에서는 문자열 끼리 비교 연산자 계산이 잘 되었었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.777777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAR0lEQVR42p2OQQoAMQgDtYoVpFD9/1+zWNi9bw8DSQ5DqKqw1gIzo/OLqoKI/pOZiAiICPbeh966XwnndJjZeejuH2OMK+EDqWY+RT1Uga8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"부등호 비교\"\n        title=\"\"\n        src=\"/static/50d5932526644923dcace7dfb585ccb8/37523/compare_date_string.png\"\n        srcset=\"/static/50d5932526644923dcace7dfb585ccb8/e9ff0/compare_date_string.png 180w,\n/static/50d5932526644923dcace7dfb585ccb8/f21e7/compare_date_string.png 360w,\n/static/50d5932526644923dcace7dfb585ccb8/37523/compare_date_string.png 720w,\n/static/50d5932526644923dcace7dfb585ccb8/302a4/compare_date_string.png 1080w,\n/static/50d5932526644923dcace7dfb585ccb8/0f246/compare_date_string.png 1118w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>숫자가 아니라서 뺄셈이 안 되는 구나! 하고 원래 식을 고치지만 여전히 안 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.222222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAL0lEQVR42mPg4Ob4zynG+Z9LjOs/Jx/nf1Z+1v/swuz/WfhY/jMxM/1nYGAgCQMARWYU0VNIiQwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"여전히 안됨\"\n        title=\"\"\n        src=\"/static/642440a7108bca31e810f9b1f72d3a54/37523/still_not_working.png\"\n        srcset=\"/static/642440a7108bca31e810f9b1f72d3a54/e9ff0/still_not_working.png 180w,\n/static/642440a7108bca31e810f9b1f72d3a54/f21e7/still_not_working.png 360w,\n/static/642440a7108bca31e810f9b1f72d3a54/37523/still_not_working.png 720w,\n/static/642440a7108bca31e810f9b1f72d3a54/302a4/still_not_working.png 1080w,\n/static/642440a7108bca31e810f9b1f72d3a54/0f246/still_not_working.png 1118w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>그러면 <code class=\"language-text\">Date</code> 인스턴스로 만들면 되지 않을까?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.222222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAANElEQVR42n3DwQ3AMAgEQT5g4wO+9F/ppoOMNJaV5CZacecSE7x99DY9zYmDJKoKd8fMfn9mmhWFqwjTrQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"date도 안됨\"\n        title=\"\"\n        src=\"/static/bc450718f3b707009e70180ab535b0a0/37523/date_not_working.png\"\n        srcset=\"/static/bc450718f3b707009e70180ab535b0a0/e9ff0/date_not_working.png 180w,\n/static/bc450718f3b707009e70180ab535b0a0/f21e7/date_not_working.png 360w,\n/static/bc450718f3b707009e70180ab535b0a0/37523/date_not_working.png 720w,\n/static/bc450718f3b707009e70180ab535b0a0/302a4/date_not_working.png 1080w,\n/static/bc450718f3b707009e70180ab535b0a0/0f246/date_not_working.png 1118w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p><code class=\"language-text\">Date</code> 인스턴스로 만들어도 안되는구나 싶던 차에 혹시 해서 해 보니 이건 또 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.222222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAANklEQVR42n3DwQnAMAwEQT3EIftkP+P03+gGXEAGJsrFOAM/plahLeaZ7HfhNpLo7jsziYjfH2QaFXp7+BCnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"date 다시 됨\"\n        title=\"\"\n        src=\"/static/77eaebc389574c260a3be740f85cede3/37523/date_working.png\"\n        srcset=\"/static/77eaebc389574c260a3be740f85cede3/e9ff0/date_working.png 180w,\n/static/77eaebc389574c260a3be740f85cede3/f21e7/date_working.png 360w,\n/static/77eaebc389574c260a3be740f85cede3/37523/date_working.png 720w,\n/static/77eaebc389574c260a3be740f85cede3/302a4/date_working.png 1080w,\n/static/77eaebc389574c260a3be740f85cede3/0f246/date_working.png 1118w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>자스에 익숙한 사람이 보면 어떻게 이런 걸 몰라 싶겠지만, sort의 람다식은 숫자를 반환해야 하며, 그 결과가 양수/0/음수임에 따라 정렬하게 된다. <code class=\"language-text\">Date</code> 인스턴스로 만들어 뺄셈을 했을 땐 결과가 숫자여서 되었던 것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAPUlEQVR42mPg5xf6z8bG/p+Xl/c/Hx8fmObm5v7PxsYGZoMwDw8PWIyJiek/AwMDfiwuzvifg4OBsEIiMQBKECmf4u81HQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"date operation\"\n        title=\"\"\n        src=\"/static/ba4c9d6053ac6e1fb91a233da33b007d/37523/compare_date.png\"\n        srcset=\"/static/ba4c9d6053ac6e1fb91a233da33b007d/e9ff0/compare_date.png 180w,\n/static/ba4c9d6053ac6e1fb91a233da33b007d/f21e7/compare_date.png 360w,\n/static/ba4c9d6053ac6e1fb91a233da33b007d/37523/compare_date.png 720w,\n/static/ba4c9d6053ac6e1fb91a233da33b007d/302a4/compare_date.png 1080w,\n/static/ba4c9d6053ac6e1fb91a233da33b007d/07a9c/compare_date.png 1440w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>생각해보면 자바도 <code class=\"language-text\">Comparator</code> 인터페이스를 동일한 방식으로 구현한다. 해당 코드는 <code class=\"language-text\">Date</code> 인스턴스 뺄셈으로 해결했지만, 기왕 공부한 거 문자열로 정렬하는 코드도 짜서 실행해보고 넘어간다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.444444444444445%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAUUlEQVR42m3MOQ6AMBADwD2iPbJCkIqK/z/TKOlAKUaWXZj0VGgqJAVyCJo3qCpE5OO/EdFePYUcCRsGuw11FTIS7g4zWzn13hERy+zMvD18AQWwKfOMWxObAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"문자열로 정렬\"\n        title=\"\"\n        src=\"/static/5c530c2c9a383fb3885ba2daa69dbc19/37523/sort_string_result.png\"\n        srcset=\"/static/5c530c2c9a383fb3885ba2daa69dbc19/e9ff0/sort_string_result.png 180w,\n/static/5c530c2c9a383fb3885ba2daa69dbc19/f21e7/sort_string_result.png 360w,\n/static/5c530c2c9a383fb3885ba2daa69dbc19/37523/sort_string_result.png 720w,\n/static/5c530c2c9a383fb3885ba2daa69dbc19/302a4/sort_string_result.png 1080w,\n/static/5c530c2c9a383fb3885ba2daa69dbc19/07a9c/sort_string_result.png 1440w,\n/static/5c530c2c9a383fb3885ba2daa69dbc19/e405b/sort_string_result.png 1566w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>프로그래머스 레벨1 문제에도 못미칠 것 같은 예시라 부끄럽지만, 하다 보면 이것 보다 간단한 것도 자주 직접 실행해 본다.\n문법을 하나하나 외우며 하기 보다 이렇게 야생형으로 익히는 게 더 빨리 익는 것 같다.</p>\n<br>\n<h2 id=\"️-그리고-함께-공부\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%ED%95%A8%EA%BB%98-%EA%B3%B5%EB%B6%80\" aria-label=\"️ 그리고 함께 공부 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✏️ 그리고, 함께 공부</h2>\n<p>처음 자스 코스를 열어봤을 때 막막했다.\n신입 같지 않은 멋진 모습을 보여주겠다고 생각했는데, 자스 코드를 보니까 이건 신입 개발자도 못 되고 대학생 때 처음으로 교양 프로그래밍 강의에 들어갔던 때 처럼 압도되었다.</p>\n<p>노드 -> 스프링 마이그레이션을 위한 리팩터링 중에, 인텔리제이로 제대로 인덱싱이 되지 않은 코드를 사용하지 않는 코드로 착각해 지우고 스테이징에 배포했다가 CPU를 터트리는 일이 잦았다. 또, 마이그레이션을 하면서 하위 호환을 맞추다 보니 점점 코드가 지저분해지고, 그 코드에 익숙해지니 점점 정리되지 않은 코드에 대한 민감도도 떨어진다고 느꼈다. 나만 이런 문제를 느낀 게 아니어서 팀에서 이를 개선하기 위한 스터디도 했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABcUlEQVR42p3STUsCQRjA8T5Zn6Jrl+gWFEVFdAoierEXCIyIDqESnaJDHXqxQ1BaZNiqQUR20WwrX0rd2d3Z9R+zaxFRYC4My8zzzG+Y55kOgEaj4Q2af0sICvFzXrQU77kcUjo4jj+k42AIgS2ln/99P9DxE3SBqq5zF4pwMTpGZjnoJTZcFfE3KVAI8YX8DYIHvus6+egxWmCRq4lJcodRP+Y2D3VdD20JdFRyrUY6sIA2Pcf50AipmQC3m1ucHm/jtgVWa9yEIuTOYmRCYW7X1tkb7GO4t5N89tLLq9frLYKq6IZBIpkkFo9znUpTLOtcayfMjXcR253362i0CEopMU3Tu5ajOgnYpkE2q7Ey1kN4thuj+oxpyWajWgQ/19X3Vn7kYGeK9aUBIqv9FPJ3SMevZVtgqVjgYC/IydEGqcR+e1dW78y2bW9umYLC4z3pRJTXp4cmaPyjKUJQLJW+HrBCVdjDbUmlUsGyrF/BD0YAQcxki63BAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"파이브 라인즈 오브 코드\"\n        title=\"\"\n        src=\"/static/861079224684682a7b430d57ffdcea27/37523/five_lines_of_code.png\"\n        srcset=\"/static/861079224684682a7b430d57ffdcea27/e9ff0/five_lines_of_code.png 180w,\n/static/861079224684682a7b430d57ffdcea27/f21e7/five_lines_of_code.png 360w,\n/static/861079224684682a7b430d57ffdcea27/37523/five_lines_of_code.png 720w,\n/static/861079224684682a7b430d57ffdcea27/302a4/five_lines_of_code.png 1080w,\n/static/861079224684682a7b430d57ffdcea27/07a9c/five_lines_of_code.png 1440w,\n/static/861079224684682a7b430d57ffdcea27/2d912/five_lines_of_code.png 1772w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그 중 하나가 <a href=\"https://product.kyobobook.co.kr/detail/S000200661796\">파이브 라인즈 오브 코드</a> 책을 읽고 액션 아이템을 정해 실천한 것이다.\n이 책은 메뉴얼처럼 구체적인 사례와 명확한 리팩터링 방법을 알려주는 게 특이하다.\n지금 다시 훑어보니 사람보다 기계를 학습시킬 때 효율적일 것 같다는 생각이 들 정도다.</p>\n<p>스터디를 할 당시, 우리 팀은 마이그레이션 하는 동시에 실험적인 기능을 빠르게 출시하고 있었다. 책에서 함께 뽑은 여러 액션 아이템 중, 그 때 뽑아 지금도 지키고 있는 것들을 몇 개 소개한다.</p>\n<ul>\n<li>최소 개발! 우리가 상상할 수 있는 문제가 아니라면 당면한 문제만 해결해야 한다.</li>\n<li>메서드 이름에 도메인 용어 사용하자</li>\n<li>사용하지 않는 코드 제거하자. (당연해 보이지만 쉽지 않다! 이미 그런 코드가 많고 시간이 촉박하며 이 코드를 지웠을 때 언.낫.펑이 터지진 않을까 하는 불안감이 항상 존재한다면!)</li>\n<li>메서드/함수에서 Ten Lines of Code 하자. 단, 추상화 수준을 맞춰서</li>\n</ul>\n<p>사실 스터디는 셋이 했는데, 현재 팀에 있는 건 나 뿐이지만… 그래도 체화해서 잘 지키고 있다. 이런 룰 없이 인원 변동이 있었다면 코드 퀄리티 유지가 쉽지 않았을 것이다.</p>\n<p>그 외에도 여러 심금을 울리는 얘기가 나온다.</p>\n<blockquote>\n<p>추상화는 인지된 복잡성의 감소를 위해 실제의 복잡성의 증가를 허용하는 것이다. (p151)</p>\n</blockquote>\n<blockquote>\n<p>프로그램이 시간이 고정된 도메인에 대한 개발팀의 공동 지식이라는 유사성에 주목했습니다. 프로그램은 개발자가 도메인에 대해 사실이라고 믿는 모든 것에 대한 완전하고 모호하지 않은 설명입니다. (p223)</p>\n</blockquote>\n<blockquote>\n<p>부수적 복잡성의 가장 단순한 유형은 기술적 무지입니다. 무의식적으로 코드에서 잘못된 결정을 내림으로써 좋지 않은 아키텍처를 만듭니다. …가장 중요하게는 의도적인 연습을 통해 기술을 향상시키기 위해 지속적으로 노력해야 합니다. 연습을 대신할 수 있는 것이란 없습니다. (p251)</p>\n</blockquote>\n<blockquote>\n<p>레거시 코드의 일반적인 정의는 ‘수정하기가 겁나는 코드’입니다. 이 상황은 종종 서커스 팩터의 결과입니다. …만약 이 시스템을 배포하는 방법은 존 밖에 모른다 라는 말을 듣는다면 해당 시스템에 서커스 팩터가 있다고 말합니다. (p254)</p>\n</blockquote>\n<blockquote>\n<p>‘아주 좋은’의 기준을 넘을 수 있는 시간이나 기술이 없다면 그냥 ‘나쁘게’ 놔두어야 합니다. 이 활동을 코드를 깨끗한 코드와 레거시 코드로 분리합니다. (p335)</p>\n</blockquote>\n<blockquote>\n<p>필요한 것 보다 더 많은 기능이나 더 일반적인 기능을 구축한다면 우리를 구할 방법은 존해하지 않습니다. 따라서 이 문제를 해결하는 유일한 방법은 최소한으로 구축하기 위한 끊임없는 노력입니다. …상상할 수 있는 문제가 아니라 이미 당면한 문제만 해결해야 합니다. (p318)</p>\n</blockquote>\n<p>딱 필요한 순간에 잘 읽은 책이었다.</p>\n<br>\n<p>다른 하나는 <a href=\"https://www.inflearn.com/course/practical-testing-%EC%8B%A4%EC%9A%A9%EC%A0%81%EC%9D%B8-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EA%B0%80%EC%9D%B4%EB%93%9C\">Practical Testing: 실용적인 테스트 가이드</a> 강의를 함께 듣는 스터디였다. 이 강의는 스프링 환경에서 테스트를 작성해본 경험이 적거나, 테스트를 도입하고 싶은데 막막한 사람에게 큰 도움이 될 것 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABTklEQVR42oVRTUvDQBDN/z958FDoWfEiiCCKRXKxCOJBrVhUkjZpkjZNsrv5aM3Hbp7sNo1NCxrYzMybmfdmdjUASNMU8/kC/nIpQ9R1fWD/87efJn/mZIrBnY7RaATwAvUemZC+bJaZpn9L9lu3wRRhWZZIswx5kUNUVau2q/7XVLuYtp8sBUdIaBvL6V4TB7RaHxCzJQHnvEOqqTUE8E4c9O+vwVgCOwk7qkfnZ3hxzUZANHgN/fmhJdySqpV5JaDrtzju9zC8uAFl8aZZCGWvLgeYOV4Hsx0XvZNTGMa0O6EMcl7Bm9gQ6TfGb2P4i6BzDb4fIMtWHWy1WuNx+AQS0b2Vm7VmjoOPr09YtoWiKBQWxzFM04RlWTAMA57nqQkJIQqPohCu6yIIgu7K0pFFMiFPnueqIEmSBgtBKQNjTIlJG0WROtKnlLav/AMrKLXk1MaWAgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"테스트 강의\"\n        title=\"\"\n        src=\"/static/cf90a2cbbf1633a790dfd5ec1ea5139e/37523/practical_test.png\"\n        srcset=\"/static/cf90a2cbbf1633a790dfd5ec1ea5139e/e9ff0/practical_test.png 180w,\n/static/cf90a2cbbf1633a790dfd5ec1ea5139e/f21e7/practical_test.png 360w,\n/static/cf90a2cbbf1633a790dfd5ec1ea5139e/37523/practical_test.png 720w,\n/static/cf90a2cbbf1633a790dfd5ec1ea5139e/302a4/practical_test.png 1080w,\n/static/cf90a2cbbf1633a790dfd5ec1ea5139e/07a9c/practical_test.png 1440w,\n/static/cf90a2cbbf1633a790dfd5ec1ea5139e/ce0a7/practical_test.png 1590w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div style=\"text-align:center; font-style:italic; color:grey;\">\n  딱 강의 소개대로!  \n</div>  \n<br>\n<p>스프링 테스트에 익숙한 사람도 있었고 아닌 사람도 있었는데, 같이 강의를 보면서 현재 팀의 테스트 작성 방식이 어떤지 점검하고, 어떤 좋은 점을 유지할지, 어떤 점을 보충할지, 통일되지 않은 부분은 어떻게 맞추면 좋을지 얘기해서 좋았다.</p>\n<br>\n<h2 id=\"-회고\" style=\"position:relative;\"><a href=\"#-%ED%9A%8C%EA%B3%A0\" aria-label=\" 회고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🍹 회고</h2>\n<p>메서드보다 더 긴 JSDoc을 써야할 때, 비교적 간단한 로직을 테스트하기 위해 모킹을 산더미처럼 해야할 때, <code class=\"language-text\">null</code>이나 <code class=\"language-text\">undefined</code> 값을 검사할 때… 자바스크립트를 자바스크립트 답게 쓰지 못하고 자꾸 익숙한 자바처럼 끼워맞추려는 욕심을 부린다는 생각이 종종 들곤 했다. 사실 자바스크립트 답게 쓰는 건 무엇인가? 를 말할 수 있을 만큼 잘 알지도 못한다.<br>\n하지만 자바스크립트에서 자바로 단방향 마이그레이션 하는 중이고, 컨셉이 다른 두 언어를 함께 사용하며 개발하려니 한 쪽으로 생각하는 게 편하고 효율적이었다.</p>\n<p>이런 자잘한 과정 없이 달리는 기차를 마법처럼 비행기로 바꿀 수 있다면 얼마나 좋을까? 생각보다 훨씬 까다롭고 지치는 작업이라는 걸 해 보기 전엔 몰랐다. 재밌겠다고 꼭 해보고 싶다고만 생각했다. 허허…</p>\n<p>다만 자바스크립트와 노드 프레임워크 공부를 더 제대로 해야 할 필요성은 언제나 느낀다. 스프링을 공부 할 때를 떠올려보면, 단순히 스프링 애플리케이션을 실행해 사용하는 건 인강을 듣고 금방 따라할 수 있었다. 하지만 내부의 원리나 철학에 진심으로 관심을 가져 탐구하고 이해하기 까지는 꽤 오랜 시간이 걸렸다.<br>\n따라하며 ‘일단 돌아가게 만들기’ 급급했던 시기를 지나, 관심이 생기는 지금이 원리나 철학을 공부하기에 좋은 때가 왔다 싶다.</p>\n<p>만약 입사하기 전의 내 귓가에 <em>너 자바스크립트 해야함</em>을 속삭였다면 도망갔을지도 모른다.\n난 뭐… 속삭여 준 사람이 없어서 선택지가 없었다! 그래도 겁내지 않고 도전하니 좋았다.\n기술 스택 때문에 회사 지원이나 입사를 망설이는 사람이 있다면 얼마든 도전해보라고 얘기해주고 싶다.\n처음엔 멘붕이었는데 지금은 꽤 즐겁다.\n다른 언어나 프레임워크를 하게 되어도 충분히 할 수 있을 것 같다! 👻</p>\n<p>마지막으로 회사가 오해를 살까 하는 걱정에 덧붙이자면, 노드보다 스프링을 훨씬 많이 짜고 생각하고 고민하고 있다. 끝!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.777777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdklEQVR42l2MQQrCMBQFe/+zeALBrQjus1FiQWMKLaGaRGySn5GWuulshoHHa5RSaK15GENn75zOR9o+ce2+GDeRSkFEkL+lrhZqraSU8SEyM3fjvSfGuAwuN83usOc5BFo7Yl1gCI4wfSjji/L2bFlOc6au/QMKvZlonKtLgQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"node contributes\"\n        title=\"\"\n        src=\"/static/323e65dc2f9f80100cfc3d105a4978cd/37523/node_contributes.png\"\n        srcset=\"/static/323e65dc2f9f80100cfc3d105a4978cd/e9ff0/node_contributes.png 180w,\n/static/323e65dc2f9f80100cfc3d105a4978cd/f21e7/node_contributes.png 360w,\n/static/323e65dc2f9f80100cfc3d105a4978cd/37523/node_contributes.png 720w,\n/static/323e65dc2f9f80100cfc3d105a4978cd/302a4/node_contributes.png 1080w,\n/static/323e65dc2f9f80100cfc3d105a4978cd/07a9c/node_contributes.png 1440w,\n/static/323e65dc2f9f80100cfc3d105a4978cd/5df5d/node_contributes.png 1572w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.777777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhklEQVR42h3DuQrCQBRAUf//UwQbC8FWjEXETsQodllgMiTzJruzXIkHzqaWnDQ9cb1nfJTnkQ8oWfDB4b3HO8dq6C27/ZZXYcjKmXc1YaeFED3Ruf/VJkbPMTlze2ZoM1EqQXcW3bfM48DXCDFGbNdzuCSUdUuhhEpblDQ0o7C0htkILgR+ZS2WjIZabaEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"spring contributes\"\n        title=\"\"\n        src=\"/static/2d6372d1979a6f22e8aaaa032786ba87/37523/spring_contributes.png\"\n        srcset=\"/static/2d6372d1979a6f22e8aaaa032786ba87/e9ff0/spring_contributes.png 180w,\n/static/2d6372d1979a6f22e8aaaa032786ba87/f21e7/spring_contributes.png 360w,\n/static/2d6372d1979a6f22e8aaaa032786ba87/37523/spring_contributes.png 720w,\n/static/2d6372d1979a6f22e8aaaa032786ba87/302a4/spring_contributes.png 1080w,\n/static/2d6372d1979a6f22e8aaaa032786ba87/07a9c/spring_contributes.png 1440w,\n/static/2d6372d1979a6f22e8aaaa032786ba87/5df5d/spring_contributes.png 1572w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#-jest%EB%A1%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A7%9C%EA%B8%B0\">🚀 Jest로 테스트 짜기</a></li>\n<li><a href=\"#-%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5%EC%A0%81%EC%9D%B8-%EB%A6%AC%ED%8C%A9%ED%84%B0%EB%A7%81\">👾 객체지향적인 리팩터링</a></li>\n<li><a href=\"#-jsdoc%EC%9C%BC%EB%A1%9C-%ED%83%80%EC%9E%85-%ED%9E%8C%ED%8A%B8-%EB%84%A3%EA%B8%B0\">🧶 JSDoc으로 타입 힌트 넣기</a></li>\n<li><a href=\"#%EF%B8%8F-%EC%9E%98-%EB%AA%A8%EB%A5%B4%EA%B2%A0%EC%9C%BC%EB%A9%B4-%EC%A7%81%EC%A0%91-%EC%B3%90%EB%B3%B4%EB%A9%B4-%EB%90%9C%EB%8B%A4\">✍️ 잘 모르겠으면 직접 쳐보면 된다</a></li>\n<li><a href=\"#%EF%B8%8F-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%ED%95%A8%EA%BB%98-%EA%B3%B5%EB%B6%80\">✏️ 그리고, 함께 공부</a></li>\n<li><a href=\"#-%ED%9A%8C%EA%B3%A0\">🍹 회고</a></li>\n</ul>\n</div>","frontmatter":{"date":"December 10, 2023","title":"자바스크립트에 불시착","categories":"회고","author":"써머","emoji":"headers/fight-javascript.png"},"fields":{"slug":"/fight-javascript/"}},"site":{"siteMetadata":{"siteUrl":"https://hyewoncc.github.io","comments":{"utterances":{"repo":"hyewoncc/hyewoncc.github.io"}}}}},"pageContext":{"slug":"/how-can-collect-time/","nextSlug":"/dns-error-eia-again/","prevSlug":"/fight-javascript/"}},"staticQueryHashes":["1073350324","1956554647","2938748437","3350743975"],"slicesMap":{}}