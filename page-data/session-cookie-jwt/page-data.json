{"componentChunkName":"component---src-templates-blog-template-js","path":"/session-cookie-jwt/","result":{"data":{"cur":{"id":"0b4579f8-1439-5de0-b380-59d8d252221d","html":"<h2 id=\"-세션의-정체를-찾아서\" style=\"position:relative;\"><a href=\"#-%EC%84%B8%EC%85%98%EC%9D%98-%EC%A0%95%EC%B2%B4%EB%A5%BC-%EC%B0%BE%EC%95%84%EC%84%9C\" aria-label=\" 세션의 정체를 찾아서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔍 세션의 정체를 찾아서</h2>\n<h3 id=\"세션의-정의\" style=\"position:relative;\"><a href=\"#%EC%84%B8%EC%85%98%EC%9D%98-%EC%A0%95%EC%9D%98\" aria-label=\"세션의 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세션의 정의</h3>\n<p>영어에서 <code class=\"language-text\">session</code>이란 특정 활동이 수행된 기간을 의미한다. 일상 속에서 보자면 나는 꾸준히 PT를 받고 있는데, PT 수업 한 회를 세션이라고 불렀다.<br>\n그럼 CS의 세션은 무엇일까? **<code class=\"language-text\">둘 또는 그 이상의 컴퓨팅 디바이스간에서 일어나는 일시적이고 상호적인 정보 교환</code>**을 의미한다. 통신을 하는 동안 세션이 유지된다면 세션의 정보를 이용할 수 있을 것이다. 이런 상태를 <code class=\"language-text\">stateful</code>이라 부른다. 반대는 <code class=\"language-text\">stateless</code>라고 부르는데, HTTP 프로토콜이 이에 속한다. (막간 홍보 : HTTP에 관심이 있다면 <a href=\"https://youtu.be/IjxkKQvn8Bc\">HTTP 테코톡</a>)</p>\n<p>HTTP 프로토콜이 <code class=\"language-text\">stateless</code>이기에, 여러 불편한 상황이 일어난다. 쇼핑몰에서 상품을 장바구니에 담을 때 마다 로그인을 새로 요구한다고 생각해보자. 짜증나서 사려던 것도 안 사고 나가지 않을까? 이런 무상태를 보충하기 위해 상태 유지를 돕는 기술을 함께 사용한다. 그 중 하나가 <code class=\"language-text\">세션</code>이다.</p>\n<br/>\n<h3 id=\"javax-servelet-httpsession\" style=\"position:relative;\"><a href=\"#javax-servelet-httpsession\" aria-label=\"javax servelet httpsession permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>javax servelet HttpSession</h3>\n<p>자바 서블릿의 <code class=\"language-text\">HttpSession</code>은 <strong>인터페이스</strong>다. 이 포스팅에서 다룰 내용을 java docs에서 간추려보았다.</p>\n<!--more-->\n<blockquote>\n<p>유저 정보를 저장함으로써 웹페이지 요청이나 사이트 방문 간에 유저를 식별할 수 있는 방법을 제공한다. 서블릿 컨테이너는 이 인터페이스를 HTTP 클라이언트와 HTTP 서버 간의 세션을 만드는데 사용한다. 세션은 여러 커넥션이나 유저의 페이지 요청을 걸쳐 특정 시간동안 유지된다. 한 세션은 보통 사이트를 여러번 방문할 한 유저에 대응된다. 쿠키나 URLs 복제 등을 이용해 서버에서 한 세션을 유지시킬 수 있다.<br>\n… 서블릿은 클라이언트가 쿠키 비허용 같이 의도적으로 세션 유지를 거부할 때에 대한 대비를 해둬야 한다. 클라이언트가 세션에 참여하면 <code class=\"language-text\">isNew</code>는 <code class=\"language-text\">true</code>를 반환한다. 클라이언트가 세션 유지를 거부하면, <code class=\"language-text\">getSession</code>은 매 요청마다 다른 세션을 반환하기에 <code class=\"language-text\">isNew</code>도 항상 <code class=\"language-text\">true</code>를 반환할 것이다.<br>\n세션 정보 범위는 현재의 웹 어플리케이션(ServletContext)로 한정되기에, 한 곳에 저장된 정보는 다른 웹 어플리케이션(ServletContext)에서 접근할 수 없다.</p>\n</blockquote>\n<br/>\n<h3 id=\"톰캣-standardsession--managerbase\" style=\"position:relative;\"><a href=\"#%ED%86%B0%EC%BA%A3-standardsession--managerbase\" aria-label=\"톰캣 standardsession  managerbase permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>톰캣 StandardSession &#x26; ManagerBase</h3>\n<p>스프링부트로 웹개발을 하고 있기에, <strong>톰캣의 구현체</strong>를 살펴보겠다. <code class=\"language-text\">StandardSession</code>은 <code class=\"language-text\">HttpSession</code>과 함께 <code class=\"language-text\">Session</code>, <code class=\"language-text\">Serializable</code>을 구현하고 있다. 이중 <code class=\"language-text\">Session</code> 인터페이스는 <code class=\"language-text\">HttpSession</code>의 <a href=\"https://ko.wikipedia.org/wiki/%ED%8D%BC%EC%82%AC%EB%93%9C_%ED%8C%A8%ED%84%B4\">퍼사드 패턴</a>적용 객체이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">/**\n* The collection of user data attributes associated with this Session.\n* 역 - 해당 세션과 관련된 유저 정보의 집합  \n*/</span>\n<span class=\"token keyword\">protected</span> <span class=\"token class-name\">ConcurrentMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> attributes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> value<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> notify<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p><code class=\"language-text\">StandardSession</code>은 <code class=\"language-text\">ConcurrentMap</code>의 형태로 정보를 담는다. <code class=\"language-text\">setAttribute</code>로 세션에 객체를 담을 수 있는데, 특이사항이 두 가지 있다.</p>\n<ol>\n<li>키값이 이미 존재한다면 값이 교체된다</li>\n<li>추가한 객체가 <code class=\"language-text\">HttpSessionBindingListener</code>의 구현체라면, <code class=\"language-text\">valueBound()</code>가 호출된다</li>\n</ol>\n<p>1번은 <code class=\"language-text\">Map</code> 자료구조를 생각하면 당연한 사실이겠지만, 2번은 추후 공부가 더 필요한 영역이다.</p>\n<p>그리고 <code class=\"language-text\">ManagerBase</code> 클래스에 <code class=\"language-text\">session id</code>를 키값으로 세션이 들어가있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ManagerBase</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LifecycleMBeanBase</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Manager</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Session</span><span class=\"token punctuation\">></span></span> sessions <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Session</span> session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        sessions<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">.</span><span class=\"token function\">getIdInternal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> sessionId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Session</span> s <span class=\"token operator\">=</span> sessions<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>sessionId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/> \n<h2 id=\"-그렇담-쿠키는-무엇인가\" style=\"position:relative;\"><a href=\"#-%EA%B7%B8%EB%A0%87%EB%8B%B4-%EC%BF%A0%ED%82%A4%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80\" aria-label=\" 그렇담 쿠키는 무엇인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🍪 그렇담 쿠키는 무엇인가</h2>\n<h3 id=\"쿠키-정의\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%ED%82%A4-%EC%A0%95%EC%9D%98\" aria-label=\"쿠키 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠키 정의</h3>\n<p>쿠키는 인터넷 웹 브라우저를 통해 컴퓨팅 기기에 설치되는 <strong>작은 기록 정보 파일</strong>이다. 쿠키는 <code class=\"language-text\">key-value</code>쌍과 속성으로 이루어져 있는데, 속성에는 만료 기간, 도메인, 플래그(ex. Secure, HttpOnly)등의 정보를 저장한다. 브라우저의 개발자 도구에서 값을 직접 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.111111111111107%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABD0lEQVQY0x2Q2W6DMBBF+f8v6hf0pW9V04SEAF4wBsIaglkancoeyRrbGp1770TGGNq25f1+I5RGFRapDUIV5FKTywJtLD+XG6c4Ic0VSSbIhCZJRZjzJ5OaeyaI6ubBMIwcxx+lrbD1g3N843SOSXOJkJq264lv9/CvTcn0nHnOL7p+YH4tLG5lGCcyoYiayjANHb5MWVKUlt/LlSTNaPsBqYsw7LvShrppmZclAJu2C7B125jmGVUYoo8vzee551vtyMJSVlVQEkJQ102I44HebZoL6keLc2sAVnWDWze2fQ9vLxid8p6rHtHdgTIWWze8nGPbjwDyqv04kksVduRXtDgXovbDGO4e6h36dP9DV3TmY6RtbwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cookie sample\"\n        title=\"cookie sample\"\n        src=\"/static/ed7a7815a36826fd59a6e115c1e5cfda/37523/cookie_sample.png\"\n        srcset=\"/static/ed7a7815a36826fd59a6e115c1e5cfda/e9ff0/cookie_sample.png 180w,\n/static/ed7a7815a36826fd59a6e115c1e5cfda/f21e7/cookie_sample.png 360w,\n/static/ed7a7815a36826fd59a6e115c1e5cfda/37523/cookie_sample.png 720w,\n/static/ed7a7815a36826fd59a6e115c1e5cfda/302a4/cookie_sample.png 1080w,\n/static/ed7a7815a36826fd59a6e115c1e5cfda/07a9c/cookie_sample.png 1440w,\n/static/ed7a7815a36826fd59a6e115c1e5cfda/ca640/cookie_sample.png 2406w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>쿠키는 세션 관리, 개인화, 트래킹 등의 목적으로 사용된다. 하지만 이미지에서 보이듯 값을 자유롭게 확인 가능함으로 <strong>비밀번호, 개인정보 등의 중요정보는 절대 담아선 안된다.</strong></p>\n<br/>\n<h3 id=\"쿠키-종류\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%ED%82%A4-%EC%A2%85%EB%A5%98\" aria-label=\"쿠키 종류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠키 종류</h3>\n<p>종류에 따라 특정한 유형으로 따로 저장되는 건 아니고, 설정에 따라 분류할 수 있다.</p>\n<ul>\n<li>Session Cookie\n<ul>\n<li>expires(유효 일자)나 max-age(만료 기간) 옵션이 지정되지 않은 쿠키. 브라우저가 닫힐 때 함께 삭제된다.</li>\n</ul>\nexpires를 과거로 지정하거나 max-age를 0으로 설정하는 경우 바로 삭제되므로 여기에 속한다.</li>\n<li>Persistent Cookie\n<ul>\n<li>장기간 저장되는 쿠키. max-age로 설정할 수 있다. 접속한 기기에 저장된다.</li>\n</ul>\n포스팅 자료를 찾다 2038년 문제와 관련된 재밌는 글을 발견했는데 심심하면 읽어보시길. <a href=\"https://stackoverflow.com/questions/3290424/set-a-cookie-to-never-expire\">절대 만료되지 않을 쿠키 만들기 - stackoverflow</a></li>\n<li>Secure Cookie\n<ul>\n<li><code class=\"language-text\">secure</code> 옵션을 설정해 HTTPS로 통신하는 경우에만 전송되는 쿠키.</li>\n</ul>\n<code class=\"language-text\">secure</code>가 설정되어 있지 않은 기본값은 <code class=\"language-text\">HTTPS &lt;-🍪-> HTTP</code>간의 이용이 자유롭다. 반면 설정 시, <code class=\"language-text\">HTTPS -🍪/-> HTTP</code> 이 되어 HTTPS에서 생성한 쿠키를 HTTP가 읽을 수 없다.<br>\n민감 내용이 저장되어 있어 비암호화인 HTTP 연결 전달을 원치 않는다면 사용하면 된다.</li>\n<li>Third-Party Cookie\n<ul>\n<li>사용자가 방문 중인 도메인이 아닌 다른 도메인에서 설장한 쿠키. <a href=\"https://ko.javascript.info/cookie#ref-696\">부록: 서드 파티 쿠키 - JAVASCRIPT.INFO</a>에 잘 설명되어 있다. 반대 개념으로 같은 도메인에서 설정한 쿠키는 First-Party Cookie다.</li>\n</ul>\n</li>\n</ul>\n<br/>\n<h2 id=\"httpsession을-이용한-상태-유지-with-\" style=\"position:relative;\"><a href=\"#httpsession%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%83%81%ED%83%9C-%EC%9C%A0%EC%A7%80-with-\" aria-label=\"httpsession을 이용한 상태 유지 with  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HttpSession을 이용한 상태 유지 (with 🍪)</h2>\n<h3 id=\"세션에-상태값-유지하기\" style=\"position:relative;\"><a href=\"#%EC%84%B8%EC%85%98%EC%97%90-%EC%83%81%ED%83%9C%EA%B0%92-%EC%9C%A0%EC%A7%80%ED%95%98%EA%B8%B0\" aria-label=\"세션에 상태값 유지하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세션에 상태값 유지하기</h3>\n<p>HttpSession으로 간단한 상태 유지를 한 사례를 <a href=\"https://github.com/hyewoncc/spring-sandbox/tree/session-cookie\">깃헙</a>에서 볼 수 있다. 해당 브랜치의 애플리케이션을 실행하면 간단한 페이지가 뜬다. <code class=\"language-text\">삐약삐약</code>을 누르면 병아리가 추가된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAmUlEQVQY04WPgQqDMAxE+/+/ONjmXFtbi7CqNerWNzoRBhuY8OC45CBRTtdobwihwzaOtg1MIowpoa3DNB7jAsZ1m25atPXU2nIzHcZ6qtpwvloulUO9MuScEREeMdL3AzLPLOvKWni+kBSZR//RxSszkYk0Z5ZloR8TsZ8YxhVFzpT+W3nzg7c099Nufi/8RFS57hjYPzniDXxpNzSqsq9OAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"session sample 1\"\n        title=\"session sample 1\"\n        src=\"/static/8f7af9d828ab8c631be123af1d0e629d/37523/session_sample1.png\"\n        srcset=\"/static/8f7af9d828ab8c631be123af1d0e629d/e9ff0/session_sample1.png 180w,\n/static/8f7af9d828ab8c631be123af1d0e629d/f21e7/session_sample1.png 360w,\n/static/8f7af9d828ab8c631be123af1d0e629d/37523/session_sample1.png 720w,\n/static/8f7af9d828ab8c631be123af1d0e629d/302a4/session_sample1.png 1080w,\n/static/8f7af9d828ab8c631be123af1d0e629d/07a9c/session_sample1.png 1440w,\n/static/8f7af9d828ab8c631be123af1d0e629d/09262/session_sample1.png 1896w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAApklEQVQY032Oy27DMAwE/f+/l556aGobkixbSGDLD0qKOYXaQwukyC7mQi4XbLzpMaMlhBtu8ExT4BBh23eM81gfsOOM9fcfhgnjRnrj6OwN60ba3vLx6bi2nuZUUFVEhHlZiHFFUiKX8o1skTS/k9aOFFtKqbsHIgd7UnLOxG1niQfrVmhQpfo/aR2fmWAuDN0bpAn08TfxdNPU715RdVb0t+JV/gshYjakwUdV+QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"session sample 2\"\n        title=\"session sample 2\"\n        src=\"/static/f07c34a356e54d001a0234d8d3f0065c/37523/session_sample2.png\"\n        srcset=\"/static/f07c34a356e54d001a0234d8d3f0065c/e9ff0/session_sample2.png 180w,\n/static/f07c34a356e54d001a0234d8d3f0065c/f21e7/session_sample2.png 360w,\n/static/f07c34a356e54d001a0234d8d3f0065c/37523/session_sample2.png 720w,\n/static/f07c34a356e54d001a0234d8d3f0065c/302a4/session_sample2.png 1080w,\n/static/f07c34a356e54d001a0234d8d3f0065c/07a9c/session_sample2.png 1440w,\n/static/f07c34a356e54d001a0234d8d3f0065c/09262/session_sample2.png 1896w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>해당 애플리케이션은 브라우저를 완전히 종료하고 다시 켜는 것만 아니면, 새로고침을 하거나, 페이지를 닫았다 열어도 증가한 만큼 병아리의 수가 유지된다. <code class=\"language-text\">HttpSession</code>에 <code class=\"language-text\">chicks</code>라는 이름으로 정수값을 저장하기 때문이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SessionController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">SESSION_KEY</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"chicks\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ModelAndView</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSession</span> session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Object</span> attribute <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SESSION_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">ModelAndView</span> modelAndView <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ModelAndView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"session.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>attribute <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SESSION_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> attribute<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            session<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SESSION_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> attribute<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> modelAndView<span class=\"token punctuation\">.</span><span class=\"token function\">addAllObjects</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SESSION_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        session<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SESSION_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> modelAndView<span class=\"token punctuation\">.</span><span class=\"token function\">addAllObjects</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@PostMapping</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSession</span> session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Object</span> attribute <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SESSION_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>attribute <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            session<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SESSION_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> attribute <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그런데 애플리케이션은 <code class=\"language-text\">ManagerBase</code>에서 해당 세션을 어떻게 찾아오는 것일까? 개발자 도구에서 <code class=\"language-text\">쿠키</code>를 보면 답을 알 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.666666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdElEQVQI1y2LORLCMBDA8v8H0lCEHLv2+g45gEoMHgo1GmkwCzymiffnw3W9WNVRauu0bSPXRi4VZ4F5FcZZuN1HxAcspu6dRdRS7wYRQVU59p3zPBHnEfUsq/Z4WgT/G3wgpkKImZgyubQ/FQsJUcdzP/gCX8uVvdmJaxQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jsessionid\"\n        title=\"jsessionid\"\n        src=\"/static/327473bdf2ba7a5bce604ba20101f597/37523/jsessionid.png\"\n        srcset=\"/static/327473bdf2ba7a5bce604ba20101f597/e9ff0/jsessionid.png 180w,\n/static/327473bdf2ba7a5bce604ba20101f597/f21e7/jsessionid.png 360w,\n/static/327473bdf2ba7a5bce604ba20101f597/37523/jsessionid.png 720w,\n/static/327473bdf2ba7a5bce604ba20101f597/302a4/jsessionid.png 1080w,\n/static/327473bdf2ba7a5bce604ba20101f597/07a9c/jsessionid.png 1440w,\n/static/327473bdf2ba7a5bce604ba20101f597/08485/jsessionid.png 2014w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">HttpSession</code>을 생성할 때, 톰캣에서 자동으로 랜덤한 문자열인 <code class=\"language-text\">JSESSIONID</code>를 생성한다. 그리고 이 값을 쿠키에 담아 클라이언트에 전송하고, 쿠키가 유지되는 동안 이 쿠키의 <code class=\"language-text\">JSESSIONID</code> 값으로 저장된 세션을 찾아온다. 해당 쿠키를 삭제하면 새로운 세션에 연결되고 병아리의 수가 초기화된다.</p>\n<h2 id=\"세션의-한계와-극복법\" style=\"position:relative;\"><a href=\"#%EC%84%B8%EC%85%98%EC%9D%98-%ED%95%9C%EA%B3%84%EC%99%80-%EA%B7%B9%EB%B3%B5%EB%B2%95\" aria-label=\"세션의 한계와 극복법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세션의 한계와 극복법</h2>\n<p>세션은 JVM에 저장된다. 따라서 서버가 분산되어 있다면 위의 방식으로 동작하지 않는다. A서버 메모리의 세션 맵과 B서버 메모리의 세션 맵이 다르기 때문이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVQY04WQyW7DMAxE8/9/1UPvSW8OEjixbMuyJGrxIjmmxCJwELeHonMhCeIRwznQv0qJYvAGwCittZQSEbfNYSsAME3TOI7bGJdlnucQI4YQrWuZK8+FrT80mK7rmqbx3u9wCOHrdJJSEtHDT65XQggpZc+FEGHyxFvZcaaVBoCcc0rpBeeciagoCmMM4nIpz9frpbpXjLHyVs1j+OuhHe77fhgGRPRurMquqdu6rkXPZ5QprwaUUSWYp+0QQoxxt01E67q+k0gpIeJ2NOXVPtidHdXtUwNwzpVS1tpf8A/lDcv51TwTNSCV1Vo55962vwGStZK2eQfZWAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"servers\"\n        title=\"servers\"\n        src=\"/static/a1310f23cf408bd8b9e8d43b3b395daf/37523/balance01.png\"\n        srcset=\"/static/a1310f23cf408bd8b9e8d43b3b395daf/e9ff0/balance01.png 180w,\n/static/a1310f23cf408bd8b9e8d43b3b395daf/f21e7/balance01.png 360w,\n/static/a1310f23cf408bd8b9e8d43b3b395daf/37523/balance01.png 720w,\n/static/a1310f23cf408bd8b9e8d43b3b395daf/1d69c/balance01.png 750w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이를 극복할 수 있는 몇 방안을 간략하게 소개하겠다.</p>\n<h3 id=\"sticky-session\" style=\"position:relative;\"><a href=\"#sticky-session\" aria-label=\"sticky session permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sticky session</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+ElEQVQY022QS26EMBBE5/4XmxOQRVYICeNf293Y4wZ/cMQQoSTKW1d1V9Wjv6m1Silzzr33o/8DEXokC85ae2qOU/XIOa/rGmN8Pp/kMYdUw2tnfqXEvOWSAmt6Kal0xBnk5yKNVoqIvs3OuVqrVmrf89a6wwBiMdZaY4xVkVJJTZ4IKWdEPI6jtXaa72DHm967R0KkcRynadJSllJuwZ8uj+tMKWUYBkRquSOEWYzzhZBljS0m5/xK1oHS2jDztm2nmZmFECmlYRi894kxsGl9v96U3n3KdmWlIZJYpo9ZSABAxF+xieha+2eRe3sAcM6D8zGEO/YX6zORvB4z9SMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sticky session\"\n        title=\"sticky session\"\n        src=\"/static/d63eba98af923b75c4aa90f1da0d56db/37523/balance02.png\"\n        srcset=\"/static/d63eba98af923b75c4aa90f1da0d56db/e9ff0/balance02.png 180w,\n/static/d63eba98af923b75c4aa90f1da0d56db/f21e7/balance02.png 360w,\n/static/d63eba98af923b75c4aa90f1da0d56db/37523/balance02.png 720w,\n/static/d63eba98af923b75c4aa90f1da0d56db/1d69c/balance02.png 750w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>한 사용자가 처음 세션에 참여한 서버로 접속을 고정시킨다. <code class=\"language-text\">유저1</code>이 <code class=\"language-text\">서버B</code>에 요청을 보냈다면, 세션이 유지되는 동안 <code class=\"language-text\">서버B</code>와 통신을 주고받게 된다.</p>\n<h3 id=\"session-clustering\" style=\"position:relative;\"><a href=\"#session-clustering\" aria-label=\"session clustering permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Session clustering</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8klEQVQY032Q3W7CMAyFef9HG1fTJNaVDZXSoDZJE5UmscmPPVVAx6RpvrCOJX/2sTf8b9BDlFwudpB9532IMTrniGhzbyKKMa4MIoYQACClxAA8uzzNXfO+r9+MnNzkjTULTLRM986/bLd+dhwwGWvFWUmptJrGsQS4GejFV3PYWXXJvvjgmfm+OaVUVRVggKKErpQRTXNs27YfhjlqzDbzVZzq/cerliaFDAF+YCJCxFIKM8eEUg2iE0IIrTUzpQKJQcn28Lmz41SutJyzwn+8iui5YOZRtudTrXqTIAOEX/Da/SweesnOzcZoBGTim8dv+XiUwxbHiH0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"session clustering\"\n        title=\"session clustering\"\n        src=\"/static/43c7a09ba53bd43f9711b87d785d77be/37523/balance03.png\"\n        srcset=\"/static/43c7a09ba53bd43f9711b87d785d77be/e9ff0/balance03.png 180w,\n/static/43c7a09ba53bd43f9711b87d785d77be/f21e7/balance03.png 360w,\n/static/43c7a09ba53bd43f9711b87d785d77be/37523/balance03.png 720w,\n/static/43c7a09ba53bd43f9711b87d785d77be/1d69c/balance03.png 750w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>서버 간에 세션을 복사해 공유한다. 한 서버에서 생성된 세션이 모든 서버에 복사되기에, 어떤 서버에 접속하더라도 같은 세션값을 받을 수 있다. 하지만 <code class=\"language-text\">sticky session</code>과 같이 유지 비용이 많이 든다.</p>\n<h3 id=\"session-storage-db\" style=\"position:relative;\"><a href=\"#session-storage-db\" aria-label=\"session storage db permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Session storage DB</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+UlEQVQY03WQyW7DMAxE/f/flmuDpKc4TrRYsSSL2qyFLLIUaIN2roOHId9AP4NIv+M9MMYWbeqjqbWUUnrvz3YgolIKPrDeuw8hpZRzLi3bOvOZ7T/2F8Zjp9CRcTGOk5TiBW/bttvtrDHUOyyLMeZ6vRpjNCgiAoDzOKrbbUPSEDyYANraNaV0hxHxeDwCgLvN4+enFPJwOEgpNFdUaJHmNJ4YF6mjdn4LGqyIMa/r+jo759xaw0pgo+BCKcU4S/OCdnPaT9NZzaog+VK1894H59zz7YH+yd2BDzCr6XJhjMeGsb37HB6O8Vs2vpmvtcYYU84N/xj4AkXVk5S3inVvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"session storage db\"\n        title=\"session storage db\"\n        src=\"/static/3e674016960ae522056015067a4fa350/37523/balance04.png\"\n        srcset=\"/static/3e674016960ae522056015067a4fa350/e9ff0/balance04.png 180w,\n/static/3e674016960ae522056015067a4fa350/f21e7/balance04.png 360w,\n/static/3e674016960ae522056015067a4fa350/37523/balance04.png 720w,\n/static/3e674016960ae522056015067a4fa350/1d69c/balance04.png 750w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>외부에 세션 저장소를 따로 둔다. 앞선 두 방법 보다 비용 측면에서 나아 보이지만, 분산 서버의 많은 요청이 외부 저장소로 들어갔을 때 부하가 생길 수 있다.</p>\n<p>또는…</p>\n<h2 id=\"-토큰\" style=\"position:relative;\"><a href=\"#-%ED%86%A0%ED%81%B0\" aria-label=\" 토큰 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🪙 토큰</h2>\n<h3 id=\"토큰이란\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0%EC%9D%B4%EB%9E%80\" aria-label=\"토큰이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰이란?</h3>\n<p><code class=\"language-text\">토큰</code>이란 단어는 아주 광범위하게 쓰인다. 예를 들어 java <code class=\"language-text\">StringTokenizer</code>의 토큰은 문자열을 자르는 데 이용되는 특정한 문자열이다. <code class=\"language-text\">jwt</code>의 토큰은 생성 정보와 키, 값 쌍을 인코딩한 문자열이다. 여러 사례를 보고 내가 일반화한 CS의 토큰은 <code class=\"language-text\">특정 값을 식별하는데 사용되는 키</code>이다.</p>\n<p>토큰 기반 인증은 <code class=\"language-text\">사용자가 서버에서 발급받은 토큰을 요청마다 함께 주는 방식</code>이다. 얼핏 보면 세션ID를 쿠키로 전달하는 것과 비슷해보이지만, 전달받은 값을 서버에서 처리하는 방식이 다르다. 토큰은 저장소에 접근하지 않고, 서버에서 유효성을 검증한다. 따라서 분산 서버 환경이어도 문제가 없다.</p>\n<p>다만 <code class=\"language-text\">Access Token</code>과 <code class=\"language-text\">Refresh Token</code>을 함께 사용하는 경우에는 <code class=\"language-text\">Refresh Token</code>을 DB에 저장하게 된다. 이번 포스팅에서 마저 다루기엔 내용이 길기에, 대신 잘 정리되어 있는 다른 블로그 포스팅 링크를 남기겠다. 토큰에 대해 알아보며 토큰을 사용한 대표적인 인증 방식인 <code class=\"language-text\">OAuth</code>도 함께 공부할 필요성을 느껴서 함께 올린다.</p>\n<ul>\n<li><a href=\"https://tansfil.tistory.com/59\">쉽게 알아보는 서버 인증 2편(Access Token + Refresh Token)</a></li>\n<li><a href=\"https://www.icatpark.com/entry/OAuth-20-%EC%9D%B4%ED%95%B4\">OAuth 2.0 이해</a></li>\n</ul>\n<br/>\n<h3 id=\"번외---session-id는-토큰인가\" style=\"position:relative;\"><a href=\"#%EB%B2%88%EC%99%B8---session-id%EB%8A%94-%ED%86%A0%ED%81%B0%EC%9D%B8%EA%B0%80\" aria-label=\"번외   session id는 토큰인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>번외 - session id는 토큰인가?</h3>\n<p>우테코 레벨2 인터뷰에서 <code class=\"language-text\">session id는 토큰일까요 아닐까요?</code>라는 포비의 질문에 제대로 대답하지 못했다. 내가 생각하던 <code class=\"language-text\">토큰</code>은 <code class=\"language-text\">HTTP 헤더 Authorization</code>에 들어가는 문자열이었기 때문이다. 하지만 인증 방식과 CS의 토큰의 사례에 대해 알아보면서, <code class=\"language-text\">session id == session token</code>임을 알게 되었다.</p>\n<br/>\n<h2 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h2>\n<ul>\n<li><a href=\"https://medium.com/@llamacorn/computer-science-sessions-7517ec8af766\">CS의 Sessions</a></li>\n<li><a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies\">HTTP쿠키 mdn</a></li>\n<li><a href=\"https://ko.javascript.info/cookie\">쿠키와 document.cookie</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EC%84%B8%EC%85%98%EC%9D%98-%EC%A0%95%EC%B2%B4%EB%A5%BC-%EC%B0%BE%EC%95%84%EC%84%9C\">🔍 세션의 정체를 찾아서</a></p>\n<ul>\n<li><a href=\"#%EC%84%B8%EC%85%98%EC%9D%98-%EC%A0%95%EC%9D%98\">세션의 정의</a></li>\n<li><a href=\"#javax-servelet-httpsession\">javax servelet HttpSession</a></li>\n<li><a href=\"#%ED%86%B0%EC%BA%A3-standardsession--managerbase\">톰캣 StandardSession &#x26; ManagerBase</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EA%B7%B8%EB%A0%87%EB%8B%B4-%EC%BF%A0%ED%82%A4%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80\">🍪 그렇담 쿠키는 무엇인가</a></p>\n<ul>\n<li><a href=\"#%EC%BF%A0%ED%82%A4-%EC%A0%95%EC%9D%98\">쿠키 정의</a></li>\n<li><a href=\"#%EC%BF%A0%ED%82%A4-%EC%A2%85%EB%A5%98\">쿠키 종류</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#httpsession%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%83%81%ED%83%9C-%EC%9C%A0%EC%A7%80-with-\">HttpSession을 이용한 상태 유지 (with 🍪)</a></p>\n<ul>\n<li><a href=\"#%EC%84%B8%EC%85%98%EC%97%90-%EC%83%81%ED%83%9C%EA%B0%92-%EC%9C%A0%EC%A7%80%ED%95%98%EA%B8%B0\">세션에 상태값 유지하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%84%B8%EC%85%98%EC%9D%98-%ED%95%9C%EA%B3%84%EC%99%80-%EA%B7%B9%EB%B3%B5%EB%B2%95\">세션의 한계와 극복법</a></p>\n<ul>\n<li><a href=\"#sticky-session\">Sticky session</a></li>\n<li><a href=\"#session-clustering\">Session clustering</a></li>\n<li><a href=\"#session-storage-db\">Session storage DB</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%ED%86%A0%ED%81%B0\">🪙 토큰</a></p>\n<ul>\n<li><a href=\"#%ED%86%A0%ED%81%B0%EC%9D%B4%EB%9E%80\">토큰이란?</a></li>\n<li><a href=\"#%EB%B2%88%EC%99%B8---session-id%EB%8A%94-%ED%86%A0%ED%81%B0%EC%9D%B8%EA%B0%80\">번외 - session id는 토큰인가?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">참고자료</a></p>\n</li>\n</ul>\n</div>","excerpt":"🔍 세션의 정체를 찾아서 세션의 정의 영어에서 이란 특정 활동이 수행된 기간을 의미한다. 일상 속에서 보자면 나는 꾸준히 PT를 받고 있는데, PT 수업 한 회를 세션이라고 불렀다. 그럼 CS의 세션은 무엇일까? ****을 의미한다. 통신을 하는 동안 세션이 유지된다면 세션의 정보를 이용할 수 있을 것이다. 이런 상태를 이라 부른다. 반대는 라고 부르는데, HTTP 프로토콜이 이에 속한다. (막간 홍보 : HTTP에 관심이 있다면 HTTP 테코톡) HTTP 프로토콜이 이기에, 여러 불편한 상황이 일어난다. 쇼핑몰에서 상품을 장바구니에 담을 때 마다 로그인을 새로 요구한다고 생각해보자. 짜증나서 사려던 것도 안 사고 나가지 않을까? 이런 무상태를 보충하기 위해 상태 유지를 돕는 기술을 함께 사용한다. 그 중 하나가 이다. javax servelet HttpSession 자바 서블릿의 은 인터페이스다. 이 포스팅에서 다룰 내용을 java docs에서 간추려보았다. 유저 정보를 저장함으…","frontmatter":{"date":"July 09, 2022","title":"세션의 정체를 찾아서(with 🍪, 🪙)","categories":"Spring CS","author":"써머","emoji":"headers/session-cookie-jwt.png"},"fields":{"slug":"/session-cookie-jwt/"}},"next":{"id":"1edd5815-991a-5bfd-bddf-48c3cf82d2d2","html":"<p>DB를 연동하고 스프링을 쓰기 시작하면서 어플리케이션의 구조가 복잡해졌다. 그에 따라 테스트도 다양한 어노테이션을 활용하여 작성해야 했는데, 처음에는 예제를 보며 따라했다. 그러다 각 어노테이션의 정확한 역할과 적용되는 방식이 궁금해 미션을 진행하며 사용한 세 테스트용 어노테이션을 학습했다.</p>\n<h2 id=\"jdbctest\" style=\"position:relative;\"><a href=\"#jdbctest\" aria-label=\"jdbctest permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@JdbcTest</h2>\n<blockquote>\n<p>JDBC 기반 컴포넌트만 테스트하는 JDBC 테스트를 위한 어노테이션이다. 이 어노테이션을 사용하면 auto-configuration이 비활성화 되고, JDBC 테스트와 관련된 configuration만 적용된다. 기본적으로 <code class=\"language-text\">@JdbcTest</code>가 붙은 테스트는 트랜젝션 처리가 되고, 각 테스트가 죵로된 후 롤백을 시행한다. 또한 명시됐거나 자동 설정된 DataSource 대신 인메모리 DB를 사용하게 된다.<code class=\"language-text\">@AutoConfigureTestDatabase</code>를 사용하면 이런 설정을 덮어쓸 수 있다.  <!--more-->\n전체 어플리케이션 설정을 사용하면서 인메모리 DB를 사용하고 싶다면, 이 어노테이션 대신 <code class=\"language-text\">@SpringBootTest</code>와 <code class=\"language-text\">@AutoConfigureTestDatabase</code>를 조합해 사용하는 게 낫다. <code class=\"language-text\">JUnit 4</code>를 사용한다면 <code class=\"language-text\">@RunWith(SpringRunner.class)</code>를 함께 사용해야 한다.</p>\n</blockquote>\n<p>미션에서 <code class=\"language-text\">JdbcTemplate</code>만 주입 받으면 되는 <code class=\"language-text\">Dao</code> 객체들을 테스트하는 데 사용했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@JdbcTest</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JdbcLineDaoTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">LineDao</span> lineDao<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">JdbcLineDaoTest</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JdbcTemplate</span> jdbcTemplate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lineDao <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcLineDao</span><span class=\"token punctuation\">(</span>jdbcTemplate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Repository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JdbcLineDao</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">LineDao</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">NamedParameterJdbcTemplate</span> jdbcTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">JdbcLineDao</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JdbcTemplate</span> jdbcTemplate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jdbcTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NamedParameterJdbcTemplate</span><span class=\"token punctuation\">(</span>jdbcTemplate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>자바독에서 볼 수 있듯이 해당 어노테이션을 적용한 테스트는 인메모리 DB로 테스트를 시행하며, 트랜젝션과 자동 롤백을 지원하게 된다. 또한, 스프링 컨테이너에 전체 컴포넌트를 등록하지 않아 테스트 비용을 절감할 수 있다.</p>\n<h2 id=\"webmvctest\" style=\"position:relative;\"><a href=\"#webmvctest\" aria-label=\"webmvctest permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@WebMvcTest</h2>\n<blockquote>\n<p><code class=\"language-text\">스프링 MVC</code> 컴포넌트만 테스트하기 위한 어노테이션이다. 이 어노테이션을 사용하면 auto-configuration이 비활성화 되고, MVC 테스트와 관련된 configuration들만 적용된다. (ex. @Controller, @ControllerAdvice, @JsonComponent, Converter/GenericConverter, Filter, WebMvcConfigurer and HandlerMethodArgumentResolver 빈들, 다만 <strong>@Component, @Service, @Repository 빈들 제외</strong>)<br>\n기본적으로 <code class=\"language-text\">@WebMvcTest</code>가 사용된 테스트는 스프링 시큐리티와 MockMvc를 자동 설정한다. (HtmlUnit WebClient와 Selenium WebDriver 지원 포함) MockMvc에 대한 더욱 세밀한 설정을 위해 <code class=\"language-text\">@AutoConfigureMockMvc</code>를 사용할 수 있다. 일반적으로 <code class=\"language-text\">@WebMvcTest</code>를 사용할 때, <code class=\"language-text\">@Controller</code> 빈에 필요한 객체를 <code class=\"language-text\">@MockBean</code>이나 <code class=\"language-text\">@Import</code>를 통해 생성한다.<br>\n전체 어플리케이션 configuration을 로드하면서 <code class=\"language-text\">MockMvc</code>를 사용하고 싶다면, 이 어노테이션 보다 <code class=\"language-text\">@SpringBootTest</code>와 <code class=\"language-text\">@AutoConfigureMockMvc</code>를 함께 사용하는 게 낫다. <code class=\"language-text\">JUnit 4</code>를 사용한다면 <code class=\"language-text\">@RunWith(SpringRunner.class)</code>를 함께 사용해야 한다.</p>\n</blockquote>\n<p>미션에서 <em>컨트롤러만 단위 테스트</em>할 때 사용했다. 괄호 안에 테스트 할 특정 클래스를 적어주면 해당 클래스만 생성된다. MVC에 관련 된 빈만 생성되고 컨트롤러에 주입되는 빈이 생성되지 않기 떄문에, <code class=\"language-text\">@MockBean</code>으로 필요한 빈을 생성해야 한다. 그렇지 않으면 <code class=\"language-text\">Failed to load ApplicationContext</code> 메시지와 함께 실행에 실패한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@WebMvcTest</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LineController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">LineControllerUnitTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MockMvc</span> mockMvc<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@MockBean</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LineService</span> lineService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"번외\" style=\"position:relative;\"><a href=\"#%EB%B2%88%EC%99%B8\" aria-label=\"번외 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>번외?</h3>\n<p>테스트 할 컨트롤러를 특정하지 않으면 모든 <code class=\"language-text\">@Controller</code> 빈이 등록된다. 처음에는 테스트 대상 클래스를 표기해야만 실행되는 줄 알았다. 그런데 공식 문서로 공부하고 보니 특정하지 않아 실패한 것이 아니라, 모든 컨트롤러에 필요한 모든 서비스(테스트 내에서 사용하지 않더라도)를 생성하지 않아서 실행되지 않은 것이었다. 따라서 그럴 일은 없겠지만, 컨트롤러를 특정하지 않으면 다음과 같이 <code class=\"language-text\">@MockBean</code>으로 몽땅 등록하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@WebMvcTest</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">LineControllerUnitTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MockMvc</span> mockMvc<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@MockBean</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LineService</span> lineService<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@MockBean</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PathService</span> pathService<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@MockBean</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">StationService</span> stationService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token comment\">// 외의 모든 컨트롤러에서 사용되는 모든 주입받을 객체  </span>\n<span class=\"token punctuation\">}</span>  </code></pre></div>\n<h2 id=\"springboottest\" style=\"position:relative;\"><a href=\"#springboottest\" aria-label=\"springboottest permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@SpringBootTest</h2>\n<blockquote>\n<p>스프링부트 기반 테스트를 위한 어노테이션이다. <code class=\"language-text\">Spring TestContext Framework</code>에 더해 다음과 같은 기능을 제공한다.</p>\n<ul>\n<li><code class=\"language-text\">@ContextConfiguration(loader=...)</code>가 정의되어 있지 않다면, 기본 <code class=\"language-text\">ContextLoader</code>로 <code class=\"language-text\">SpringBootContextLoader</code>를 사용</li>\n<li>내부에 <code class=\"language-text\">@Configuration</code>이 없고 <code class=\"language-text\">classes</code>가 정의되어 있지 않다면, 자동으로 <code class=\"language-text\">@SpringBootConfiguration</code>을 탐색</li>\n<li><code class=\"language-text\">properties attribute</code>를 이용한 <code class=\"language-text\">Environment</code> 설정</li>\n<li><code class=\"language-text\">args attribute</code>를 통한 어플리케이션 arguments를 정의</li>\n<li>웹 서버를 <code class=\"language-text\">defined</code> 또는 <code class=\"language-text\">random</code> 포트에서 구동 시킬지를 포함해, 여러 <code class=\"language-text\">webEnviroment</code> 모드를 설정</li>\n<li>웹 서버를 구동하는 웹 테스트에서 <code class=\"language-text\">TestRestTemplate, WebTestClient</code> 빈을 등록</li>\n</ul>\n</blockquote>\n<p>모든 객체를 실제 빈으로 등록하고 사용하는 컨트롤러 통합 테스트와 인수 테스트에서 해당 어노테이션을 사용했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 컨트롤러 통합 테스트  </span>\n<span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token annotation punctuation\">@AutoConfigureMockMvc</span>\n<span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token annotation punctuation\">@Sql</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/testSchema.sql\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LineControllerIntegrationTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MockMvc</span> mockMvc<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 인수 테스트</span>\n<span class=\"token annotation punctuation\">@SpringBootTest</span><span class=\"token punctuation\">(</span>webEnvironment <span class=\"token operator\">=</span> <span class=\"token class-name\">SpringBootTest<span class=\"token punctuation\">.</span>WebEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RANDOM_PORT</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@DirtiesContext</span><span class=\"token punctuation\">(</span>classMode <span class=\"token operator\">=</span> <span class=\"token class-name\">DirtiesContext<span class=\"token punctuation\">.</span>ClassMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">BEFORE_EACH_TEST_METHOD</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Sql</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/testSchema.sql\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AcceptanceTest</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@LocalServerPort</span>\n    <span class=\"token keyword\">int</span> port<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@BeforeEach</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">RestAssured</span><span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> port<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>모든 빈을 생성하기 때문에 비용과 실행 시간이 제일 많이 든다. 특히 <code class=\"language-text\">@DirtiesContext</code>로 매 테스트 마다 새로운 컨테이너를 생성하면 정말 끝내주는 실행 속도를 보여준다.</p>\n<br/>\n<p>어플리케이션 규모가 커지고 테스트 수가 늘어나면서 각 경우에 적절한 테스트를 설정하는 것이 중요해졌다. 사실 성격이 느긋해서 테스트에 시간이 많이 걸려도 신경쓰지 않는 편이었는데… 인수테스트를 필요에 따라 <code class=\"language-text\">@DirtiesContext</code>와 함께 쓰면서 테스트에 소모되는 비용과 시간 절약을 자연스레 고려하게 되었다. 이 외에도 다양한 테스트용 어노테이션과 추가 설정 가능한 사항들이 있는데, 아는 것만 쓰지 말고 더 넓게 학습해 더 나은 효율의 테스트를 작성하고 싶다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#jdbctest\">@JdbcTest</a></p>\n</li>\n<li>\n<p><a href=\"#webmvctest\">@WebMvcTest</a></p>\n<ul>\n<li><a href=\"#%EB%B2%88%EC%99%B8\">번외?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#springboottest\">@SpringBootTest</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"May 29, 2022","title":"[Spring] @JdbcTest, @WebMvcTest, @SpringBootTest","categories":"Spring","author":"써머","emoji":"headers/test-annotations.png"},"fields":{"slug":"/test-annotations/"}},"prev":{"id":"75ab6283-c820-5191-ac78-8ff6b58e19f0","html":"<h2 id=\"슬랙이-봇을-강퇴시켰어요\" style=\"position:relative;\"><a href=\"#%EC%8A%AC%EB%9E%99%EC%9D%B4-%EB%B4%87%EC%9D%84-%EA%B0%95%ED%87%B4%EC%8B%9C%EC%BC%B0%EC%96%B4%EC%9A%94\" aria-label=\"슬랙이 봇을 강퇴시켰어요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>슬랙이 봇을 강퇴시켰어요</h2>\n<p>서버에서 슬랙 API를 호출하려면 발급받은 봇 토큰이 필요하다. 해당 정보를 기밀이라고 생각하지 않았는데…</p>\n<ol>\n<li>애초에 봇에게 호출할 수 있는 API 제한이 있다</li>\n<li>연결된 워크스페이스가 개발을 위해 생성된 줍줍 팀 워크스페이스다</li>\n</ol>\n<p>라는 이유에서였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABS0lEQVQoz51SSW7DMAzU/x+XQ24BYtlGnaB1vW+yNk8xDOSih/ZQAgNSGzkcSsUY4b0XhBBwHMe/QKNXy7Lger3icrmg73v811JiRVZt2wqmaULbtGia5txjzEJp3XUtun5AO+/oxwlN8wmSSqbWdUVZlMjzHNVbhbIssW2bSOCcEzDe9x3G7OJ3a7G7AGsdjDE/JFN8nGUaWue43W7QmRYmwzAIyJoM+eAv4yykZQbrMmM3BjF4OSAray3meZaEjJPwv+l3tuy8R90OgnmzCPF7Yokd2yRDJk7F6LmfmKUfolyIqEeDj9Hgvd9gnD9beD6foun9fofW+qVzVaEoClk/Ho+TXepExXhgs15gfSA3ucSEnB4v0lPPcRhffhzRdZ1IwiQ0dsA3yvmIZ7cKmsmcFdkCGZJdlmWo6xpDP4gEBBNzeOnLsAgl+AIiGgcqoFozNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bot scopes\"\n        title=\"bot scopes\"\n        src=\"/static/5f6a98a9050130e45c6238b44da2370d/37523/scopes.png\"\n        srcset=\"/static/5f6a98a9050130e45c6238b44da2370d/e9ff0/scopes.png 180w,\n/static/5f6a98a9050130e45c6238b44da2370d/f21e7/scopes.png 360w,\n/static/5f6a98a9050130e45c6238b44da2370d/37523/scopes.png 720w,\n/static/5f6a98a9050130e45c6238b44da2370d/302a4/scopes.png 1080w,\n/static/5f6a98a9050130e45c6238b44da2370d/c45c7/scopes.png 1346w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div style=\"text-align:center; font-style:italic; color:grey;\">\n  슬랙에서 scopes 라는 명칭으로 봇에게 api별 호출 권한을 설정 가능하다\n</div>\n<p>그래서 깃헙에 <code class=\"language-text\">bot-token</code>을 포함한 <code class=\"language-text\">yml</code>을 올려놨는데… <strong>어느날 API 응답이 오지 않았다.</strong> 개발자 도구의 응답에는 <code class=\"language-text\">Expired Token</code>이라는 에러 문구가 떴고, 분명 워크스페이스에 정상 추가했던 봇이 사라져 있었다. <!--more--> <strong>슬랙이 봇을 강제 추방</strong>시킨 것이었다…</p>\n<p>얼마간 잘 썼기에, 일정 주기로 공개 저장소들을 크롤링 해 한번에 정지시키는 게 아닐까 싶다.</p>\n<br/>\n<h3 id=\"설명서를-잘-읽자\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EB%AA%85%EC%84%9C%EB%A5%BC-%EC%9E%98-%EC%9D%BD%EC%9E%90\" aria-label=\"설명서를 잘 읽자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설명서를 잘 읽자</h3>\n<p>슬랙 API에 들어가면 <code class=\"language-text\">토큰을 공개적인 버전 컨트롤에 올리지 말라</code>가 떡하니 명시되어 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAh0lEQVQY02WOSQ7EIAwE+f9PWbwwMBcipUduJlxyKDVumZJTqw2tvRERUktlRldrUJFz5qyqnLn3z/R8NLOTsRhYpAhUo99zKYVCYa9HFv0YYwvdHSp6LqPc/NDEoN5h3vmJfAbmnKT33d/3jRT2R8Q3T1dkHSg+kW2i2M7Wv7iu68VaixnCH0Z2MArh8iu+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack warning\"\n        title=\"slack warning\"\n        src=\"/static/16366b208f74e43a27f1ecc9b709e4bf/37523/slack_warning.png\"\n        srcset=\"/static/16366b208f74e43a27f1ecc9b709e4bf/e9ff0/slack_warning.png 180w,\n/static/16366b208f74e43a27f1ecc9b709e4bf/f21e7/slack_warning.png 360w,\n/static/16366b208f74e43a27f1ecc9b709e4bf/37523/slack_warning.png 720w,\n/static/16366b208f74e43a27f1ecc9b709e4bf/302a4/slack_warning.png 1080w,\n/static/16366b208f74e43a27f1ecc9b709e4bf/07a9c/slack_warning.png 1440w,\n/static/16366b208f74e43a27f1ecc9b709e4bf/891d5/slack_warning.png 1520w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>봇 토큰에는 큰 권한이 있습니다. 토큰은 사용자가 앱을 설치함으로써 권한을 부여했음을 나타냅니다. 앱을 설치한 유저가 준 신뢰를 해치지 않도록 토큰을 안전하게, 기밀로 보관하세요.<br>\n<strong>최소한 공개적인 형상관리에 토큰을 올리지 마세요.</strong> 환경 변수를 통해 사용하시길 바랍니다. 더 많은 정보는 저희가 제공하는 <a href=\"https://api.slack.com/authentication/best-practices\">앱 보안을 위한 지침</a>을 참고하세요.</p>\n</blockquote>\n<p>하지만 직접 정지시킬 줄은 몰랐다. 깃헙에 올라간 상태로 꽤 오래 쓰고 있었기 때문에 더 그랬다.<br>\n변명을 하자면 테스트용 팀 워크스페이스를 사용하고 있었고, 실서비스라면 절대 그러지 않았을 것이다. 그럼에도 보안에 너무 소홀했던 것 같다. 슬랙의 안내를 읽고 나니 앱을 설치함으로써 우리를 신뢰할 미래의 사용자에게 큰 잘못이 맞았다.</p>\n<br/>\n<h2 id=\"서브모듈-도입기\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B8%8C%EB%AA%A8%EB%93%88-%EB%8F%84%EC%9E%85%EA%B8%B0\" aria-label=\"서브모듈 도입기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서브모듈 도입기</h2>\n<h3 id=\"yaml-밀거래\" style=\"position:relative;\"><a href=\"#yaml-%EB%B0%80%EA%B1%B0%EB%9E%98\" aria-label=\"yaml 밀거래 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>yaml 밀거래</h3>\n<p>봇 정지를 당하고 <code class=\"language-text\">application.yml</code> 설정파일을 깃헙에서 내렸다. 그리고 <code class=\"language-text\">yml</code>파일을 팀 워크스페이스에서 밀거래(?)했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6ElEQVQ4y51Uy4oaURDtb3IlqEs3btQv8AP8Dr9FdKWg7oSJ6CKYjSgTidghicTWfk6/32eogtvJDM5MTMHpV/WtOlWn7pWeLAvyUYYsy9jv9zgcDvycpinI8jz/EGRZliGOY0hXTcXP0wmu68IwDFiWxbBtG1EU4W+jxbTwLRAJybJt/Lqc4TgOgiCA53mciZ7pTu/X65Xh+36x8BaYYUKLXA+6rjMz13HZkSQJgxIpioKLcuEqyCdAfsGO2FNFEjnINOWA3z+2uNeoAlEVM6QL9dUwTex2W3Q6HTQaDbRaLTSbzZtot9uo1+vo9Xpcqug395BoI0/h2hrOygXz+RyTyQSz2QzT6fQmyDcej7FerzlIGIZcMrVNiuIYWRojCUz4QXB3yUIQsuPxCImiq6oGw3hCEEQwTZMVphLIR3chkPgmQO0SqhcBhSimfoaunu5mSIkKYTXtT0BV+Y5vj1/w8PAJy+XyXaxWKywWC2w2G55NGqcXolBDHdfDbvfI6pXLZVSrVVQqlZuo1WoolUrodrtc+ouxEZGjKORsNMg0Bv8CwUz0mQebMpDchmHB90P+6aM9K3bG68Oj2ClZnsMyFFjG+b8EEWoXO0WI8nX7Gf1+H4PBAMPh8E2QfzQa8ekk2kTsKOAzwcGUYSFH7QEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"yml trafficking\"\n        title=\"yml trafficking\"\n        src=\"/static/7a5d781111bde075323f0f53981f4c18/37523/yml.png\"\n        srcset=\"/static/7a5d781111bde075323f0f53981f4c18/e9ff0/yml.png 180w,\n/static/7a5d781111bde075323f0f53981f4c18/f21e7/yml.png 360w,\n/static/7a5d781111bde075323f0f53981f4c18/37523/yml.png 720w,\n/static/7a5d781111bde075323f0f53981f4c18/302a4/yml.png 1080w,\n/static/7a5d781111bde075323f0f53981f4c18/a6ec4/yml.png 1438w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div style=\"text-align:center; font-style:italic; color:grey;\">\n  yaml 밀거래의 현장. 설정이 바뀔 때 마다 밀거래가 발생했다.\n</div>\n<p>언제까지고 이렇게 할 수는 없을 뿐 더러, <code class=\"language-text\">배포 자동화</code>를 앞두고 있었기에 이를 해결해야만 했다.</p>\n<br/>\n<h3 id=\"서브모듈-등록\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B8%8C%EB%AA%A8%EB%93%88-%EB%93%B1%EB%A1%9D\" aria-label=\"서브모듈 등록 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서브모듈 등록</h3>\n<ol>\n<li>개발 중이라 설정이 완전히 고정되지 않았다</li>\n<li>팀원 누구나 접근해서 수정할 수 있어야 한다</li>\n<li>배포 자동화 시 최대한 관리가 편해야 한다</li>\n</ol>\n<p>이 세 가지를 고려해 <code class=\"language-text\">서브모듈</code> 사용을 제안했고 받아들여졌다. 연로그가 백엔드 팀원들을 모두 초대한 <code class=\"language-text\">organization</code>을 만들고 <code class=\"language-text\">private</code> 레포지토리를 개설했다. 여기에 <code class=\"language-text\">application.yml</code>을 올리고, 기존 프로젝트에 서브모듈을 추가했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> submodule <span class=\"token function\">add</span> <span class=\"token operator\">&lt;</span>private repository 주소<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>추가할 모듈명<span class=\"token operator\">></span></code></pre></div>\n<p>추가하면 폴더와 파일이 생기는데, 깃에는 내용을 제외한 폴더만 감지된다. 그리고 최상단에 경로에 서브모듈 경로 정보를 담은 <code class=\"language-text\">.gitmodules</code> 파일이 생성된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[submodule \"backend/src/main/resources/security\"]\n\tpath = backend/src/main/resources/security\n\turl = https://github.com/2022-pickpick/security.git</code></pre></div>\n<p>우리 팀은 <code class=\"language-text\">security</code>란 이름으로 서브모듈을 추가했다. 이 상태로 <code class=\"language-text\">push</code>하면 서브모둘이 <code class=\"language-text\">github</code>에 추가된 것을 볼 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAnElEQVQY042QSQ7CMBAE8/8vggQHNrPYiZeMJ85QCMgFwYGW6lLqS3dXtRFTJteZczKu2QjFiGKkagyxEILHzPgn3ck5VusNx7Nn5wLbveN0CRzc7eWO7sLeefokiE5IXdDfdHEY6L1HVVGt5FIQqYyjUEZhlIpoQ6eZNtvCzNSe7psuTzBU8OU99VdEhBjT+5qc6bOibene7x+TH2UuN3UUro0JAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"submodule in github\"\n        title=\"submodule in github\"\n        src=\"/static/7473e109db6825064794d4033bfc703a/37523/submodule.png\"\n        srcset=\"/static/7473e109db6825064794d4033bfc703a/e9ff0/submodule.png 180w,\n/static/7473e109db6825064794d4033bfc703a/f21e7/submodule.png 360w,\n/static/7473e109db6825064794d4033bfc703a/37523/submodule.png 720w,\n/static/7473e109db6825064794d4033bfc703a/302a4/submodule.png 1080w,\n/static/7473e109db6825064794d4033bfc703a/07a9c/submodule.png 1440w,\n/static/7473e109db6825064794d4033bfc703a/cb1ac/submodule.png 1936w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>접근 권한이 있는 상태로 모듈을 클릭하면 해당 private 레포로 이동한다. 하지만 권한이 없는 상태로 모듈을 클릭할 시, <code class=\"language-text\">404 에러 페이지</code>가 뜬다.</p>\n<br/>\n<h3 id=\"-젠킨스-배포\" style=\"position:relative;\"><a href=\"#-%EC%A0%A0%ED%82%A8%EC%8A%A4-%EB%B0%B0%ED%8F%AC\" aria-label=\" 젠킨스 배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>+ 젠킨스 배포</h3>\n<p>이 후 젠킨스를 통한 빌드 및 배포 자동화가 이뤄졌다. 젠킨스에서는 깃헙 계정에서 발급한 토큰을 <code class=\"language-text\">credentianl</code>에 등록해 서브모듈의 접근 권한을 줄 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAo0lEQVQY06WQWwqEMAxF3f9C/HFP4ljfjw7W1ha1PYMdcPyfwIHc3BAuSaqqIs9ziqLgPE/+rUQphZQysm0bx3Gw73vsnXO39t4TQoj6mjtnb+9Jsq4r19FpmqibDmMMRmtKUdH1A9Za+r5HCEHbtlz7wzhSNy1q1Wj94/JiwnmeWJRBWY8PAQgs5mRz3xe8ypI0TcmyjLeU+ACz2tH2iKmffACRzzSJjU2KRwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jenkins credential\"\n        title=\"jenkins credential\"\n        src=\"/static/f2c65f119b81122d0e7ba1b1f35291d4/37523/credential.png\"\n        srcset=\"/static/f2c65f119b81122d0e7ba1b1f35291d4/e9ff0/credential.png 180w,\n/static/f2c65f119b81122d0e7ba1b1f35291d4/f21e7/credential.png 360w,\n/static/f2c65f119b81122d0e7ba1b1f35291d4/37523/credential.png 720w,\n/static/f2c65f119b81122d0e7ba1b1f35291d4/302a4/credential.png 1080w,\n/static/f2c65f119b81122d0e7ba1b1f35291d4/07a9c/credential.png 1440w,\n/static/f2c65f119b81122d0e7ba1b1f35291d4/5e703/credential.png 1942w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>젠킨스 credential 깃헙 권한 등록 때 도움을 받은 포스트 - <a href=\"https://velog.io/@zzarbttoo/JenkinsGit-%EC%97%B0%EB%8F%99%ED%95%98%EA%B8%B0Git-Token-%EB%B0%9C%EA%B8%89-Jenkins-Credential-%EB%93%B1%EB%A1%9D\">[Jenkins]Git 연동하기(Git Token 발급 + Jenkins Credential 등록)</a></p>\n<p>권한을 주지 않고 테스트 또는 빌드를 진행할 시, 설정값을 불러오지 못해 시행되지 않는다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABBElEQVQY06WQzW6EMAyEef8X21v3tMduF9gQkpBQwn9J+KqkanvprZasscbjseXCWktVVXRdx3me/CfSfLFtG9M0kTARKUMI7PvOcRzEGH8wcSlTnTTfvTSbMEXx1ybvB263G0IIxtFzv99ZlgXnHEopYgwsy0w4PhjHMeuGYfg1DMeRrzTGYG2HNukNNbJpcK6nlS3OOqRUyEZmY9FapO7RWlOWJcZ8vawY5g1jHdfrS26uy4r2mqp/IN5r9NyiZomaJHVfZr6dJMIL5Ciz5q17RQ7Nl2EIkWmauVwueO/z2f1ueW4lcnvSRU13KkxokXtNs9W5tqfCRkW7C57rA73KbPgJs2PMvp5FSlAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build success\"\n        title=\"build success\"\n        src=\"/static/e6a2644d6ef47d5c9dee94fc949086da/37523/success.png\"\n        srcset=\"/static/e6a2644d6ef47d5c9dee94fc949086da/e9ff0/success.png 180w,\n/static/e6a2644d6ef47d5c9dee94fc949086da/f21e7/success.png 360w,\n/static/e6a2644d6ef47d5c9dee94fc949086da/37523/success.png 720w,\n/static/e6a2644d6ef47d5c9dee94fc949086da/302a4/success.png 1080w,\n/static/e6a2644d6ef47d5c9dee94fc949086da/07a9c/success.png 1440w,\n/static/e6a2644d6ef47d5c9dee94fc949086da/cb1ac/success.png 1936w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">credential</code> 등록 후 서브모듈이 포함된 프로젝트가 성공적으로 빌드되는 것을 볼 수 있다.</p>\n<br/>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%8A%AC%EB%9E%99%EC%9D%B4-%EB%B4%87%EC%9D%84-%EA%B0%95%ED%87%B4%EC%8B%9C%EC%BC%B0%EC%96%B4%EC%9A%94\">슬랙이 봇을 강퇴시켰어요</a></p>\n<ul>\n<li><a href=\"#%EC%84%A4%EB%AA%85%EC%84%9C%EB%A5%BC-%EC%9E%98-%EC%9D%BD%EC%9E%90\">설명서를 잘 읽자</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%84%9C%EB%B8%8C%EB%AA%A8%EB%93%88-%EB%8F%84%EC%9E%85%EA%B8%B0\">서브모듈 도입기</a></p>\n<ul>\n<li><a href=\"#yaml-%EB%B0%80%EA%B1%B0%EB%9E%98\">yaml 밀거래</a></li>\n<li><a href=\"#%EC%84%9C%EB%B8%8C%EB%AA%A8%EB%93%88-%EB%93%B1%EB%A1%9D\">서브모듈 등록</a></li>\n<li><a href=\"#-%EC%A0%A0%ED%82%A8%EC%8A%A4-%EB%B0%B0%ED%8F%AC\">+ 젠킨스 배포</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"July 25, 2022","title":"[git] 슬랙한테 봇 강퇴당하고 서브모듈 도입한 이야기","categories":"ETC 트러블슈팅","author":"써머","emoji":"headers/git-submodule.png"},"fields":{"slug":"/git-submodule/"}},"site":{"siteMetadata":{"siteUrl":"https://hyewoncc.github.io","comments":{"utterances":{"repo":"hyewoncc/hyewoncc.github.io"}}}}},"pageContext":{"slug":"/session-cookie-jwt/","nextSlug":"/test-annotations/","prevSlug":"/git-submodule/"}},"staticQueryHashes":["1073350324","1956554647","2938748437","3350743975"]}