{"componentChunkName":"component---src-templates-blog-template-js","path":"/jpa-transactional/","result":{"data":{"cur":{"id":"89c01e28-cb12-5ced-a644-49526626224b","html":"<h2 id=\"-문제상황\" style=\"position:relative;\"><a href=\"#-%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9\" aria-label=\" 문제상황 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧶 문제상황</h2>\n<p><a href=\"https://hyewoncc.github.io/load-test/\">서버 오픈 전 부하테스트로 대비하기</a>의 경험으로, 요즘 코드를 짤 때 외부 호출이 끼어있다면 트랜잭션을 최소로 잡고 있다.\n거기다 더티 체킹도 사용하지 않고 명시적으로 다시 저장해주는 방식을 사용 중이다. 이건 교휸이 있어서는 아니고, 그냥 성향이다. 더 읽기 명확한 것 같고?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA7klEQVR42mWR226DMBBE8///1vahVKnUphVBGBo7mJudgC+nAkpI1JXGHo9Ws/Z4F2NkQgjLHmHjsx5Ya9ViCDNmbeJx69/BQvIq8Cks78eGVHouY2SwA+Ig2b98cEhSTmk1m7ii4PqWoJ6fsMkrQyFuA3fTMlUmFKXUtGagtY7eXjCdIT8WaFVjWovtrjjnqITg5/uLodb4tsH13X9Dqc6UZYlSirbtcM5T65osy1BKLjdzjr7vabRG5DnGmPnJfhweDRcsQvjLczYYPfIkqc4a7wMXc8VauwZ6y/Ihw5VAXKO/Tbuv+/P6eRs2w18Fj9N7fX0PggAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"entity\"\n        title=\"\"\n        src=\"/static/37295abf486de22af73111d2cec6e742/37523/entity.png\"\n        srcset=\"/static/37295abf486de22af73111d2cec6e742/e9ff0/entity.png 180w,\n/static/37295abf486de22af73111d2cec6e742/f21e7/entity.png 360w,\n/static/37295abf486de22af73111d2cec6e742/37523/entity.png 720w,\n/static/37295abf486de22af73111d2cec6e742/302a4/entity.png 1080w,\n/static/37295abf486de22af73111d2cec6e742/07a9c/entity.png 1440w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemService</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">UserItemRepository</span> userItemRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ExternalItemClient</span> itemClient<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Item</span> item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        itemClient<span class=\"token punctuation\">.</span><span class=\"token function\">checkAvailable</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserNotExistException</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        userItemRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getItems</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>여기에 아이템을 삭제하는 기능을 추가 개발하게 되었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> itemId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        itemClient<span class=\"token punctuation\">.</span><span class=\"token function\">checkExpired</span><span class=\"token punctuation\">(</span>itemId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        userItemRepository<span class=\"token punctuation\">.</span><span class=\"token function\">deleteByUserIdAndItemId</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> itemId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>그리고 테스트를 실행하니, 아래와 같은 에러 메시지를 던지며 터졌다.</p>\n<blockquote>\n<p>No EntityManager with actual transaction available for current thread - cannot reliably process ‘remove’ call; nested exception is javax.persistence.TransactionRequiredException: No EntityManager with actual transaction available for current thread - cannot reliably process ‘remove’ call\norg.springframework.dao.InvalidDataAccessApiUsageException: No EntityManager with actual transaction available for current thread - cannot reliably process ‘remove’ call; nested exception is javax.persistence.TransactionRequiredException: No EntityManager with actual transaction available for current thread - cannot reliably process ‘remove’ call</p>\n</blockquote>\n<br>\n<h2 id=\"-transactional-없어도-잘되던데\" style=\"position:relative;\"><a href=\"#-transactional-%EC%97%86%EC%96%B4%EB%8F%84-%EC%9E%98%EB%90%98%EB%8D%98%EB%8D%B0\" aria-label=\" transactional 없어도 잘되던데 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>❓ Transactional 없어도 잘되던데</h2>\n<p>이 에러를 보자마자 스치는 기억이 있었으니…\n팀원에게 코드리뷰를 받다가 <code class=\"language-text\">트랜잭션이 없는데 제대로 동작해? 확인한 거지?</code>라는 얘기를 들었었다.\n그 때 잘 되는데? 트랜잭션이랑 이거랑 관련 없지 않아? 하고 넘어갔는데, 원인은 모르지만 이 얘기였구나! 했다.</p>\n<p>에러 메시지를 검색하면 서비스 메서드에 <code class=\"language-text\">@Transactional</code>을 붙이면 해결된다는 얘기가 많이 나온다.\n붙여보니 잘 된다.\n나도 외부 호출 문제를 겪기 전에는 으레 이렇게 짜곤 했으니, 이런 문제를 겪을 일이 없었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> itemId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        itemClient<span class=\"token punctuation\">.</span><span class=\"token function\">checkExpired</span><span class=\"token punctuation\">(</span>itemId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        userItemRepository<span class=\"token punctuation\">.</span><span class=\"token function\">deleteByUserIdAndItemId</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> itemId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>그런데 여기서 이상하다 느낀 게, 서비스에 <code class=\"language-text\">@Transactional</code> 없다고 동작 안하는 게 맞나?\n한 트랜잭션에서 처리하고 싶지 않을 수도 있는데? 하는 거였다.\n그리고 이제까지는 왜 문제가 없었지? 하는 점도 이상했다.</p>\n<p>이유는 금방 찾을 수 있었는데, <code class=\"language-text\">JpaRepository</code>의 구현체인 <code class=\"language-text\">SimpleJpaRepository</code>에서 이미 메서드에 <code class=\"language-text\">@Transactional</code>을 붙여 놓아서다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Repository</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>readOnly <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SimpleJpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> ID<span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">JpaRepositoryImplementation</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> ID<span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ID</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">notNull</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token constant\">ID_MUST_NOT_BE_NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EmptyResultDataAccessException</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No %s entity with id %s exists!\"</span><span class=\"token punctuation\">,</span> entityInformation<span class=\"token punctuation\">.</span><span class=\"token function\">getJavaType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>그래서 <code class=\"language-text\">JpaRepository</code>에 미리 선언된 메서드를 호출할 경우에, 서비스 클래스에서 <code class=\"language-text\">@Transactional</code>을 붙이지 않아도 문제가 없었던 것이다.\n따라서 레포지토리 클래스에 추가로 정의한 메서드에 <code class=\"language-text\">@Transactional</code>을 붙여줘도 문제를 해결할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Repository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserItemRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserItem</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">deleteByUserIdAndItemId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> itemId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>그러다 직접 사용할 메서드를 선언해야 하는 <code class=\"language-text\">Repository</code> 인터페이스를 상속하면 어떻게 될까 궁금해졌다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserItemRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Repository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserItem</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// @Transactional이 없는데 동작할까?  </span>\n    <span class=\"token class-name\">UserItem</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserItem</span> userItem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">void</span> <span class=\"token function\">deleteByUserIdAndItemId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> itemId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 5.555555555555555%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAQklEQVR42kXGSwqAMAwFQI8iImJJQj62Dd7/YK+0LlwMzKaREG8oErjZQFohkWDrIGtg7//tu3gu8/q868dF2M+CAdeBHw+Sry07AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"구현체\"\n        title=\"\"\n        src=\"/static/36a1bd768d0328bb18fadf1b4bc01436/37523/simplejparepository.png\"\n        srcset=\"/static/36a1bd768d0328bb18fadf1b4bc01436/e9ff0/simplejparepository.png 180w,\n/static/36a1bd768d0328bb18fadf1b4bc01436/f21e7/simplejparepository.png 360w,\n/static/36a1bd768d0328bb18fadf1b4bc01436/37523/simplejparepository.png 720w,\n/static/36a1bd768d0328bb18fadf1b4bc01436/302a4/simplejparepository.png 1080w,\n/static/36a1bd768d0328bb18fadf1b4bc01436/07a9c/simplejparepository.png 1440w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이 역시 구현체는 <code class=\"language-text\">SimpleJpaRepository</code>로 동일해, 미리 구현되어 있는 메서드는 <code class=\"language-text\">@Transactional</code> 없이도 동작한다.</p>\n<br>\n<h2 id=\"-관성을-이기기\" style=\"position:relative;\"><a href=\"#-%EA%B4%80%EC%84%B1%EC%9D%84-%EC%9D%B4%EA%B8%B0%EA%B8%B0\" aria-label=\" 관성을 이기기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🛺 관성을 이기기</h2>\n<p>JPA 쓴 지가 언젠데 이제까지 이걸 몰랐을까? 자문했을 때, 일하면서 기출변형같은 문제를 마주쳐서 그런 것 같다.\n<a href=\"https://hyewoncc.github.io/fetch-join-and-entity-graph/\">실종된 데이터와 연관 객체 조회하기</a> 포스팅도 그랬다.\n보통 JPA를 쓰면 서비스 클래스에 <code class=\"language-text\">@Transactional</code>부터 붙이고 시작하니까 이런 식의 오류를 마주칠 일이 적다.\n이런 문제를 해결할 때 왜 나는 좀 더 꼼꼼히 공부하지 않았을까? 자책했는데, 요즘은 해결하면서 배워가면 충분한 거 아닌가? 로 생각이 조금 바뀌었다.</p>\n<p>처음 JPA를 접하면서 지금 수준까지 일단 파보려고 했다면 개발을 재밌게 공부할 수 있었을까? 재미야 둘째쳐도, 효율적으로 공부할 수 있었을까?\n요즘 익숙한 스프링보다 낯선 Node.js의 오류와 싸우는 시간이 길어서 이런 생각이 더 드는 것 같기도 하다.\n자바스크립트랑 Node를 마스터하고 해결해야지 하면 아직 오류 하나도 제대로 못고쳤을지 모른다.\n앞으로 수많은 이걸 왜 몰랐지를 마주칠텐데, 그 때 마다 스트레스 받을 필요가 없다.</p>\n<p>또 다른 생각은 관성을 이기자는 것이다. 매번 다짐하는데 잘 안되는 걸 보면, 내가 관성에 약한 편인 것 같다.\n이 문제를 금방 해결할 수 있었던 건, 팀원이 말했던 <code class=\"language-text\">트랜잭션이 없는데 제대로 동작하냐</code>는 리뷰 덕분이었다.\n그 때도 난 잘 되던데 하고 그냥 넘어갔었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAAD/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAT4txCyJP//EABkQAQADAQEAAAAAAAAAAAAAAAEAAhEDEP/aAAgBAQABBQJW0dvAyc/f/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEQITH/2gAIAQEABj8C4YjY5//EABoQAQEAAwEBAAAAAAAAAAAAAAEAESFRMdH/2gAIAQEAAT8hMOYa8icJggRG+7xws7b/2gAMAwEAAgADAAAAEHc//8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EBwm/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8Qiv/EABwQAQACAwADAAAAAAAAAAAAAAEAESFBUTGBwf/aAAgBAQABPxAP6gvBvxNoM2ZQ9rURIQR1Ego03ke4BUBbmiKM+/k//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"난 이렇게 살아왔는데\"\n        title=\"\"\n        src=\"/static/fdaa77e4845fff6789187e56a5c2ec98/80e3c/livethisway.jpg\"\n        srcset=\"/static/fdaa77e4845fff6789187e56a5c2ec98/4ec73/livethisway.jpg 180w,\n/static/fdaa77e4845fff6789187e56a5c2ec98/158ba/livethisway.jpg 360w,\n/static/fdaa77e4845fff6789187e56a5c2ec98/80e3c/livethisway.jpg 720w,\n/static/fdaa77e4845fff6789187e56a5c2ec98/47311/livethisway.jpg 1080w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div style=\"text-align:center; font-style:italic; color:grey;\">\n  이런 상태가 될 때가 종종 있다 \n</div>\n<br>\n<p>허투루 지나가지 않고 왜 제대로 동작하지 않을 것 같냐고 물어봤다면 더 빨리 배울 수 있었다.\n하던 대로 하지않고 절박한 마음으로 일하고 공부하는 그런 열정을 가질 수 있도록… 의식적으로 노력해야겠다.\n말만 썼는데 벌써 쉽지 않다.</p>\n<p>그리고 위에서 문제가 되었던 <code class=\"language-text\">deleteByUserIdAndItemId()</code>는 결국 요구사항에 맞춰 소프트 딜리트로 바뀌면서 자연스레 해결됐다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> itemId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        itemClient<span class=\"token punctuation\">.</span><span class=\"token function\">checkExpired</span><span class=\"token punctuation\">(</span>itemId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">UserItems</span> userItems <span class=\"token operator\">=</span> <span class=\"token class-name\">UserItems</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>userItemRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllByUserId</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        userItems<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>itemId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        userItemRepository<span class=\"token punctuation\">.</span><span class=\"token function\">saveAll</span><span class=\"token punctuation\">(</span>userItems<span class=\"token punctuation\">.</span><span class=\"token function\">getUserItems</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>원래 소프트 딜리트로 만들었어야 할 로직인데, 옆길로 새서 좋은 걸 배웠다.</p>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#-%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9\">🧶 문제상황</a></li>\n<li><a href=\"#-transactional-%EC%97%86%EC%96%B4%EB%8F%84-%EC%9E%98%EB%90%98%EB%8D%98%EB%8D%B0\">❓ Transactional 없어도 잘되던데</a></li>\n<li><a href=\"#-%EA%B4%80%EC%84%B1%EC%9D%84-%EC%9D%B4%EA%B8%B0%EA%B8%B0\">🛺 관성을 이기기</a></li>\n</ul>\n</div>","excerpt":"🧶 문제상황 서버 오픈 전 부하테스트로 대비하기의 경험으로, 요즘 코드를 짤 때 외부 호출이 끼어있다면 트랜잭션을 최소로 잡고 있다.\n거기다 더티 체킹도 사용하지 않고 명시적으로 다시 저장해주는 방식을 사용 중이다. 이건 교휸이 있어서는 아니고, 그냥 성향이다. 더 읽기 명확한 것 같고?  여기에 아이템을 삭제하는 기능을 추가 개발하게 되었다. 그리고 테스트를 실행하니, 아래와 같은 에러 메시지를 던지며 터졌다. No EntityManager with actual transaction available for current thread - cannot reliably process ‘remove’ call; nested exception is javax.persistence.TransactionRequiredException: No EntityManager with actual transaction available for current thread - cannot reliably…","frontmatter":{"date":"May 07, 2023","title":"[JPA] @Transactional이 없다고 레포지토리가 왜 터져?","categories":"JPA 트러블슈팅","author":"써머","emoji":"headers/jpa-transactional.png"},"fields":{"slug":"/jpa-transactional/"}},"next":{"id":"2a371f8a-21eb-5899-8d7d-9423a398d608","html":"<p>어느날 문득 천재적인 생각이 떠올랐다.\n‘벚꽃철에 석촌호수에서 폴라로이드 사진을 돈 받고 찍으면 부자가 될 수 있지 않을까?’</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWElEQVR42n2SzSuEURTGJ3+DpChmYTGZhaSkFM0QspQNe38ASTI7jCTKlhkf+UgWFENKNiLF28yIjUYW3umVha+YMTO99/4016Xx0ZzN6fQ857nP07kOdEkpdReqi2Sc0y0f28Fe0lZIzbbkmyO/dvTeVzlyhyxRKPyJ8/V2+tocDHUUYMy5wewC0498j2uy+GHkj2AWkNL+fPluDfukntudJqw9L5GlWlZ8TrZGSrCj3ZC+1w4Fv+uPoIp7MwVhD9Z+CwfTbnYnXMz2lmIs1kHEi4gNK0HUTl6HOsZLGIw2rLUqNsdcLAw6mekv53immtfDZoh2IjOP+SMrUBG0SytEKlgMRiscergOVLIyUMZkTyFmqBHkA+Kf2I6ci/yIIIXgbb6GZ38BiUARcqMCzhpIHHlJXY3npMp7Zal1P0nixSRzsYp9OYq89WPHlyEZ+07z+8tkBT8AOMo+mHrCILAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hmm\"\n        title=\"\"\n        src=\"/static/2fea1c5946edf51051ec5a940e84d203/37523/hmm.png\"\n        srcset=\"/static/2fea1c5946edf51051ec5a940e84d203/e9ff0/hmm.png 180w,\n/static/2fea1c5946edf51051ec5a940e84d203/f21e7/hmm.png 360w,\n/static/2fea1c5946edf51051ec5a940e84d203/37523/hmm.png 720w,\n/static/2fea1c5946edf51051ec5a940e84d203/302a4/hmm.png 1080w,\n/static/2fea1c5946edf51051ec5a940e84d203/07a9c/hmm.png 1440w,\n/static/2fea1c5946edf51051ec5a940e84d203/29007/hmm.png 1600w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>우리 회사엔 <code class=\"language-text\">가설과 팩트를 구분하자</code>는 그라운드 룰이 있다.\n예시로 ‘비오는 날에 킥보드 이용이 줄어든다’는 팩트, ‘킥보드에 우산을 달면 이용률이 올라갈 것이다’는 가설이다.\n이 룰에 따라 내 발상을 표현하자면 다음과 같다.</p>\n<ul>\n<li>팩트\n<ul>\n<li>인생네컷과 같은 사진 촬영, 즉석 출력 서비스가 인기가 많다.</li>\n<li>인생네컷에는 지역, 계절별로 특별한 프레임, 예를 들어 벚꽃 프레임 같은 것이 한정판으로 존재한다.</li>\n</ul>\n</li>\n<li>가설\n<ul>\n<li>요즘 사람들은 디지털 사진을 찍는 것이 대부분이다. 그래서 실물 사진을 갖고 싶어 한다.</li>\n<li>사실 인생네컷 같은 실물 사진을 벚꽃과 함께 찍고싶지만, 그러기 힘들어서 벚꽃 프레임 같은 걸로 대리만족 하고있다.</li>\n</ul>\n</li>\n</ul>\n<p>이 아이디어를 회사 사람들에게 얘기했을 때, 소수의 몇명은 돈이 되겠다 동의하고 몇명은 반대했다.\n제일 긍정적인 의견이 한 10만원 벌 것 같다 였고, 제일 비관적인 의견은 만원이나 벌면 다행이라 했다.\n이 쯤 되니 진짜 얼마가 벌리나 너무너무 궁금해졌다.</p>\n<p>그래서 해봤다.\n폴라로이드 사진기조차 없엇지만, 내 예상 만큼 수익이 나면 당연히 카메라 가격은 번다고 생각해서 당근으로 구매했다.\n폴라로이드 필름도 100장 시켰다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABTElEQVR42n2RvU7DMBSFeWtegJWF5wCJoR1ADAxMSPyUFqmAOkALJU0KTWwnvo7tD8VVESBgsK5ln/P5+twtgBhjVxBr0VWJE8FoRVMbtKpwYpPGOYeIkGUZxpjkCSF8+ru69RVYFjnj4ZCX/J2yFoyLNB4CYK2lLEuslQT23tPYFud8R6BDfAfGmIzq+QG57sH4BIZ9uDyA2QBVN0xnM+rWEJISWt+t+DewuyqXSybX5zyNLphP7tFFBq0QYmT0OGKa5WT5knyx4PV1njrfML4B17+OeB9oGksns3dnyP427aCXTLpakRdFys+K8Pb2/jdwE3ClDIX25A0s5nOqyQD0cj00EaqqRFyLbjwr5ZCU4a8drqFWraj6u+jDHfTRHvXxHn58muIIwSedUjrBu/2/U/YhYmuDDE+wVz3szRHhpk98vuXnw5v9z7MP0FNpHCJHmQEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"buying\"\n        title=\"\"\n        src=\"/static/7cd0810d091b665aa9b95e5a83184e32/37523/buying.png\"\n        srcset=\"/static/7cd0810d091b665aa9b95e5a83184e32/e9ff0/buying.png 180w,\n/static/7cd0810d091b665aa9b95e5a83184e32/f21e7/buying.png 360w,\n/static/7cd0810d091b665aa9b95e5a83184e32/37523/buying.png 720w,\n/static/7cd0810d091b665aa9b95e5a83184e32/302a4/buying.png 1080w,\n/static/7cd0810d091b665aa9b95e5a83184e32/07a9c/buying.png 1440w,\n/static/7cd0810d091b665aa9b95e5a83184e32/9f9a4/buying.png 1560w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>그리고 이 ‘폴라로이드 사진 찍기’로 실험할 수 있는 여러 가설이 떠올랐다.\n그 중 하나가 이 부업의 최대 병목은 ‘돈을 송금하는 시간’일 것이라는 가설이다.</p>\n<p>그래서 가격을 적은 피켓 뒤에 카카오페이와 토스 QR도 출력해 붙였다.\n몇 년 전에 마지막으로 썼던 사진 잘 찍을 것만 같은 카메라 가방도 발굴해서 좀 더 전문가스러워 보이기 위해 멨다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAADOklEQVR42lXQ62scVRzG8fnn9A+QYl6JBpWoiFBKUQmk1AtB2zRBbCGmtbltssnO7s7eZzczs3M9Z2b2kuxubm7SYhLN5YVtXgmK8JVMpNgDH36Hw+Hhx6Pc+WSEOx/dYG7qLnErZnuvT7dr0G6VabcqtNtVup0am906vS2DQd9gZ2Ay3A/ZO9invdXj6FBSWHzAvVujKJO3P6CQWaK33abTMZBBjkgWiKMScViiFZXoRGW6cYVuu0Zn06c1GKJ7A35aLuNtnjAcdml7Waa/GENxnTKdrkngZxNSaISykIhFgZYo0JYlulIjiprU5TNm5jLc/Pwu777/MTk9pr9/yHDXYvXR1yhCaPiuigy0VyJfIw7+R2jE8koJU+6yf/ArZ+fnnJ5d8OLlJbvPLuj3XSIng+J7eXw/h/Q1Qi9L5GaI/ByRnycMriV3oREJFVcE/P0Pr53t55eEsWSvV70OlCKP8DPIoITj+7hujdBXkz6ln0VcVXHVrcgReBr9/d8YHr3k8PgPnh+dsLUVshlX6beKKI6totdVnLBFyegwM5ujYgSEQRbhXYcJT0V6KpGfJfLWsGwb3fTRqyrNxgqphSmks0YvKqDYzSzzaZ3xbx7x3tgt3hoZZerhKkLoBM4a0s0kn8Mr7nqiFWTQi3NMfz+OWVmgkn+CtNfZ7VZRrrop1S2qdYcwbuOJiOHhCa1uF89KJWHSSSPsdDKlex0ceyrl3BxuI8VOq0jbXSe/9ABFLz1hwyzz51+vF73Z/wWrnvovbJWguZpMaaeTbWNnjY6fQTTTuGae5kaFbz97B+XHe1/i2SqDnQOOTy85Pfudi/NjhFfGri/iWyuvBOYKYXMFYaaw9RQbNZWmtYEQks3egEYxg3L7w7cx9SUq5Ry1WolcZpbp+xPM3J/A0pdwNpbxjBSBsYxbX8CoLNOo5bFMEz8QSBkipUzErTbK2I03mJ+dxDHTPPzhK76bHGfx6TRFdQ6zuoBVm8coP0UvLFEraxiGhev5+L6P53m4rpvMIAiSN+XTkTeZuDmK2Uiz+PM0pdxjLH0Zo7xIJf8YLTNPUcvRaJg0bQ/bdrEsi2bTwrbthOM4Cdd1+Bead3yK3RqCVQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"qr\"\n        title=\"\"\n        src=\"/static/4a43a74f2507a9d0dd2c778e1ce0d8c4/37523/qr.png\"\n        srcset=\"/static/4a43a74f2507a9d0dd2c778e1ce0d8c4/e9ff0/qr.png 180w,\n/static/4a43a74f2507a9d0dd2c778e1ce0d8c4/f21e7/qr.png 360w,\n/static/4a43a74f2507a9d0dd2c778e1ce0d8c4/37523/qr.png 720w,\n/static/4a43a74f2507a9d0dd2c778e1ce0d8c4/302a4/qr.png 1080w,\n/static/4a43a74f2507a9d0dd2c778e1ce0d8c4/b67f3/qr.png 1338w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAADF0lEQVR42h2Pa09bBQBA74f5A5yTZRrdFibb5DWT2c2qwdeYoQyGwuZmu/JaC0MHgwoK64DiihsWMl590AJ2UN593Jbe23v7CBAc05EZgplfNDEmJvonjpEPJ+fbSY7Q0fEVSiKGokjIiThJVUaSoqRTMpmUTFKRWJn14HMOM+504XaNMj3lpq+vh95uCwszDmQpgM/rIBZ5iGBp/ZJMUmJg4HuCoRDzCwtExAhqUiEuSfz67DeePZYITfQTWA4SWJzj4ZSLtvoaGo2fExN9bKyH8fmGWVn2I5SXnkNVVhl+MEQoHESMRghHQiiqTDC0wtbPP/Eo6iHk6sZ0x0ZhqY5r+iomB/q4UW1AjHjZ3lbxTY0SFecRirRvsPnjOtHwErFVkXQmuRf63/F4lCdPf0Ge7EL09qD59Ar7TxVgaGrgu44mrF/oGRmzsbOTYTbgQZZWEM4UHCWdUVlZCqCq8b1VWY6TSqmIYojf//yLpQEjjxZtfKCvZ9+hgxw/e5pzn+iouFrOkeL3uGXvZNo/jpIII2g0hcTkVSQ5zmosyPpGhoQi75FOq/z9z788XV/mj22Z8loT+w7sJyvnVbSlJVysq+O5wnyy3n8HfesN1tISgrW9hd6vmzHVV2NpaaS2thqT2Yzddpv2tmbmJwa5225GicWwOwbJP/MmRWUlmNtasPT0kqsr4YBWg7njJmtpGeHqh6cpfzuXgryTGC5dIOvQyzz/4ktcN1RSVVHKzGA7XquBzUQM75SPu/1WAnM/4A/4UdIZ7o85uVhvxOV2oEgiQsW7+WjzjvB6zmtcq9KRk53NiWPHqCw7j/FyGfJEFylfJ7uP1/F6J+mzdTLhdTIzN0MilWJja4uEEmP4wbdEw4sIF946wUenDvPKwRcoyD/J8ezDFOQcJTcvF4v5M3bCDnbEIXa31hgZdWK3W5meduP2jDG3MIsYDeP3e7ljbcUzeg+hq07HNzUlVBWfpbhIQ+V5LQ1XPsbeZiQ0fpsnwSF2oyNsyhHu3xvAZDbQdKuR6ut1XNLr0VVW0Nxcw80GA/3dbfwHCCs09NUKqTUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bag\"\n        title=\"\"\n        src=\"/static/de4d07586d6baf7aa2abc228c3702c56/37523/bag.png\"\n        srcset=\"/static/de4d07586d6baf7aa2abc228c3702c56/e9ff0/bag.png 180w,\n/static/de4d07586d6baf7aa2abc228c3702c56/f21e7/bag.png 360w,\n/static/de4d07586d6baf7aa2abc228c3702c56/37523/bag.png 720w,\n/static/de4d07586d6baf7aa2abc228c3702c56/302a4/bag.png 1080w,\n/static/de4d07586d6baf7aa2abc228c3702c56/07a9c/bag.png 1440w,\n/static/de4d07586d6baf7aa2abc228c3702c56/66632/bag.png 1504w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"-가설-정리\" style=\"position:relative;\"><a href=\"#-%EA%B0%80%EC%84%A4-%EC%A0%95%EB%A6%AC\" aria-label=\" 가설 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🎯 가설 정리</h2>\n<p>폴라로이드 사진 찍기로 증명하고 싶었던 가설 목록이다.</p>\n<ul>\n<li>사업 감각\n<ul>\n<li>⬜️ 벚꽃 철에 폴라로이드를 찍으면 돈을 벌 수 있다</li>\n<li>⬜️ 일요일에 최소 50만원은 벌 수 있을 것이다</li>\n<li>⬜️ 가격은 적절하게 책정되었다</li>\n</ul>\n</li>\n<li>고객 유형\n<ul>\n<li>⬜️ 커플이 많을 것이다</li>\n<li>⬜️ 아기나 어린이를 동반한 가족이 많을 것이다</li>\n<li>⬜️ 20대 여성 그룹(내 생각에 인생네컷을 많이 찍는…)이 많을 것이다</li>\n<li>⬜️ 반려동물을 동반한 사람이 많을 것이다</li>\n</ul>\n</li>\n<li>고객 행동\n<ul>\n<li>⬜️ 대부분의 사람들은 현금을 들고 다니지 않을 것이다</li>\n<li>⬜️ 이 작업의 최대 병목은 돈을 주고받거나 송금하는 시간이 될 것이다</li>\n</ul>\n</li>\n</ul>\n<p>과연 이 중에 얼마나 사실로 밝혀졌을까?</p>\n<br>\n<h2 id=\"️-41-토요일---파일럿\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-41-%ED%86%A0%EC%9A%94%EC%9D%BC---%ED%8C%8C%EC%9D%BC%EB%9F%BF\" aria-label=\"️ 41 토요일   파일럿 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧑‍✈️ 4/1 토요일 - 파일럿</h2>\n<p>폴라로이드 필름은 한 장에 천원으로 꽤 비싸다.\n얼마나 팔릴지 모르는데 덮어두고 시키기엔 부담되는 금액이었다.\n거기다 <code class=\"language-text\">벚꽃 사진</code>이라는 특성 상, 그 주 주말이 마지막 장사 기회였다.</p>\n<p>그래서 토요일에 나름 <code class=\"language-text\">파일럿 프로젝트</code>를 했다.\n그리고 장소로 석촌호수가 아닌 양재천을 택했다.\n집에서 가깝기도 하고, 이미 좋은 포토스팟을 알고 있었기 떄문이다.\n오후에 약속이 있어서 오전 11시 20분부터 12시 10분까지 50분 간 서있었다.\n이 날의 판매량을 토대로 일요일에 필요한 총 필름을 더 주문하려고 했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAADG0lEQVR42h3DW0xbBQCA4fPmgybbQrIIbGqYIMmgKzBYUi6DOakb4TYGUkahFyoyYGwwCKZc19IDvVEoLbSlnLaUtqcMGpjiEgNZjDHLosYYfdjznqbZg0affxO/5BPcM2bWxQWCTjdR7xp70hZe0cGSeYZUOILf6WFVdBLxh3BZ7dimrHhtDmJrfh5vJ3n2/Y/88upPfnvzL7++/hthZXaW6LKLqGeFgH2R6Kqb5IYP15yFxGaYtSUnHouN2EaQRDjCpi/Mmugi7g+SSaR5dvwdv7/6g5dv/uHl678QIqsevFYL64sOoh4PcsCHHPSxKor4nG7EqVmWRRdyZJunmUMycoadkMRjKUYyKHGYSHH89IQXz3/mh+c/Iaw7ncyPj2I3P0Ty2PkmGeckIyMH15geHWegx8hXaZmDZIqjvX2epPc4SO0iB0LsBsJ8HU9ytJMiE46xG0sjDPZqWPhykAf9n7FoHiC9vsKLoyd8K8cZ1OowtHeyt+lnXwr9f9PlIGh3kA6GiCyvcihFOYrvcLJ/SMS/jbDlchFy2LBO3Cdon2fLPU3C5+BACjCk09PToeNYjiNveMlIAcKeJVYsj/DZRFzzVpKBEJmwRMDupr6mAcE+O8Lcw7vcaW1hwXyfvajIxJAB1/w4Oo2GytrbTE1MY9QZER/N4Z6bYnhgkIG7D7BNmnFbFjjcjmKZsVJWUY+QpzhLieJDCi4oUamuMjHUTZGyEqP2Fk3qa+Qr1XxwuZq88it0adqYHh9j5N4ouv579PfoqVFVcv26GkWtjksVaoRT7+ZwNiuXixeVKMs/prD4Mm+deZ+338nlzOlcst4r5nxJDqfzs6lpaqS2rpGy6iqqG1pouHmDapWKmto6FKpWiso+QWjV92D4wkDf50ZMJhOVVTUUFBRTWHiJnHP5ZF9QkpV3nlM52bRpTRSWXKX0SjmfNrdRVKygvLSCRrWa7o52qq61IPQZdHRpNNzp6kSv66azox2TvpfJsWHMY8M0t3Zi7O2l36Djxs1Gzn1USm1dPXptN83Nt9C0d9DXo2VyZJCmxhb+AzhLDiFbE2dcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"day1\"\n        title=\"\"\n        src=\"/static/bb9bcb18ee60c75ec41ee91a6451aede/37523/day1.png\"\n        srcset=\"/static/bb9bcb18ee60c75ec41ee91a6451aede/e9ff0/day1.png 180w,\n/static/bb9bcb18ee60c75ec41ee91a6451aede/f21e7/day1.png 360w,\n/static/bb9bcb18ee60c75ec41ee91a6451aede/37523/day1.png 720w,\n/static/bb9bcb18ee60c75ec41ee91a6451aede/302a4/day1.png 1080w,\n/static/bb9bcb18ee60c75ec41ee91a6451aede/07a9c/day1.png 1440w,\n/static/bb9bcb18ee60c75ec41ee91a6451aede/d61c2/day1.png 1800w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이 날 50분 동안 총 19장의 자신을, 매출은 48,000원을 기록했다.\n진짜 되는 장사였던 것이다.\n일요일은 9시부터 해가 질 때 까지, 약 9~10시간 정도 있을 예정이었기에 100장의 필름을 추가 주문했다.</p>\n<p>예상 외로 실물 현금으로 지불한 사람이 절반이었다.\n<code class=\"language-text\">요즘 사람들은 현금을 들고 다니지 않는다</code>는 가설이 깨지는 순간이었다.\n일요일에 잔돈을 거슬러주지 못할까 걱정되었지만, 주말이라 은행을 갈 수 없어 그냥 잔돈이 없을 수 있다는 사실만 염두에 두기로 했다.</p>\n<p>돈이 된다는 제일 중요한 가설이 증명되었으니, 일요일에 시도해 볼 가치가 충분했다. 아래는 가설 중간 점검이다.</p>\n<ul>\n<li>사업 감각\n<ul>\n<li>✅ 벚꽃 철에 폴라로이드를 찍으면 돈을 벌 수 있다</li>\n<li>⬜️ 일요일에 최소 50만원은 벌 수 있을 것이다</li>\n<li>⬜️ 가격은 적절하게 책정되었다</li>\n</ul>\n</li>\n<li>고객 유형\n<ul>\n<li>⬜️ 커플이 많을 것이다</li>\n<li>⬜️ 아기나 어린이를 동반한 가족이 많을 것이다</li>\n<li>⬜️ 20대 여성 그룹(내 생각에 인생네컷을 많이 찍는…)이 많을 것이다</li>\n<li>⬜️ 반려동물을 동반한 사람이 많을 것이다</li>\n</ul>\n</li>\n<li>고객 행동\n<ul>\n<li>❌ 대부분의 사람들은 현금을 들고 다니지 않을 것이다</li>\n<li>⬜️ 이 작업의 최대 병목은 돈을 주고받거나 송금하는 시간이 될 것이다</li>\n</ul>\n</li>\n</ul>\n<br>\n<h2 id=\"-42-일요일---진짜-한-탕-하자\" style=\"position:relative;\"><a href=\"#-42-%EC%9D%BC%EC%9A%94%EC%9D%BC---%EC%A7%84%EC%A7%9C-%ED%95%9C-%ED%83%95-%ED%95%98%EC%9E%90\" aria-label=\" 42 일요일   진짜 한 탕 하자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🌸 4/2 일요일 - 진짜 한 탕 하자</h2>\n<p>토요일 파일럿 때 사람들이 <code class=\"language-text\">사진이 예쁘게 나올 지 모르겠어서</code> 망설이다 안 찍는 걸 보고, 아침에 친구를 찍은 샘플을 허락받고 샘플로 붙였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAADlklEQVR42i3S2U/TBwDA8d82NhwON7MHkzFc9rBEp6JhiRtzE8aCCOMK59gAFQGjI4CAHHI0UKCUFuhJ75PSArYChXJVxlFug+CMCtv7/o3vErLX78Pn6SvcLcyj/o8H1FZWUfWgksaHD5F2iFBIetDK+7Bq1QwNKnDbbHiddizaISZGnIiam2moa6S8tILSokJKCrIpzMlCqL5XikWnZ35mgfnZIAd7Bzzf3sPp8GG0TDOoGadb5kChdGK2TaIzTdArs9LTo8Zg9uFwB2mtq6Yg4waxMRcRivLzmPPaONzfwO1wotPoWJwLolQaaW6RU1MvobFlkKYWOZPTG9Q3iOnus+IcXWZievu4tdbeJys5nsjISITEhJ9ZmBhhJ7SMql9G2+N2vKNe5gPPUAyaeNTYTdNjKb19BtzuGXqkRsQSI1K5gdDWK3z+EEk/JfLxqU8QBAHh3LmLjFhNPN/YIvDUx5+LS4SWV9lcXeevgyP29w6Znd3CaJ1Ho/Mz7JrD7VnAYJ1EZfZgcfn5/rtrx9h7YWEI0Z9/gbitlZmpeSwWH0evjzDrDWyvrfDi5b+ozevIlH46+ybplE0ypLXRLuqnrVNNYVEZ4h41X1+4/D/4PsLJDyO4X1bOanCZSf8qe7v7bK6uEFpeZnZ2G6V+gZm5FwSCbzE519BoXCjVHgZUIxTfqqCvX0daSiqfnj7NO++GIZw6+RFpqRnshlZYWXtNcOkAl82GQT+Ma2ydxaWXuL07DI/voDYuoNU6aRfJ0ejG8Ae3GZ16Rvmd21TdKyElKQHhxAfh5GXn88+bv9nYfMPI+AqiNjG1dR0Maqfokj9BpgnQrVykT7eK2z1FV7cSjd7LgMaJbEBHWmo6P8ZdJfGHOISI8HBSbtzk8NVb7MNL9Ctcx1ibSIlMMY5SH2DMt4XTE8Lj28IzOotKO4rZPkdVdSNldyv4NTeXby6dJzoqCiEy4gSJ1+PZCu2iH7IjkWjolph41CRH1KE6Htzp8KIdcqFQ2enqNaHSPcVgDdCvcjCoHSYjPYcrMZeI+/YqwmdnznAlJpZRTwC79QlarQOJ1Ex9o5yaOiltHTrEEgstHXo6eu10SiwMqMaQq8YQS200tasoKsin/Pbv5CclInwZfZboqLPcTM6gpKiU4uIysvLLSc8ppaK6k8oGCTUNXUhkGmpb+0nKvENC8m9c/6WE2GvpJGfeojA3k+zkeC6f/4r/ADfxk+/Et6KBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"day2\"\n        title=\"\"\n        src=\"/static/ad10545c9182a8df27048e9dc61ec338/37523/day2.png\"\n        srcset=\"/static/ad10545c9182a8df27048e9dc61ec338/e9ff0/day2.png 180w,\n/static/ad10545c9182a8df27048e9dc61ec338/f21e7/day2.png 360w,\n/static/ad10545c9182a8df27048e9dc61ec338/37523/day2.png 720w,\n/static/ad10545c9182a8df27048e9dc61ec338/302a4/day2.png 1080w,\n/static/ad10545c9182a8df27048e9dc61ec338/07a9c/day2.png 1440w,\n/static/ad10545c9182a8df27048e9dc61ec338/6a5c3/day2.png 1646w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그리고 개인적인 아쉬움으로, 폴라로이드 사진을 파는 것과 별개로 커플이나 가족이 사진을 함께 찍기 어려워하는 모습이 많이 보였다.\n소심한 편인 나도 그럴 때 지나가는 사람한테 부탁을 잘 못해서, 폰카를 무료로 찍어준다는 말을 덧붙였다.\n하지만 이 무료 서비스를 많이 이용할 거라는 기대는 아래 가설에 따라 안했는데…</p>\n<ul>\n<li>⬜️ 지나가는 사람들에게 사진 찍어달라고 얘기 못 하는 사람은, 당연히 나한테 무료로 찍어달라 얘기 못 할 것이다</li>\n<li>⬜️ 무료로 찍어주는 서비스를 받으면 사진을 팔아줘야 한다는 부담감을 느낄 것이다</li>\n</ul>\n<p>이 가설도 증명해보고 싶었다.</p>\n<br>\n<p>양재천에서 제일 예쁜 포토스팟 앞에 오전 10시부터 서있었다.\n사진은 주로 이런 느낌으로 찍었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAADEElEQVR42m3QW0+bBQCA4f4L71QkWYZTSGRsyHSAyRIXbjwsuukkmS6UwQ7EA4VANkaxi8JSOdjzgdNC269fS2lLjxsdoRYoFFgHDG0RDGNmd5OMUujymnnt+wOei1dyz+5k0jnG5KibsMWOoDZw1+ZgOhBiNbHEnyuPSG4+Y2ozx9TGHjNbWXypDMPLWex/7ONcP8CzkSOwlSP85AUS089K7Go9Y+Y7jBkGcGqNWPq0uAdHsOkHmBSdJJbWca3sISR3GV3NEEjtIjzKMJbeY3x9n9DmAXe3D5h8CfZ3dTPY1Y1Lb0bo0/6H2tUGRL2Z37x+wlaReCDEzMNtvGtZgmvPiaR38axlCKQzhDezRLayRLf3mf57H4nLZMahM2LtVdF3Q0HHNRle0yD3RSdz/hDxcT/z/hDJByliyS1iqWfMbOwwkfqHyF8Z7m/uMPt4l/nHz1l8mkXi7u9H1OgRtUZ+ab1Jz3U5Do2BexY7C6Ews24PcbePaaeb5ZkED7Z3WN54yvziGvHEKrG5FRaW0jz8fZtk+gmSXxW3GOpVYexSImgNjBoHEHUmBK2J4IiA6afb9Hcq8Q8NE7bZWF1YJj41S1R0ER/zkfBPMOePMOubIOQIIulobqL5aj1WjQ730B0EnY6XGywqLWGrQFdLK2qFAptKTfeNNpYCYaLeIG7jID7TEFHBxbwnSNzlJyp4kJyuKKHi6NucqzrFl1VV1H/xGbKLF/j+aynKluvcaviO9isNtNU10NvajqgxEPME8JqHcWiNTNhEIhaRccMQMbsLyat5r/BmQR4Fb73GoUOvc7ykkA8rK7l8oQZ5Uys//tBIZ0szjbVX6OtQ4BuxErQ6UN3soKetDbVcQWdTO4O3e7H0aJAczn+D8rJCSo8eofxEIZXvFXO6ohx5k4wXuRz/12Isxjeffk6jVIr0XDXyb2XY1BoGlN1ICvLzKDqcT0nREU6WFvNucREnj73DB2XHuVRTw+VLddRJa6mvreVqXR3NjTIuflXNieISykvLOPV+Bec/+oTzH5+h+sxZ/gV/WHkfqq0sHQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"spot\"\n        title=\"\"\n        src=\"/static/c8a618689fc959828b1539fe11f1b73b/37523/spot.png\"\n        srcset=\"/static/c8a618689fc959828b1539fe11f1b73b/e9ff0/spot.png 180w,\n/static/c8a618689fc959828b1539fe11f1b73b/f21e7/spot.png 360w,\n/static/c8a618689fc959828b1539fe11f1b73b/37523/spot.png 720w,\n/static/c8a618689fc959828b1539fe11f1b73b/302a4/spot.png 1080w,\n/static/c8a618689fc959828b1539fe11f1b73b/07a9c/spot.png 1440w,\n/static/c8a618689fc959828b1539fe11f1b73b/0e0c4/spot.png 1884w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>원래 계획은 해질 때 까지 있기였으나, 날이 더운데 밥도 물도 먹지 않고 있으니 너무 힘들어서 오후 5시에 철수했다.</p>\n<br>\n<h2 id=\"-가설-검증\" style=\"position:relative;\"><a href=\"#-%EA%B0%80%EC%84%A4-%EA%B2%80%EC%A6%9D\" aria-label=\" 가설 검증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔍 가설 검증</h2>\n<p>그러면 이 이상한 부업의 결과를 공개하겠다.</p>\n<p>먼저 사업 감각 부분이다.</p>\n<ul>\n<li>✅ 벚꽃 철에 폴라로이드를 찍으면 돈을 벌 수 있다</li>\n<li>❌ 일요일에 최소 50만원은 벌 수 있을 것이다</li>\n</ul>\n<p>돈은 확실히 벌었으나, 매출이 50만원까지 나오진 않았다.\n오전에는 토요일보다 훨씬 많은 사람들이 찍어서 필름이 모자라진 않을까 걱정할 정도였는데, 오후 1시 ~ 3시 쯤 사진을 찍는 사람이 급격하게 줄었다.\n그 날 날씨가 꽤 더웠는데, 사람들이 대부분 긴팔과 겉옷을 입고 있었다.\n안그래도 더운데 사진 찍을 자리가 나기를 기다릴 마음이 없던 것 같다.</p>\n<ul>\n<li>❓ 가격은 적절하게 책정되었다</li>\n</ul>\n<p>적절했다고 생각하는 건 여러번 찍은 사람들이 있어서다.\n나도 갈 수록 스킬이 늘어서 나중에는 내가봐도 사진을 기막히게 예쁘게 찍었는데…\n제일 많이 찍은 고객은 세 번, 여섯 장, 총 15,000원을 지불하셨다.</p>\n<p>적절하지 않았다고 생각하는 건 찍을까 말까 얘기하며 비싸다는 말을 한 사람들이 있어서다. (결국 찍지 않았던 것 같다.)\n원래는 1장 5,000원 2장 8,000원에 하려다가 회사 사람들이 너무 비싸다 해서 깎은 가격이었다.</p>\n<p>인생네컷과 비교해 타당한 가격이라 생각했는데 고객 입장에서는 그렇지 않나보다.\n비싸게 하고 총 매출을 올릴 수도 있었으니 완전히 검증하지 못했다.</p>\n<br>\n<p>고객 유형 부분이다.</p>\n<ul>\n<li>✅ 커플이 많을 것이다</li>\n<li>✅ 아기나 어린이를 동반한 가족이 많을 것이다</li>\n<li>❌ 20대 여성 그룹(내 생각에 인생네컷을 많이 찍는…)이 많을 것이다</li>\n<li>❌ 반려동물을 동반한 사람이 많을 것이다</li>\n</ul>\n<p>대부분이 고객이 커플과 아이가 있는 가족이었다.\n20대 여성 그룹은 두 번 정도 있었고, 반려동물을 동반한 사람은 한 번도 찍지 않았다!\n도무지 이해가 안갔는데, 아마 20대 여성 그룹은 이미 사진을 잘 찍어서 남에게 맡길 이유를 못느껴서고,\n반려동물은 움직여서 사진을 여러 번 찍어야 한 장 건질까 말까라 그렇지 않을까 추측만 했다.</p>\n<p>그리고 또 하나 착각이 있었다.</p>\n<ul>\n<li>❌ 어린이들은 폴라로이드가 뭔지 잘 모른다</li>\n</ul>\n<p>폴라로이드가 추억의 사진 느낌이라 그런가?\n사실 뚜렷한 근거 없이 초등학생 정도 까지의 어린이들 부터 한 중학생까지 폴라로이드를 잘 모를 거라 생각했다.\n그런데 다수의 어린이들이 날 보고 사진 찍자고 부모님을 조르다가 혼났다.\n관광지 앞에서 풍선과 장난감으로 아이들을 현혹하는 역할이 된 것 같고, 혼난 어린이들에게 너무 미안했다…</p>\n<p>어쨌든, 그래도 폴라로이드를 찍거나 찍혀본 경험은 적을텐데 왜 좋아하는 것일까? 고민하는데, 친구가\n‘요즘 폰카 어플에 폴라로이드 효과가 있어서 그걸 많이 접한 것이 아닐까?‘했다.\n증명은 불가능하지만 굉장히 일리 있는 말이었다.</p>\n<br>\n<p>마지막으로 고객 행동 부분이 제일 의외였다.</p>\n<ul>\n<li>❌ 대부분의 사람들은 현금을 들고 다니지 않을 것이다</li>\n<li>❌ 이 작업의 최대 병목은 돈을 주고받거나 송금하는 시간이 될 것이다</li>\n</ul>\n<p>대부분의 고객이 20~30대 였음에도, 실물 현금으로 계산한 사람이 절반이 넘었다.\n나는 지폐를 만져본 지가 까마득해서 당연히 다른 사람들도 그럴 줄 알았다.\n그런데 전혀 아니었다.\n거기다 만원짜리만 잔뜩 받아 거슬러 줄 돈이 없을까 걱정이었는데, 많은 사람들이 천원 지폐를 들고 다녔다.</p>\n<p>그리고 돈계산 하는 시간은 전혀 병목이 아니었으며, 벚꽃 스팟 앞에서 자리가 나길 기다리는 시간이 제일 많았다 ㅎㅎ…\n같이 서서 멀뚱히 기다리려니 엄청 뻘쭘했다.</p>\n<p>거기다 내가 얼마나 편향 속에 살았는지 깨달은 것이 있었는데…</p>\n<ul>\n<li>❌ QR 송금은 사람들에게 익숙하며 편한 결제 방식이다</li>\n</ul>\n<p>이게 전혀 아니었다.\n내가 만들어 간 QR 코드는 휴대폰 기본 카메라를 대면, 카카오페이와 토스의 송금 페이지로 연결되는 코드였다.\n그런데 이 플로우를 알고 있는 사람이 한명도 없었다.\n모두 카카오페이나 토스 앱을 일단 키거나, 계좌 번호를 물어보았다.</p>\n<p>그래서 ‘기본 카메라로 찍으면 카카오페이나 토스 송금 화면에 자동으로 연결된다’라고 꼬박꼬박 설명을 했는데도,\n따라하다가 뭔가 잘 안돼서 포기하거나, 그냥 은행 송금을 하면 안되냐고 물어봤다.</p>\n<p>나부터가 직업이 개발자고, 주위 사람도 IT 업종에 종사하거나, 그렇지 않아도 기술이나 신제품에 관심이 많은 사람이 대부분이다.\n그래서 <code class=\"language-text\">QR을 기본 카메라로 찍을 수 있다</code>가 보편적인 지식이라 생각했다.\n내 사고가 굉장히 편향적인 환경에서 돌아가고 있구나 깨달았다.</p>\n<br>\n<p>그래도 폰카 무료 서비스 부분은 모두 적중했다.</p>\n<ul>\n<li>✅ 지나가는 사람들에게 사진 찍어달라고 얘기 못 하는 사람은, 당연히 나한테 무료로 찍어달라 얘기 못 할 것이다</li>\n<li>✅ 무료로 찍어주는 서비스를 받으면 사진을 팔아줘야 한다는 부담감을 느낄 것이다</li>\n</ul>\n<p>사진을 찍어달라 하는 사람이 거의 없었다.\n단체로 온 중장년 분들 정도…\n한 번은 단체 사진 찍는 걸 어려워해서 말 걸었더니 괜찮다고 거절당한 적이 있고,\n또 한 번은 일행 중 한 명이 나한테 말을 걸었는데, 다른 사람이 황급하게 말린 적이 있었다.</p>\n<p>그러다 중간에 한 커플이 셀카봉이 고장났는지 끙끙대고 있어서 폰카 찍어주겠다고 가서 찍었는데…\n폴라로이드 얘기는 한마디도 하지 않았음에도 강매로 느꼈는지 찍고 나서 굉장히 당황+불쾌해해서 ㅠㅠ 나도 민망해서 그 뒤로 먼저 폰카 찍어주겠다는 말은 하지 못했다. 근데 충분히 이해한다…</p>\n<br>\n<h2 id=\"-부업-총-정리와-회고\" style=\"position:relative;\"><a href=\"#-%EB%B6%80%EC%97%85-%EC%B4%9D-%EC%A0%95%EB%A6%AC%EC%99%80-%ED%9A%8C%EA%B3%A0\" aria-label=\" 부업 총 정리와 회고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💸 부업 총 정리와 회고</h2>\n<ul>\n<li>사업 감각\n<ul>\n<li>✅ 벚꽃 철에 폴라로이드를 찍으면 돈을 벌 수 있다</li>\n<li>❌ 일요일에 최소 50만원은 벌 수 있을 것이다</li>\n<li>❓ 가격은 적절하게 책정되었다</li>\n</ul>\n</li>\n<li>고객 유형\n<ul>\n<li>✅ 커플이 많을 것이다</li>\n<li>✅ 아기나 어린이를 동반한 가족이 많을 것이다</li>\n<li>❌ 20대 여성 그룹(내 생각에 인생네컷을 많이 찍는…)이 많을 것이다</li>\n<li>❌ 반려동물을 동반한 사람이 많을 것이다</li>\n</ul>\n</li>\n<li>고객 행동\n<ul>\n<li>❌ 대부분의 사람들은 현금을 들고 다니지 않을 것이다</li>\n<li>❌ 이 작업의 최대 병목은 돈을 주고받거나 송금하는 시간이 될 것이다</li>\n</ul>\n</li>\n<li>기타\n<ul>\n<li>❌ 어린이들은 폴라로이드가 뭔지 잘 모른다</li>\n<li>❌ QR 송금은 사람들에게 익숙하며 편한 결제 방식이다</li>\n<li>✅ 지나가는 사람들에게 사진 찍어달라고 얘기 못 하는 사람은, 당연히 나한테 무료로 찍어달라 얘기 못 할 것이다</li>\n<li>✅ 무료로 찍어주는 서비스를 받으면 사진을 팔아줘야 한다는 부담감을 느낄 것이다</li>\n</ul>\n</li>\n</ul>\n<br>\n<p>처음에는 요즘 삶에 서스팬스가 부족해… 하고 시작한 장난이었는데, 의외로 유용한 인사이트를 얻었다.\n무엇보다 그 이후로 ‘우리 서비스를 사용하는 고객은 이러이러 할 것이다’ 생각할 때,\n이게 정말 맞나? 근거는? 관찰한 사실이 있나? 어디까지가 나의 편향인가? 를 돌아보게 되었다.</p>\n<p>그리고 꽃 구경 사람 구경 실컷 해서 재밌었다.\n나도 중간부터는 뻔치가 늘어서 폴라로이드 찍고 서비스로 이어서 폰카를 엄청나게 찍어줬는데,\n커플들한테 포즈 추천도 하고 너무 보기 좋다고 하고 재밌어서 주접을 떨었다.</p>\n<p>사람들이 사진이 너무 잘나왔다며 기뻐할 때 나도 기뻤고,\n아이가 눈을 감아서 한 장을 그냥 추가로 찍어드리자 고맙다며 아이를 통해 간식을 건네준 분도 계셨다.\n이렇게 돈 벌 생각을 하다니 천재적이라는 말을 여러번 들었고, 심지어 그 분 중에 한 분은 나랑 셀카를 찍어가셨다. 대체 왜…?!</p>\n<p>반면 불쾌한 경험도 있었는데, 내가 NPC로 보였던 건지 도촬을 엄청 당했다… 찍지 말라 하기도 이상해서 그냥 있었는데 그건 좀 스트레스였다.</p>\n<p>그리고 이 자리를 빌어 고백할 일이 있는데… 덜 부끄럽고 덜 창피하려고 ‘누가 물어보면 대학생이고 과제라고 해야지’ 하는 생각을 했는데…\n물어본 사람이 두 명 있어서 준비했던 거짓말을 하고 말았다.\n그러니 아~ 그렇구나 하는 반응이어서 덜 쪽팔리긴 했는데, 별 거 아닌데도 거짓말 하고 나서 계속 신경쓰였다.\n정직하게 살자.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 121.1111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAABYlAAAWJQFJUiTwAAAGLklEQVR42h2UWVeTBwJAvz8xf2HOmaexqBWsMB6ro9LOuFHr0kFbwIUghM2QQBLIRvY9ZCUJ2ZMviyEkEAikpsjYOkep0+o5Ws889aG/4s5pH+/LfbtXiPjMBFxa4mE3AYcBq0GB26IkG/GS9CyjmpukWsoj5tNkUzEqpQL1eo3EWoxyMU+tIrLbavLjj4d8+OUdQtDnYsVpIuC1IopZvC4z2VyKUm4NnUJKZtVDs1EhGvZRrZYoV0psbjfJF3KYl7WYDYskY2GajSpbNREhl00jFrIkYgESq34syxrCAS+lTBStQkrUbSDiMpCJB8iLOdbrVfY6bYplEfWCDJ/bQjTkJuyzs7ZiQUjFI3/Akyd5dnfWcZpUWHUKmjWRkNdKrZIlFXbgsGgRxRS1epmNRpVsdo1w0M3+QQdRzOAwa1j1GBDa7SZb61nCHiPPvtvG79IT9Zk4PHxOJOxDLKSwmrXk8wlarQ02GhWefrfNdrNCqZRht92kUslRq+Z4++YVwvqTPJ12gyfFJD6bGo9FyWrAzov/7GMxLuF2mjAaFmm3qvjsS7x8scfTTpOnnR0q5TQHB3t8/0OHd+//yy/vDxHScTffthts1nLEgnbWIk5yqRD7+zu47VoCPgsOkxqbbg7/8jRJjxIxauTtTx2y6QC7rSIfPrzmt9/+x6+/vkGIhUzUiqvU17O8e/8TzUaRfMpPIRtGI3uAanoYlWwM/cIE9kUplgUJafc0G3kTBvUoK7ZRautx3v68z5vDLYRyLkAyZCATc9BqlijlwojZEKPDNxgbvoF2fhzZxDBG9TQuo5yEb4l8SEvCv8js2E1M6hFUsq8RE0Z+2FlFqBd9dHZzbK0nqYhRnDYNYjaIZOQ239y+xPxjCZOjdzAqJ1gxyUl4l9hM2dhIWnl07ybq2a+xasbwGKfYzpoQGmU/haSTeNRLu1Um4jexvDRDPGBk5tFdZsaHkE0MoZwcQi97SNKrpZHxkgsuo5VLmHp4i4XpIRZl90k4ZQiljJ1K2oqYcbNRDJAKW5iUDDInHeL6P85w785VJMPXGbzxOYqJO5Qjy6T8OvwWBarHQ9j0UgYuncWgHGXNM4cQsstJhTS06iHyCQsuixSbcZJbAxe42t/LY+ldRu4O0H/+b+gU91kxKzCqxzBpxph8dB2jbpRb1/tJ+vWIYQOCSSUht6qlVfWQjS0SDSgJ+BRIR7/i87MnuHPzHEf++hF3rx5FqxvAatLicar/kF288DESST+Dt8/is97B77qH4LfJeJLUUS+YKWVURFeGCPtvo5ZfY+BSL319f+b26W6qbjPJsJJg3EMs7mReKeXB/SvcGz7D5cs9SCd6UcjPIpgXR9gsmKkXtXhtl5mb7UauOMm94dMo5s/Q0/sn5Nf6eRZZo5PwURAjrAQtuAJ2wlEHDpuC+8PXGHtwicGb5xCmpBfJrD1gxX2VBVk3M7JTyFU9KBc/xeLsZVpyFt03XxKa+Ipd3xI/v/ieYDhANOIgGDbj8JlxrlgwmuTMTN5C+PJWH3NzJ9Goe9DpjmN1H8Hq7iK49hfcoYu04nYqfiv5XJlGxMnrRoHNepWAR4vbq8cfMGF0GQjFnPjDVoR/DR1lfqEbk74Hq/4EGtUpZmeOo17sIh54SNMmI+wwUCqWWf/9h3oJ29kQ8Zid+Jodq0tPYs1OKuXEFbAiqIxdaA3HsZu68BqPMP7wGFc+62bgnz08fnSOcszORrlMrVzi2702B/Uyz8ou1ksu4r8HkXBRyHlJJD2ks36EOWU3soUuZmQfIRk9yrz8E6TjfUxKP2ZBfoxSMcPOdoetzTbbzTavXx3Srq1STBgpZ60Ew1YSCRfRqJ18xoMwPd/FzMIJVJqT6LTHWF76FPX8BXyOXibu95BNZag3npJI7VAobNColkiHltgtGimnjUSjFvJZD1vrQWoVP8LDkR4WFH08Gj+F0/J3rNovmJ34gpnxTxgf6aNUKHFw8IpO5yX/PnhJe7tJKWGgmtbQEC00qx5KBQ/P92I0awGEWekpBq90MzzYx9TkeeYmrjMxfp4Z6WkG+k8wNT2FJZBG7wjhitdo7HVolizUMjqeb3loVd082w7yej9GZyvI/wG6QQHJdgKrIwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"end\"\n        title=\"\"\n        src=\"/static/3be2b732cbe4a167649f9df160d8469a/37523/end.png\"\n        srcset=\"/static/3be2b732cbe4a167649f9df160d8469a/e9ff0/end.png 180w,\n/static/3be2b732cbe4a167649f9df160d8469a/f21e7/end.png 360w,\n/static/3be2b732cbe4a167649f9df160d8469a/37523/end.png 720w,\n/static/3be2b732cbe4a167649f9df160d8469a/302a4/end.png 1080w,\n/static/3be2b732cbe4a167649f9df160d8469a/4a00e/end.png 1406w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>철수할 때 친구에게 부업 기념 사진을 찍어달라 부탁했다.</p>\n<p>마지막으로 가장 중요한 깨달음은…\n한 탕 벚꽃 사진 장사로는 부자가 될 수 없다! 개발 공부 열심히 하자!! 회사를 열심히 다니자!!! 였다. 🥹\n그래도 이런 영감을 주는 호작질을 기회가 되면 또 해보고 싶다.\n이상한 부업 일기 2를 언젠가 쓸 수 있기를…</p>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#-%EA%B0%80%EC%84%A4-%EC%A0%95%EB%A6%AC\">🎯 가설 정리</a></li>\n<li><a href=\"#%EF%B8%8F-41-%ED%86%A0%EC%9A%94%EC%9D%BC---%ED%8C%8C%EC%9D%BC%EB%9F%BF\">🧑‍✈️ 4/1 토요일 - 파일럿</a></li>\n<li><a href=\"#-42-%EC%9D%BC%EC%9A%94%EC%9D%BC---%EC%A7%84%EC%A7%9C-%ED%95%9C-%ED%83%95-%ED%95%98%EC%9E%90\">🌸 4/2 일요일 - 진짜 한 탕 하자</a></li>\n<li><a href=\"#-%EA%B0%80%EC%84%A4-%EA%B2%80%EC%A6%9D\">🔍 가설 검증</a></li>\n<li><a href=\"#-%EB%B6%80%EC%97%85-%EC%B4%9D-%EC%A0%95%EB%A6%AC%EC%99%80-%ED%9A%8C%EA%B3%A0\">💸 부업 총 정리와 회고</a></li>\n</ul>\n</div>","frontmatter":{"date":"April 09, 2023","title":"이상한 부업 일기 - 나는 얼마나 고객을 알고 있을까","categories":"etc","author":"써머","emoji":"headers/weird-side-job-1.png"},"fields":{"slug":"/weird-side-job-1/"}},"prev":{"id":"bf219710-390f-5cde-918c-40c4ce3086ca","html":"<h2 id=\"️-문제-상황\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\" aria-label=\"️ 문제 상황 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⚡️ 문제 상황</h2>\n<p>언젠가부터 백엔드 서버 배포 직후에 아주 짧은 서비스 순단이 일어났다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.555555555555557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAZ0lEQVR42m2MSwqAIBRF2/92oq3UIIg+A7Wflk/7WN5IokkduHAGhxvxQUHbBTfe+7CbiQy0scE7qVALCSEyNEUC0u3Tn2+/7Q6TXRGxXkKb/8OZTHDej6jYCMFTlHkMovbTb+4Ihxf2oJqshiIhMAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"데이터독 로그\"\n        title=\"\"\n        src=\"/static/8aef0bdae49e0e866850d2f48ebcb9b4/37523/datadog_log.png\"\n        srcset=\"/static/8aef0bdae49e0e866850d2f48ebcb9b4/e9ff0/datadog_log.png 180w,\n/static/8aef0bdae49e0e866850d2f48ebcb9b4/f21e7/datadog_log.png 360w,\n/static/8aef0bdae49e0e866850d2f48ebcb9b4/37523/datadog_log.png 720w,\n/static/8aef0bdae49e0e866850d2f48ebcb9b4/302a4/datadog_log.png 1080w,\n/static/8aef0bdae49e0e866850d2f48ebcb9b4/07a9c/datadog_log.png 1440w,\n/static/8aef0bdae49e0e866850d2f48ebcb9b4/d3d45/datadog_log.png 1614w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>배포 직후 외부 API를 호출 할 때 DNS 조회에 실패하는 걸로 추정되었다.\n여러번 발생하는 에러가 아니기에 다른 팀원이 애플리케이션 실행 후 트래픽 허용 전, <code class=\"language-text\">nslookup</code>으로 호출하는 모든 도메인을 한 번씩 조회하도록 배포 스크립트를 수정했다.\nDNS 조회 결과를 캐싱할 것으로 기대했기 때문이다.</p>\n<p>하지만 조치 후에도 여전히 <code class=\"language-text\">EAI_AGAIN</code>이라는 동일한 에러 메시지와 함께 순단이 발생했다.\n순단으로 인해 틀어진 여러 정합을 수동으로 맞춰야 하는 상황을 없애기 위해 이번 스프린트에 해결을 목표했다.</p>\n<br>\n<h2 id=\"-eai_again은-어디에서-오는가\" style=\"position:relative;\"><a href=\"#-eai_again%EC%9D%80-%EC%96%B4%EB%94%94%EC%97%90%EC%84%9C-%EC%98%A4%EB%8A%94%EA%B0%80\" aria-label=\" eai_again은 어디에서 오는가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧶 EAI_AGAIN은 어디에서 오는가</h2>\n<p>이 코드를 누가 언제 왜 던지는가 부터 알기 위해 라이브러리를 포함해 코드를 검색했는데 나오지 않았다.\n그래서 함수 이름으로 추정되는 <code class=\"language-text\">getaddrinfo</code>를 검색해보고, 에러 콜스택도 읽어봤다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAZklEQVR42i2MgQqAIAxE+/+/LA1EnVMrxQwuthqMd/cGW67xYM6J4zwRIsHHiECkWdbuO6y1ynXdsBmj/eN3897DOQdmxoJ/xhigxOBclPKs1AORkrrEGblUpXhx0iW31tF6x31PvLn4l5LSsxdjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"에러 콜스택\"\n        title=\"\"\n        src=\"/static/3d841a7863112fee934981180cac0112/37523/error_call_stack.png\"\n        srcset=\"/static/3d841a7863112fee934981180cac0112/e9ff0/error_call_stack.png 180w,\n/static/3d841a7863112fee934981180cac0112/f21e7/error_call_stack.png 360w,\n/static/3d841a7863112fee934981180cac0112/37523/error_call_stack.png 720w,\n/static/3d841a7863112fee934981180cac0112/302a4/error_call_stack.png 1080w,\n/static/3d841a7863112fee934981180cac0112/07a9c/error_call_stack.png 1440w,\n/static/3d841a7863112fee934981180cac0112/7db30/error_call_stack.png 1494w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>프로젝트 및 노드 모듈 코드 내에 <code class=\"language-text\">getaddrinfo</code>라는 함수는 없었고, 대신 노드 모듈 내의 <code class=\"language-text\">dns.d.ts</code> 파일의 주석에 언급이 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"> <span class=\"token operator\">*</span> See the <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Implementation considerations section</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token keyword\">for</span> more information<span class=\"token punctuation\">.</span>\n <span class=\"token operator\">*</span> <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">see</span></span> <span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>nodejs<span class=\"token operator\">/</span>node<span class=\"token operator\">/</span>blob<span class=\"token operator\">/</span>v16<span class=\"token punctuation\">.</span><span class=\"token number\">9.0</span><span class=\"token operator\">/</span>lib<span class=\"token operator\">/</span>dns<span class=\"token punctuation\">.</span>js<span class=\"token punctuation\">)</span>\n <span class=\"token operator\">*</span><span class=\"token operator\">/</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'dns'</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> dnsPromises <span class=\"token keyword\">from</span> <span class=\"token string\">'node:dns/promises'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Supported getaddrinfo flags.</span>\n    <span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">ADDRCONFIG</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">...</span></code></pre></div>\n<br>\n<p>그리고 해당 파일의 제일 상단 주석에서 node DNS 모듈 내 <code class=\"language-text\">lockup()</code>과 다른 메서드들의 역할을 알 수 있었다.</p>\n<blockquote>\n<p>The <code class=\"language-text\">dns</code> module enables name resolution. For example, use it to look up IP addresses of host names. Although named for the <a href=\"https://en.wikipedia.org/wiki/Domain_Name_System\">Domain Name System (DNS)</a>, it does not always use the DNS protocol for lookups… (생략)</p>\n</blockquote>\n<p>설명은 대략 이런 내용이었다.</p>\n<p><code class=\"language-text\">dns.lookup()</code>은 DNS 조회를 운영체제 기능을 통해 수행한다. 네트워크 통신이 일어나지 않을 수도 있다.\n시스템의 다른 애플리케이션들과 동일한 방식으로 동작하는 DNS 조회를 할 수 있다.</p>\n<p>반면 다른 메서드들은 실제 DNS 서버에 연결해 항상 네트워크를 통해 조회한다. <code class=\"language-text\">lookup()</code>과 사용하는 설정값이 다르다.\n다른 DNS 조회 기능을 사용하지 않고 언제나 네트워크를 통해 수행하고 싶다면 <code class=\"language-text\">resolve()</code>와 같은 다른 메서드를 사용하면 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB20lEQVR42n3PTWiSARzH8R061cE5bDmfpsu09QQqDV0WMnKtZ9q0lpYWsaHEGFnCoKIGCyrKw3aIXk6xWxRF1KW9pfXQXizKgl7oYDRih7EOvtZV/cbsUtR2+vE7/D/8/jUAlUplOSgWcgQCHqQDLiSvxKmgHc/+Dvw9fjwBD26/i7Y9rbS7d2HebqBerWBiaqJ6WyqVqlnzJ1go5OkLdRMJd3E9YiF+vpETPe30RvsJhgIEQ0FcB/fS6ZNosYmIFh0JOf4vWC6Xq2UpU+DsMSvyORVzQypmhlTcjRpwdzqwOXZgbTXTYjdhtVtwudqwOcwk5Kf/W/gbzObzHO6WeHKmAXlQ4EFEz2h4M8PhrezzSex02hi5ESOd/sTX+TTuQ26mnk2uvDCXyyLoDBx3buB1rIEXl+q5E9Xw+LSRI0Ev3qMBPnz+SPFnjkf3byNs28jcm+TKYDaTQWjSolHU8dCjYaZPYCzUxNhuPbdszYwOiLwbv8ni4gLXBjrQmfQkU69WAbMZjGIzW9QC4+tqSa1VMKmtI+FUMXtSyezlRt7K98j9KBK7MojWtGl1cPll0WTBIqiZrlXyfo2CeNd6pkcEnvcqGe73Mf99iW8LX7h49QJGq0gy9fIv8Bcj4MGUs39DGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"푸 노안 짤\"\n        title=\"\"\n        src=\"/static/c9327bf6aee2bb3e651f1e359117c6df/37523/pooh.png\"\n        srcset=\"/static/c9327bf6aee2bb3e651f1e359117c6df/e9ff0/pooh.png 180w,\n/static/c9327bf6aee2bb3e651f1e359117c6df/f21e7/pooh.png 360w,\n/static/c9327bf6aee2bb3e651f1e359117c6df/37523/pooh.png 720w,\n/static/c9327bf6aee2bb3e651f1e359117c6df/302a4/pooh.png 1080w,\n/static/c9327bf6aee2bb3e651f1e359117c6df/07a9c/pooh.png 1440w,\n/static/c9327bf6aee2bb3e651f1e359117c6df/c0566/pooh.png 1544w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>난 에러 코드의 뜻을 알고 싶었을 뿐인데 서먹한 개념들만 나온다…\n에러 콜스택에서 <code class=\"language-text\">onlookup()</code>이라는 비슷한 이름의 메서드를 봤으니 이 메서드를 찾아봤다.</p>\n<p>어쩐지 모듈 내 코드에는 없고, 주석에 링크가 있던 <code class=\"language-text\">dns.js</code> 파일에서 발견할 수 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">onlookup</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> addresses</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token function\">dnsException</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> <span class=\"token string\">'getaddrinfo'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>hostname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> addresses<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>family <span class=\"token operator\">||</span> <span class=\"token function\">isIP</span><span class=\"token punctuation\">(</span>addresses<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">lookup</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">hostname<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> hints <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> family <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> all <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> verbatim <span class=\"token operator\">=</span> <span class=\"token function\">getDefaultVerbatim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">...</span>\n\n  <span class=\"token keyword\">const</span> req <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GetAddrInfoReqWrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 콜스택에서 본 친구다!  </span>\n  req<span class=\"token punctuation\">.</span>callback <span class=\"token operator\">=</span> callback<span class=\"token punctuation\">;</span>\n  req<span class=\"token punctuation\">.</span>family <span class=\"token operator\">=</span> family<span class=\"token punctuation\">;</span>\n  req<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">=</span> hostname<span class=\"token punctuation\">;</span>\n  req<span class=\"token punctuation\">.</span>oncomplete <span class=\"token operator\">=</span> all <span class=\"token operator\">?</span> onlookupall <span class=\"token operator\">:</span> onlookup<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 완료되면 onlookup을 호출하는구나 짐작된다  </span>\n  <span class=\"token operator\">...</span>\n\n  <span class=\"token keyword\">return</span> req<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>콜스택에서 봤던 <code class=\"language-text\">GetAddrInfoReqWrap.onlookup()</code>가 있었고, 해당 모듈과 다른 모듈의 테스트 코드에서 에러 코드를 찾을 수 있었다.</p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> dnsPromises <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dns'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>promises<span class=\"token punctuation\">;</span>\n\ndnsPromises<span class=\"token punctuation\">.</span><span class=\"token function\">lookupService</span><span class=\"token punctuation\">(</span><span class=\"token string\">'127.0.0.1'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>common<span class=\"token punctuation\">.</span><span class=\"token function\">mustCall</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ssh'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">strictEqual</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> result<span class=\"token punctuation\">.</span>hostname<span class=\"token punctuation\">,</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">notStrictEqual</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>hostname<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Use an IP from the RFC 5737 test range to cause an error.</span>\n<span class=\"token comment\">// Refs: https://tools.ietf.org/html/rfc5737</span>\nassert<span class=\"token punctuation\">.</span><span class=\"token function\">rejects</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> dnsPromises<span class=\"token punctuation\">.</span><span class=\"token function\">lookupService</span><span class=\"token punctuation\">(</span><span class=\"token string\">'192.0.2.1'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">code</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^(?:ENOTFOUND|EAI_AGAIN)$</span><span class=\"token regex-delimiter\">/</span></span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p><code class=\"language-text\">dns.lookup()</code>이 OS 기능을 사용한다는 것과 에러 코드 정의가 없는 것을 봤을 때, <code class=\"language-text\">EAI_AGAIN</code>은 OS에서 반환하는 코드인 것 같았다.\n그렇다면 배포 스크립트의 <code class=\"language-text\">nslookup</code>이 성공하지 않았던 것일까?\n배포 로그를 봤을 때 그건 아니었다. 잘 조회되고 있었다.</p>\n<p>사실 이쯤 해서 시도할 해결책은 결정나 있었다.\n팀원이 언급한 적 있던 <a href=\"https://github.com/yahoo/dnscache\">dnscache</a>로 노드 애플리케이션에서 별도 캐싱을 적용하는 것이었다.\n서버 로그를 봤을 때, 배포 직후 첫 요청에 실패하는 것이 아니라 새로운 서버에 트래픽이 흐르고 1~2분 지났을 시점에 한두건의 요청이 실패한다는 특정한 패턴이 있었다.\n그래서 애플리케이션 단에서 캐싱을 적용하면 해결될 것으로 기대했다.</p>\n<p>어쨌든 에러 코드의 명확한 스펙을 알게된 건 아니라 더 찾아보았다.\n사실 여기서 시간을 엄청나게 소비했는데…\n검색해보면 정보가 잘 안나왔다.</p>\n<p>특히 노드 모듈 테스트 코드도 그랬고, 틀린 도메인이나 설정값으로 요청해서 해당 에러가 생기는 경우가 대부분이었다.\n우리처럼 정상적으로 동작하다가 에러가 발생하고, 다시 정상적으로 되는 경우는 없었다.\n공식 문서 찾기에 지쳤을 때 문득 생각나서 빙챗으로 검색을 했는데 <a href=\"https://man7.org/linux/man-pages/man3/getaddrinfo.3.html\">linux 문서</a>를 바로 알려주는 것이었다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9klEQVR42mVQi2rDMBDr///fWsbiOo82Xhrn/bJ9TjTuIGNlB0LiMLJOlznPMagEze2KuTKYVo8QCEQBIQQQkfC2bcJ/4b2Hc040z3EcuLAIkaCTTxSpQmVKlKVBnudY11UwzzOapsGyLKJPTNOEvu9Fvxs6B2seeKYJHvoL09AjECHGKOCHjH3ff5n3nIz1acYjhocsD7SNxe36AX2/wxiDoiiglBLWWiPLMtGcfhxHdF0nqf8ZUvDoXgbfRYp1WUAxSncM7o57YvD5zLzjZOcbTvt28r5HxOBRvyqkWksKTlPXtXR0dmWtlWTDMAi3bSvgT07DH7c/zhlMRv64AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"리눅스 문서\"\n        title=\"\"\n        src=\"/static/357ffa25bfba15ab254061ef09a3ff60/37523/linux_docs.png\"\n        srcset=\"/static/357ffa25bfba15ab254061ef09a3ff60/e9ff0/linux_docs.png 180w,\n/static/357ffa25bfba15ab254061ef09a3ff60/f21e7/linux_docs.png 360w,\n/static/357ffa25bfba15ab254061ef09a3ff60/37523/linux_docs.png 720w,\n/static/357ffa25bfba15ab254061ef09a3ff60/302a4/linux_docs.png 1080w,\n/static/357ffa25bfba15ab254061ef09a3ff60/07a9c/linux_docs.png 1440w,\n/static/357ffa25bfba15ab254061ef09a3ff60/a8c87/linux_docs.png 1538w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<p>그리고 이 함수에 대해 상세한 설명을 해주신 블로그 글 <a href=\"https://techlog.gurucat.net/293\">[네트워크/C] getaddrinfo 함수 - 제임스 딘딘</a>도 함께 알려주었다.\n문서에 따르면 일시적인 조회 실패로, 잠시 후 다시 시도하라는 뜻이었다.</p>\n<p>모든 외부 API 호출이 해당 사유로 실패 가능했기 때문에, 전역적인 재시도 처리를 하는 것도 방법이었다.\n그래도 캐싱으로 충분할 것 같아 <code class=\"language-text\">dnscache</code>를 적용했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dnscache'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">enable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>해당 모듈을 적용하면 전역적으로 모든 <code class=\"language-text\">dns</code> 메서드를 래핑해준다 한다.</p>\n<p>적용 후 테스트 환경에서 세차례 정도 배포해보았는데, 순단이 발생하지 않았다.\n그래서 프로덕션에도 적용해 배포해본 결과 일단은 무찌른 것 같다. 아마도…</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA2klEQVR42p1R22rDMAzN///dYPRhfSgrdKXFtSw7thI7ySly15ayDTILDgJfpHPpUkpwRLgYA2ZGCAF6tiwLtO59bXX62ZLD7nACOfe40EEt6Pq+R0wJQy6Y57mJ1QvDQQRMhKmUP5npojW4MfQevP/E1/EAYwystSCiB5xzUBW/Qf0OPtQeY0QpBZ2yYnbYnc44mgtEBNM0IZdSHyjWePcSSpIBhiOGccTyTb2lquQkcpNnLfI4VoY55/aUg+fqk/e+yntua0z5bfOOj+0W1hKYzshCP9L+z8ArzJgSh1U3+2EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"슬랙\"\n        title=\"\"\n        src=\"/static/07140bbe82d85b9668a7168d790c09dd/37523/slack.png\"\n        srcset=\"/static/07140bbe82d85b9668a7168d790c09dd/e9ff0/slack.png 180w,\n/static/07140bbe82d85b9668a7168d790c09dd/f21e7/slack.png 360w,\n/static/07140bbe82d85b9668a7168d790c09dd/37523/slack.png 720w,\n/static/07140bbe82d85b9668a7168d790c09dd/302a4/slack.png 1080w,\n/static/07140bbe82d85b9668a7168d790c09dd/07a9c/slack.png 1440w,\n/static/07140bbe82d85b9668a7168d790c09dd/bfe41/slack.png 2082w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div style=\"text-align:center; font-style:italic; color:grey;\">\n  진짜로 순간 속았음  \n</div>  \n<br>  \n<h2 id=\"-잘-하는-개발자는-어떻게-될-수-있나요\" style=\"position:relative;\"><a href=\"#-%EC%9E%98-%ED%95%98%EB%8A%94-%EA%B0%9C%EB%B0%9C%EC%9E%90%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%90%A0-%EC%88%98-%EC%9E%88%EB%82%98%EC%9A%94\" aria-label=\" 잘 하는 개발자는 어떻게 될 수 있나요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🛶 잘 하는 개발자는 어떻게 될 수 있나요</h2>\n<p>사실 글로만 보면 꽤 간단하게 해결한 것 같은데!!!\n여기에 페어로 이틀을 꼬박 소모했다.</p>\n<p>이유는 이 에러가 프로덕션 무중단 배포 시에만 발생했는데, 스테이지 환경은 동일한 배포 파이프라인이 구축되어 있지 않아서 재연이 어려웠기 때문이다.\n원인을 확실하게 알지 못하니 재연된 스테이지 환경에 적용 후 해결 되었는지 봐야 했는데…\n여러가지 다양한 이유로 재연 환경을 구축하기가 만만치 않았다.\n사실 나는 조수석에 앉아있었고 든든한 페어가 멋지게 뚝딱뚝딱 구축해줬지만…</p>\n<p>잘 하고 싶다는 고민이 많은 요즘이다.\n내가 생각하는 ‘잘 하는 개발자’는 언어나 분야에 제약받지 않는 사람이다.\n예를 들어, 정말 그림을 잘 그리는 사람은 동양화를 주로 그렸어도, 대리석 조각을 깎으라 시키면 잘 할 수 있다.\n동양화를 그리면서 체득한 양감이나 구도에 대한 이해와 손을 쓰는 능력은 조각에도 적용되기 때문이다.</p>\n<p>반면 나는 노드에서 익숙하지 않은 코드를 보면 스프링을 보듯이 이해 할 수가 없다.\n같은 백엔드인데도 그렇다.\n인프라도 그렇고… 열심히 하면 어떻게든 되겠지만 참 쉽지않다!!!\n‘노드라서 자스라서 잘 모르겠다’는 말을 하고싶지 않은데 하지 않기가 어렵다.</p>\n<p>그래도 처음에는 노드 + 자스에 손 댈 일이 생길 때 마다 부담되고 고통스러웠는데 지금은 즐겁다.\n디버깅도 즐거워지는 때가 오겠지…</p>\n<p>그리고 프롬프트 엔지니어 얘기가 괜히 나온 게 아니라는 걸 느꼈다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABdklEQVR42j3NO2sUUQDF8f1A1qIBcet8AeuAIGInKcRaJJ1iNtgoaLVIEBUbSWflB3DNusnO7rx2nvfO885N5rV/2UFS/DinOmeUF5osr0nzhqJsCWXDw7cJ+y8F+y8k958Lxs8E9w4F40PJ+GnC3ScJe49T9h6l3D5IuXOQcetBytGHilGa1QipiaUmihVeqJj+zHh3lvP+LOPke8bJt4zJ15zJl4LjzwXHpyWT05I3nxSvporX04qjj4ofv64ZRYlivjCZna+4NDY4rkQVFX3T0dUd27a/0Tc9fbulb6Gue67rjqu6R++y6UhVxyhJNBtPYDsBQZgQhCm2G+FsJKYtMNbhYG3Fg+UqYLH0cEOFG7fYYTMwow4r7hgJUWAYFkvDZf7XYPbngt+zC87nq+HEDySeL/BDOfSNL3DciEgqPNHj7EbjDkvcDCocx8f1KxbrCtO94tLULG1NqXoqvUXpLWX1nwaZ1Vhhhhk1rKOGVbjTDv4BYCCrQ7uOxwwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"빙쳇\"\n        title=\"\"\n        src=\"/static/a882dd5f2516c760b7e5343c51dc983b/37523/bingchat.png\"\n        srcset=\"/static/a882dd5f2516c760b7e5343c51dc983b/e9ff0/bingchat.png 180w,\n/static/a882dd5f2516c760b7e5343c51dc983b/f21e7/bingchat.png 360w,\n/static/a882dd5f2516c760b7e5343c51dc983b/37523/bingchat.png 720w,\n/static/a882dd5f2516c760b7e5343c51dc983b/302a4/bingchat.png 1080w,\n/static/a882dd5f2516c760b7e5343c51dc983b/07a9c/bingchat.png 1440w,\n/static/a882dd5f2516c760b7e5343c51dc983b/8170e/bingchat.png 2132w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>빙챗의 엄청난 검색 능력을 보여주려고 다시 질문했는데 절대 그 때 주었던 리눅스 문서를 주지 않는다.\n로그인 하지 않고 검색했어서 히스토리를 찾을 수가 없는데, 어떻게 검색했었을까?\n내가 했는데도 기억이 안 나서 몹시 안타깝다.</p>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EF%B8%8F-%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\">⚡️ 문제 상황</a></li>\n<li><a href=\"#-eai_again%EC%9D%80-%EC%96%B4%EB%94%94%EC%97%90%EC%84%9C-%EC%98%A4%EB%8A%94%EA%B0%80\">🧶 EAI_AGAIN은 어디에서 오는가</a></li>\n<li><a href=\"#-%EC%9E%98-%ED%95%98%EB%8A%94-%EA%B0%9C%EB%B0%9C%EC%9E%90%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%90%A0-%EC%88%98-%EC%9E%88%EB%82%98%EC%9A%94\">🛶 잘 하는 개발자는 어떻게 될 수 있나요</a></li>\n</ul>\n</div>","frontmatter":{"date":"June 04, 2023","title":"배포 중 순단을 없애고 싶었을 뿐인데","categories":"etc CS","author":"써머","emoji":"headers/dns-error-eia-again.png"},"fields":{"slug":"/dns-error-eia-again/"}},"site":{"siteMetadata":{"siteUrl":"https://hyewoncc.github.io","comments":{"utterances":{"repo":"hyewoncc/hyewoncc.github.io"}}}}},"pageContext":{"slug":"/jpa-transactional/","nextSlug":"/weird-side-job-1/","prevSlug":"/dns-error-eia-again/"}},"staticQueryHashes":["1073350324","1956554647","2938748437","3350743975"],"slicesMap":{}}